{"version":2,"ops":[{"type":6,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1618260611,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDo1MjIyMzQxNTE="},"target":"a28a180c085a022083f041980153126d98d352c7f85b2d70236681b116b2003e","message":"I'm not able to reopen an issue so opening a new one\n\n@yarikoptic - I followed your instruction, clicking copy-paste etc, and I succeeded to get the url, but I have the same error as in #550:\n\n```\n(dandi_dev) yasah:dandi-cli dorota$ dandi download https://api.dandiarchive.org/api/dandisets/010006/versions/draft/assets/3442ac20-595a-4b47-83cf-78da1495bf06/download/\n2021-04-12 14:09:39,851 [ WARNING] A newer version (0.13.1) of dandi/dandi-cli is available. You are using 0.10.0+461.gc57717c\n2021-04-12 14:09:40,361 [    INFO] Logs saved in /Users/dorota/Library/Logs/dandi-cli/20210412180939Z-29364.log\nError: 'asset_id'\n```\n\n**edit**\nIt's the same error, but it's different than #550","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618255778,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODA3NTQyMA==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818075420"},"message":"It appears that the asset metadata on the server was changed to store the asset ID in an `\"identifier\"` field instead of `\"asset_id\"`.  @satra When did that happen?  I though you had yet to make that change.  Moreover, why I am not notified when API changes like this happen?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1618259583,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODE4ODMxMw==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818188313"},"message":"Eh, too many ids ;)  I think this one has nothing to do with `identifier` -\u003e `identifier + @id` change which is yet to come, and probably just some not unittested (within `dandi-cli`) use-case and a true bug?\nNow that we have dandi-cli tests ran as part of the dandi-api CI, as long as we have a test for it - should not go by unnoticed.  May be we just indeed need the fix @djarecka implemented in https://github.com/dandi/dandi-cli/pull/552/files and which I (prematurely) closed?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618260045,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODIwNDA0NA==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818204044"},"message":"@yarikoptic That patch is doing entirely the wrong thing.  The root of the problem is that the asset structures returned by `/dandisets/{versions__dandiset__pk}/versions/{versions__version}/assets/` and `…/assets/{asset_id}/` are not compatible, as they use different names for the same fields.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618260058,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDUxMTQwNjA1"},"target":"dac2fcb1f54e9aa2820e609ea870f2fcecdeca89264db11a6766a3d8599f9eec","message":"@yarikoptic That patch is doing entirely the wrong thing.  The root of the problem in this issue is that the asset structures returned by `/dandisets/{versions__dandiset__pk}/versions/{versions__version}/assets/` and `…/assets/{asset_id}/` are not compatible, as they use different names for the same fields.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1618260123,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODIwNjY0Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818206647"},"message":"do you see a straightforward way to support both and add a test for both end points?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618260215,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODIwOTg1NA==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818209854"},"message":"@yarikoptic My preferred solution would be for the API to make its return values consistent (e.g., by making `…/assets/` return a paginated list of asset metadata) so that the client only needs to know about a single set of field names.","files":null},{"type":2,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1618260560,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDU4NDUyNjIxNg=="},"title":"issue with download","was":"issue with download"},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1618261000,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODIzMTYzMg==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818231632"},"message":"I've changed the title because it looks like it's indeed different than #550. But I believe it shows my point I was making about the tests -- the `parse_dandi_url(url)` does not raise any error but `download` does","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1618261730,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODIzODY5MA==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818238690"},"message":"\u003e (e.g., by making `…/assets/` return a paginated list of asset metadata)\n\nthat would be unnecessarily expensive since the idea IIRC was to not return metadata in the listing, and return metadata for individual records.  And since the URL in the original issue description is the one which users would copy-paste from the browser, we better support it in the dandi-cli.\n\nBut I am not sure why it has anything to do with what API returns @jwodder? we should use those urls only to parse them up to identify the dandiset and possibly assets (i.e. a singular asset for such a URL) to download.  Then based on that parsed information we  compose the download urls (possibly reconstructing the original url in this case).  So it seems that we just do not correctly identify that it is a URL for a singular asset (and not a path with multiple assets)","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1618261758,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDUxMTQ5MTA0"},"target":"629bc05c8c77b1e53985e4e82f61184513af8cfdcb569f77fe63dbfdacd7504d","message":"\u003e (e.g., by making `…/assets/` return a paginated list of asset metadata)\n\nthat would be unnecessarily expensive since the idea IIRC was to not return metadata in the listing, and return metadata only for for individual asset endpoint.  And since the URL in the original issue description is the one which users would copy-paste from the browser, we better support it in the dandi-cli.\n\nBut I am not sure why it has anything to do with what API returns @jwodder? we should use those urls only to parse them up to identify the dandiset and possibly assets (i.e. a singular asset for such a URL) to download.  Then based on that parsed information we  compose the download urls (possibly reconstructing the original url in this case).  So it seems that we just do not correctly identify that it is a URL for a singular asset (and not a path with multiple assets)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1618264990,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODI3MjIxMg==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818272212"},"message":"\u003e But I believe it shows my point I was making about the tests -- the `parse_dandi_url(url)` does not raise any error but `download` does\n\nwell -- we (tried to?;-)) decoupled the 1. parsing of url, 2. operation on what was parsed, so we do not need to test full combinatorial combination of parse + operation.  parsing has its own tests and operations are tested on some set of URLs.  In this particular case (didn't check though) I think parsing is buggy and missing test for this usecase.","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1618266949,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODI4NzY4NA==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818287684"},"message":"@yarikoptic - decoupling is great, but I would still vote for adding any tests for `download` (or `download_generator`, `navigate_url`) for `server_type == \"api\"`...","files":null},{"type":6,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1618267152,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDUxMTc0NjA1"},"target":"16bfa3ddc83b9390f630a605be14a6677565315fa29d808d43f4368e26b608be","message":"@yarikoptic - decoupling is great, but I would still vote for adding any tests for `download` (or `download_generator`, `navigate_url`) for `server_type == \"api\"`. not really sure what is controversial...","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618320056,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxODczMDYyOA==","github-url":"https://github.com/dandi/dandi-cli/issues/557#issuecomment-818730628"},"message":"@yarikoptic I can change the code to get the asset ID directly from the URL when present, but the difference in return structures from `navigate_url()` depending on the format of the URL will still lead to issues with the `ls` command and may cause other problems later on up until a proper asset class is created for #447.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1618333072,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDU4OTI1MzAzOQ=="},"status":2}]}