{"version":2,"ops":[{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1656982572,"metadata":{"github-id":"UCE_lAHODBZtRc5NG8MJzjBxce4"},"target":"325a22169fed2471bde26abf6ec76e4fe8d7ef88406469654c15825af8cc12d6","message":"Apparently it's now a subcommand and DANDI tests will fail with newer docker which no longer provides the `docker-compose` alias. Tried to update our code myself but thus far no luck.","files":null},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1656982884,"metadata":{"github-id":"IC_kwDODBZtRc5GAUII","github-url":"https://github.com/dandi/dandi-cli/issues/1042#issuecomment-1174487560"},"message":"Just the background on what I tried:\n\n```\ndiff --git a/dandi/tests/fixtures.py b/dandi/tests/fixtures.py\nindex 50c0688..7be003f 100644\n--- a/dandi/tests/fixtures.py\n+++ b/dandi/tests/fixtures.py\n@@ -233,14 +233,14 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n     try:\n         if create:\n             run(\n-                [\"docker-compose\", \"run\", \"--rm\", \"django\", \"./manage.py\", \"migrate\"],\n+                [\"docker compose\", \"run\", \"--rm\", \"django\", \"./manage.py\", \"migrate\"],\n                 cwd=str(LOCAL_DOCKER_DIR),\n                 env=env,\n                 check=True,\n             )\n             run(\n                 [\n-                    \"docker-compose\",\n+                    \"docker compose\",\n                     \"run\",\n                     \"--rm\",\n                     \"-e\",\n@@ -259,7 +259,7 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n\n         r = check_output(\n             [\n-                \"docker-compose\",\n+                \"docker compose\",\n                 \"run\",\n                 \"--rm\",\n                 \"-T\",\n@@ -281,7 +281,7 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n\n         if create:\n             run(\n-                [\"docker-compose\", \"up\", \"-d\", \"django\", \"celery\", \"redirector\"],\n+                [\"docker compose\", \"up\", \"-d\", \"django\", \"celery\", \"redirector\"],\n                 cwd=str(LOCAL_DOCKER_DIR),\n                 env=env,\n                 check=True,\n@@ -299,7 +299,7 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n         yield {\"django_api_key\": django_api_key}\n     finally:\n         if persist in (None, \"0\"):\n-            run([\"docker-compose\", \"down\", \"-v\"], cwd=str(LOCAL_DOCKER_DIR), check=True)\n+            run([\"docker compose\", \"down\", \"-v\"], cwd=str(LOCAL_DOCKER_DIR), check=True)\n\n\n @dataclass\ndiff --git a/dandi/tests/skip.py b/dandi/tests/skip.py\nindex 7fed758..5de64a0 100644\n--- a/dandi/tests/skip.py\n+++ b/dandi/tests/skip.py\n@@ -101,7 +101,7 @@ from ..utils import on_windows as _on_windows\n\n def no_docker_commands():\n     missing_cmds = []\n-    for cmd in (\"docker\", \"docker-compose\"):\n+    for cmd in (\"docker\",):\n         if shutil.which(cmd) is None:\n             missing_cmds.append(cmd)\n     msg = \"missing Docker commands: {}\".format(\", \".join(missing_cmds))\n~\n```\n\nGave me `ERROR fixtures.py::test_whatamidoing1 - FileNotFoundError: [Errno 2] No such file or directory: 'docker compose'`","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1656982893,"metadata":{"github-id":"UCE_lALODBZtRc5GAUIIziTMwWM"},"target":"96f7f36a216e9ef27c1feee21c6c941d697cbfebc9eea8236ec0ffca02118c9c","message":"Just the background on what I tried:\n\n```diff\ndiff --git a/dandi/tests/fixtures.py b/dandi/tests/fixtures.py\nindex 50c0688..7be003f 100644\n--- a/dandi/tests/fixtures.py\n+++ b/dandi/tests/fixtures.py\n@@ -233,14 +233,14 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n     try:\n         if create:\n             run(\n-                [\"docker-compose\", \"run\", \"--rm\", \"django\", \"./manage.py\", \"migrate\"],\n+                [\"docker compose\", \"run\", \"--rm\", \"django\", \"./manage.py\", \"migrate\"],\n                 cwd=str(LOCAL_DOCKER_DIR),\n                 env=env,\n                 check=True,\n             )\n             run(\n                 [\n-                    \"docker-compose\",\n+                    \"docker compose\",\n                     \"run\",\n                     \"--rm\",\n                     \"-e\",\n@@ -259,7 +259,7 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n\n         r = check_output(\n             [\n-                \"docker-compose\",\n+                \"docker compose\",\n                 \"run\",\n                 \"--rm\",\n                 \"-T\",\n@@ -281,7 +281,7 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n\n         if create:\n             run(\n-                [\"docker-compose\", \"up\", \"-d\", \"django\", \"celery\", \"redirector\"],\n+                [\"docker compose\", \"up\", \"-d\", \"django\", \"celery\", \"redirector\"],\n                 cwd=str(LOCAL_DOCKER_DIR),\n                 env=env,\n                 check=True,\n@@ -299,7 +299,7 @@ def docker_compose_setup() -\u003e Iterator[Dict[str, str]]:\n         yield {\"django_api_key\": django_api_key}\n     finally:\n         if persist in (None, \"0\"):\n-            run([\"docker-compose\", \"down\", \"-v\"], cwd=str(LOCAL_DOCKER_DIR), check=True)\n+            run([\"docker compose\", \"down\", \"-v\"], cwd=str(LOCAL_DOCKER_DIR), check=True)\n\n\n @dataclass\ndiff --git a/dandi/tests/skip.py b/dandi/tests/skip.py\nindex 7fed758..5de64a0 100644\n--- a/dandi/tests/skip.py\n+++ b/dandi/tests/skip.py\n@@ -101,7 +101,7 @@ from ..utils import on_windows as _on_windows\n\n def no_docker_commands():\n     missing_cmds = []\n-    for cmd in (\"docker\", \"docker-compose\"):\n+    for cmd in (\"docker\",):\n         if shutil.which(cmd) is None:\n             missing_cmds.append(cmd)\n     msg = \"missing Docker commands: {}\".format(\", \".join(missing_cmds))\n~\n```\n\nGave me `ERROR fixtures.py::test_whatamidoing1 - FileNotFoundError: [Errno 2] No such file or directory: 'docker compose'`","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1656985672,"metadata":{"github-id":"IC_kwDODBZtRc5GAaT3","github-url":"https://github.com/dandi/dandi-cli/issues/1042#issuecomment-1174512887"},"message":"@TheChymera You need to split \"docker\" and \"compose\" into separate arguments.","files":null},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658934838,"metadata":{"github-id":"LE_lADODBZtRc5NG8MJzwAAAAGlo3_b"},"added":["tests"],"removed":[]},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1685459971,"metadata":{"github-id":"IC_kwDODBZtRc5df2EX","github-url":"https://github.com/dandi/dandi-cli/issues/1042#issuecomment-1568629015"},"message":"@yarikoptic as part of issue triaging, should we revisit https://github.com/dandi/dandi-cli/pull/1168 ? Or perhaps we could migrate to podman fully? @asmacdo","files":null},{"type":4,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1723486650,"metadata":{"github-id":"CE_lADODBZtRc5NG8MJzwAAAAM5tQrP"},"status":2},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1723486686,"metadata":{"github-id":"IC_kwDODBZtRc6ILN07","github-url":"https://github.com/dandi/dandi-cli/issues/1042#issuecomment-2284641595"},"message":"fixed by https://github.com/dandi/dandi-cli/pull/1465","files":null}]}