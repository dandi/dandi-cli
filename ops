{"version":2,"ops":[{"type":1,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1642454410,"metadata":{"github-id":"I_kwDODBZtRc5B8FKX","github-url":"https://github.com/dandi/dandi-cli/issues/869","origin":"github"},"title":"Login when downloading embargoed dandisets","message":"When testing embargoed upload I had some problems with authentication. I was using a fresh installation (so no existing login info) and trying to upload a a new embargoed dandiset.\nNormally the first step to upload data is to do a `dandi download` of the dandiset to initialize the directory, but when you `dandi download` an embargoed dandiset, it gives an error 404. This is expected as the dandiset is not visible to unauthenticated users, but the CLI does not prompt the user to log in.\n\nI resolved the issue by specifying `DANDI_API_KEY` as an environment variable, but the UX around that isn't great. \n\nSome options:\n* Add a `dandi login` command that prompts the user for their API key and saves it in the keyring for later use. In whatever embargo documentation we have, tell users that they should run that if it ever appears that their embargoed dandisets do not exist. Perhaps print a warning to that effect in the 404 error message in the CLI.\n* As discussed in https://github.com/dandi/dandi-cli/issues/867#issuecomment-1014737524, require an `--embargoed` flag that ensures the user is authenticated whenever dealing with embargoed dandisets.\n* Make the API server return error 401 unauthorized instead of 404 not found for embargoed dandisets. When the CLI encounters that 401 it should prompt for login. For various reasons this isn't very convenient in Django, but it can be done.\n\nattn @yarikoptic","files":null}]}