{"version":2,"ops":[{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1601650219,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDcwMjc3OTEyMg==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-702779122"},"message":"we could also have a datasets module that fetches relevant dandisets similar to keras/scikit-learn\n\nbut we should also consider a dandiset object and an asset object that allows extraction of data and metadata and eventually hands of to pynwb or nibabel or other things.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1613757672,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjI0MDA1Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782240057"},"message":"I've been writing up my own thoughts on a Python API [here](https://gist.github.com/jwodder/9b9c251cb1dafe1e7d66e53887739663) (work in progress).  The main points are that (a) the new API should be accessed via dedicated Dandiset, Version, and Asset classes instead of entirely though the client class, and (b) upload \u0026 download functions should come in sets of two or three: one version blocks until everything is complete, while the other versions are (a)synchronous iterators over progress data.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1613758647,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjI0OTg3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782249879"},"message":"THANK YOU @jwodder, I will try to digest your thoughts later on (if you think it is time).  Let me just note: I wonder if it is worth dealing with asyncio for our case: on one hand it makes total sense, but due to fiascos we keep discovering in datalad (e.g. impossibility to have[ async/sync/async nesting](https://bugs.python.org/issue33523#msg349561)) thus likely us needing to have/support two implementations: async + blocking + `iter_`, where `blocking` one could probably be just a helper on top of  `iter_` thus avoiding need for duplicated implementations.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1613760866,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjI3MjY0NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782272645"},"message":"On the OP, my only comment at the moment is that I dislike the idea of a function that returns its results as a generator, list, or scalar depending on a parameter.  Such a function would be better off always returning a generator, and then functions that wrap that function to return other types can be added depending on how useful or complex they are.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1613763510,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjI5NzE3NA==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782297174"},"message":"On the topic of functions returning structured records that can then be fed to various formatters:\n* The iterable download \u0026 upload functions (and possibly also the organize function) should return iterators of formattable records, which can then be fed to a formatter for display.\n* For listing assets, normal listing of assets (returning `Asset`/`LocalAsset` objects) should be done through `Version.get_all_assets()`, `LocalDandiset.iter_assets()`, and the like.  Emulating the display of the `dandi ls` command should be done through an `ls()` function that wraps these methods and returns an iterator of formattable records.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1613765919,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjMxNzQ5MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782317491"},"message":"Agree on returns.  Not sure about `Version` -- is that a versioned `Dandiset`? I would have just made any `Dandiset` versioned (even if only just with a `\"draft\"` or better even `None`  version)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1613766110,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjMyMDc4Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782320787"},"message":"@yarikoptic `Version` is here a version of a Dandiset retrieved from the API.  A Dandiset and its versions are different types of resources with their own fields (especially as far as the Django API is concerned) and thus should be represented by different classes.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1613767077,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MjMzMDk2MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-782330961"},"message":"So relates to https://github.com/dandi/dandi-cli/issues/236 I guess.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614113064,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDQ5ODg5OA==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-784498898"},"message":"Although I see it nice to have Python API to \"parallel\" web API, I am not sure if making Python API parallel web API  too closely would make Python API a victim if web API changes, and just make Python API a bit odd to use while working solely in Python. And as far as I see it, you already \"broke\" (which is not a bad thing, per above) such a \"parallel\".  E.g. return structures of web API are heavily inflicted by underlying design/tables: e.g. `Version.identifier` you envisioned (and which is reasonable to have if `Version` is a \"version of a dandiset\") already needs to be \"proxied\" from the underlying `.dandiset.identifier` (and that is pretty much so in every data structure since API returns \"dandiset\" record in all similar cases). (May be that underlying rudimentary dandiset record could be a `BareDandiset`, and hide in `._bare_dandiset`, or alike if we need a structure/type?).\n\nAlso, whenever API has the composition of \"dandiset + version\" reflected in the query URL, we would not have that in Python API, and for a user seeing a `Version` object would be odd.  So am \"Luke warm\" about a bare (in name) `Version`. In the API the notion of a \"dandiset\" (table)  is somewhat of a \"Dandiset Entity\" or \"Dandiset Versions\" -- it is where all the versions of the particular dandiset reside. From a user perspective the `Version` is actually a specific versioned (even if it is a draft) Dandiset.  So I wonder if we should make it `DandisetVersions` (for what is `Dandiset` in your gist) and then a `Dandiset` (and `DraftDandiset`) for `Version` (and corresponding `DraftVersion`)? (note: there is no need for `Version.dandiset` if I see it right since `.identifier` should indeed be proxied up, although may be internally keep that `._bare_dandiset` record?).\n\nThen proposed methods could reflect that and provide high(er) level constructs, e.g. proposed\n```python\ncreate_dandiset(name: str, metadata: DandiMeta) -\u003e Dandiset\n```\nwould become\n```python\ncreate_dandiset(name: str, metadata: DandiMeta) -\u003e DraftDandiset\n```\nmaking a ready to be interacted with `DraftDandiset` (not just some top level dandisets table record).  And retain `get_dandiset(version: str)` to return a `Dandiset` (or DraftDandiset if `version=='draft'`), again as to provide users with an easy to use Python API to address their use cases.\n\nWDYT @jwodder?  altogether -- I think you are on the right track and it would be great to see it implemented, and we could tune going forward.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614116538,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDUzMjY1Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-784532656"},"message":"@yarikoptic For the record, `Version.identifier` is meant to be the version's `version_id`/\"version\" field, not the Dandiset ID (which would be retrieved through `Version.dandiset.identifier`).\n\nI'm theoretically fine with renaming `Dandiset` and `Version` to `DandisetVersions` (or similar) and `Dandiset`, though I feel that might lead to some confusing or conflicting names elsewhere; do `dandiset_id` and `version_id` become `dandiset_versions_id` and `dandiset_id`?  Would we now have a `get_dandiset_versions()` method that returned a single object despite having a plural name?  What would we call the method for getting all `DandisetVersions`es?\n\n\u003e I am not sure if making Python API parallel web API too closely would make Python API a victim if web API changes\n\nCurrently, the client class already parallels the API in its methods, but without any Python-level guarantees about the structure of return values.  If the web API changes, code is going to change no matter what:\n\n* Adding, removing, \u0026 renaming endpoints is about the same amount of effort the OO way and the God Class way.\n* If the structure of the objects returned by the API changes, classes would still be able to maintain their interfaces through properties and the like.  If we stuck with just returning dicts from the client class instead, we'd need functions to completely rearrange the dicts into their old forms in order to avoid breaking any calling code.\n* If the API completely changes its resource types from dandiset+version+asset to something else, the code would need massive rewrites either way.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614288914,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NjI0MzQ5Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-786243497"},"message":"\u003e For the record, `Version.identifier` is meant to be the version's `version_id`/\"version\" field\n\ndo you mean the \"published version\", like `0.210225.1423` now?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614289008,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NjI0NDMxNw==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-786244317"},"message":"@yarikoptic Right, or \"draft\" for draft versions.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614298726,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NjMxOTcwMg==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-786319702"},"message":"May be my brain is too \"git rotten\" but making parallels to it instead of the API internal design make more sense to me and I think would be easier for users.  What about melding current `Version` to become an inherent property of a `Dandiset` and adding ability to \"switch\" versions?  Names can change, but I decided to make the base class named `Dandiset` to signal that any `.get_dandiset` (or `.dandiset`) would return a `Dandiset` (or its subclass).\n\nSo what about the following:\n\n- `Version` -- just that, the information about version with `.identifier: str`, `.created: date`, without back-referencing the dandiset itself. Largely to be used as an argument to specify desired version. (we might later expand it with `.description` to provide release description, etc. so should not succumb to make it just a str probably)\n- `Dandiset` - the base/interface class. Defines abstract `.identifier`, `.created`, `.modified`, `version: Version`, `.get_*assets`, `get_metadata`\n   - `RemoteDandiset(Dandiset)` - what the `Version` is now; does not have any `.dandiset`, but gets `.api_server` (for direct interactions with the server via its API interface), and  `get_versions: Iterator[Version]`, `get_version(Union[str, Version]) -\u003e Union[RemoteDandiset, DraftDandiset])`, `get_asset_by_uuid` (not provided by `LocalDandiset`)\n       - `DraftDandiset(RemoteDandiset)` - gains all the \"mutator\" methods + `publish`.    `.version == \"draft\"`\n   - `LocalDandiset(Dandiset)` - it might as well have a `.version` if its `dandiset.yaml` contains one. Assets will be `BareAsset`s\n      - `DataLadDandiset(LocalDandiset)` - would get closer to `Dandiset` in being able to switch versions etc (we might want to define some mixin interface class even at some point), while otherwise delegating the rest to `.dataset: datalad.Dataset`\n\nPS\n- may be we should rename in metadata `BareAssetMeta`, `AssetMeta` -\u003e `AssetMeta`, `RemoteAssetMeta` to make a parallel?\n- If we did not use \"Publish\" as \"Release\" (version a published instance, make it immutable), then we could have made a better parallel to Datalad where `publish` == `push` or \"make it public\" (not just local).  Then `Remote` above for a Dandiset or Asset could be `Published` which would be more harmonious. `PublishedAsset` would get its `contentUrl`, `uuid` etc.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614349258,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NjY3NTg0NA==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-786675844"},"message":"@yarikoptic Looks like a good idea.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614791381,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTg5MjE2Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-789892163"},"message":"@yarikoptic I've revised [the gist](https://gist.github.com/jwodder/9b9c251cb1dafe1e7d66e53887739663) with your suggestions and further changes \u0026 details.  Should I move this to [the repository wiki](https://github.com/dandi/dandi-cli/wiki) so that you can edit it as well?","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614791381,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDM5NjY0Nzcz"},"target":"3272af0b00a9c33e3c917b28ead06070d965a75381d2d893d3e5f42976de507f","message":"@yarikoptic I've revised [the gist](https://gist.github.com/jwodder/9b9c251cb1dafe1e7d66e53887739663) with your suggestions and further changes \u0026 details.  Some things still need decisions made.  Should I move this to [the repository wiki](https://github.com/dandi/dandi-cli/wiki) so that you can edit it as well?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614811967,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc5MDEzMDAwNg==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-790130006"},"message":"What about a PR with that file eg under `doc/design/python-api-1.md` - that probably would make it easier to comment/discuss/refine?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614812322,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc5MDEzMjkxOA==","github-url":"https://github.com/dandi/dandi-cli/issues/249#issuecomment-790132918"},"message":"@yarikoptic PR: https://github.com/dandi/dandi-cli/pull/447","files":null},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1616599397,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ1MDI2MTg1NzM="},"added":["waiting"],"removed":[]}]}