{"version":2,"ops":[{"type":6,"author":{"id":"adccd23cf679e6fb55b1c23d1d08cb100dec6f4e"},"timestamp":1658168083,"metadata":{"github-id":"UCE_lAHODBZtRc5N-7PlzjEU5Wg"},"target":"f5e421b3ce04df22141e53725dddc6bf113cdb1936f0a4323cfa7b4558e735f9","message":"Attempt to run dandi upload leading to indefinite stalling. At first I thought it may be due to output not piping correctly, but logs revealed no activity.\n\nOn version 0.45.1\n\nCommand\n`DANDI_DEVEL=1 dandi upload --validation skip --allow-any-path ./`\nWithin directory contain ome.zarr files for upload\n\nLog in it's entirety\n```\n2022-07-18T14:09:44-0400 [INFO    ] dandi 15159:139926543738688 dandi v0.45.1, hdmf v1.5.4, pynwb v1.2.1, h5py v2.10.0\n2022-07-18T14:09:44-0400 [INFO    ] dandi 15159:139926543738688 sys.argv = ['/mnt/beegfs/satra/miniconda3/envs/dandi/bin/dandi', 'upload', '--validation', 'skip', '--allow-any-path', './']\n2022-07-18T14:09:44-0400 [INFO    ] dandi 15159:139926543738688 os.getcwd() = /mnt/beegfs/Lee/dandi/sub-MITU01/ses-20211111h11m08s18/micr\n2022-07-18T14:09:45-0400 [DEBUG   ] urllib3.connectionpool 15159:139926543738688 Starting new HTTPS connection (1): rig.mit.edu:443\n2022-07-18T14:09:45-0400 [DEBUG   ] urllib3.connectionpool 15159:139926543738688 https://rig.mit.edu:443 \"GET /et/projects/dandi/dandi-cli HTTP/1.1\" 200 579\n2022-07-18T14:09:45-0400 [DEBUG   ] dandi 15159:139926543738688 No newer (than 0.45.1) version of dandi/dandi-cli found available\n2022-07-18T14:10:21-0400 [INFO    ] dandi 15159:139926543738688 Logs saved in /home/smarx/.cache/dandi-cli/log/20220718180944Z-15159.log\n```","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658173526,"metadata":{"github-id":"IC_kwDODBZtRc5G0u8c","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188228892"},"message":"@slaytonmarx - does the behavior change if you just use `.` instead of the `./`","files":null},{"type":3,"author":{"id":"adccd23cf679e6fb55b1c23d1d08cb100dec6f4e"},"timestamp":1658175359,"metadata":{"github-id":"IC_kwDODBZtRc5G02P1","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188258805"},"message":"Unfortunately not :(","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658175666,"metadata":{"github-id":"IC_kwDODBZtRc5G03qc","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188264604"},"message":"@jwodder - any ideas what would cause this behavior? is it doing something but not logging?\n\n@slaytonmarx - can you post which session/folder you are doing this in? i can also try it. (please do kill those processes)","files":null},{"type":3,"author":{"id":"adccd23cf679e6fb55b1c23d1d08cb100dec6f4e"},"timestamp":1658175705,"metadata":{"github-id":"IC_kwDODBZtRc5G03zE","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188265156"},"message":"Yes!\n\nses-20211111h11m08s18\n\n`/mnt/beegfs/Lee/dandi/sub-MITU01/ses-20211111h11m08s18/micr`","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658176142,"metadata":{"github-id":"IC_kwDODBZtRc5G053N","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188273613"},"message":"could you try `cd /mnt/beegfs/Lee/dandi/; DANDI_DEVEL=1 dandi upload --validation skip --allow-any-path sub-MITU01/ses-20211111h11m08s18/micr` instead?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658177437,"metadata":{"github-id":"IC_kwDODBZtRc5G0_in","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188296871"},"message":"i can confirm the behavior. in fact even this command hangs:\n\n\u003e DANDI_DEVEL=1 dandi -l DEBUG --pdb upload --validation skip --allow-any-path sub-MITU01/ses-20211111h11m08s18/micr/sub-MITU01_ses-20211111h11m08s18_sample-11_photo.jpg","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658177762,"metadata":{"github-id":"IC_kwDODBZtRc5G1ApH","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188301383"},"message":"oh... \"hangs\".  It might not be \"hanging\" but still \"navigating\" the filesystem to find bids datasets... since network and .zarrs -- may be taking awhile.  I have ran also and now observing the thing to be at\n\n```\nleviathan:~\n$\u003e ls -l /proc/37865/fd/\ntotal 0\n0 lrwx------ 1 yoh chunglab 64 Jul 18 16:54 0 -\u003e /dev/pts/2\n0 lrwx------ 1 yoh chunglab 64 Jul 18 16:54 1 -\u003e /dev/pts/2\n0 lrwx------ 1 yoh chunglab 64 Jul 18 16:54 2 -\u003e /dev/pts/2\n0 lr-x------ 1 yoh chunglab 64 Jul 18 16:54 3 -\u003e /dev/urandom\n0 l-wx------ 1 yoh chunglab 64 Jul 18 16:54 4 -\u003e /home/yoh/.cache/dandi-cli/log/20220718203715Z-37865.log\n0 lr-x------ 1 yoh chunglab 64 Jul 18 16:54 5 -\u003e /mnt/beegfs/Lee/dandi/sub-MITU01/ses-20220310h10m08s20/micr/sub-MITU01_ses-20220310h10m08s20_sample-19_stain-YO_run-1_chunk-7_SPIM.ome.zarr/sub-MITU01_ses-20220310h10m08s20_sample-19_stain-YO_run-1_chunk-7_SPIM.ngff/0/0/0/14/15/\n```\n\nso -- we should stop navigating deeper than into .ngff (BTW -- how come there is .ngff -- should be .ome.zarr, right?) or .ome.zarr subfolders.... I will propose PR in a minute.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658177957,"metadata":{"github-id":"IC_kwDODBZtRc5G1BSq","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188304042"},"message":"is there a reason why it's navigating anything other than going up to find dandiset.yaml when a specific path is provided (for example the jpg command above).","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658178090,"metadata":{"github-id":"IC_kwDODBZtRc5G1Bx4","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188306040"},"message":"also why is it trying to find bids datasets with both `--validation skip --allow-any-path`. either should prevent any search.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658179411,"metadata":{"github-id":"IC_kwDODBZtRc5G1Gnq","github-url":"https://github.com/dandi/dandi-cli/issues/1069#issuecomment-1188325866"},"message":"\u003e is there a reason why it's navigating anything other than going up to find dandiset.yaml when a specific path is provided (for example the jpg command above).\n\nnot yet sure about why it is navigating that much BUT it is not about dandiset.yaml -- we look for BIDS datasets **under** the path(s) and validate them. E.g. think about 000026.\n\n\u003e also why is it trying to find bids datasets with both `--validation skip --allow-any-path`. either should prevent any search.\n\nIn principle \"yes\" with --allow-any-path but currently code finds BIDS datasets to decide either to allow upload files other than .nwb (but there is https://github.com/dandi/dandi-cli/issues/1055 so YMMV ;)).\n\nAnyways -- hold there, I will propose a fix to avoid navigating too deep.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658248821,"metadata":{"github-id":"CE_lADODBZtRc5N-7PlzwAAAAGikFu5"},"status":2}]}