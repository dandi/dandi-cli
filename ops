{"version":2,"ops":[{"type":1,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1620608996,"metadata":{"github-id":"MDU6SXNzdWU4ODMxMDcwMjk=","github-url":"https://github.com/dandi/dandi-cli/issues/625","origin":"github"},"title":"Different ways of validating dandiset metadata","message":"i'm doing optional injections only to show other types of errors when known issues are taken into account.\n\n```python\nimport requests\nimport json\nimport jsonschema\ndef get_dandisets():\n   url = f\"https://api.dandiarchive.org/api/dandisets\"\n   querystring = {\"page_size\":\"100\"}\n   headers = {\"Accept\": \"application/json\"}\n   resp = requests.request(\"GET\", url, headers=headers, params=querystring).json()\n   results = resp[\"results\"]\n   while resp[\"next\"]:\n       resp = requests.request(\"GET\", resp[\"next\"], headers=headers).json()\n       results.extend(resp[\"results\"])\n   assert len(results) == resp[\"count\"]\n   return results\ndandisets = get_dandisets()\nmetadata = {}\nfor dandiset in dandisets:\n    url = f\"https://api.dandiarchive.org/api/dandisets/{dandiset['identifier']}/versions/draft\"\n    headers = {\"Accept\": \"application/json\"}\n    resp = requests.request(\"GET\", url, headers=headers).json()\n    metadata[dandiset[\"identifier\"]] = resp\n\nwith open(\"../tmp/schema/0.3.0/dandiset.json\") as fp:\n    schema = json.load(fp)\n\nfrom dandi.models import DandisetMeta\ninject = False  # doesn't include some known missing fields\n\n# using model\nfor val in metadata.values:\n    base = {}\n    if inject:\n        base = dict(version=\"draft\", license=[\"spdx:CC0-1.0\"], contributor=[{\"schemaKey\": \"Person\", \"name\": \"Last, First\", \"roleName\": ['dandi:ContactPerson']}], id=\"fancyid\")\n    base.update(**val)\n    try:\n        DandisetMeta(**base)\n    except ValidationError as e:\n        print(val[\"identifier\"], str(e))\n\n# using json schema\nfor val in metadata.values():\n    base = {}\n    if inject:\n        base = dict(version=\"draft\", license=[\"spdx:CC0-1.0\"], contributor=[{\"schemaKey\": \"Person\", \"name\": \"Last, First\", \"roleName\": ['dandi:ContactPerson']}], id=\"fancyid\")\n    base.update(**val)\n    try:\n        jsonschema.validate(base, schema)\n    except jsonschema.ValidationError as e:\n        print(val[\"identifier\"], e.message)\n\n```","files":null}]}