{"version":2,"ops":[{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612194966,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MDk1OTM1Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-770959357"},"message":"could you provide an exact command \n\n\u003cdetails\u003e\n\u003csummary\u003ecannot reproduce on a local copy\u003c/summary\u003e \n\n```shell\n(git-annex)lena:~/proj/dandi/dandisets/000008[master]git\n$\u003e datalad get sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb\nget(ok): sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb (file) [from web...]   \n(dev3) 1 54696 [1].....................................:Mon 01 Feb 2021 10:53:08 AM EST:.\n(git-annex)lena:~/proj/dandi/dandisets/000008[master]git\n$\u003e dandi ls sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb\n/usr/lib/python3/dist-packages/hdmf/spec/namespace.py:484: UserWarning: Ignoring cached namespace 'hdmf-common' version 1.1.3 because version 1.3.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n/usr/lib/python3/dist-packages/hdmf/spec/namespace.py:484: UserWarning: Ignoring cached namespace 'core' version 2.1.0 because version 2.2.5 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n- age: P98D\n  cell_id: 20181207_sample_1\n  date_of_birth: 2018-08-31 00:00:00-04:00\n  experiment_description: Current clamp square\n  experimenter:\n  - Matteo Bernabucci\n  genotype: Pvalb-Cre/wt; Ai9/wt\n  identifier: a4ec4579-5d87-4d0b-bcea-9da129b2d6ab\n  institution: Baylor College of Medicine\n  keywords: null\n  lab: Tolias\n  nd_types:\n  - CreSubject\n  - CurrentClampSeries (79)\n  - CurrentClampStimulusSeries (79)\n  - DandiIcephysMetadata\n  - Device (161)\n  - IZeroClampSeries\n  - IntracellularElectrode (160)\n  - SweepTable\n  number_of_electrodes: 0\n  number_of_units: 0\n  nwb_version: 2.1.0\n  path: sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb\n  related_publications: null\n  session_description: Current clamp square\n  session_id: 20181207_sample_1\n  session_start_time: 2018-12-07 00:00:00-05:00\n  sex: M\n  size: 9456345\n  slice_id: 20181207_slice_1\n  species: null\n  subject_id: mouse_ZZPUG\n2021-02-01 10:53:15,857 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20210201155313Z-411932.log\n\n```\n\u003c/details\u003e\n\ndandiset is available via datalad on http://github.com/dandisets/000008\n\nConfirming though that metadata is missing if tried on web UI : most likely there was an issue with extracting it when uploading, so was not uploaded, and we do not yet \"automagically\" re-extract on the server.  Not sure if that is something to fix on dandi-cli side.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612195005,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MDk1OTc4Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-770959783"},"message":"With migration to new API, we will reextract metadata anyways in a harmonized way across all dandisets, so that would be the point I guess where this particular file(s) would be fixed.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612195008,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDI3NDQ5NDMyMQ=="},"status":2},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1612197621,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MDk5MDEzNQ==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-770990135"},"message":"unless this migration takes place in the next week or two, we will need this metadata available in the current server. we are going to have to start fixing dandisets for the BICCN paper and this is one of them.","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1612198851,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MTAwNDMzMw==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-771004333"},"message":"the command I used: `ls -f json -r https://identifiers.org/DANDI:000008`\n\nThe output is long, but as an example, most look like this\n```\n{\"attrs\": {\"ctime\": \"2020-08-07T23:56:25.670000+00:00\", \"mtime\": \"2020-07-03T13:09:38.340000-04:00\", \"size\": 9389431}, \"girder\": {\"id\": \"5f2dea29ee8baa608594bafe\"}, \"metad\\\nata\": {\"ALM_VISp_top3\": \"pvalb reln tac1 (90.0%), pvalb reln itm2a (9.0%)\", \"RNA_family\": \"pvalb\", \"RNA_type\": \"pvalb calb1_2\", \"RNA_type_top3\": \"pvalb calb1_2 (58.0%), pv\\\nalb reln (27.7%), pvalb gpr149 (9.6%)\", \"age\": \"p98d\", \"cell_id\": \"20181207_sample_2\", \"date_of_birth\": \"2018-08-31T00:00:00-04:00\", \"experiment_description\": \"current cla\\\nmp square\", \"genotype\": \"pvalb-cre/wt; ai9/wt\", \"identifier\": \"390fcd5a-1ae9-4f8e-91a3-33c158b8c336\", \"institution\": \"baylor college of medicine\", \"lab\": \"tolias\", \"md5\": \\\n\"3ec1e752c25964bd1b2bfb9236badad0\", \"nwb_version\": \"2.1.0\", \"session_description\": \"current clamp square\", \"session_id\": \"20181207_sample_2\", \"session_start_time\": \"2018-1\\\n2-07T00:00:00-05:00\", \"sex\": \"m\", \"sha1\": \"323b8a7fd660c6d3a0abdd8f9d4cd543b25f097f\", \"sha256\": \"874ec74460efaead0c60366bf91ac67f313b0cb4f86a7bd89a1706e232e3eef3\", \"sha512\\\n\": \"e2f2a6cb6b6b92f0385f53314dd8d653b3f15d85b00b8c09cdf0af8b1547d5cf71620436d1cc717c63ea2f5dc47d8e54afc8e04f6ead4d38ed0cfdc9a57d4339\", \"slice_id\": \"20181207_slice_1\", \"sub\\\nject_id\": \"mouse_zzpug\", \"uploaded_datetime\": \"2020-08-07T19:56:22.214388-04:00\", \"uploaded_mtime\": \"2020-07-03T13:09:38.340000-04:00\", \"uploaded_nwb_object_id\": \"d62fd6f5\\\n-790a-4ad3-a0d1-c5c99b9caf1e\", \"uploaded_size\": 9389431}, \"modified\": \"2020-07-03 13:09:38.340000-04:00\", \"name\": \"sub-mouse-ZZPUG_ses-20181207-sample-2_slice-20181207-sli\\\nce-1_cell-20181207-sample-2_icephys.nwb\", \"path\": \"/sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181207-sample-2_slice-20181207-slice-1_cell-20181207-sample-2_icephys.nwb\", \"sha2\\\n56\": \"874ec74460efaead0c60366bf91ac67f313b0cb4f86a7bd89a1706e232e3eef3\", \"size\": 9389431, \"type\": \"file\"}\n```\n\nbut for `/sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb` it looks like this:\n```\n{\"attrs\": {\"ctime\": \"2020-08-07T23:45:04.947000+00:00\", \"size\": 9456345}, \"girder\": {\"id\": \"5f2de780ee8baa608594baa4\"}, \"metadata\": {}, \"modified\": \"2020-08-07 23:45:04.94\\\n7000+00:00\", \"name\": \"sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb\", \"path\": \"/sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181\\\n207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb\", \"size\": 9456345, \"type\": \"file\"}\n```\n\nso no `metadata`, no `sha256`","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612202739,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MTA0MzA4Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-771043087"},"message":"\u003e unless this migration takes place in the next week or two, we will need this metadata available in the current server. we are going to have to start fixing dandisets for the BICCN paper and this is one of them.\n\nI have doubts that we will accomplish migration that fast (even if it would work, and we could upload, we are still in flux on everything and new platform is untested) I guess we indeed need to resolve https://github.com/dandi/dandi-cli/issues/105 and just sweep through archive and upload all metadata according to the old idea of its schema... But then we would not be able to provide persistent URLs to the files since they might be gone with migration, or we don't need to do that for this metadata dump @satra ? (also \"publish\" functionality is ripped away from classical girder interface)\n\nIf we are to provide URLs, I wonder if we should add a redirector to \nAnyways -- for the files we","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612202739,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDMxMzI3ODU1"},"target":"11ec1042f0b07f76e8f55a3a254c6d73cb6d9c1f0b1808ab05c60e542fe5a7f4","message":"NB edited since reopened while editing\n\n\u003e unless this migration takes place in the next week or two, we will need this metadata available in the current server. we are going to have to start fixing dandisets for the BICCN paper and this is one of them.\n\nI have doubts that we will accomplish migration that fast (even if it would work, and we could upload, we are still in flux on everything and new platform is untested) I guess we indeed need to resolve https://github.com/dandi/dandi-cli/issues/105 and just sweep through archive and upload all metadata according to the old idea of its schema... But then we would not be able to provide persistent URLs to the files since they might be gone with migration, or we don't need to do that for this metadata dump @satra ? \nBut  \"publish\" functionality is ripped away from classical girder interface so we cannot really establish guaranteed to exist version, which is pretty much a pre-condition for establishing a permanently present versions of those datasets...  So it seems that if we need to provide links to the files, we need to mint a dataset version, and for that we are doomed to finish dandi-api migration at least on a set of those dandisets.\n\nA somewhat complimentary, but not an alternative, https://github.com/dandi/redirector/issues/37 -- I wonder if URLs should go through redirector (for centralized accounting, and seamless to the user possible API changes etc)?","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612202448,"metadata":{"github-id":"MDEzOlJlb3BlbmVkRXZlbnQ0Mjc1MTQzMDQ5"},"status":1},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612293760,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MTkxMDI3MA==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-771910270"},"message":"\u003e Can't get enough info about `/sub-mouse-ZZPUG/sub-mouse-ZZPUG_ses-20181207-sample-1_slice-20181207-slice-1_cell-20181207-sample-1_icephys.nwb` from `DANDI:000008` when running `dandi ls`: no `metadata`, no `sha256` etc.\n\u003e \n\u003e can't find this info also on website: https://gui.dandiarchive.org/#/dandiset/000021/draft/files?_id=5f2de703ee8baa608594ba82\u0026_modelType=folder\n\n\noh... almost started complaining against dandiarchive -- it is `000008` but then you @djarecka listed a url which has `000021` in it.  that webfrontend at large ignores that ID in the url since I guess it gets all the information based on the folder `_id`.  But I wonder -- how did you arrive with such a url (i.e. 21 instead of 8 in it) -- any recollection?    When I browse from https://gui.dandiarchive.org/#/dandiset/000008/draft to \"View Data\" I have the correct dataset id in the url: https://gui.dandiarchive.org/#/dandiset/000008/draft/files?_id=5f2de703ee8baa608594ba82\u0026_modelType=folder","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612297733,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MTk1OTA0Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-771959043"},"message":"ok, reporting, using the 370e57f57ce0394d35b2027378ac3df3e37c30b0 version of #355 which I had to tune to allow upload of metadata if remote file has no metadata at all (so we cannot compare mtime etc), I managed to screw up and remove that file from the archive.  I had it locally, hopefully of the correct version, so I just reuploaded.  Now that file has metadata record.  I then\n```\ndandi ls -f json_pp -r https://gui.dandiarchive.org/#/dandiset/000008/draft \u003e| /tmp/000008.ls\n```\nand verified that there is no empty metadata records with `grep -A1 '\"metadata\": {.*}' /tmp/000008.ls` and visually quickly checked that there is metadata record for each path with `grep -e '\"path' -e '\"metadata' /tmp/000008.ls` .  So I think we are all set for this one.  Please open a new issue @djarecka if you find other files like this.  Also I am still interested to possibly discover the answer to the question in the comment above","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612297733,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDI4MTUzNTQxMw=="},"status":2},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1612310082,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MjA5Njk5Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-772096996"},"message":"i was talking about `0008` not `0021`. When I run `dandi ls` now it gives me a different output for this one file i mentioned, so must have been updated","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1612310420,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MjA5OTE2Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-772099166"},"message":"I know that you are taking about 8 and not 21, but check url in your top message. And yes, file was updated","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1612310947,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc3MjEwMzMwNg==","github-url":"https://github.com/dandi/dandi-cli/issues/349#issuecomment-772103306"},"message":"oh yes, the link! I've just tried to repeat it and success!\n\n- open dandi archive `https://gui.dandiarchive.org/#/`\n- open `public dandisetssets`: https://gui.dandiarchive.org/#/dandiset\n- click on random one: https://gui.dandiarchive.org/#/dandiset/000003\n- click `view data`: https://gui.dandiarchive.org/#/dandiset/000003/draft/files?_id=5e6eb2b776569eb93f451f8d\u0026_modelType=folder\n- click on `drafts` folder and choose a different dandiset, e.g. 0008: https://gui.dandiarchive.org/#/dandiset/000003/draft/files?_id=5e7115073da50caa9adaf419\u0026_modelType=folder","files":null}]}