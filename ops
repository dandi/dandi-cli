{"version":2,"ops":[{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653506432,"metadata":{"github-id":"LE_lADODBZtRc5KbCZ-zwAAAAGOMI2Z"},"added":["UX"],"removed":[]},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653506432,"metadata":{"github-id":"LE_lADODBZtRc5KbCZ-zwAAAAGOMI2b"},"added":["performance"],"removed":[]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653591822,"metadata":{"github-id":"IC_kwDODBZtRc5D4nPR","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1138914257"},"message":"@yarikoptic Exactly which endpoints do you want this implemented for, and should those endpoints always use this?  Currently, the client paginates the following:\n\n* `/dandisets/`\n* `/dandisets/:id/versions/`\n* `/dandisets/:id/versions/:id/assets/`, with \u0026 without a `path` parameter","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653592554,"metadata":{"github-id":"IC_kwDODBZtRc5D4poS","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1138924050"},"message":"Let's do it at the generic level of pagination handling in `paginate`.\nThreading is fast, so let's do threaded fetching of pages \u003e=2 if overall there is more than 1 page.\nPlease add add a check that the `next` for the first returned result is in the expected form (`{base_url}?page=2`), and if not -- issue a WARNING and `if not os.environ.get(\"DANDI_PAGINATION_DISABLE_FALLBACK\", False)` -- continue serially with current implementation, and otherwise \n\n```python\nraise AssertionError(f'API changed the pagination strategy. \"next\" URL {fetched_next_url} is different from expected {next_url}')\n```\nor alike.\n\nThen in CI we could export DANDI_PAGINATION_DISABLE_FALLBACK in one of the matrix runs so we detect when/if API changes how pagination is done, and clients would still perform reliably even if pagination changes.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653661311,"metadata":{"github-id":"IC_kwDODBZtRc5D7fAb","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1139666971"},"message":"@yarikoptic I implemented this, and then I wrote a test that creates a Dandiset with a bunch of assets and paginates through them.  In order to ensure that there would be more than five pages even after https://github.com/dandi/dandi-archive/pull/1107 is merged, I set the number of assets to 617.  Unfortunately, uploading that many assets (even when they're tiny) takes too long for the test suite; the shortest amount of time I could get this down to was about 2 and a half minutes, and that was by foregoing `upload()` in favor of just calling `LocalAsset.upload()` directly (and parallelizing the uploads in a `ThreadPoolExecutor` only shaved off a couple seconds).\n\n(Threadedly paginating through the assets afterwards takes about 15 seconds, and that was using an earlier number of 1234 assets.)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653673009,"metadata":{"github-id":"IC_kwDODBZtRc5D8PRW","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1139864662"},"message":"can you upload 5 assets, and set page_size to 1 to get 5 pages?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653674536,"metadata":{"github-id":"IC_kwDODBZtRc5D8YP1","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1139901429"},"message":"@yarikoptic `get_assets()` doesn't have a `page_size` option; only `paginate()` does.   Should all the methods that call `paginate()` gain this option?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653676903,"metadata":{"github-id":"IC_kwDODBZtRc5D8gHG","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1139933638"},"message":"@yarikoptic Alternatively, `per_page` (and `lookahead`?) could be instance attributes of the client instead of method arguments.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653678772,"metadata":{"github-id":"IC_kwDODBZtRc5D8luf","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1139956639"},"message":"Since it is such a low level detail, I am leaning toward client instance attribute.  May be even not bother interfacing it in its constructor, just have it defined at the level of a class and be allowed to be overloaded for an instance. But at large -- up to you.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1654011240,"metadata":{"github-id":"CE_lADODBZtRc5KbCZ-zwAAAAGP_gni"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1654011323,"metadata":{"github-id":"IC_kwDODBZtRc5EFgm-","github-url":"https://github.com/dandi/dandi-cli/issues/1019#issuecomment-1142294974"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.40.0`](https://github.com/dandi/dandi-cli/releases/tag/0.40.0) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1654011324,"metadata":{"github-id":"LE_lADODBZtRc5KbCZ-zwAAAAGP_jfZ"},"added":["released"],"removed":[]}]}