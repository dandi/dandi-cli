{"version":2,"ops":[{"type":6,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1700586890,"metadata":{"github-id":"UCE_lAHODBZtRc53foIqzk6xefQ"},"target":"9d3eb032be761a2a628994cd320dc74b7e2b2a436a7906fb8bd5d76e1865595e","message":"```python\nfrom dandi.dandiapi import DandiAPIClient\n\nclient = DandiAPIClient(token=\"my token\")  # need token for embargo\n\ndandiset_620 = client.get_dandiset(dandiset_id=\"000620\")  # embargoed\n\ndandiset_620_metadata = dandiset_620.get_metadata()\n\n\u003e ValidationError: 1 validation error for Dandiset\n\u003e access -\u003e 0 -\u003e __root__\n\u003e   An embargo end date is required for NIH awards to be in compliance with NIH resource sharing policy. (type=value_error)\n```\n\nI'd be happy to set this value on the dandiset, but I don't know how to and it wasn't required to create the dandiset either","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1700598409,"metadata":{"github-id":"IC_kwDODBZtRc5sk9bF","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1821628101"},"message":"\u003cdetails\u003e\n\u003csummary\u003eat the lower API  we seems by default to allow for errors with  ignore_errors: bool = True,\u003c/summary\u003e \n\n```shell\n❯ git grep -A4 'def get_metadata'\ndandi/cli/cmd_ls.py:def get_metadata_ls(\ndandi/cli/cmd_ls.py-    path, keys, errors, flatten=False, schema=None, use_fake_digest=False\ndandi/cli/cmd_ls.py-):\ndandi/cli/cmd_ls.py-    from ..dandiset import Dandiset\ndandi/cli/cmd_ls.py-    from ..metadata.nwb import get_metadata, nwb2asset\n--\ndandi/dandiapi.py:    def get_metadata(self) -\u003e models.Dandiset:\ndandi/dandiapi.py-        \"\"\"\ndandi/dandiapi.py-        Fetch the metadata for this version of the Dandiset as a\ndandi/dandiapi.py-        `dandischema.models.Dandiset` instance\ndandi/dandiapi.py-        \"\"\"\n--\ndandi/dandiapi.py:    def get_metadata(self) -\u003e models.Asset:\ndandi/dandiapi.py-        \"\"\"\ndandi/dandiapi.py-        Fetch the metadata for the asset as a `dandischema.models.Asset`\ndandi/dandiapi.py-        instance\ndandi/dandiapi.py-        \"\"\"\n--\ndandi/files/bases.py:    def get_metadata(\ndandi/files/bases.py-        self,\ndandi/files/bases.py-        digest: Digest | None = None,\ndandi/files/bases.py-        ignore_errors: bool = True,\ndandi/files/bases.py-    ) -\u003e CommonModel:\n--\ndandi/files/bases.py:    def get_metadata(\ndandi/files/bases.py-        self,\ndandi/files/bases.py-        digest: Digest | None = None,\ndandi/files/bases.py-        ignore_errors: bool = True,\ndandi/files/bases.py-    ) -\u003e DandisetMeta:\n--\ndandi/files/bases.py:    def get_metadata(\ndandi/files/bases.py-        self,\ndandi/files/bases.py-        digest: Digest | None = None,\ndandi/files/bases.py-        ignore_errors: bool = True,\ndandi/files/bases.py-    ) -\u003e BareAsset:\n--\ndandi/files/bases.py:    def get_metadata(\ndandi/files/bases.py-        self,\ndandi/files/bases.py-        digest: Digest | None = None,\ndandi/files/bases.py-        ignore_errors: bool = True,\ndandi/files/bases.py-    ) -\u003e BareAsset:\n--\ndandi/files/bases.py:    def get_metadata(\ndandi/files/bases.py-        self,\ndandi/files/bases.py-        digest: Digest | None = None,\ndandi/files/bases.py-        ignore_errors: bool = True,\ndandi/files/bases.py-    ) -\u003e BareAsset:\n--\ndandi/files/bids.py:    def get_metadata(\ndandi/files/bids.py-        self,\ndandi/files/bids.py-        digest: Digest | None = None,\ndandi/files/bids.py-        ignore_errors: bool = True,\ndandi/files/bids.py-    ) -\u003e BareAsset:\n--\ndandi/files/bids.py:    def get_metadata(\ndandi/files/bids.py-        self,\ndandi/files/bids.py-        digest: Digest | None = None,\ndandi/files/bids.py-        ignore_errors: bool = True,\ndandi/files/bids.py-    ) -\u003e BareAsset:\n--\ndandi/files/bids.py:    def get_metadata(\ndandi/files/bids.py-        self,\ndandi/files/bids.py-        digest: Digest | None = None,\ndandi/files/bids.py-        ignore_errors: bool = True,\ndandi/files/bids.py-    ) -\u003e BareAsset:\n--\ndandi/files/zarr.py:    def get_metadata(\ndandi/files/zarr.py-        self,\ndandi/files/zarr.py-        digest: Digest | None = None,\ndandi/files/zarr.py-        ignore_errors: bool = True,\ndandi/files/zarr.py-    ) -\u003e BareAsset:\n--\ndandi/metadata/nwb.py:def get_metadata(\ndandi/metadata/nwb.py-    path: str | Path | Readable, digest: Digest | None = None\ndandi/metadata/nwb.py-) -\u003e dict | None:\ndandi/metadata/nwb.py-    \"\"\"\ndandi/metadata/nwb.py-    Get \"flatdata\" from a .nwb file\n\n```\n\u003c/details\u003e\n\nbut here we do not give such an option. Shouldn't we make it uniform and return unvalidated ones here too, wdyt @satra @jwodder ?  I feel that we had related discussion at some point but I fail to find it.\n\nmeanwhile\n- if you are just interested in record as a `dict` -- use `get_raw_metadata`, and you can convert it to unvalidated model \"manually\", e.g.\n\n```\n\u003e ... python cody-1363.py\nid='DANDI:000620/draft' schemaKey='Dandiset' schemaVersion='0.6.4' name='JazLab Processing' description='Work in progress dataset for the Jazayeri lab while prototyping the conversion and intermediate data processing such as spike sorting' contributor=[{'name': 'National Institutes of Health (NIH)', 'roleName': ['dcite:Funder'], 'schemaKey': 'Organization', 'awardNumber': '5 R01 NS 119519-03'}, {'name': 'Baker, Cody', 'email': 'cody.c.baker.phd@gmail.com', 'roleName': ['dcite:DataCurator', 'dcite:ContactPerson'], 'schemaKey': 'Person', 'affiliation': [], 'includeInCitation': True}] about=[] studyTarget=[] license=['spdx:CC-BY-4.0'] protocol=[] ethicsApproval=[] keywords=[] acknowledgement=None access=[{'status': 'dandi:EmbargoedAccess', 'schemaKey': 'AccessRequirements'}] url='https://dandiarchive.org/dandiset/000620/draft' repository='https://dandiarchive.org' relatedResource=[] wasGeneratedBy=[] identifier='DANDI:000620' dateCreated='2023-08-09T18:02:50.024110+00:00' dateModified=None citation='Baker, Cody (2023) JazLab Processing (Version draft) [Data set]. DANDI archive. https://dandiarchive.org/dandiset/000620/draft' assetsSummary={'species': [{'name': 'Macaca mulatta - Rhesus monkey', 'schemaKey': 'SpeciesType', 'identifier': 'http://purl.obolibrary.org/obo/NCBITaxon_9544'}], 'approach': [{'name': 'electrophysiological approach', 'schemaKey': 'ApproachType'}, {'name': 'behavioral approach', 'schemaKey': 'ApproachType'}], 'schemaKey': 'AssetsSummary', 'dataStandard': [{'name': 'Neurodata Without Borders (NWB)', 'schemaKey': 'StandardsType', 'identifier': 'RRID:SCR_015242'}], 'numberOfBytes': 289917799769, 'numberOfFiles': 5, 'numberOfSubjects': 3, 'variableMeasured': ['ProcessingModule', 'Units', 'ElectrodeGroup', 'SpatialSeries', 'ElectricalSeries'], 'measurementTechnique': [{'name': 'spike sorting technique', 'schemaKey': 'MeasurementTechniqueType'}, {'name': 'behavioral technique', 'schemaKey': 'MeasurementTechniqueType'}, {'name': 'analytical technique', 'schemaKey': 'MeasurementTechniqueType'}, {'name': 'surgical technique', 'schemaKey': 'MeasurementTechniqueType'}, {'name': 'multi electrode extracellular electrophysiology recording technique', 'schemaKey': 'MeasurementTechniqueType'}]} manifestLocation=['https://api.dandiarchive.org/api/dandisets/000620/versions/draft/assets/'] version='draft' @context='https://raw.githubusercontent.com/dandi/schema/master/releases/0.6.4/context.json'\n❯ cat cody-1363.py\nfrom dandi.dandiapi import DandiAPIClient\nimport os\nfrom dandischema import models\n\nclient = DandiAPIClient(token=os.environ.get('DANDI_API_KEY'))  # need token for embargo\n\ndandiset_620 = client.get_dandiset(dandiset_id=\"000620\")  # embargoed\n\ndandiset_620_metadata = models.Dandiset.unvalidated(**dandiset_620.get_raw_metadata())\nprint(dandiset_620_metadata)\n```","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1700598514,"metadata":{"github-id":"IC_kwDODBZtRc5sk97W","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1821630166"},"message":"Great, thanks for the advice!","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1700598574,"metadata":{"github-id":"IC_kwDODBZtRc5sk-M8","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1821631292"},"message":"@yarikoptic That `ignore_errors` option is for use when extracting data from an NWB file, not for validating API responses.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1700607759,"metadata":{"github-id":"IC_kwDODBZtRc5slv01","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1821834549"},"message":"@yarikoptic - i would agree with @jwodder that we make all fields optional so that the models can be passed. and we add a separate requirements validation that needs to pass before assets/dandisets can be published. i.e. pull validation into a separate function that enforces the requirements. that would help in situations like this.  however, this brings up a point that a user may have to check if a data object is valid  to make assumptions about what exists in it. i would tune this either with the pydantic 2 layer or right after it.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1700608088,"metadata":{"github-id":"IC_kwDODBZtRc5slw9f","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1821839199"},"message":"I also agree with the fact @jwodder clarified ;)  the question is either we should simplify people getting access to non-validated API responses (through a parameter to a call) or not (and just instruct to create those models \"manually\" out of raw responses, with v2 pydantic or before)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1700671028,"metadata":{"github-id":"IC_kwDODBZtRc5sqmpj","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1823107683"},"message":"ah, here is the issue which @sneakers-the-rat reminded me about which points to the same problematic UX: https://github.com/dandi/dandi-cli/issues/1205 -- people expect to just get metadata (valid or not) but get an error and get stuck, we need to come back and explain the vision that draft versions might still be not fulfilling the model etc.  \nSo may be indeed it is just a matter of documentation:  echoing the question in #1361, we should make our example(s) clear/er  and outline\n- how to get only already released dandisets to have a guarantee of not crashing models\n- that using `get_raw_metadata` they can get records (not unvalidated pydantic models) on any dandisets \n- how to create unvalidated model\n\nand/or alternatively: guide user by exception better, e.g. instead of just\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n```\n\nmake it\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n\nNote: that only published Dandisets and their assets models are expected to be valid. Consider using 'get_raw_metadata' instead to get a metadata dictionary, and wrapping it as Dandiset.unvalidated(**obj.get_raw_metadata()) happen you want unvalidated model\n```\n\nor simply adding `ignore_errors=False` (to retain behavior but that would make it inconsistent with aforementioned use while loading from files) and advising to use it in that `Note:` or `ignore_errors=True` and thus not even needing any explanation in the exception.\n\nWDYT?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1700671046,"metadata":{"github-id":"UCE_lALODBZtRc5sqmpjzjtSW2k"},"target":"910700e9b26e3d50d577d61643fc70bcda02bdbb09725a0200e33d8acdc8a06b","message":"ah, here is the issue which @sneakers-the-rat reminded me about which points to the same problematic UX: https://github.com/dandi/dandi-cli/issues/1205 -- people expect to just get metadata (valid or not) but get an error and get stuck, we need to come back and explain the vision that draft versions might still be not fulfilling the model etc.  \nSo may be indeed it is just a matter of documentation:  echoing the question in #1361, we should make our example(s) clear/er  and outline\n- how to get only already released dandisets to have a guarantee of not crashing models\n- that using `get_raw_metadata` they can get records (not unvalidated pydantic models) on any dandisets \n- how to create unvalidated model\n\nand/or alternatively: guide user by exception better, e.g. instead of just\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n```\n\nmake it\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n\nNote: that only published Dandisets and their assets models are expected to be valid.\nConsider using 'get_raw_metadata' instead to get a metadata dictionary, and wrapping it as Dandiset.unvalidated(**obj.get_raw_metadata()) happen you want unvalidated model\n```\n\nor simply adding `ignore_errors=False` (to retain behavior but that would make it inconsistent with aforementioned use while loading from files) and advising to use it in that `Note:` or `ignore_errors=True` and thus not even needing any explanation in the exception.\n\nWDYT?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1700671146,"metadata":{"github-id":"UCE_lALODBZtRc5sqmpjzjtSYug"},"target":"910700e9b26e3d50d577d61643fc70bcda02bdbb09725a0200e33d8acdc8a06b","message":"ah, here is the issue which @sneakers-the-rat reminded me about which points to the same problematic UX: https://github.com/dandi/dandi-cli/issues/1205 -- people expect to just get metadata (valid or not) but get an error and get stuck, we need to come back and explain the vision that draft versions might still be not fulfilling the model etc.  \nSo may be indeed it is just a matter of documentation:  echoing the question in #1361, we should make our example(s) clear/er  and outline\n- how to get only already released dandisets to have a guarantee of not crashing models\n- that using `get_raw_metadata` they can get records (not unvalidated pydantic models) on any dandisets \n- how to create unvalidated model\n\nand/or alternatively: guide user by exception better, e.g. instead of just\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n```\n\nmake it\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n\nNote: that only published Dandisets and their assets models are expected to be valid.\nConsider using 'get_raw_metadata' instead to get a metadata dictionary, and wrapping it as Dandiset.unvalidated(**obj.get_raw_metadata()) happen you want unvalidated model\n```\n\nor simply adding `ignore_errors=False` (to retain behavior but that would make it inconsistent with aforementioned use while loading from files) and advising to use it in that `Note:` or `ignore_errors=True` and thus not even needing any explanation in the exception.\n\nWDYT?\n\nedit: we could even make it `ignore_errors=None` and then if not set to explicit to a `bool` , in case of errors we issue a warning with the content of ValidationError and return unvalidated model.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1700671212,"metadata":{"github-id":"UCE_lALODBZtRc5sqmpjzjtSaA8"},"target":"910700e9b26e3d50d577d61643fc70bcda02bdbb09725a0200e33d8acdc8a06b","message":"ah, here is the issue which @sneakers-the-rat reminded me about which points to the same problematic UX: https://github.com/dandi/dandi-cli/issues/1205 -- people expect to just get metadata (valid or not) but get an error and get stuck, we need to come back and explain the vision that draft versions might still be not fulfilling the model etc.  \nSo may be indeed it is just a matter of documentation:  echoing the question in #1361, we should make our example(s) clear/er  and outline\n- how to get only already released dandisets to have a guarantee of not crashing models\n- that using `get_raw_metadata` they can get records (not unvalidated pydantic models) on any dandisets \n- how to create unvalidated model\n\nand/or alternatively: guide user by exception better, e.g. instead of just\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n```\n\nmake it\n\n```\nValidationError: 1 validation error for Dandiset\nlicense\n  ensure this value has at least 1 items (type=value_error.list.min_items; limit_value=1)\n\nNote: that only published Dandisets and their assets models are expected to be valid.\nConsider using 'get_raw_metadata' instead to get a metadata dictionary, and wrapping it as Dandiset.unvalidated(**obj.get_raw_metadata()) happen you want unvalidated model\n```\n\nor simply adding `ignore_errors=False` (to retain behavior but that would make it inconsistent with aforementioned use while loading from files) and advising to use it in that `Note:` or `ignore_errors=True` and thus not even needing any explanation in the exception.\n\nWDYT?\n\nedit: we could even make it `ignore_errors=None` and then if not set to explicit to a `bool` , in case of errors we issue a warning with the content of ValidationError and return unvalidated model. This way we would in effect inform user about problem, but do not crash and possibly give them a hint to skip such dandisets/assets or adjust `ignore_errors` to his desired `bool` value.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1700671223,"metadata":{"github-id":"IC_kwDODBZtRc5sqoGS","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1823113618"},"message":"@yarikoptic \n\n\u003e we need to come back and explain the vision that draft versions might still be not fulfilling the model\n\nLong-term, once the discussed overhaul of dandischema's models takes place, draft versions *will* fulfill a model.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1700672586,"metadata":{"github-id":"UCE_lALODBZtRc5sqoGSzjtSzK4"},"target":"367c20abdf8e11208f77595b7a4cebd14789df5f9aef3841ea00c90445190f1b","message":"@yarikoptic \n\n\u003e we need to come back and explain the vision that draft versions might still be not fulfilling the model\n\nLong-term, once [the overhaul of dandischema's models](https://github.com/dandi/dandi-schema/issues/205) takes place, draft versions *will* fulfill a model.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1700671349,"metadata":{"github-id":"IC_kwDODBZtRc5sqo88","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1823117116"},"message":"@yarikoptic Regarding adding `ignore_errors`, what exactly should happen if `ignore_errors` is `True` but the data doesn't pass validation?  Is the method supposed to return objects that don't even satisfy their own type annotations?  That would be bad, and I would categorically oppose it.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1706715099,"metadata":{"github-id":"IC_kwDODBZtRc5yZucU","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1919346452"},"message":"I would like to get back to this one.  Why do you think it would be that bad @jwodder ? \nWe now do have a bad situation that users are left without any clear way forward while simply asking for metadata -- `get_metadata` sounds like a safe thing to do/ask.  But it blows into their face because of the reasons out of their control. That complicates writing scripts to consume such metadata records, in particular in cases where they might not even care about those fields which fail to pass validation.  So why we cannot give them a way to overcome the hurdle in a consistent manner?  it will be up to them to set `ignore_errors=True` and step on that \"thin ice\".","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1706715417,"metadata":{"github-id":"IC_kwDODBZtRc5yZxFc","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1919357276"},"message":"@yarikoptic - let's address https://github.com/dandi/dandi-schema/issues/205 this now that pydantic has been upgraded. it will solve a bunch of issues, but we do need  coordinated effort to make this work. i was hoping we have cli and archive updated with dandi-schema release before this happened.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1706716056,"metadata":{"github-id":"IC_kwDODBZtRc5yZ2nk","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1919379940"},"message":"@yarikoptic \n\n* There's already a clear way forwards for getting metadata: `get_raw_metadata()`\n* If a class (like one of our dandischema models) has type annotations, and a function returns an instance of that class that doesn't conform to those annotations, then the function is buggy \u0026 broken, plain \u0026 simple.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1706729660,"metadata":{"github-id":"IC_kwDODBZtRc5ybc03","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1919798583"},"message":"\u003e * There's already a clear way forwards for getting metadata: `get_raw_metadata()`\n\nok, then let's at least make that exception more informative to guide user like I outlined [above](https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1823107683). Agree?","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1706816316,"metadata":{"github-id":"CE_lADODBZtRc53foIqzwAAAAK34dmu"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1706909359,"metadata":{"github-id":"IC_kwDODBZtRc5yuP-H","github-url":"https://github.com/dandi/dandi-cli/issues/1363#issuecomment-1924726663"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.59.1`](https://github.com/dandi/dandi-cli/releases/tag/0.59.1) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1706909360,"metadata":{"github-id":"LE_lADODBZtRc53foIqzwAAAAK4wivd"},"added":["released"],"removed":[]}]}