{"version":2,"ops":[{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1570826123,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTIxNDg2Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541214866"},"message":"@yarikoptic HDF5 compression is done by dataset. You could query each dataset to see if it is compressed. Is that what you want to do? pynwb does not have a flag that compresses all datasets. Alternatively, we could just automatically compress the entire HDF5, but that would not require any HDF5 programming.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570830573,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTIzNTU5Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541235596"},"message":"Yep, it is per dataset, but unlikely any user would need/like to choose it per each dataset. I guess for sensing it would be enough to check some (eg 10) datasets within a file and treat compression of any of them as indicator that likely compression was used","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570830662,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTIzNTk4NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541235985"},"message":"As for pynwb, I will suggest enabling compression by default (thus for all datasets) unless there was targeted investigation of typical cases which showed significant performance hit on topical operations","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1570832901,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI0NDY5Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541244697"},"message":"It has been a design decision of pynwb to leave datasets plain by default. That means no compression and no chunking. If a user wants compression or chunking they must specify that for each dataset. What is the motivation behind checking datasets to see if some of them have been compressed?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570833225,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI0NTgyMQ==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541245821"},"message":"Motivation is the observed up to 90% storage and possibly traffic waste.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570833432,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI0NjQ3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541246479"},"message":"Related observation - in neuroimaging majority of data is compressed (.nii.gz) although uncompressed is an option and used (rarely) for memory mapped access.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570833612,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI0NzAzNA==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541247034"},"message":"Re design decision - was there some open discussion or document describing reasoning? I might indeed be fighting windmills if compression would complicate some use cases or cause significant performance degradation. But it would be great to see some reasoning","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1570836365,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI1NTA3Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541255073"},"message":"Ok well checking a few isn't going to tell you whether the biggest ones are compressed, since the command must be made for each dataset. I can't think of any strong reasons why datasets shouldn't be compressed by default. I like the idea of chunking by default because it would allow us to grow datasets in append mode. Good luck.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570836959,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI1NTk4MA==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541255980"},"message":"ok then, we will add a mode to ls to get % of compressed datasets. My wild bet is that it is either 0   or very rarely close to 100% and nothing in the middle ;-) since you are they one producing many of them, you can beat me to it and prove that I am wrong! ;-)","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570836959,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDI5MTg5NjI5NA=="},"target":"619f4685cc215bd5b15ab1a6a0804983643cf4c98b31165230f522157ab79cd2","message":"ok then, we will add a mode to ls to get % of compressed datasets. My wild bet is that it is either 0   or very rarely close to 100% and nothing in the middle ;-) since you are the one producing many of them, you can beat me to it and prove that I am wrong! ;-)","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1570842838,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI2ODA1Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541268053"},"message":"Since it's optional you would probably only expect to see it on the large datasets. You would have to do things in an awkward way to get the datasets in `DynamicTables` for instance to be compressed. Is there a reason you can't just compress the whole HDF5 file when transferring?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570847222,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTI3NTAwNg==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541275006"},"message":"For transfer - the original question to @mgrauer . But built in compression - for any storage and I worked be surprised if it would cause some operations speed up actually (eg ls) . Yet to investigate in practice","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570847222,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDI5MTkyMzU3NA=="},"target":"8825057dbe10445062d0e0780a546b0125278999ba077a5c5cdda9e5b2208fa4","message":"For transfer - the original question to @mgrauer . But built in compression - for any storage and I would not be surprised if it would cause some operations speed up actually (eg ls) . Yet to investigate in practice","files":null},{"type":3,"author":{"id":"c8082a0f6b38dd60d28641b213f904bcd85419c2"},"timestamp":1570913838,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTM2MDg3MA==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541360870"},"message":"@yarikoptic \n\nI'm not sure what you specifically mean by\n\n\u003edoes girder support receiving compressed payload\n\nGirder considers files to be opaque blobs, so if you want to upload a compressed file or an uncompressed file, Girder doesn't care, nor will it know that the file is compressed or not.\n\nThis relates a bit to the discussion on [ingest](https://github.com/dandi/dandiarchive/issues/15).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1570941026,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTM4NTIzNg==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541385236"},"message":"I meant something like https://en.m.wikipedia.org/wiki/HTTP_compression, where original file/blob is not compressed, client compresses it for the transfer and lets server (girder) know that the file/blob needs to be uncompressed upon receive.","files":null},{"type":3,"author":{"id":"c8082a0f6b38dd60d28641b213f904bcd85419c2"},"timestamp":1570982181,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDU0MTQzMDc4MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/23#issuecomment-541430781"},"message":"Girder does not support this behavior out of the box.\n\nWhy not just have the client compress the file and upload and store the compressed file? What is the need to store the uncompressed file on the server?\n\nThis discussion has been good for generating requirements for describing an ingest pipeline! We can discuss more when we meet up in person at SfN.","files":null},{"type":2,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1584131486,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50MzEyODEwMTgyNA=="},"title":"upload: option to compress traffic","was":"upload: option to compress traffic"}]}