{"version":2,"ops":[{"type":6,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1651700512,"metadata":{"github-id":"UCE_lAHODBZtRc5JEzPqzi168iU"},"target":"6c7fae83c1ffa0301e758b71c07be2ae44b1ce7188ecb132fc4638502e137596","message":"Hey all, I'd like to be able to use `dandi organize` to force usage of both subject ID and session ID when generating a unique filename.\n\n*E.g.*, I want to get `sub-subj1_ses-foobar_ecephys.nwb` but all I get is after standard `dandi organize` is `sub-subj1_ecephys.nwb`\n\nThis came about because I am iteratively uploading only a single NWBFile at a time to a dandiset that is being downloaded lazily (`dandi download ... --download dandiset.yaml`) in order to reduce the amount of time my very large files spend on the processing server.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1651774644,"metadata":{"github-id":"IC_kwDODBZtRc5CsSFJ","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1118904649"},"message":"Yet to check in detail, but I think it is at large duplicate of #69","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1651979599,"metadata":{"github-id":"IC_kwDODBZtRc5Cxwus","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1120340908"},"message":"@yarikoptic Specifically the last comment by @satra in that thread (https://github.com/dandi/dandi-cli/issues/69#issuecomment-833629364, the part about 'partial access' to data) kind of touches on a part of why I'm requesting this...\n\nBut the issue would still exist for the very first session of each subject I upload, which acts as if the subject ID alone is sufficient to be 'unique', but really it needs the full session ID added on for that. But I won't have two files present at time of organize to force the automated usage of the session ID, so a manual control for that would be nice.","files":null},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658935424,"metadata":{"github-id":"LE_lADODBZtRc5JEzPqzwAAAAGlpL2U"},"added":["cmd-organize"],"removed":[]},{"type":3,"author":{"id":"1d7d442aa1925df5e89cbf71d597eb72205cfee1"},"timestamp":1667484266,"metadata":{"github-id":"IC_kwDODBZtRc5NnXPc","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1302164444"},"message":"@AlmightyYakob and I (with @CodyCBakerPhD's help) discovered that this may be leading to bad behavior in general: apparently, repeated upload of a disambiguated filename of the kind Cody is talking about here led to multiple assets being stored in the dandiset at the exact same pathname. This resulted in two assets in the dandiset only one of which was visible in the file browser.\n\nWe have manually renamed the later version of the duplicate pathname and communicated with Cory about it, and we expect that under the new AssetPath work in the archive that this shouldn't happen again, but it may instead result in an error about the target file already existing in the dandiset. We may find out soon as Cody's CI runs and uploads files to that folder again.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1667489571,"metadata":{"github-id":"IC_kwDODBZtRc5Nn2HG","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1302290886"},"message":"@waxlamp I am not certain on what is **this** and what would be the **bad behavior** in \n\n\u003e this may be leading to bad behavior in general\n\nsince \n\n\u003e led to multiple assets being stored in the dandiset at the exact same pathname\n\nsounds just as a bug in dandi-archive backend to not replace an asset with the same pathname upon an upload of a new asset.  In other words -- it is native to upload different version for the same path.  Could you please elaborate a little more and what in particular would you like to be changed in `dandi-cli`?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1667490059,"metadata":{"github-id":"IC_kwDODBZtRc5Nn40h","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1302301985"},"message":"\u003e  led to multiple assets being stored in the dandiset at the exact same pathname.\n\ni agree with @yarikoptic . this should never happen according to our design. if it's happening, something broke. path is a unique key in the asset space. there can be only one.\n\nperhaps there was a regression at some point.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1667490361,"metadata":{"github-id":"IC_kwDODBZtRc5Nn6fW","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1302308822"},"message":"the place where this gets tricky is partial uploads and perhaps where @CodyCBakerPhD is running into an issue.\n\n`dandi organize` currently assumes all your data are local for path disambiguation. there is an open issue i think to support partial dataset disambiguation, i.e. take into account both local and remote to do disambiguation and also change paths of remote assets as a result. this has not been implemented.","files":null},{"type":6,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1667491060,"metadata":{"github-id":"UCE_lALODBZtRc5Nn6fWzikeDSg"},"target":"ec2b4940260413a2a9d598bf7f42d44dc1f527b3cb950f782cfe76cc9d19ebfb","message":"the place where this gets tricky is partial uploads and perhaps where @CodyCBakerPhD is running into an issue.\n\n`dandi organize` currently assumes all your data are local for path disambiguation. there is an open issue i think to support partial dataset disambiguation, i.e. take into account both local and remote to do disambiguation and also change paths of remote assets as a result. this has not been implemented. \n\nping @jwodder and @yarikoptic about the partial disambiguation step. also see #69 and #47","files":null},{"type":3,"author":{"id":"1d7d442aa1925df5e89cbf71d597eb72205cfee1"},"timestamp":1667490798,"metadata":{"github-id":"IC_kwDODBZtRc5Nn85C","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1302318658"},"message":"I don't know specifically what caused multiple assets to be coexisting in the database with identical pathnames. Perhaps it was a dandi-archive bug, or perhaps it was intended behavior, with a future GC capability intended to remove orphaned versions. This came up with @AlmightyYakob was applying the new AssetPath checks and Cody's dandiset was the one place it came up. If the duplicate asset path doesn't appear again during regular use of Cody's CI, then I believe we can chalk it up to something that was buggy and no longer is; if we run into difficulties, we can decide at that point what the proper behavior of the archive ought to be, and adjust the logic to account for that.\n\nThat is to say, no action needed at the moment nor any bugs to address, and we're just waiting on more data from the CI outcomes.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1670509150,"metadata":{"github-id":"IC_kwDODBZtRc5QCaIs","github-url":"https://github.com/dandi/dandi-cli/issues/1000#issuecomment-1342808620"},"message":"I stay with opinion that it is at large a duplicate of #69 .","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1670509151,"metadata":{"github-id":"CE_lADODBZtRc5JEzPqzwAAAAHcNuM3"},"status":2}]}