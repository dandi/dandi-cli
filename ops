{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680096365,"metadata":{"github-id":"I_kwDODBZtRc5iGSAx","github-url":"https://github.com/dandi/dandi-cli/issues/1258","origin":"github"},"title":"download: leaks error/exception details to the user","message":"For the following simple script\n```shell\n❯ cat download-embargoed.py\nimport dandi.download\ndandi.download.download('https://gui-staging.dandiarchive.org/dandiset/207699', '.')\n```\nrunning it 1st time shows leaking of some initial lack of authentication detail which is not important to the user:\n\n```shell\n❯ python download-embargoed.py\nError 401 while sending GET request to https://api-staging.dandiarchive.org/api/dandisets/207699/: {\"detail\":\"Authentication credentials were not provided.\"}\nPATH                 SIZE    DONE    DONE% CHECKSUM STATUS          MESSAGE   \n207699/dandiset.yaml                                done            updated   \n207699/random.dat    7 Bytes 7 Bytes  100%    ok    done                      \nSummary:             7 Bytes 7 Bytes                2 done          1 updated \n                             100.00%  \n```\n\nSo we see that it authenticates eventually and downloads just fine, so that 401 should not be shown.  Running 2nd time makes display even worse since leaks some exception handling detail which should not be shown (reflected in pyout output status anyways):\n\n```shell\n❯ python download-embargoed.py\nError 401 while sending GET request to https://api-staging.dandiarchive.org/api/dandisets/207699/: {\"detail\":\"Authentication credentials were not provided.\"}\nPATH                 SIZE DONE    DONE% CHECKSUM STATUS    MESSAGE    \n207699/dandiset.yaml                             skipped   no change  \nSummary:                  0 Bytes                1 skipped 1 no change\n                          \u003c0.00%                                      \nCaught while downloading 207699/random.dat:\nTraceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/download.py\", line 353, in _download_generator_guard\nPATH                 SIZE     DONE    DONE% CHECKSUM STATUS    MESSAGE          \n207699/dandiset.yaml                                 skipped   no change        download_file\n207699/random.dat                                    error     FileExistsError  \nSummary:             0 Bytes  0 Bytes                1 skipped 1 no change      \n                     +7 Bytes 0.00%                  1 error   1 FileExistsError\n```","files":null}]}