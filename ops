{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614087618,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDIxMDE2Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784210166"},"message":"@yarikoptic @dchiquito I believe I'll require an API key for the new API that has permission to upload to 000003.  I found [these instructions](https://github.com/dandi/dandi-cli/issues/277#issuecomment-738314239) for generating an API key, but they appear to be out of date, as there is no \"Django Login\" on https://api.dandiarchive.org/swagger/, and `GET /auth/token/` gives me a 401 error.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614088347,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDIxNzUzMw==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784217533"},"message":"I remember also being given some super user permission over dandi-api instance so I could upload dandisets of others. @dchiquito could you please make @jwodder a super user too (if he isn't yet)?","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614095538,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDMwMTQzOQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784301439"},"message":"@jwodder those instructions are out of date at this point. You will need to go to https://gui-beta-dandiarchive-org.netlify.app/#/, click \"Create Account\", then \"Register with Github\", sign in with your github account, then click \"Authorize\". Once you are signed in on the web gui, you should be able to load or refresh https://api.dandiarchive.org/swagger/ and use any authentication required endpoints. To get the API key, click on your initials in the web GUI to open the user dropdown and copy the API Key from there.\n\nI can give you admin permissions once your account is created.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614096075,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDMwODAzMQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784308031"},"message":"@dchiquito I've created my account.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614097339,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDMyMzg5Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784323897"},"message":"@jwodder Promoted to superuser. Let me know if you run into any more permissions issues.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614099332,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDM0NzcyNA==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784347724"},"message":"@yarikoptic @dchiquito Uploading using the latest version of dandi-cli master failed with a 403:\n\n```\n2021-02-23T11:45:45-0500 [ERROR   ] dandi Error 403 while sending PUT request to https://dandi-api-dandisets-testing.s3.amazonaws.com/uploads/4bdbe151-8ed4-4d2e-945a-3af0c9736091?uploadId=7zt6H0Ri2CN2aFmcck.MFQPouCh2.bJJz0o5NSYO_wCka0YqfyU9HRrebMn3RJWQcJIaUuCxwSiwyT5fEGlBOEyzwtpsEbqHrurGE_r.0rtKF8U_dsr38iQgk7zMn7Oy\u0026partNumber=1\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20210223%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20210223T164542Z\u0026X-Amz-Expires=86400\u0026X-Amz-SignedHeaders=content-length%3Bhost\u0026X-Amz-Signature=e105bf80c9eb8250797d1f624825da04695e25898770a2e67b3bd630d57b5026: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eAccessDenied\u003c/Code\u003e\u003cMessage\u003eThere were headers present in the request which were not signed\u003c/Message\u003e\u003cHeadersNotSigned\u003econtent-md5\u003c/HeadersNotSigned\u003e\u003cRequestId\u003eF745YYTTRQVJNMBB\u003c/RequestId\u003e\u003cHostId\u003ec0OOpBQC2RF2jMgaCJy5SGa+eSCsxWiJhpk4hnK2DZoW7tr12S5Y62DVk1SwwNRA9G2iKCDPcBE=\u003c/HostId\u003e\u003c/Error\u003e\n```\n\nIt appears that we aren't including the `Content-MD5` header properly.  If I'm reading [this page](https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-query-string-auth.html) right, including the header requires using it to calculate the signature in the URL, which can only be done by the server when it generates the upload URL.  If this is correct, it seems that setting the `Content-MD5` is not something we can do.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614100574,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NDM2MjE1NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-784362155"},"message":"I haven't been following this saga, but it looks like you are including a `Content-MD5` header when uploading parts to S3. Presigned URLs require that you declare all headers you are going to be using, so untrusted clients who will be using the presigned URL can't tweak the headers to malicious ends.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614348076,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NjY2NDg2MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-786664861"},"message":"@dchiquito On my latest attempt to upload 000003/sub-YutaMouse33, most of the files finished successfully, but four of them failed on the request to `/uploads/validate/`, which returned a 400 with the body `[\"Validation already in progress.\"]`.  I feel like, when that happens, the endpoint should do nothing and return success so that the client can continue following the validation already in progress.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614348768,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4NjY3MTI2Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-786671267"},"message":"Good point. I suspect those validations are associated with task processes that have died, so I will also work on adding a heartbeat so prematurely aborted tasks get cleaned up.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614614472,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4ODA2Mzc5Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-788063793"},"message":"@jwodder You should now get a 204 when creating a new validation, and a 200 with body `Validation already in progress` when a validation is already going.\n\nI still need to add a job to mark IN_PROGRESS validations as FAILED after a timeout. The longest running jobs in the logs took about 6 hours, so if you see any validations that take longer than that ping me and I can mark them failed. A better engineered celery task should make that better, but that takes time.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614701494,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTAyMjM3NA==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789022374"},"message":"@dchiquito Once again, uploading 000003/sub-YutaMouse33 resulted in eight files uploading fine and one relatively small file stuck in validation.  The stuck file has hash `81a6e764bda0c0cfa4b96d200b103d347e7d7c7c4ee82665b5b9784f8d2084cf`.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614703265,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTA0NDM3MA==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789044370"},"message":"@jwodder I just marked that issue as FAILED. The last time validation was started for that validation was on the 24th, so I think your last upload did not start the validation. Can you try to upload just that file?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614703414,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTA0NTEzMg==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789045132"},"message":"@dchiquito I've restarted the upload, and it's now in the validation stage again.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614703414,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDM5MjY4MDY2"},"target":"fa7b1ac78d6351e1929fc35a06aac6384e901bd4fd0452814f801feb3cc95152","message":"@dchiquito I've restarted the upload for just that file, and it's now in the validation stage again.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614703789,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTA1MDYyNg==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789050626"},"message":"I see the validation started in the logs, hopefully it should complete soon.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614704337,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTA1Njk4NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789056985"},"message":"@dchiquito Validation completed successfully.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614707695,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTA5NTAxNQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789095015"},"message":"Great! @jwodder please start upload of some other sample data in other datasets in parallel","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614708759,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTEwNjg0NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789106845"},"message":"@yarikoptic I was able to successfully upload files from three different Dandisets in three separate simulaneous processes.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1614708759,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDM5Mjk2OTIx"},"target":"af874d697aade47d26a0bf673de6f0b9bf1a20b9811158a5615d43813cca50eb","message":"@yarikoptic I was able to successfully upload files from three different Dandisets in three separate simultaneous processes.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614710444,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4OTEyNTgyOQ==","github-url":"https://github.com/dandi/dandi-cli/issues/414#issuecomment-789125829"},"message":"Great, let's consider it resolved then!","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614710448,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDM5NzUwMjYwNw=="},"status":2}]}