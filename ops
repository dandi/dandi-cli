{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1733945751,"metadata":{"github-id":"UCE_lAHODBZtRc6i8DEpzmx5aKQ"},"target":"9988b6ce93a855a3e799d6fb5c5c5697520406813c9b88fd1af19e757c92aba9","message":"While troubleshooting with @Kevancic the download of 000026 at MGH we observed that process is at 100% while not downloading much\n\n\u003cdetails\u003e\n\u003csummary\u003epy-spy top gave following\u003c/summary\u003e \n\n![image](https://github.com/user-attachments/assets/132b5326-32ed-4cf3-89f6-eb3a0d488495)\n\n\u003c/details\u003e\n\ninvocation was \n\n```\nDANDI_DEVEL_AGGRESSIVE_RETRY=1 dandi --log-level=INFO download -e refresh -J 1:1 https://dandiarchive.org/dandiset/000026/draft/files?location=sub-I48\n```\n\nnote: we still were logging at DEBUG level in our log file, there were no pyout (?) logs there, but still were spending time validating using jsonschema every bloody record...\n\nIn general it should not be a problem but I think it is that within long running process and some \"summary\" or alike events start to pile up.","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1733940592,"metadata":{"github-id":"LE_lADODBZtRc6i8DEpzwAAAAOjMFCV"},"added":["performance"],"removed":[]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1733948204,"metadata":{"github-id":"IC_kwDODBZtRc6XN_XU","github-url":"https://github.com/dandi/dandi-cli/issues/1549#issuecomment-2537027028"},"message":"just notes: looking at the shared log, where process was 100% busy with just `-J 1:1` we see one individual file in zarr at a time about each second\n\n\u003cdetails\u003e\n\u003csummary\u003eonly with a handful of retries and errors overall reported\u003c/summary\u003e \n\n```shell\n❯ grep 'and retry' 2024.11.27-16.02.28Z-3234289.log\n2024-12-04T23:47:56-0500 [DEBUG   ] dandi 3234289:140581367957248 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Calretinin_SPIM.ome.zarr/1/0/32/28 - download failed on attempt #1: HTTPSConnectionPool(host='api.dandiarchive.org', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T00:54:30-0500 [DEBUG   ] dandi 3234289:140581393135360 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-NeuN_SPIM.ome.zarr/0/0/35/68 - download failed on attempt #1: HTTPSConnectionPool(host='api.dandiarchive.org', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T06:09:59-0500 [DEBUG   ] dandi 3234289:140583565764352 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Nuclei_SPIM.ome.zarr/0/0/65/79 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out., will sleep a bit and retry\n2024-12-05T10:50:28-0500 [DEBUG   ] dandi 3234289:140582978569984 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Somatostatin_SPIM.ome.zarr/0/0/88/46 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n2024-12-05T19:34:15-0500 [DEBUG   ] dandi 3234289:140582450091776 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-NeuN_SPIM.ome.zarr/0/1/22/78 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T20:04:17-0500 [DEBUG   ] dandi 3234289:140582450091776 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-NeuN_SPIM.ome.zarr/0/1/48/45 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T21:08:22-0500 [DEBUG   ] dandi 3234289:140582450091776 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-NeuN_SPIM.ome.zarr/1/0/3/31 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-06T01:01:15-0500 [DEBUG   ] dandi 3234289:140583590942464 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Nuclei_SPIM.ome.zarr/1/0/19/14 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-08T19:29:04-0500 [DEBUG   ] dandi 3234289:140580269037312 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-NeuN_SPIM.ome.zarr/0/0/32/24 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out., will sleep a bit and retry\n2024-12-09T17:51:01-0500 [DEBUG   ] dandi 3234289:140582986962688 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-Somatostatin_SPIM.ome.zarr/1/0/22/20 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n❯ grep Error 2024.11.27-16.02.28Z-3234289.log\n2024-12-05T06:09:59-0500 [DEBUG   ] dandi 3234289:140583565764352 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Nuclei_SPIM.ome.zarr/0/0/65/79.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-05T10:50:27-0500 [DEBUG   ] dandi 3234289:140582978569984 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Somatostatin_SPIM.ome.zarr/0/0/88/46.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-05T10:50:28-0500 [DEBUG   ] dandi 3234289:140582978569984 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Somatostatin_SPIM.ome.zarr/0/0/88/46 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n2024-12-06T20:37:16-0500 [DEBUG   ] dandi 3234289:140582466877184 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr/0/0/76/11.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.HTTPError'\u003e, 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/69fc58ee-92b8-4cfe-a9fa-7e3ce4c163fc/0/0/76/11?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241207%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241207T013711Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2cd25ddb59736529ff4b32489a809ab57ef87a9702c6d090ca1e89fb2c02d879\n2024-12-06T20:37:16-0500 [DEBUG   ] dandi 3234289:140582466877184 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr/0/0/76/11 - download failed: 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/69fc58ee-92b8-4cfe-a9fa-7e3ce4c163fc/0/0/76/11?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241207%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241207T013711Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2cd25ddb59736529ff4b32489a809ab57ef87a9702c6d090ca1e89fb2c02d879\nAssertionError\n2024-12-08T19:29:04-0500 [DEBUG   ] dandi 3234289:140580269037312 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-NeuN_SPIM.ome.zarr/0/0/32/24.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-09T17:51:01-0500 [DEBUG   ] dandi 3234289:140582986962688 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-Somatostatin_SPIM.ome.zarr/1/0/22/20.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-09T17:51:01-0500 [DEBUG   ] dandi 3234289:140582986962688 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-Somatostatin_SPIM.ome.zarr/1/0/22/20 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n\n```\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003eand there was an interesting singular AssertionError triggered -- so code path there needs analysis/ fixup\u003c/summary\u003e \n\n```\n2024-12-06T20:59:54-0500 [ERROR   ] dandi 3234289:140586896269824 Caught while downloading sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr:\nTraceback (most recent call last):\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 372, in _download_generator_guard\n    yield from generator\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 974, in _download_zarr\n    for path, status in it:\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 346, in __next__\n    return self.get()\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 380, in get\n    self._end()\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 400, in _end\n    e.get()\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 110, in get\n    raise e.with_traceback(tb) from None\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 274, in _process\n    x = next(it)\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 1117, in pairing\n    for d in gen:\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 761, in _download_file\n    assert isinstance(attempts_allowed_or_not, int)\nAssertionError\n```\n\n\u003c/details\u003e","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1733950360,"metadata":{"github-id":"UCE_lALODBZtRc6XN_XUzld4QyU"},"target":"b178f3dd56b1dc3c640bfcab9d41dcccb5cb85dc8914545c0e03f111014657ba","message":"just notes: looking at the shared log, where process was 100% busy with just `-J 1:1` we see one individual file in zarr at a time about each second\n\n\u003cdetails\u003e\n\u003csummary\u003eonly with a handful of retries and errors overall reported\u003c/summary\u003e \n\n```shell\n❯ grep 'and retry' 2024.11.27-16.02.28Z-3234289.log\n2024-12-04T23:47:56-0500 [DEBUG   ] dandi 3234289:140581367957248 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Calretinin_SPIM.ome.zarr/1/0/32/28 - download failed on attempt #1: HTTPSConnectionPool(host='api.dandiarchive.org', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T00:54:30-0500 [DEBUG   ] dandi 3234289:140581393135360 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-NeuN_SPIM.ome.zarr/0/0/35/68 - download failed on attempt #1: HTTPSConnectionPool(host='api.dandiarchive.org', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T06:09:59-0500 [DEBUG   ] dandi 3234289:140583565764352 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Nuclei_SPIM.ome.zarr/0/0/65/79 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out., will sleep a bit and retry\n2024-12-05T10:50:28-0500 [DEBUG   ] dandi 3234289:140582978569984 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Somatostatin_SPIM.ome.zarr/0/0/88/46 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n2024-12-05T19:34:15-0500 [DEBUG   ] dandi 3234289:140582450091776 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-NeuN_SPIM.ome.zarr/0/1/22/78 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T20:04:17-0500 [DEBUG   ] dandi 3234289:140582450091776 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-NeuN_SPIM.ome.zarr/0/1/48/45 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-05T21:08:22-0500 [DEBUG   ] dandi 3234289:140582450091776 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-NeuN_SPIM.ome.zarr/1/0/3/31 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-06T01:01:15-0500 [DEBUG   ] dandi 3234289:140583590942464 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Nuclei_SPIM.ome.zarr/1/0/19/14 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30), will sleep a bit and retry\n2024-12-08T19:29:04-0500 [DEBUG   ] dandi 3234289:140580269037312 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-NeuN_SPIM.ome.zarr/0/0/32/24 - download failed on attempt #1: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out., will sleep a bit and retry\n2024-12-09T17:51:01-0500 [DEBUG   ] dandi 3234289:140582986962688 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-Somatostatin_SPIM.ome.zarr/1/0/22/20 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n❯ grep Error 2024.11.27-16.02.28Z-3234289.log\n2024-12-05T06:09:59-0500 [DEBUG   ] dandi 3234289:140583565764352 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Nuclei_SPIM.ome.zarr/0/0/65/79.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-05T10:50:27-0500 [DEBUG   ] dandi 3234289:140582978569984 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Somatostatin_SPIM.ome.zarr/0/0/88/46.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-05T10:50:28-0500 [DEBUG   ] dandi 3234289:140582978569984 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS26_stain-Somatostatin_SPIM.ome.zarr/0/0/88/46 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n2024-12-06T20:37:16-0500 [DEBUG   ] dandi 3234289:140582466877184 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr/0/0/76/11.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.HTTPError'\u003e, 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/69fc58ee-92b8-4cfe-a9fa-7e3ce4c163fc/0/0/76/11?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241207%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241207T013711Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2cd25ddb59736529ff4b32489a809ab57ef87a9702c6d090ca1e89fb2c02d879\n2024-12-06T20:37:16-0500 [DEBUG   ] dandi 3234289:140582466877184 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr/0/0/76/11 - download failed: 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/69fc58ee-92b8-4cfe-a9fa-7e3ce4c163fc/0/0/76/11?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241207%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241207T013711Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2cd25ddb59736529ff4b32489a809ab57ef87a9702c6d090ca1e89fb2c02d879\nAssertionError\n2024-12-08T19:29:04-0500 [DEBUG   ] dandi 3234289:140580269037312 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-NeuN_SPIM.ome.zarr/0/0/32/24.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-09T17:51:01-0500 [DEBUG   ] dandi 3234289:140582986962688 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-Somatostatin_SPIM.ome.zarr/1/0/22/20.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-09T17:51:01-0500 [DEBUG   ] dandi 3234289:140582986962688 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS25_stain-Somatostatin_SPIM.ome.zarr/1/0/22/20 - download failed on attempt #1: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n\n```\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003eand there was an interesting singular AssertionError triggered -- so code path there needs analysis/ fixup\u003c/summary\u003e \n\n```\n2024-12-06T20:59:54-0500 [ERROR   ] dandi 3234289:140586896269824 Caught while downloading sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr:\nTraceback (most recent call last):\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 372, in _download_generator_guard\n    yield from generator\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 974, in _download_zarr\n    for path, status in it:\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 346, in __next__\n    return self.get()\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 380, in get\n    self._end()\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 400, in _end\n    e.get()\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 110, in get\n    raise e.with_traceback(tb) from None\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/interleave/__init__.py\", line 274, in _process\n    x = next(it)\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 1117, in pairing\n    for d in gen:\n  File \"/autofs/cluster/exvivo3/dandi_env_2024/lib/python3.9/site-packages/dandi/download.py\", line 761, in _download_file\n    assert isinstance(attempts_allowed_or_not, int)\nAssertionError\n```\n\n\u003c/details\u003e\n\n\n\u003cdetails\u003e\n\u003csummary\u003eedit 1: overall, among 130sec of total time for 'main' we get only 30 sec for reading data (download etc), 69sec for interleave::get (! based on Own) and around 47sec in jsonschema validation (based on Total but there should be no children within our code there). \u003c/summary\u003e \n\n```shell\nsh -J 1:1 https://api.dandiarchive.org/api/assets/f0da6521-b9c7-4fa5-9405-c48527aebe90/download/' (python v3.12.7)\nTotal Samples 97317\nGIL: 13.00%, Active: 21.00%, Threads: 2\n\n  %Own   %Total  OwnTime  TotalTime  Function (filename)                                                                                                                            \n  0.00%  17.00%   0.000s    131.2s   main (click/core.py)\n  0.00%  17.00%   0.010s    131.2s   download (dandi/download.py)\n  0.00%  17.00%   0.000s    131.2s   download (dandi/cli/cmd_download.py)\n  0.00%  17.00%   0.000s    131.2s   \u003cmodule\u003e (dandi)\n  0.00%  17.00%   0.000s    131.2s   __call__ (click/core.py)\n  0.00%  17.00%   0.000s    131.2s   wrapper (dandi/cli/base.py)\n  0.00%  17.00%   0.000s    131.2s   invoke (click/core.py)\n  0.00%  17.00%   0.000s    131.2s   new_func (click/decorators.py)\n  0.00%   4.00%   0.000s    70.35s   _download_generator_guard (dandi/download.py)\n  0.00%   4.00%   0.010s    70.35s   _download_zarr (dandi/download.py)\n  0.00%   4.00%   0.000s    70.35s   download_generator (dandi/download.py)\n  0.00%   4.00%   0.770s    70.35s   \u003cgenexpr\u003e (dandi/download.py)\n  0.00%   4.00%   0.000s    69.09s   __next__ (interleave/__init__.py)\n  4.00%   4.00%   69.08s    69.09s   get (interleave/__init__.py)\n  0.00%  13.00%   0.010s    60.76s   wrapped (pyout/interface.py)\n  0.00%  13.00%   0.000s    60.75s   __call__ (pyout/interface.py)\n  0.00%  13.00%   0.020s    60.52s   _write (pyout/interface.py)\n  0.00%  13.00%   0.020s    60.43s   _write_update (pyout/interface.py)\n  0.00%  13.00%   0.050s    59.70s   update (pyout/common.py)\n  0.00%  13.00%   0.060s    59.11s   render (pyout/common.py)\n  0.00%  13.00%   0.010s    54.55s   _render (pyout/common.py)\n  0.00%  13.00%   0.000s    54.54s   join (pyout/common.py)\n  0.00%   9.00%   0.100s    47.53s   _proc_group (pyout/common.py)\n  0.00%   4.00%   0.000s    47.46s   _bootstrap (threading.py)\n  0.00%   4.00%   0.000s    47.46s   run (threading.py)\n  0.00%   4.00%   0.000s    47.46s   _bootstrap_inner (threading.py)\n  0.00%   4.00%   0.010s    47.46s   _worker (concurrent/futures/thread.py)\n  0.00%   4.00%   0.010s    47.45s   run (concurrent/futures/thread.py)\n  0.00%   4.00%   0.030s    47.43s   _process (interleave/__init__.py)\n  0.00%   4.00%   0.020s    47.39s   pairing (dandi/download.py)\n  2.00%   4.00%   10.13s    47.37s   _download_file (dandi/download.py)\n  0.00%   9.00%   0.010s    47.30s   validate (pyout/elements.py)\n  0.00%   9.00%   0.060s    47.29s   validate (jsonschema/validators.py)\n  0.00%   9.00%   0.090s    46.83s   iter_errors (jsonschema/validators.py)\n  0.00%   8.00%    5.09s    46.48s   descend (jsonschema/validators.py)\n  0.00%   8.00%   0.340s    45.32s   additionalProperties (jsonschema/_keywords.py)\n  2.00%   9.00%    2.26s    45.13s   properties (jsonschema/_keywords.py)\n  0.00%   8.00%    1.04s    44.88s   ref (jsonschema/_keywords.py)\n  0.00%   9.00%   0.010s    38.98s   check_schema (jsonschema/validators.py)\n  0.00%   2.00%   0.000s    32.52s   downloader (dandi/dandiapi.py)\n  0.00%   1.00%   0.040s    29.69s   readinto (socket.py)\n  1.00%   1.00%   29.65s    29.65s   read (ssl.py)\n  0.00%   1.00%   0.000s    29.65s   recv_into (ssl.py)\n```\n\u003c/details\u003e\n\nNumbers do not necessarily add up nicely but seems do need investigation on why \n- #1551 \n- and jsonschema consuming so much for pyout. May be we could/should completely disable validation there since records are not obtained from external sources","files":null}]}