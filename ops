{"version":2,"ops":[{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596637518,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM2MjQ5MzE0OTU="},"added":["enhancement"],"removed":[]},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596637518,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM2MjQ5MzE0OTY="},"added":["testing"],"removed":[]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1596652450,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTM3NTA3Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669375076"},"message":"My attempts to get the Django container to run (using the latest code from dandi-publish@master) are currently failing with the following in the container's logs:\n\n```\n[32mdjango-configurations version , using configuration DevelopmentConfiguration[0m\n[18:29:28] INFO     Watching for file changes with             autoreload.py:612\n                    StatReloader                                                \nPerforming system checks...\n\nException in thread django-main-thread:\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.8/threading.py\", line 932, in _bootstrap_inner\n    self.run()\n  File \"/usr/local/lib/python3.8/threading.py\", line 870, in run\n    self._target(*self._args, **self._kwargs)\n  File \"/usr/local/lib/python3.8/site-packages/django/utils/autoreload.py\", line 53, in wrapper\n    fn(*args, **kwargs)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/commands/runserver.py\", line 118, in inner_run\n    self.check(display_num_errors=True)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/base.py\", line 392, in check\n    all_issues = checks.run_checks(\n  File \"/usr/local/lib/python3.8/site-packages/django/core/checks/registry.py\", line 70, in run_checks\n    new_errors = check(app_configs=app_configs, databases=databases)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/checks/urls.py\", line 13, in check_url_config\n    return check_resolver(resolver)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/checks/urls.py\", line 23, in check_resolver\n    return check_method()\n  File \"/usr/local/lib/python3.8/site-packages/django/urls/resolvers.py\", line 408, in check\n    for pattern in self.url_patterns:\n  File \"/usr/local/lib/python3.8/site-packages/django/utils/functional.py\", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File \"/usr/local/lib/python3.8/site-packages/django/urls/resolvers.py\", line 589, in url_patterns\n    patterns = getattr(self.urlconf_module, \"urlpatterns\", self.urlconf_module)\n  File \"/usr/local/lib/python3.8/site-packages/django/utils/functional.py\", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File \"/usr/local/lib/python3.8/site-packages/django/urls/resolvers.py\", line 582, in urlconf_module\n    return import_module(self.urlconf_name)\n  File \"/usr/local/lib/python3.8/importlib/__init__.py\", line 127, in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 1014, in _gcd_import\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 991, in _find_and_load\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 975, in _find_and_load_unlocked\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 671, in _load_unlocked\n  File \"\u003cfrozen importlib._bootstrap_external\u003e\", line 783, in exec_module\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 219, in _call_with_frames_removed\n  File \"/opt/django/dandi/urls.py\", line 7, in \u003cmodule\u003e\n    from rest_framework_extensions.routers import ExtendedSimpleRouter\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/routers.py\", line 2, in \u003cmodule\u003e\n    from rest_framework_extensions.utils import compose_parent_pk_kwarg_name\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/utils.py\", line 6, in \u003cmodule\u003e\n    from rest_framework_extensions.key_constructor.constructors import (\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/key_constructor/constructors.py\", line 4, in \u003cmodule\u003e\n    from rest_framework_extensions.key_constructor import bits\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/key_constructor/bits.py\", line 3, in \u003cmodule\u003e\n    from django.db.models.sql.datastructures import EmptyResultSet\nImportError: cannot import name 'EmptyResultSet' from 'django.db.models.sql.datastructures' (/usr/local/lib/python3.8/site-packages/django/db/models/sql/datastructures.py)\n```","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1596652450,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkxMDIyMTcz"},"target":"c413a703ef4492a0c73032088dfa624aaf696dc1f87101b66bc6b2086603b264","message":"My attempts to get the Django container to run (using the latest code from dandi-publish@master) are currently failing with the following in the container's logs:\n\n```\n[32mdjango-configurations version , using configuration DevelopmentConfiguration[0m\n[18:29:28] INFO     Watching for file changes with             autoreload.py:612\n                    StatReloader                                                \nPerforming system checks...\n\nException in thread django-main-thread:\nTraceback (most recent call last):\n  File \"/usr/local/lib/python3.8/threading.py\", line 932, in _bootstrap_inner\n    self.run()\n  File \"/usr/local/lib/python3.8/threading.py\", line 870, in run\n    self._target(*self._args, **self._kwargs)\n  File \"/usr/local/lib/python3.8/site-packages/django/utils/autoreload.py\", line 53, in wrapper\n    fn(*args, **kwargs)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/commands/runserver.py\", line 118, in inner_run\n    self.check(display_num_errors=True)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/base.py\", line 392, in check\n    all_issues = checks.run_checks(\n  File \"/usr/local/lib/python3.8/site-packages/django/core/checks/registry.py\", line 70, in run_checks\n    new_errors = check(app_configs=app_configs, databases=databases)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/checks/urls.py\", line 13, in check_url_config\n    return check_resolver(resolver)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/checks/urls.py\", line 23, in check_resolver\n    return check_method()\n  File \"/usr/local/lib/python3.8/site-packages/django/urls/resolvers.py\", line 408, in check\n    for pattern in self.url_patterns:\n  File \"/usr/local/lib/python3.8/site-packages/django/utils/functional.py\", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File \"/usr/local/lib/python3.8/site-packages/django/urls/resolvers.py\", line 589, in url_patterns\n    patterns = getattr(self.urlconf_module, \"urlpatterns\", self.urlconf_module)\n  File \"/usr/local/lib/python3.8/site-packages/django/utils/functional.py\", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File \"/usr/local/lib/python3.8/site-packages/django/urls/resolvers.py\", line 582, in urlconf_module\n    return import_module(self.urlconf_name)\n  File \"/usr/local/lib/python3.8/importlib/__init__.py\", line 127, in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 1014, in _gcd_import\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 991, in _find_and_load\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 975, in _find_and_load_unlocked\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 671, in _load_unlocked\n  File \"\u003cfrozen importlib._bootstrap_external\u003e\", line 783, in exec_module\n  File \"\u003cfrozen importlib._bootstrap\u003e\", line 219, in _call_with_frames_removed\n  File \"/opt/django/dandi/urls.py\", line 7, in \u003cmodule\u003e\n    from rest_framework_extensions.routers import ExtendedSimpleRouter\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/routers.py\", line 2, in \u003cmodule\u003e\n    from rest_framework_extensions.utils import compose_parent_pk_kwarg_name\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/utils.py\", line 6, in \u003cmodule\u003e\n    from rest_framework_extensions.key_constructor.constructors import (\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/key_constructor/constructors.py\", line 4, in \u003cmodule\u003e\n    from rest_framework_extensions.key_constructor import bits\n  File \"/usr/local/lib/python3.8/site-packages/rest_framework_extensions/key_constructor/bits.py\", line 3, in \u003cmodule\u003e\n    from django.db.models.sql.datastructures import EmptyResultSet\nImportError: cannot import name 'EmptyResultSet' from 'django.db.models.sql.datastructures' (/usr/local/lib/python3.8/site-packages/django/db/models/sql/datastructures.py)\n```\n\nThis is apparently a Django 3.1 compatibility problem which the responsible library (drf-extensions) [has been updated for](https://github.com/chibisov/drf-extensions/commit/8001a440c7322be26bbe2d16f3a334a8b0b5860b) but not yet made a release with yet.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1596653632,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTQwMTgyNg==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669401826"},"message":"So after editing dandi-publish's `setup.py` to require `django\u003c3.1`, Django comes up without any fatal errors, but http://localhost:8000 is a 404 with the following text:\n\n\u003e Using the URLconf defined in dandi.urls, Django tried these URL patterns, in this order:\n\u003e\n\u003e 1. `__debug__/`\n\u003e 2. `api/`\n\u003e 3. `admin/`\n\u003e 4. `swagger/ [name='schema-swagger-ui']`\n\u003e 5. `redoc/ [name='schema-redoc']`\n\u003e\n\u003e The empty path didn't match any of these.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596656736,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTQ1NDQxNQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669454415"},"message":"May be @dandi/dandiarchive would have an immediate clue/recommendation.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1596658642,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTQ3OTg0NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669479845"},"message":"@yarikoptic Did that ping anyone to come here, or are you suggesting I ask in the dandiarchive team discussion (or somewhere else)?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596665676,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTU0ODU0MA==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669548540"},"message":"just \"to come here\" ... indeed it was vague, sorry.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596665695,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTU0ODY1NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669548655"},"message":"but indeed could be also asked on slack in \"internal\"","files":null},{"type":3,"author":{"id":"c8082a0f6b38dd60d28641b213f904bcd85419c2"},"timestamp":1596667380,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTU2OTk2Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669569966"},"message":"I'm lurking here on dandi-cli for now, I'm not sure if I got pinged by the @dandi/dandiarchive or not. The right thing to do to get help for this problem was to post an issue in dandi-publish, as @jwodder did.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596674020,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY2OTYxNDg1Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-669614853"},"message":"Apparently you just weren't a part of the team @mgrauer ;-) you are now! See others and possibly remove former members on https://github.com/orgs/dandi/teams/dandiarchive/members\n\nIssuing issues for simple questions might be too much, so we better make it work \"properly\"","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1596744477,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MDE2NjY5MA==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-670166690"},"message":"Status: I'm able to get the docker-publish Django container to come up, and I can connect it to Girder using a \"publish\" admin user (At least, I think it's connected; I don't know how to test that.)  I can't get Girder to connect to Django, as that requires getting an API key from Django, which is [currently a GUI-only operation](https://github.com/dandi/dandi-publish/issues/121).  Also, [the celery container is exiting](https://github.com/dandi/dandi-publish/issues/120), but I don't know how important that is.\n\nUsing this setup requires building two more custom images; one (which requires a rebuild everytime docker-publish changes) uses a modified version of the Dockerfile currently in docker-publish@master, and the other uses a Dockerfile that only exists in the PR you linked me to.  Where should I store these Dockerfiles so that Docker Hub can build them?\n\nAlso, should this setup be used for the `local_docker_compose` fixture or a new fixture?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596747075,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MDE4NTY1MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-670185651"},"message":"\u003e Also, should this setup be used for the `local_docker_compose` fixture or a new fixture?\n\nI think it should all go into the same fixture, which purpose is \"to bring up all necessary components dandi-cli would interact with as with a real main deployment\".  IMHO that would be simpler and more \"realistic\" although not modular and thus cause longer tests session fixture setup time even if not all components get used by the tests.\n\n@mgrauer , does dandi-publish require anything \"custom\" (not present in the current/default girder deployment) functionality to be deployed alongside whenever `dandi-publish` gets deployed and https://github.com/dandi/dandiarchive/pull/341 (web ui, we don't test/interact with it here, not bringing up in compose recipe for testing)?  If so - that might preclude proceeding with adding \"publish\" to that fixture, but if not -- should be ok I think.","files":null},{"type":3,"author":{"id":"c8082a0f6b38dd60d28641b213f904bcd85419c2"},"timestamp":1596753495,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MDIyNTU4Mg==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-670225582"},"message":"\u003edoes dandi-publish require anything \"custom\" (not present in the current/default girder deployment) functionality to be deployed alongside whenever dandi-publish gets deployed and dandi/dandiarchive#341 (web ui, we don't test/interact with it here, not bringing up in compose recipe for testing)? If so - that might preclude proceeding with adding \"publish\" to that fixture, but if not -- should be ok I think.\n\nSorry, I'm not sure what you are asking here.\n\n\n\nIt seems like you are going through a lot of work--is all of this work necessary? I'd love to save you from so much work if possible, but I'm not following what you are doing.\n\nThinking out loud: Why do you specifically need both of the Docker Compose services up for your testing? Which endpoints are you hitting currently from the dandi-publish app? Perhaps you could just mock those few readonly endpoints out rather than having to run a full dandi-publish app and connect it to Girder and run a publish task? Also with the consideration that the django service is going to be changing quite a bit and we'd like to migrate into a unified system, whatever work you are putting into this now will also have to change to keep up--it seems like a large maintenance burden to me and I'd like you to be aware of that. Is there a lower cost path you could pursue for now? I don't understand enough of what your goals are to evaluate the tradeoffs.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596756361,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MDIzOTUwMA==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-670239500"},"message":"In brief (can reply in detail or we could have a jitsi chat), overall goal: to be able to test dandi-cli functionality. dandi client is useless without archive. For upload we need to test against a live instance. We don't want to butcher/conflict/etc our main instance. Mocking can get us half way, but will not guarantee that upload would work in real life. The same goes for locking. For download we could test on real instance (like we already do) but makes testing in simulated tricky scenarios \"tricky\" and causes unnecessary requirement for network connectivity.\nAs more API developed, not we need such integration testing. Especially in the current turbulent development where things change and break.\n\nMy question was: can we use dandi-publish competent with plain as deployed instance if girder, or it requires some special instance of girder?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596756361,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkxMzg2OTE3"},"target":"c02056b8da46983a23acca5ec1e3a59a604097b0976df7b1eb8762eb3027ffa1","message":"In brief (can reply in detail or we could have a jitsi chat), overall goal: to be able to test dandi-cli functionality. dandi client is useless without archive. For upload we need to test against a live instance. We don't want to butcher/conflict/etc our main instance. Mocking can get us half way, but will not guarantee that upload would work in real life. The same goes for locking. For download we could test on real instance (like we already do) but makes testing in simulated tricky scenarios \"tricky\" and causes unnecessary requirement for network connectivity.\nAs more API developed, not we need such integration testing. Especially in the current turbulent development where things change and break.\n\nMy question was: can we use dandi-publish component with plain as deployed instance if girder, or it requires some special instance of girder?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596756371,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkxMzg2OTQw"},"target":"c02056b8da46983a23acca5ec1e3a59a604097b0976df7b1eb8762eb3027ffa1","message":"In brief (can reply in detail or we could have a jitsi chat), overall goal: to be able to test dandi-cli functionality. dandi client is useless without archive. For upload we need to test against a live instance. We don't want to butcher/conflict/etc our main instance. Mocking can get us half way, but will not guarantee that upload would work in real life. The same goes for locking. For download we could test on real instance (like we already do) but makes testing in simulated tricky scenarios \"tricky\" and causes unnecessary requirement for network connectivity.\nAs more API developed, not we need such integration testing. Especially in the current turbulent development where things change and break.\n\nMy question was: can we use dandi-publish component with plain as deployed instance of girder, or it requires some special instance of girder?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1596756478,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkxMzg3MTc4"},"target":"c02056b8da46983a23acca5ec1e3a59a604097b0976df7b1eb8762eb3027ffa1","message":"In brief (can reply in detail or we could have a jitsi chat), overall goal: to be able to test dandi-cli functionality. dandi client is useless without archive. For upload we need to test against a live instance. We don't want to butcher/conflict/etc our main instance. Mocking can get us half way, but will not guarantee that upload would work in real life. The same goes for locking. For download we could test on real instance (like we already do) but makes testing in simulated tricky scenarios \"tricky\" and causes unnecessary requirement for network connectivity.\nAs more API developed, we need such integration testing even more. Especially in the current turbulent development where things change and break.\n\nAs things progress, and there would be more instances of dandi archive, client would need to be tested against multiple deployment versions/scenarios.\n\nMy question was: can we use dandi-publish component with plain as deployed instance of girder, or it requires some special instance of girder?","files":null},{"type":3,"author":{"id":"c8082a0f6b38dd60d28641b213f904bcd85419c2"},"timestamp":1596760228,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MDI1NjUxMQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-670256511"},"message":"Thanks for clarifying your testing needs.\n\n\u003eMy question was: can we use dandi-publish component with plain as deployed instance of girder, or it requires some special instance of girder?\n\nIf you have an instance of dandi-publish it should in theory work with any instance of dandiarchive (girder + dandiarchive plugin), I don't think anything special is needed. You will need to have bidirectional authentication set up.\n\ndandiarchive exposes a [publish endpoint](https://github.com/dandi/dandiarchive/blob/69218815727d060e7a67c8f8a2151ffa5fa68ce5/girder-dandi-archive/girder_dandi_archive/rest.py#L228) that requires a user named \"publish\" with admin permissions to use. it also relies on two settings, PUBLISH_API_URL (\"dandi.publish_api_url\" is the DB setting key) and PUBLISH_API_KEY(\"dandi.publish_api_key\" is the DB setting key) to talk to the publish service. You can set these system settings through an endpoint like [this](https://girder.dandiarchive.org/api/v1#!/system/system_setSetting). You need to get the token manually from publish. [Here's info on how to connect from publish into dandiarchive](https://github.com/dandi/dandi-publish#connecting-to-dandiarchive).\n\nThe dandiarchive publish [endpoint](https://github.com/dandi/dandiarchive/blob/69218815727d060e7a67c8f8a2151ffa5fa68ce5/girder-dandi-archive/girder_dandi_archive/rest.py#L238 ) first calls [sync](https://github.com/dandi/dandi-publish/blob/master/dandi/publish/views/dandiset.py#L51-L59) on the publish service (which calls back into Girder with a [synchronous operation](https://github.com/dandi/dandi-publish/blob/master/dandi/publish/models/dandiset.py#L39-L65)). dandiarchive publish [endpoint](https://github.com/dandi/dandiarchive/blob/69218815727d060e7a67c8f8a2151ffa5fa68ce5/girder-dandi-archive/girder_dandi_archive/rest.py#L251) then calls /versions/publish on dandi-publish, which launches an [async operation](https://github.com/dandi/dandi-publish/blob/master/dandi/publish/views/version.py#L52-L56) in Celery to copy all of the metadata and data from Girder into the publish service.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597266476,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MzExMTkyOA==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-673111928"},"message":"note: call out to `publish` API endpoint might (or not) happen while preparing tests for  https://github.com/dandi/dandi-cli/pull/189 where the only DANDI API for download available is only for published datasets, so it would need to be published first within tests fixture.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1598278351,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3OTE1MTY5Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-679151697"},"message":"@mgrauer could you or your team provide a complete recipe to be able to establish or get that key within docker compose setup? In the long run: there should be a single key and some \"permissions\" levels I guess (to allow or disallow publishing by users) https://github.com/dandi/dandi-publish/issues/135","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1598971488,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY4NDkwNzQ3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-684907479"},"message":"ok, token could be easily obtained by running (XXXX replaces sensitive output)\n```\n$\u003e docker exec 4efc ./manage.py drf_create_token root\nGenerated token XXXX for user root\n```\nwhere 4efc is the container of dandi-publish_django . And verified that it gives access:\n\n```shell\n$\u003e curl -X POST \"http://localhost:8000/api/dandisets/000001/versions/publish/\" -H \"accept: application/json\" -H \"Content-Type: application/json\" -H \"Authorization: Token BOGUS\" -d \"{ \\\"dandiset\\\": {\\\"identifier\\\": \\\"000001\\\"}, \\\"version\\\": \\\"1\\\", \\\"name\\\": \\\"name string\\\", \\\"description\\\": \\\"string\\\"}\"\n{\"detail\":\"Invalid token.\"}%                                                                                                                                                                                                       \n$\u003e curl -X POST \"http://localhost:8000/api/dandisets/000001/versions/publish/\" -H \"accept: application/json\" -H \"Content-Type: application/json\" -H \"Authorization: Token XXXX\" -d \"{ \\\"dandiset\\\": {\\\"identifier\\\": \\\"000001\\\"}, \\\"version\\\": \\\"1\\\", \\\"name\\\": \\\"name string\\\", \\\"description\\\": \\\"string\\\"}\"\n{\"detail\":\"Not found.\"}%     \n```","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1598973188,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY4NDkyNzc3Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-684927776"},"message":"The image for the minio container (which the Django container depends on) is currently failing to build.  I posted a question about it in dandi/dandi-publish#71.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1599060321,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY4NTc3NTg2MA==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-685775860"},"message":"I'm trying to get dandiarchive to connect to dandi-publish following [these instructions](https://github.com/dandi/dandiarchive#publish), but the following command:\n\n```\ncurl -fsSL -H \"Girder-Token: $PUBLISH_API_KEY\" -X PUT \\\n    -F key=dandi.publish_api_url \\\n    -F value=http://localhost:8000/api/ \\\n    http://localhost:8080/api/v1/system/setting\n```\n\nis currently failing with a 400 error and the message:\n\n```\n{\"field\": \"key\", \"message\": \"Invalid setting key \\\"dandi.publish_api_url\\\".\", \"type\": \"validation\"}\n```\n\nThe same error is returned when attempting to set the setting via the Swagger UI.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1599060321,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6Mzk3NDQ5NzIz"},"target":"38c8a9c7f41badaecce8cf627d4dafa665d747d1b66002b6561689a288d40bf3","message":"I'm trying to get dandiarchive to connect to dandi-publish following [these instructions](https://github.com/dandi/dandiarchive#publish), but the following command:\n\n```\ncurl -fsSL -H \"Girder-Token: $PUBLISH_API_KEY\" -X PUT \\\n    -F key=dandi.publish_api_url \\\n    -F value=http://localhost:8000/api/ \\\n    http://localhost:8080/api/v1/system/setting\n```\n\nis currently failing with a 400 error and the message:\n\n```\n{\"field\": \"key\", \"message\": \"Invalid setting key \\\"dandi.publish_api_url\\\".\", \"type\": \"validation\"}\n```\n\nThe same error is returned when attempting to set the setting via the Swagger UI.\n\nI've created an issue on dandiarchive: https://github.com/dandi/dandiarchive/issues/494","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1599142690,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY4NjUyMzgyOQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-686523829"},"message":"@yarikoptic I think I've finally got the prototype working now; is there a way to check whether the dandiarchive+dandi-publish connection is working as intended?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1599145576,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY4NjU1NjMxOA==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-686556318"},"message":"well, \"dandiarchive\" == \"webui\" + \"girder\" + ... . In dandi-cli I guess we do not care about `webui -\u003e dandi-publish` connection, but if you were to test it -- I guess what they have https://github.com/dandi/dandiarchive/tree/master/test might do it.  We should not worry about that portion too much ATM and leave it to \"dandiarchive\" people.\nWe do care about `dandi-publish -\u003e girder` so I guess the best would be if provisioning script (if it doesn't already) would just issue a `/dandisets/{dandiset__pk}/versions/publish/` request on some dandiset with a known version, and a test would obtain assets listing for that published version of that dandist.\nOr did I misunderstand \"connection\" you are after? ;)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1599149031,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY4NjU5MjA2NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/164#issuecomment-686592065"},"message":"I just need [this PR](https://github.com/dandi/dandi-publish/pull/147) merged, and then set up building a \"publish\" image on Docker Hub, and then this PR should finally be done.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1599149031,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6Mzk3NzUwMDcw"},"target":"3259a80471e02596a65a5facdb62a2c6c24a64edc64da66807fb9d034c2027ea","message":"I just need [this PR](https://github.com/dandi/dandi-publish/pull/147) merged, and then set up building a \"publish\" image on Docker Hub, and then this issue should finally be done.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1599149963,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6Mzk3NzU0MjQ0"},"target":"3259a80471e02596a65a5facdb62a2c6c24a64edc64da66807fb9d034c2027ea","message":"I just need [this PR](https://github.com/dandi/dandi-publish/pull/147) merged, and then I'll set up building a \"publish\" image on Docker Hub, and then this issue should finally be done.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1599579292,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50Mzc0MTU4OTI1MQ=="},"status":2},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1613075694,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQzMjE4NTI4ODA="},"added":["tests"],"removed":[]},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1613075694,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50NDMyMTg1Mjg4OA=="},"added":[],"removed":["testing"]}]}