{"version":2,"ops":[{"type":1,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1655315771,"metadata":{"github-id":"I_kwDODBZtRc5L2blO","github-url":"https://github.com/dandi/dandi-cli/issues/1030","origin":"github"},"title":"dandi download had two weird states","message":"`dandi download DANDI:000243` executed on dandihub\n\nfailed partly in instance 1 because it couldn't acquire a lock. seems like it didn't wait at all.\n\n\u003cdetails\u003e \u003csummary\u003e error details \u003c/summary\u003e\n\n```\nPATH                              SIZE      DONE           DONE% CHECKSUM STATUS          MESSAGE   \ndandiset.yaml                                                             done            updated   \nparticipants.tsv                  26 Bytes  26 Bytes        100%    ok    done                      \nsub-S01/anat/sub-S01_T2w.json     311 Bytes 311 Bytes       100%    ok    done                      \nsub-S01/anat/sub-S01_T2w.nii.gz   3.1 GB    3.1 GB          100%    ok    done                      \ndataset_description.json          263 Bytes 263 Bytes       100%    ok    done                      \nsub-S01/anat/sub-S01_T2w.ome.zarr 3.0 GB    2.5 GB           99%          downloading     896 done  \nSummary:                          6.1 GB    5.6 GB                        5 done          1 updated \n                                            91.50%                        1 downloading   1 896 done\n                                            ETA: 3 minutes                                          \n\n\nERROR: 1 asynchronous worker failed\n\nProducing value for row ('sub-S01/anat/sub-S01_T2w.ome.zarr',) failed:\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 380, in get\n    r = self._funnel.get(block=block, timeout=timeout)\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 223, in get\n    raise EndOfInputError()\ninterleave.EndOfInputError\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 279, in _print_async_exceptions\n    future.result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/opt/conda/lib/python3.9/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 841, in _download_zarr\n    for path, status in it:\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 348, in __next__\n    return self.get()\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 382, in get\n    self._end()\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 402, in _end\n    e.get()\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 112, in get\n    raise e.with_traceback(tb)\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 276, in _process\n    x = next(it)\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 902, in pairing\n    for d in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 631, in _download_file\n    with DownloadDirectory(path, digests or {}) as dldir:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 736, in __enter__\n    raise RuntimeError(f\"Could not acquire download lock for {self.filepath}\")\nRuntimeError: Could not acquire download lock for 000243/sub-S01/anat/sub-S01_T2w.ome.zarr/0/0/0/6/4/7\n```\n\u003c/details\u003e\n\n\nfailed in instance two with this message: \n\n\u003cdetails\u003e\n\u003csummary\u003e error details \u003c/summary\u003e\n\n```\nPATH                              SIZE    DONE    DONE% CHECKSUM STATUS    MESSAGE    \ndandiset.yaml                                                    skipped   no change  \nparticipants.tsv                                                                      \nsub-S01/anat/sub-S01_T2w.json                                                         \nsub-S01/anat/sub-S01_T2w.nii.gz                                                       \ndataset_description.json                                                              \nsub-S01/anat/sub-S01_T2w.ome.zarr                                                     \nSummary:                          0 Bytes 0 Bytes                1 skipped 1 no change\n                                  +6.1 GB 0.00%                                       \n\n\nERROR: 5 asynchronous workers failed\n\nProducing value for row ('participants.tsv',) failed:\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 279, in _print_async_exceptions\n    future.result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/opt/conda/lib/python3.9/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 521, in _download_file\n    raise FileExistsError(f\"File {path!r} already exists\")\nFileExistsError: File './000243/participants.tsv' already exists\n\nProducing value for row ('sub-S01/anat/sub-S01_T2w.json',) failed:\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 279, in _print_async_exceptions\n    future.result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/opt/conda/lib/python3.9/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 521, in _download_file\n    raise FileExistsError(f\"File {path!r} already exists\")\nFileExistsError: File './000243/sub-S01/anat/sub-S01_T2w.json' already exists\n\nProducing value for row ('sub-S01/anat/sub-S01_T2w.nii.gz',) failed:\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 279, in _print_async_exceptions\n    future.result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/opt/conda/lib/python3.9/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 521, in _download_file\n    raise FileExistsError(f\"File {path!r} already exists\")\nFileExistsError: File './000243/sub-S01/anat/sub-S01_T2w.nii.gz' already exists\n\nProducing value for row ('dataset_description.json',) failed:\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 279, in _print_async_exceptions\n    future.result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/opt/conda/lib/python3.9/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 521, in _download_file\n    raise FileExistsError(f\"File {path!r} already exists\")\nFileExistsError: File './000243/dataset_description.json' already exists\n\nProducing value for row ('sub-S01/anat/sub-S01_T2w.ome.zarr',) failed:\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 380, in get\n    r = self._funnel.get(block=block, timeout=timeout)\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 223, in get\n    raise EndOfInputError()\ninterleave.EndOfInputError\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 279, in _print_async_exceptions\n    future.result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/opt/conda/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/opt/conda/lib/python3.9/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/opt/conda/lib/python3.9/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 841, in _download_zarr\n    for path, status in it:\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 348, in __next__\n    return self.get()\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 382, in get\n    self._end()\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 402, in _end\n    e.get()\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 112, in get\n    raise e.with_traceback(tb)\n  File \"/opt/conda/lib/python3.9/site-packages/interleave/__init__.py\", line 276, in _process\n    x = next(it)\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 902, in pairing\n    for d in gen:\n  File \"/opt/conda/lib/python3.9/site-packages/dandi/download.py\", line 521, in _download_file\n    raise FileExistsError(f\"File {path!r} already exists\")\nFileExistsError: File './000243/sub-S01/anat/sub-S01_T2w.ome.zarr/.zattrs' already exists\n```\n\u003c/details\u003e","files":null}]}