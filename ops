{"version":2,"ops":[{"type":6,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1606216718,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDo0NTk4NzA5NTA="},"target":"48e6d50b840789fbb19fcc644cc681becc68f8d7665780a65d8c1320e0c9ef61","message":"Follow up from https://github.com/NeurodataWithoutBorders/pynwb/issues/1321.\n\nCan someone explain why HardwareTests-V2-IP8.nwb is good with\n\n```\n$ dandi --log-level DEBUG ls HardwareTests-V2-IP8.nwb\n2020-11-24 01:20:38,661 [   DEBUG] No newer (than 0.7.2) version of dandi/dandi-cli found available\n2020-11-24 01:20:41,977 [   DEBUG] Calling memoized version of \u003cfunction get_metadata at 0x0000000008A4A678\u003e for E:\\projekte\\mies-igor\\tools\\unit-testing\\HardwareTests-V2-IP8.nwb\n- age: null\n  date_of_birth: null\n  experiment_description: null\n  experimenter: null\n  genotype: null\n  identifier: ac24acc942a5b87538bf15d140e06b4576481565b77b114877c4d26ba23fc09e\n  institution: null\n  keywords: null\n  lab: null\n  nd_types:\n  - Device (7)\n  - IntracellularElectrode (6)\n  - LabNotebook\n  - LabNotebookDevice\n  - StimulusSets\n  - Subject\n  - SweepTable\n  - Testpulse\n  - TestpulseDevice\n  - TimeSeries (4)\n  - UserComment\n  - UserCommentDevice\n  - VoltageClampSeries (2)\n  - VoltageClampStimulusSeries (2)\n  number_of_electrodes: 0\n  number_of_units: 0\n  nwb_version: 2.2.4\n  path: HardwareTests-V2-IP8.nwb\n  related_publications: null\n  session_description: PLACEHOLDER\n  session_id: null\n  session_start_time: 2020-11-21 20:42:02.721000+00:00\n  sex: null\n  size: 9180392\n  species: null\n  subject_id: null\n(\n```\n\nbut bad.nwb gives\n\n```\n$ dandi --log-level DEBUG ls bad.nwb\n2020-11-24 12:18:13,126 [   DEBUG] No newer (than 0.7.2) version of dandi/dandi-cli found available\n2020-11-24 12:18:17,903 [   DEBUG] Calling memoized version of \u003cfunction get_metadata at 0x0000000008A49678\u003e for E:\\projekte\\mies-igor\\tools\\unit-testing\\bad.nwb\n2020-11-24 12:18:17,917 [   DEBUG] Running original \u003cfunction get_metadata at 0x0000000008A49678\u003e on 'E:\\\\projekte\\\\mies-igor\\\\tools\\\\unit-testing\\\\bad.nwb'\n2020-11-24 12:18:20,087 [   DEBUG] Call to get_metadata on bad.nwb failed: Could not construct IntracellularElectrode object due to: IntracellularElectrode.__init__: incorrect type for 'description' (got 'bytes', expected 'str')\n2020-11-24 12:18:20,087 [   DEBUG] Problem obtaining metadata for bad.nwb: 'NoneType' object has no attribute 'items'\n2020-11-24 12:18:20,087 [ WARNING] Failed to operate on some paths (empty records were listed):\n AttributeError: 1 paths\n- path: bad.nwb\n  size: 31985390\n```\n\nBoth have the exact same HDF5 type \n\n```\nE:\\projekte\\mies-igor\\tools\\unit-testing\u003eh5dump -d \"/general/intracellular_ephys/electrode_0/description\" bad.nwb HardwareTests-V2-IP8.nwb\nHDF5 \"bad.nwb\" {\nDATASET \"/general/intracellular_ephys/electrode_0/description\" {\n   DATATYPE  H5T_STRING {\n      STRSIZE H5T_VARIABLE;\n      STRPAD H5T_STR_NULLTERM;\n      CSET H5T_CSET_UTF8;\n      CTYPE H5T_C_S1;\n   }\n   DATASPACE  SIMPLE { ( 1 ) / ( 1 ) }\n   DATA {\n   (0): \"Headstage 0\"\n   }\n}\n}\nHDF5 \"HardwareTests-V2-IP8.nwb\" {\nDATASET \"/general/intracellular_ephys/electrode_0/description\" {\n   DATATYPE  H5T_STRING {\n      STRSIZE H5T_VARIABLE;\n      STRPAD H5T_STR_NULLTERM;\n      CSET H5T_CSET_UTF8;\n      CTYPE H5T_C_S1;\n   }\n   DATASPACE  SIMPLE { ( 1 ) / ( 1 ) }\n   DATA {\n   (0): \"Headstage 0\"\n   }\n}\n}\n```\n\n[files.zip](https://github.com/dandi/dandi-cli/files/5586590/files.zip)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606182859,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMjUzNTUxMA==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-732535510"},"message":"Wrong second paste? (Looks like hdf5dump and no error in any of those pasted)","files":null},{"type":3,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1606216733,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMjg1MDU5MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-732850591"},"message":"@yarikoptic Thanks. Fixed.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606235192,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMzA5MDA1Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-733090053"},"message":"I cannot tell what is wrong, and most likely an underlying pynwb issue, not dandi (but I could be wrong) for \n```\nCould not construct IntracellularElectrode object due to: IntracellularElectrode.__init__: incorrect type for 'description' (got 'bytes', expected 'str')\n```\nbut you could try with env variable `DANDI_CACHE=ignore` to see if that is not somehow due to serialization during caching of the results (unlikely but possible).\n\nThen there is a dandi `ls` issue with\n```\nProblem obtaining metadata for bad.nwb: 'NoneType' object has no attribute 'items'\n```\nis due to the failure above, I will probably (yet deciding on either it is worth it at this stage -- we are yet to do big RF #249 TODO which would touch on it more harmoniously) submit a PR shortly to handle it a bit better.\n\nAnd that bad.nwb - it is not the one from https://github.com/NeurodataWithoutBorders/pynwb/files/5578038/HardwareTests-V2-MIES-187d9143.zip , is it available to look \"deeper\"?","files":null},{"type":3,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1606239527,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMzEzMTYwOA==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-733131608"},"message":"@yarikoptic I have attached files.zip to the issue of course.","files":null},{"type":3,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1606239595,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMzEzMjE4Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-733132186"},"message":"Same error with `DANDI_CACHE=ignore`.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606317220,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMzc2Njk1Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-733766956"},"message":"eh, sorry -- missed that link.\n\nfor me both files ls fine with pynwb 1.4.0.post.dev3 \"installed\" straight from upstream repo at 1.4.0-3-g6d6ea6c9  (hdmf was 2.1.0 and then upgraded to 2.2.0) at https://github.com/NeurodataWithoutBorders/pynwb/pull/1282\n\n\u003cdetails\u003e\n\u003csummary\u003eoutput\u003c/summary\u003e \n\n```shell\n$\u003e dandi  ls /tmp/bad.nwb /tmp/HardwareTests-V2-IP8.nwb      \nPATH                          SIZE    IDENTIFIER                                                       NWB   ND_TYPES                                                                                                      SESSION_DESCRIPTION SESSION_START_TIME  \n/tmp/bad.nwb                  32.0 MB 2ae7afd1a09f78c3d7c3311d71990095010fab706d91f9048986eef429991a70 2.2.4 CurrentClampSeries (73), CurrentClampStimulusSeries (73), Device (148), IntracellularElectrode (147), LabN... PLACEHOLDER         2019-11-08/18:46:09 \n/tmp/HardwareTests-V2-IP8.nwb 9.2 MB  ac24acc942a5b87538bf15d140e06b4576481565b77b114877c4d26ba23fc09e 2.2.4 Device (7), IntracellularElectrode (6), LabNotebook, LabNotebookDevice, StimulusSets, Subject, SweepTable,... PLACEHOLDER         2020-11-21/20:42:02 \nSummary:                      41.2 MB                                                                                                                                                                                                          2019-11-08/18:46:09\u003e\n                \n```\n\u003c/details\u003e\n\nso I then did `pip install --upgrade --force-reinstall pynwb==1.4.0`\n\n\u003cdetails\u003e\n\u003csummary\u003ewhich pulled in everything including a kitchensink\u003c/summary\u003e \n\n```shell\n(git)lena:~/proj/dandi/dandi-cli[tags/0.7.2^0]\n$\u003e pip install --upgrade --force-reinstall pynwb==1.4.0\nCollecting pynwb==1.4.0\n  Using cached pynwb-1.4.0-py2.py3-none-any.whl (94 kB)\nCollecting numpy\u003e=1.16\n  Downloading numpy-1.19.4-cp38-cp38-manylinux2010_x86_64.whl (14.5 MB)\n     |████████████████████████████████| 14.5 MB 4.9 MB/s \nCollecting h5py\u003e=2.9\n  Downloading h5py-3.1.0-cp38-cp38-manylinux1_x86_64.whl (4.4 MB)\n     |████████████████████████████████| 4.4 MB 5.9 MB/s \nCollecting pandas\u003e=0.23\n  Downloading pandas-1.1.4-cp38-cp38-manylinux1_x86_64.whl (9.3 MB)\n     |████████████████████████████████| 9.3 MB 5.3 MB/s \nCollecting hdmf\u003c3,\u003e=2.1.0\n  Using cached hdmf-2.2.0-py2.py3-none-any.whl (132 kB)\nCollecting python-dateutil\u003e=2.7\n  Using cached python_dateutil-2.8.1-py2.py3-none-any.whl (227 kB)\nCollecting pytz\u003e=2017.2\n  Downloading pytz-2020.4-py2.py3-none-any.whl (509 kB)\n     |████████████████████████████████| 509 kB 5.9 MB/s \nCollecting ruamel.yaml\u003e=0.15\n  Using cached ruamel.yaml-0.16.12-py2.py3-none-any.whl (111 kB)\nCollecting scipy\u003e=1.1\n  Downloading scipy-1.5.4-cp38-cp38-manylinux1_x86_64.whl (25.8 MB)\n     |████████████████████████████████| 25.8 MB 5.6 MB/s \nCollecting jsonschema\u003e=2.6.0\n  Using cached jsonschema-3.2.0-py2.py3-none-any.whl (56 kB)\nCollecting six\u003e=1.5\n  Using cached six-1.15.0-py2.py3-none-any.whl (10 kB)\nCollecting ruamel.yaml.clib\u003e=0.1.2; platform_python_implementation == \"CPython\" and python_version \u003c \"3.9\"\n  Using cached ruamel.yaml.clib-0.2.2-cp38-cp38-manylinux1_x86_64.whl (578 kB)\nCollecting setuptools\n  Using cached setuptools-50.3.2-py3-none-any.whl (785 kB)\nCollecting pyrsistent\u003e=0.14.0\n  Downloading pyrsistent-0.17.3.tar.gz (106 kB)\n     |████████████████████████████████| 106 kB 7.3 MB/s \nCollecting attrs\u003e=17.4.0\n  Downloading attrs-20.3.0-py2.py3-none-any.whl (49 kB)\n     |████████████████████████████████| 49 kB 3.2 MB/s \nBuilding wheels for collected packages: pyrsistent\n  Building wheel for pyrsistent (setup.py) ... done\n  Created wheel for pyrsistent: filename=pyrsistent-0.17.3-cp38-cp38-linux_x86_64.whl size=108030 sha256=35d9b62b6ae1719f89cdc792f8a5a1a519fc6b56cab22e086e3fadaebe431c40\n  Stored in directory: /home/yoh/.cache/pip/wheels/3d/22/08/7042eb6309c650c7b53615d5df5cc61f1ea9680e7edd3a08d2\nSuccessfully built pyrsistent\nERROR: launchpadlib 1.10.13 requires testresources, which is not installed.\nInstalling collected packages: numpy, h5py, six, python-dateutil, pytz, pandas, ruamel.yaml.clib, ruamel.yaml, scipy, setuptools, pyrsistent, attrs, jsonschema, hdmf, pynwb\n  Attempting uninstall: numpy\n    Found existing installation: numpy 1.19.3\n    Not uninstalling numpy at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'numpy'. No files were found to uninstall.\n  Attempting uninstall: h5py\n    Found existing installation: h5py 2.10.0\n    Not uninstalling h5py at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'h5py'. No files were found to uninstall.\n  Attempting uninstall: six\n    Found existing installation: six 1.14.0\n    Uninstalling six-1.14.0:\n      Successfully uninstalled six-1.14.0\n  Attempting uninstall: python-dateutil\n    Found existing installation: python-dateutil 2.8.1\n    Not uninstalling python-dateutil at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'python-dateutil'. No files were found to uninstall.\n  Attempting uninstall: pytz\n    Found existing installation: pytz 2020.1\n    Not uninstalling pytz at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'pytz'. No files were found to uninstall.\n  Attempting uninstall: pandas\n    Found existing installation: pandas 1.1.3\n    Not uninstalling pandas at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'pandas'. No files were found to uninstall.\n  Attempting uninstall: ruamel.yaml.clib\n    Found existing installation: ruamel.yaml.clib 0.2.2\n    Not uninstalling ruamel.yaml.clib at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'ruamel.yaml.clib'. No files were found to uninstall.\n  Attempting uninstall: ruamel.yaml\n    Found existing installation: ruamel.yaml 0.16.12\n    Not uninstalling ruamel.yaml at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'ruamel.yaml'. No files were found to uninstall.\n  Attempting uninstall: scipy\n    Found existing installation: scipy 1.5.2\n    Not uninstalling scipy at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'scipy'. No files were found to uninstall.\n  Attempting uninstall: setuptools\n    Found existing installation: setuptools 44.0.0\n    Uninstalling setuptools-44.0.0:\n      Successfully uninstalled setuptools-44.0.0\n  Attempting uninstall: pyrsistent\n    Found existing installation: pyrsistent 0.15.5\n    Not uninstalling pyrsistent at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'pyrsistent'. No files were found to uninstall.\n  Attempting uninstall: attrs\n    Found existing installation: attrs 19.3.0\n    Not uninstalling attrs at /usr/lib/python3/dist-packages, outside environment /home/yoh/proj/dandi/dandi-cli/venvs/dev3\n    Can't uninstall 'attrs'. No files were found to uninstall.\n  Attempting uninstall: jsonschema\n    Found existing installation: jsonschema 3.2.0\n    Uninstalling jsonschema-3.2.0:\n      Successfully uninstalled jsonschema-3.2.0\n  Attempting uninstall: hdmf\n    Found existing installation: hdmf 2.2.0\n    Uninstalling hdmf-2.2.0:\n      Successfully uninstalled hdmf-2.2.0\n  Attempting uninstall: pynwb\n    Found existing installation: pynwb 1.4.0\n    Uninstalling pynwb-1.4.0:\n      Successfully uninstalled pynwb-1.4.0\nSuccessfully installed attrs-20.3.0 h5py-3.1.0 hdmf-2.2.0 jsonschema-3.2.0 numpy-1.19.4 pandas-1.1.4 pynwb-1.4.0 pyrsistent-0.17.3 python-dateutil-2.8.1 pytz-2020.4 ruamel.yaml-0.16.12 ruamel.yaml.clib-0.2.2 scipy-1.5.4 setuptools-50.3.2 six-1.15.0\npip install --upgrade --force-reinstall pynwb==1.4.0  14.34s user 2.57s system 68% cpu 24.512 total\n\n```\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003eand now it doesn't work on either of those:\u003c/summary\u003e \n\n```shell\n$\u003e DANDI_CACHE=ignore dandi -l debug ls -f yaml /tmp/bad.nwb /tmp/HardwareTests-V2-IP8.nwb\n2020-11-25 10:11:05,197 [   DEBUG] No newer (than 0.7.2) version of dandi/dandi-cli found available\n2020-11-25 10:11:06,412 [   DEBUG] Calling memoized version of \u003cfunction get_metadata at 0x7f2119214550\u003e for /tmp/bad.nwb\n2020-11-25 10:11:06,412 [   DEBUG] Running original \u003cfunction get_metadata at 0x7f2119214550\u003e on '/tmp/bad.nwb'\n2020-11-25 10:11:07,503 [   DEBUG] Call to get_metadata on /tmp/bad.nwb failed: Could not construct IntracellularElectrode object due to: IntracellularElectrode.__init__: incorrect type for 'description' (got 'bytes', expected 'str')\n2020-11-25 10:11:07,503 [   DEBUG] Problem obtaining metadata for /tmp/bad.nwb: 'NoneType' object has no attribute 'items'\n2020-11-25 10:11:07,503 [   DEBUG] Calling memoized version of \u003cfunction get_metadata at 0x7f2119214550\u003e for /tmp/HardwareTests-V2-IP8.nwb\n2020-11-25 10:11:07,504 [   DEBUG] Running original \u003cfunction get_metadata at 0x7f2119214550\u003e on '/tmp/HardwareTests-V2-IP8.nwb'\n2020-11-25 10:11:08,175 [   DEBUG] Call to get_metadata on /tmp/HardwareTests-V2-IP8.nwb failed: Could not construct IntracellularElectrode object due to: IntracellularElectrode.__init__: incorrect type for 'description' (got 'bytes', expected 'str')\n2020-11-25 10:11:08,175 [   DEBUG] Problem obtaining metadata for /tmp/HardwareTests-V2-IP8.nwb: 'NoneType' object has no attribute 'items'\n2020-11-25 10:11:08,175 [ WARNING] Failed to operate on some paths (empty records were listed):\n AttributeError: 2 paths\n- path: /tmp/bad.nwb\n  size: 31985390\n- path: /tmp/HardwareTests-V2-IP8.nwb\n  size: 9180392\n\n```\n\u003c/details\u003e\n\nso at least there is some consistency ;)  note that the upgrade pulled in `h5py-3.1.0` which hdmf is not compatible with yet.\n\nwhat h5py do you have ? (we need WTF #57)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606317452,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMzc2OTI3Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-733769277"},"message":"downgrade `pip install --upgrade 'h5py==2.10.0'` made it work again\n\n\u003cdetails\u003e\n\u003csummary\u003eoutput\u003c/summary\u003e \n\n```shell\n$\u003e DANDI_CACHE=ignore dandi ls  /tmp/bad.nwb /tmp/HardwareTests-V2-IP8.nwb     \nPATH                          SIZE    IDENTIFIER                                                       SESSION_START_TIME   ND_TYPES                                                                                                      SESSION_DESCRIPTION NWB  \n/tmp/bad.nwb                  32.0 MB 2ae7afd1a09f78c3d7c3311d71990095010fab706d91f9048986eef429991a70 2019-11-08/18:46:09  CurrentClampSeries (73), CurrentClampStimulusSeries (73), Device (148), IntracellularElectrode (147), LabN... PLACEHOLDER         2.2.4\n/tmp/HardwareTests-V2-IP8.nwb 9.2 MB  ac24acc942a5b87538bf15d140e06b4576481565b77b114877c4d26ba23fc09e 2020-11-21/20:42:02  Device (7), IntracellularElectrode (6), LabNotebook, LabNotebookDevice, StimulusSets, Subject, SweepTable,... PLACEHOLDER         2.2.4\nSummary:                      41.2 MB                                                                  2019-11-08/18:46:09\u003e                                                                                                                                        \n                                                                                                       2020-11-21/20:42:02\u003c  \n```\n\u003c/details\u003e","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606319961,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczMzc5NTUzOQ==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-733795539"},"message":"So, nothing really to \"fix\" on dandi-cli side, besides improving that `ls` behavior in case of pynwb etc puking.  I will retitle for that","files":null},{"type":2,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606320059,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDAzODc5NzM5Ng=="},"title":"make `ls` more resilient in case of metadata loading fails with pynwb for some reason","was":"make `ls` more resilient in case of metadata loading fails with pynwb for some reason"},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606320092,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQwMzg3OTk5MjI="},"added":["severity-minor"],"removed":[]},{"type":3,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1606421239,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDczNDQ2Mjg1Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/282#issuecomment-734462853"},"message":"Thanks for digging. Once I downgrade h5py to \"2.10.0\" it indeed works. I thought I checked that but looks like I got lost in tracking the various issues involved in that.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1606923724,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDA2MzAyODMzNQ=="},"status":2}]}