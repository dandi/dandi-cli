{"version":2,"ops":[{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658214363,"metadata":{"github-id":"IC_kwDODBZtRc5G2c9k","github-url":"https://github.com/dandi/dandi-cli/issues/1055#issuecomment-1188679524"},"message":"Ok, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate, uses inheritance, for which support is not yet merged upstream (and we are not yet using the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option, convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option, create empty CHANGES files on all our archives.\n3. The worst, hard-code that CHANGES is not actually required.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658215026,"metadata":{"github-id":"UCE_lALODBZtRc5G2c9kziVFWxY"},"target":"000326307f43e338302997e0ed7557b66eee9bd87cbcf2554320543c32ff416f","message":"Ok, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate, uses inheritance, for which support is not yet merged upstream (and we are not yet using the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option, convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option, create empty CHANGES files on all our archives.\n3. The meh option, accept missing files by default (i.e. without `validation=\"ignore\"`).\n4. The absolute worst, hard-code that CHANGES is not actually required.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658215048,"metadata":{"github-id":"UCE_lALODBZtRc5G2c9kziVFXAI"},"target":"000326307f43e338302997e0ed7557b66eee9bd87cbcf2554320543c32ff416f","message":"Ok, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate uses inheritance, for which support is not yet merged upstream (and we are not yet using the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option, convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option, create empty CHANGES files on all our archives.\n3. The meh option, accept missing files by default (i.e. without `validation=\"ignore\"`).\n4. The absolute worst, hard-code that CHANGES is not actually required.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658215062,"metadata":{"github-id":"UCE_lALODBZtRc5G2c9kziVFXIo"},"target":"000326307f43e338302997e0ed7557b66eee9bd87cbcf2554320543c32ff416f","message":"Ok, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate uses inheritance, for which support is not yet merged upstream (and we are not yet loading the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option, convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option, create empty CHANGES files on all our archives.\n3. The meh option, accept missing files by default (i.e. without `validation=\"ignore\"`).\n4. The absolute worst, hard-code that CHANGES is not actually required.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658215126,"metadata":{"github-id":"UCE_lALODBZtRc5G2c9kziVFXyw"},"target":"000326307f43e338302997e0ed7557b66eee9bd87cbcf2554320543c32ff416f","message":"Ok, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate uses inheritance, for which support is not yet merged upstream (and we are not yet loading the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option, convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option, create empty CHANGES files on all our archives.\n3. The meh option, accept missing files by default (i.e. without `validation=\"ignore\"`).\n4. The absolute worst, hard-code that CHANGES is not actually required.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658215163,"metadata":{"github-id":"UCE_lALODBZtRc5G2c9kziVFYOs"},"target":"000326307f43e338302997e0ed7557b66eee9bd87cbcf2554320543c32ff416f","message":"Ok, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate uses inheritance, for which support is not yet merged upstream (and we are not yet loading the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option: convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option: create empty CHANGES files in all our archives.\n3. The meh option: accept missing files by default (i.e. without `validation=\"ignore\"`).\n4. The absolute worst: hard-code that CHANGES is not actually required.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1658215194,"metadata":{"github-id":"UCE_lALODBZtRc5G2c9kziVFYjM"},"target":"000326307f43e338302997e0ed7557b66eee9bd87cbcf2554320543c32ff416f","message":"@yarikoptic \n\nOk, so I tracked this down. The issue I assume is the datasets lack the `CHANGES` file which BIDS insists is mandatory. The fact that the BIDS reference data is invalid as per the BIDS schema is presumably an artifact of the reference data being linked to the JS validator and not the new schema-synced and schema-loading validator.\n\nThe “error” (which is not an error, it's a proper validation failure) is caused by the following lines, where if validation is not set to “ignore” the dataset will not be detected as valid BIDS: https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\nAdditionally, the dataset you are trying to validate uses inheritance, for which support is not yet merged upstream (and we are not yet loading the upstream code anyway):\nhttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\n\nTo confirm this, you can run:\n```console\nchymera@decohost ~/src/bids-examples $ touch asl003/dandiset.yaml\nchymera@decohost ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\nchymera@decohost ~/src/bids-examples $ touch asl003/CHANGES\nchymera@decohost ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n```\n\nThis should work.\n\nThere are `bids-examples` datasets which have CHANGES, but by a funny coincidence, they all use inheritance, meaning that our validator would still fail.\n\nWe have the following options:\n1. The best option: convince BIDS to drop the mandatory presence of CHANGES. There is no need for this to be mandatory.\n2. The second-best option: create empty CHANGES files in all our archives.\n3. The meh option: accept missing files by default (i.e. without `validation=\"ignore\"`).\n4. The absolute worst: hard-code that CHANGES is not actually required.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658234664,"metadata":{"github-id":"IC_kwDODBZtRc5G3tE6","github-url":"https://github.com/dandi/dandi-cli/issues/1055#issuecomment-1189007674"},"message":"According to the spec\nhttps://bids-specification.readthedocs.io/en/stable/03-modality-agnostic-files.html#changes\nit does not appear to be mandatory.\n\nOn Tue, Jul 19, 2022, 3:06 AM Horea Christian ***@***.***\u003e\nwrote:\n\n\u003e Ok, so I tracked this down. The issue I assume is the datasets lack the\n\u003e CHANGES file which BIDS insists is mandatory. The fact that the BIDS\n\u003e reference data is invalid as per the BIDS schema is presumably an artifact\n\u003e of the reference data being linked to the JS validator and not the new\n\u003e schema-synced and schema-loading validator.\n\u003e\n\u003e The “error” (which is not an error, it's a proper validation failure) is\n\u003e caused by the following lines, where if validation is not set to “ignore”\n\u003e the dataset will not be detected as valid BIDS:\n\u003e https://github.com/dandi/dandi-cli/blob/97fe900730c4d3723ae094402d704505c8677826/dandi/upload.py#L451-L452\n\u003e\n\u003e Additionally, the dataset you are trying to validate, uses inheritance,\n\u003e for which support is not yet merged upstream (and we are not yet using the\n\u003e upstream code anyway):\n\u003e bids-standard/bids-specification#1120 (comment)\n\u003e \u003chttps://github.com/bids-standard/bids-specification/pull/1120#discussion_r923678005\u003e\n\u003e\n\u003e To confirm this, you can run:\n\u003e\n\u003e ***@***.*** ~/src/bids-examples $ touch asl003/dandiset.yaml\n\u003e ***@***.*** ~/src/bids-examples $ dandi upload --validation=ignore -i dandi-staging asl003/\n\u003e ***@***.*** ~/src/bids-examples $ touch asl003/CHANGES\n\u003e ***@***.*** ~/src/bids-examples $ dandi upload -i dandi-staging asl003/\n\u003e\n\u003e This should work.\n\u003e\n\u003e There are bids-examples datasets which have CHANGES, but by a funny\n\u003e coincidence, they all use inheritance, meaning that our validator would\n\u003e still fail.\n\u003e\n\u003e We have the following options:\n\u003e\n\u003e    1. The best option, convince BIDS to drop the mandatory presence of\n\u003e    CHANGES. There is no need for this to be mandatory.\n\u003e    2. The second-best option, create empty CHANGES files on all our\n\u003e    archives.\n\u003e    3. The worst, hard-code that CHANGES is not actually required.\n\u003e\n\u003e —\n\u003e Reply to this email directly, view it on GitHub\n\u003e \u003chttps://github.com/dandi/dandi-cli/issues/1055#issuecomment-1188679524\u003e,\n\u003e or unsubscribe\n\u003e \u003chttps://github.com/notifications/unsubscribe-auth/AABM574HOFTAOVXMPCLM54TVUZHWLANCNFSM53COAGXA\u003e\n\u003e .\n\u003e You are receiving this because you are subscribed to this thread.Message\n\u003e ID: ***@***.***\u003e\n\u003e","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658242074,"metadata":{"github-id":"IC_kwDODBZtRc5G4Pq_","github-url":"https://github.com/dandi/dandi-cli/issues/1055#issuecomment-1189149375"},"message":"nicely done wise @satra, indeed I do not think it is required -- I filed https://github.com/bids-standard/bids-specification/pull/1151 .\n\n@TheChymera the point then is to alert the user that \"I have found BIDS dataset at location {path} but it is not valid ({len(errors)} errors detected) so it will not be considered as BIDS dataset for download\" in case of `--validation` is not skip or ignore.  If it is `skip` or `ignore` -- BIDS dataset, even if invalid, should get its files uploaded.","files":null},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658934712,"metadata":{"github-id":"LE_lADODBZtRc5NdRRLzwAAAAGloz3d"},"added":["BIDS"],"removed":[]},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658934712,"metadata":{"github-id":"LE_lADODBZtRc5NdRRLzwAAAAGloz3h"},"added":["cmd-upload"],"removed":[]},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1670276634,"metadata":{"github-id":"IC_kwDODBZtRc5Pw46J","github-url":"https://github.com/dandi/dandi-cli/issues/1055#issuecomment-1338216073"},"message":"@yarikoptic I think this works pending https://github.com/dandi/dandi-cli/pull/1164 , since I've been uploading datasets as part of the `ls` debugging all day. Do you want to test it locally as well, or can I close?","files":null},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1671557255,"metadata":{"github-id":"IC_kwDODBZtRc5RDeoh","github-url":"https://github.com/dandi/dandi-cli/issues/1055#issuecomment-1359866401"},"message":"haven't had any issues with upload, and we have extensive tests. Given no reply to the message above I'll close this. Feel free to reopen and ping me if you encounter this again.","files":null},{"type":4,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1671557255,"metadata":{"github-id":"CE_lADODBZtRc5NdRRLzwAAAAHhoguq"},"status":2}]}