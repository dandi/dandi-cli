{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1717456463,"metadata":{"github-id":"UCE_lAHODBZtRc6LArKezlyWAmI"},"target":"45d23687deb6a75ed6d44bf7d452d656ebd4351f10b3a3c20723d57ab844bb7d","message":"The underlying trigger for the issue is\n\n- https://github.com/dandi/dandi-archive/issues/1944\n\nwhere assets started to fail validation, preventing publishing of dandisets, only when already on the archive.  It boiled down to the fails in validation against `jsonschema` export of pydantic models which is done to guarantee that meditor validation could be done online (thus in JS), and the difference in treating `date-time` format by jsonschema and pydantic (datetime).\n\nLooking at the code, in dandi-archive we do\n\n```python\nfrom dandischema.metadata import aggregate_assets_summary, validate\n...\n            metadata = asset.published_metadata()\n            validate(metadata, schema_key='PublishedAsset', json_validation=True)\n```\n\nwhile in the dandi-cli we do not use `dandischema..validate` construct and rather \n\n```\n        try:\n            asset = self.get_metadata(digest=self._DUMMY_DIGEST)\n            BareAsset(**asset.model_dump())\n        except ValidationError as e:\n            if devel_debug:\n                raise\n            return _pydantic_errors_to_validation_results(\n                e, self.filepath, scope=Scope.FILE\n            )\n```\n\nso in effect only validating against Pydantic (and for a BareAsset).\n\nedit 1:  moreover we do not even get to above from NWBAsset.get_validation_errors due to\n\n```python\n        if schema_version is not None:\n            errors.extend(\n                super().get_validation_errors(\n                    schema_version=schema_version, devel_debug=devel_debug\n                )\n            )\n        else:\n            # make sure that we have some basic metadata fields we require\n            try:\n                origin = ValidationOrigin(\n                    name=\"nwbinspector\",\n                    version=str(_get_nwb_inspector_version()),\n                )\n\n                for error in inspect_nwbfile(\n...\n```\n\nso we solely rely on nwbinspector inspection for NWB file but that one does not care about `dandischema` \"directly\". So we might want to change that one way or another...\n\nWe should harmonize, and I feel that here we should use `dandischema.metadata.validate`.  I think it also aligns better with our desire to separate models from intended \"validity\" assumptions.","files":null}]}