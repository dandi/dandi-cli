{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1742311644,"metadata":{"github-id":"UCE_lAHODBZtRc6uk1NaznTlGvw"},"target":"414bf3fcbdba65bb817782e842034cdc5922d1abbc595e0f6da4a57360acb170","message":"Observed in the logs kindly provided by @Kevancic \n\n```shell\n❯ grep 'download failed after' 2025.03.17-13.22.01Z-29148.log | grep dandidownload\n2025-03-17T19:06:51-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/14.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:56-0400 [DEBUG   ] dandi 29148:140441118824192 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/15.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:57-0400 [DEBUG   ] dandi 29148:140441637340928 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/16.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:08:31-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/17.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:52-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/82.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:55-0400 [DEBUG   ] dandi 29148:140441622124288 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/80.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:58-0400 [DEBUG   ] dandi 29148:140442184173312 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/83.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:29:32-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/84.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n```\n\nand I bet this is just a tip of the iceberg -- there might be more of such potentially broken [*] zarrs . \n\nInterestingly, we observe those \"folders\" \n- directly on S3 (run `aws s3 ls s3://dandiarchive/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/0/1/0/ --no-sign-request | grep dandidownload`)\n- in datalad datasets https://github.com/dandizarrs/6c80a9a2-7955-48f3-ac69-84cdf101a695/tree/draft/0/1/0\n- on webdav but only in dandisets/ endpoints (https://webdav.dandiarchive.org/dandisets/000026/draft/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/)\n\nbut not in \n- zarr manifest files\n- and thus not /zarrs/ endpoint on webdav: https://webdav.dandiarchive.org/zarrs/6c8/0a9/6c80a9a2-7955-48f3-ac69-84cdf101a695/5b8c4a0cd968b1fe1a9017d06a8605fc-17807--26781820728.zarr/0/1/0/\n\nTODOs here:\n\n- [ ] make dandi-cli error out on attempt to upload anything with such an internal suffix.\n- [ ] make dandi-cli issue a warning and skip attempt to download remote blob or a file within zarr with such a suffix\n\nTODOs elsewhere\n- see which zarrs (and dandisets) were effected - I will run find across dandizarrs on drogon\n- see which blobs were effected if any - I will run find across dandisets on drogon (edit: none found using `/mnt/backup/dandi/dandisets$ tools/check_dandidownload 00*`)\n- alert owners of the dandisets and work out clean up procedure \n\n[*] they could potentially be not really broken since zarr structure would just ignore those folders, but they are indication that there was incomplete/interrupted without clean up download.  So they are if not necessarily broken, they have \"garbage\" in them which should be \"analyzed\" and cleaned up.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1742314052,"metadata":{"github-id":"UCE_lAHODBZtRc6uk1NaznTmaW4"},"target":"414bf3fcbdba65bb817782e842034cdc5922d1abbc595e0f6da4a57360acb170","message":"Observed in the logs kindly provided by @Kevancic \n\n```shell\n❯ grep 'download failed after' 2025.03.17-13.22.01Z-29148.log | grep dandidownload\n2025-03-17T19:06:51-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/14.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:56-0400 [DEBUG   ] dandi 29148:140441118824192 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/15.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:57-0400 [DEBUG   ] dandi 29148:140441637340928 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/16.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:08:31-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/17.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:52-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/82.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:55-0400 [DEBUG   ] dandi 29148:140441622124288 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/80.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:58-0400 [DEBUG   ] dandi 29148:140442184173312 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/83.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:29:32-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/84.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n```\n\nand I bet this is just a tip of the iceberg -- there might be more of such potentially broken [*] zarrs . \n\nInterestingly, we observe those \"folders\" \n- directly on S3 (run `aws s3 ls s3://dandiarchive/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/0/1/0/ --no-sign-request | grep dandidownload`)\n- in datalad datasets https://github.com/dandizarrs/6c80a9a2-7955-48f3-ac69-84cdf101a695/tree/draft/0/1/0\n- on webdav but only in dandisets/ endpoints (https://webdav.dandiarchive.org/dandisets/000026/draft/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/)\n\nbut not in \n- zarr manifest files\n- and thus not /zarrs/ endpoint on webdav: https://webdav.dandiarchive.org/zarrs/6c8/0a9/6c80a9a2-7955-48f3-ac69-84cdf101a695/5b8c4a0cd968b1fe1a9017d06a8605fc-17807--26781820728.zarr/0/1/0/\n\nTODOs here:\n\n- [ ] make dandi-cli error out on attempt to upload anything with such an internal suffix.\n- [ ] make dandi-cli issue a warning and skip attempt to download remote blob or a file within zarr with such a suffix\n\nTODOs elsewhere\n- see which zarrs (and dandisets) were effected - I will run find across dandizarrs on drogon -- just two\n```\ndandi@drogon:/mnt/backup/dandi/dandizarrs/tools$ ./check_zarrs_dandidownload\n6c80a9a2-7955-48f3-ac69-84cdf101a695    4\n90be89e5-d7b4-4675-9851-79472b36df57    4\n```\n- see which blobs were effected if any - I will run find across dandisets on drogon (edit: none found using `/mnt/backup/dandi/dandisets$ tools/check_dandidownload 00*`)\n- alert owners of the dandisets and work out clean up procedure \n\n[*] they could potentially be not really broken since zarr structure would just ignore those folders, but they are indication that there was incomplete/interrupted without clean up download.  So they are if not necessarily broken, they have \"garbage\" in them which should be \"analyzed\" and cleaned up.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1742320075,"metadata":{"github-id":"UCE_lAHODBZtRc6uk1NaznTpXjc"},"target":"414bf3fcbdba65bb817782e842034cdc5922d1abbc595e0f6da4a57360acb170","message":"Observed in the logs kindly provided by @Kevancic \n\n```shell\n❯ grep 'download failed after' 2025.03.17-13.22.01Z-29148.log | grep dandidownload\n2025-03-17T19:06:51-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/14.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:56-0400 [DEBUG   ] dandi 29148:140441118824192 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/15.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:57-0400 [DEBUG   ] dandi 29148:140441637340928 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/16.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:08:31-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/17.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:52-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/82.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:55-0400 [DEBUG   ] dandi 29148:140441622124288 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/80.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:58-0400 [DEBUG   ] dandi 29148:140442184173312 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/83.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:29:32-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/84.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n```\n\nand I bet this is just a tip of the iceberg -- there might be more of such potentially broken [*] zarrs . \n\nInterestingly, we observe those \"folders\" \n- directly on S3 (run `aws s3 ls s3://dandiarchive/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/0/1/0/ --no-sign-request | grep dandidownload`)\n- in datalad datasets https://github.com/dandizarrs/6c80a9a2-7955-48f3-ac69-84cdf101a695/tree/draft/0/1/0\n- on webdav but only in dandisets/ endpoints (https://webdav.dandiarchive.org/dandisets/000026/draft/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/)\n\nbut not in \n- zarr manifest files\n- and thus not /zarrs/ endpoint on webdav: https://webdav.dandiarchive.org/zarrs/6c8/0a9/6c80a9a2-7955-48f3-ac69-84cdf101a695/5b8c4a0cd968b1fe1a9017d06a8605fc-17807--26781820728.zarr/0/1/0/\n\nTODOs here:\n\n- [ ] make dandi-cli error out on attempt to upload anything with such an internal suffix.\n- [ ] make dandi-cli issue a warning and skip attempt to download remote blob or a file within zarr with such a suffix\n\nTODOs elsewhere\n- see which zarrs (and dandisets) were effected - I will run find across dandizarrs on drogon -- just two\n```\ndandi@drogon:/mnt/backup/dandi/dandizarrs/tools$ ./check_zarrs_dandidownload\n6c80a9a2-7955-48f3-ac69-84cdf101a695    4\n90be89e5-d7b4-4675-9851-79472b36df57    4\n```\n\u003cdetails\u003e\n\u003csummary\u003ethose two assets metadata -- both for 000026 : sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr and sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr \u003c/summary\u003e \n\n```shell\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/' | jq .\n{\n  \"name\": \"sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr\",\n  \"dandiset\": \"000026\",\n  \"zarr_id\": \"6c80a9a2-7955-48f3-ac69-84cdf101a695\",\n  \"status\": \"Pending\",\n  \"checksum\": null,\n  \"file_count\": 0,\n  \"size\": 0\n}\n# round-trip check to confirm that name corresponds\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/webdav/assets/atpath/?dandiset_id=000026\u0026version_id=draft\u0026path=sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr' | jq .results[0].resource.zarr\n\"6c80a9a2-7955-48f3-ac69-84cdf101a695\"\n\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/zarr/90be89e5-d7b4-4675-9851-79472b36df57/' | jq .\n{\n  \"name\": \"sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr\",\n  \"dandiset\": \"000026\",\n  \"zarr_id\": \"90be89e5-d7b4-4675-9851-79472b36df57\",\n  \"status\": \"Pending\",\n  \"checksum\": null,\n  \"file_count\": 0,\n  \"size\": 0\n}\n# round-trip check to confirm that name corresponds\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/webdav/assets/atpath/?dandiset_id=000026\u0026version_id=draft\u0026path=sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr' | jq .results[0].resource.zarr\n\"90be89e5-d7b4-4675-9851-79472b36df57\"\n```\n\u003c/details\u003e\n\n- see which blobs were effected if any - I will run find across dandisets on drogon (edit: none found using `/mnt/backup/dandi/dandisets$ tools/check_dandidownload 00*`)\n- alert owners of the dandisets and work out clean up procedure \n\n[*] they could potentially be not really broken since zarr structure would just ignore those folders, but they are indication that there was incomplete/interrupted without clean up download.  So they are if not necessarily broken, they have \"garbage\" in them which should be \"analyzed\" and cleaned up.","files":null},{"type":6,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1756155572,"metadata":{"github-id":"UCE_lAHODBZtRc6uk1Nazoazi68"},"target":"414bf3fcbdba65bb817782e842034cdc5922d1abbc595e0f6da4a57360acb170","message":"Observed in the logs kindly provided by @Kevancic \n\n```shell\n❯ grep 'download failed after' 2025.03.17-13.22.01Z-29148.log | grep dandidownload\n2025-03-17T19:06:51-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/14.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:56-0400 [DEBUG   ] dandi 29148:140441118824192 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/15.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:57-0400 [DEBUG   ] dandi 29148:140441637340928 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/16.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:08:31-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/17.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:52-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/82.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:55-0400 [DEBUG   ] dandi 29148:140441622124288 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/80.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:58-0400 [DEBUG   ] dandi 29148:140442184173312 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/83.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:29:32-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/84.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n```\n\nand I bet this is just a tip of the iceberg -- there might be more of such potentially broken [*] zarrs . \n\nInterestingly, we observe those \"folders\" \n- directly on S3 (run `aws s3 ls s3://dandiarchive/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/0/1/0/ --no-sign-request | grep dandidownload`)\n- in datalad datasets https://github.com/dandizarrs/6c80a9a2-7955-48f3-ac69-84cdf101a695/tree/draft/0/1/0\n- on webdav but only in dandisets/ endpoints (https://webdav.dandiarchive.org/dandisets/000026/draft/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/)\n\nbut not in \n- zarr manifest files\n- and thus not /zarrs/ endpoint on webdav: https://webdav.dandiarchive.org/zarrs/6c8/0a9/6c80a9a2-7955-48f3-ac69-84cdf101a695/5b8c4a0cd968b1fe1a9017d06a8605fc-17807--26781820728.zarr/0/1/0/\n\nTODOs here:\n\n- [x] make dandi-cli error out on attempt to upload anything with such an internal suffix.\n- [ ] make dandi-cli issue a warning and skip attempt to download remote blob or a file within zarr with such a suffix\n\nTODOs elsewhere\n- see which zarrs (and dandisets) were effected - I will run find across dandizarrs on drogon -- just two\n```\ndandi@drogon:/mnt/backup/dandi/dandizarrs/tools$ ./check_zarrs_dandidownload\n6c80a9a2-7955-48f3-ac69-84cdf101a695    4\n90be89e5-d7b4-4675-9851-79472b36df57    4\n```\n\u003cdetails\u003e\n\u003csummary\u003ethose two assets metadata -- both for 000026 : sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr and sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr \u003c/summary\u003e \n\n```shell\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/' | jq .\n{\n  \"name\": \"sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr\",\n  \"dandiset\": \"000026\",\n  \"zarr_id\": \"6c80a9a2-7955-48f3-ac69-84cdf101a695\",\n  \"status\": \"Pending\",\n  \"checksum\": null,\n  \"file_count\": 0,\n  \"size\": 0\n}\n# round-trip check to confirm that name corresponds\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/webdav/assets/atpath/?dandiset_id=000026\u0026version_id=draft\u0026path=sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr' | jq .results[0].resource.zarr\n\"6c80a9a2-7955-48f3-ac69-84cdf101a695\"\n\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/zarr/90be89e5-d7b4-4675-9851-79472b36df57/' | jq .\n{\n  \"name\": \"sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr\",\n  \"dandiset\": \"000026\",\n  \"zarr_id\": \"90be89e5-d7b4-4675-9851-79472b36df57\",\n  \"status\": \"Pending\",\n  \"checksum\": null,\n  \"file_count\": 0,\n  \"size\": 0\n}\n# round-trip check to confirm that name corresponds\n❯ curl --silent -X 'GET' 'https://api.dandiarchive.org/api/webdav/assets/atpath/?dandiset_id=000026\u0026version_id=draft\u0026path=sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr' | jq .results[0].resource.zarr\n\"90be89e5-d7b4-4675-9851-79472b36df57\"\n```\n\u003c/details\u003e\n\n- see which blobs were effected if any - I will run find across dandisets on drogon (edit: none found using `/mnt/backup/dandi/dandisets$ tools/check_dandidownload 00*`)\n- alert owners of the dandisets and work out clean up procedure \n\n[*] they could potentially be not really broken since zarr structure would just ignore those folders, but they are indication that there was incomplete/interrupted without clean up download.  So they are if not necessarily broken, they have \"garbage\" in them which should be \"analyzed\" and cleaned up.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1756158159,"metadata":{"github-id":"CE_lADODBZtRc6uk1NazwAAAASANkNU"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1756158292,"metadata":{"github-id":"IC_kwDODBZtRc7ACVfX","github-url":"https://github.com/dandi/dandi-cli/issues/1594#issuecomment-3221837783"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.71.2`](https://github.com/dandi/dandi-cli/releases/tag/0.71.2) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1756158293,"metadata":{"github-id":"LE_lADODBZtRc6uk1NazwAAAASANqZN"},"added":["released"],"removed":[]},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1756158623,"metadata":{"github-id":"IC_kwDODBZtRc7ACYOP","github-url":"https://github.com/dandi/dandi-cli/issues/1594#issuecomment-3221848975"},"message":"@yarikoptic Did you want to re-open this to track progress on 'make dandi-cli issue a warning and skip attempt to download remote blob or a file within zarr with such a suffix'?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1756208331,"metadata":{"github-id":"IC_kwDODBZtRc7AJ3Rb","github-url":"https://github.com/dandi/dandi-cli/issues/1594#issuecomment-3223811163"},"message":"did in \n- #1697 \n\nand then closed after analysis","files":null}]}