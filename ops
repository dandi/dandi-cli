{"version":2,"ops":[{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1753217152,"metadata":{"github-id":"IC_kwDODBZtRc65Dyl3","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3104778615"},"message":"Hi @yarikoptic, could you please prioritize this issue?  For LINC, we are running this upload on an acquisition computer which fills up pretty quickly, so this is a blocker for new acquisitions.  Thank you.\n\ncc @satra @ayendiki","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753219234,"metadata":{"github-id":"IC_kwDODBZtRc65EITQ","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3104867536"},"message":"So there is already a retry mechanism for things like this but from the screenshot it seems that status code 403 was not triggering it (never heard of that one before...)\n\nI tried adding it to the allowed retry status codes in #1664, could you give that branch a try?\n\nAs far as exposing the actual number of retries, there could be a path forward but before I open that PR up and go down that rabbit hole, maybe let us confirm that the default retry parameters are insufficient for you","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1753219925,"metadata":{"github-id":"IC_kwDODBZtRc65EOlG","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3104893254"},"message":"Hi @calvinchai, could you please try #1664 this week on the acquisition computer?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1753287252,"metadata":{"github-id":"IC_kwDODBZtRc65U-AA","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3109281792"},"message":"@calvinchai did you have success uploading/copying such large files to outside (ideally to AWS S3) using any other tool?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753384985,"metadata":{"github-id":"IC_kwDODBZtRc65pXPR","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3114628049"},"message":"\u003e Hi [@calvinchai](https://github.com/calvinchai), could you please try [#1664](https://github.com/dandi/dandi-cli/pull/1664) this week on the acquisition computer?\n\nSure I will try it.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753385052,"metadata":{"github-id":"IC_kwDODBZtRc65pYzp","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3114634473"},"message":"\u003e [@calvinchai](https://github.com/calvinchai) did you have success uploading/copying such large files to outside (ideally to AWS S3) using any other tool?\n\nNot yet. I can try though. When we encountered the similar issue during download it can be resolved if the downloading client support resume from last time.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1753390107,"metadata":{"github-id":"IC_kwDODBZtRc65qXd_","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3114891135"},"message":"do you encounter also 403 during download too?\n\nfor download we also implemented an additional mode which would be very aggressively retrying , so if regular download does not work, may be try with `DANDI_DOWNLOAD_AGGRESSIVE_RETRY=1` env var set, but IIRC it also would not care about 403","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753453234,"metadata":{"github-id":"IC_kwDODBZtRc652QEh","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3118006561"},"message":"\u003e do you encounter also 403 during download too?\n\u003e \n\u003e for download we also implemented an additional mode which would be very aggressively retrying , so if regular download does not work, may be try with `DANDI_DOWNLOAD_AGGRESSIVE_RETRY=1` env var set, but IIRC it also would not care about 403\n\nI believe so. either 403 or 400. I will try it once i got a chance.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753453282,"metadata":{"github-id":"IC_kwDODBZtRc652RS4","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3118011576"},"message":"\u003e Hi [@calvinchai](https://github.com/calvinchai), could you please try [#1664](https://github.com/dandi/dandi-cli/pull/1664) this week on the acquisition computer?\n\nThank you Kabi. I am uploading 3 zarr archives now and I will let you know if they succeed or got interrupted.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753710354,"metadata":{"github-id":"IC_kwDODBZtRc66ZyWw","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3127322032"},"message":"Hello. I think the 403 error is solved but now it does not retry when there is a 400 error, which is what blocks the upload now.\n\n\u003cimg width=\"2547\" height=\"758\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/4876a36e-e957-4d10-a84d-45fd5932f409\" /\u003e","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1753712595,"metadata":{"github-id":"IC_kwDODBZtRc66aYfd","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3127478237"},"message":"thanks @calvinchai . It should have also reported on a log file. Could you share that one somehow -- may be there is more information in there on those 400 .","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753724888,"metadata":{"github-id":"IC_kwDODBZtRc66drfO","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3128342478"},"message":"[2025.07.25-14.41.44Z-4093715.log](https://github.com/user-attachments/files/21474598/2025.07.25-14.41.44Z-4093715.log)\nHere is the log file, thank you!","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753725384,"metadata":{"github-id":"IC_kwDODBZtRc66dzKA","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3128373888"},"message":"@yarikoptic Isolated at \n\n```\n2025-07-25T15:27:01-0400 [ERROR   ] dandi 4093715:139782118172416 Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/f2cac250-3caf-4867-a37c-bfa3debe25b7/0/c/0/3/5?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250725%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250725T190558Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=2683ff87710df41364d44c17d6b3a70fa6f01195e0e6b3266dbc4e54c9ae762d: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eRequestTimeout\u003c/Code\u003e\u003cMessage\u003eYour socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed.\u003c/Message\u003e\u003cRequestId\u003eYN8G4XPQJBBRDCR7\u003c/RequestId\u003e\u003cHostId\u003eONz37yKZyqkUX049XzizXShQ2eNyAdFtqxVLKytGNdQ+AofxuBObNybrfHJm3CyZKquK1KFBIqkkiNTZSGpV4C2p6hmHzVAJ\u003c/HostId\u003e\u003c/Error\u003e\n```\n\nMaybe it might be fair to include retries for `400` in this case too? So it re-opens the previously idle socket","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753726266,"metadata":{"github-id":"IC_kwDODBZtRc66d-ZW","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3128419926"},"message":"Received confirmation to try including retry for 400 from Yarik\n\nPlease retry #1664 again @calvinchai","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753728038,"metadata":{"github-id":"IC_kwDODBZtRc66eRLv","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3128496879"},"message":"Thanks! I am reuploading the failed assets.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753798125,"metadata":{"github-id":"IC_kwDODBZtRc66uYLX","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3132719831"},"message":"Hello, I found that the upload still gives the same error. \n`Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5d427fec-df97-40d2-b69e-f7e9`\nHere is the log file:\n\n[2025.07.28-18.31.03Z-1315115.log](https://github.com/user-attachments/files/21490919/2025.07.28-18.31.03Z-1315115.log)","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753800445,"metadata":{"github-id":"IC_kwDODBZtRc66vC-1","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3132895157"},"message":"@calvinchai Just to be certain, you did run `git pull` on your copy of the branch to get the latest changes including the `400` retry? I ask because I don't see any logger warnings saying retry was triggered\n\nThat said the logs also indicate a number of connection pool (too big) / socket (timeout) issues - @asmacdo from the team suggested during a meeting that reducing concurrency might limit the number of sockets that get opened and left hanging\n\nCould you also try adding `--jobs 1:1` flag to your `dandi upload` command just to see if that results in the same error? (the process, especially digesting, will likely take longer - apologies about that, but if it works it will tell us something)","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753805158,"metadata":{"github-id":"IC_kwDODBZtRc66wGCv","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3133169839"},"message":"\u003cimg width=\"725\" height=\"423\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/9aa294c6-aa38-4532-af7b-69eff101a7c4\" /\u003e\nit has been updated and reinstalled. I am uploading with the jobs flag and will update with you!","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1753806340,"metadata":{"github-id":"IC_kwDODBZtRc66wVWq","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3133232554"},"message":"FWIW according to the log 2025.07.28-18.31.03Z-1315115.log shared\n\n\u003cdetails\u003e\n\u003csummary\u003ewe did retry to upload that one a few times\u003c/summary\u003e \n\n```shell\n❯ grep '9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2' 2025.07.28-18.31.03Z-1315115.log | sed -e 's,X-Amz-Credential=[A-Z0-9]*,X-Amz-Credential=SENSORED,g'\n2025-07-28T21:01:04-0400 [DEBUG   ] dandi 1315115:139966424258304 PUT https://dandiarchive.s3.amazonaws.com/zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a\n2025-07-28T21:33:21-0400 [DEBUG   ] urllib3.connectionpool 1315115:139966424258304 https://dandiarchive.s3.amazonaws.com:443 \"PUT /zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a HTTP/1.1\" 400 None\n2025-07-28T21:33:21-0400 [ERROR   ] dandi 1315115:139966424258304 Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n2025-07-28T21:33:21-0400 [DEBUG   ] dandi 1315115:139969184114432 Error uploading zarr: HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n2025-07-29T09:35:49-0400 [DEBUG   ] dandi 1315115:139976736883712 Caught exception Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/9da4a6ac-9af5-4c87-b228-d78cbff3c531/0/c/0/3/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORED%2F20250729%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250729T010104Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=d5ecf8d5ab2061a7215b78717f91fe6f322e8008504806f40e755ef42668e46a: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n```\n\u003c/details\u003e\n\ngood idea on trying to reduce concurrency!","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753807155,"metadata":{"github-id":"IC_kwDODBZtRc66wfWK","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3133273482"},"message":"@yarikoptic Hmmm indeed interesting that occured multiple times, but I was looking for specifically this warning about retries: https://github.com/dandi/dandi-cli/blob/17cc92387a4e5d266ba3441c47cd3aab8b47d239/dandi/dandiapi.py#L232 to ensure it was actually triggering that block\n\nAny ideas why that wouldn't be in the log file?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753897786,"metadata":{"github-id":"IC_kwDODBZtRc66_4bp","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3137308393"},"message":"This is the log from the most recent attempt. I ran with `--job 1:1` flag. and it gave 403 error again. \n\n[2025.07.29-16.05.14Z-1706317.log](https://github.com/user-attachments/files/21515333/2025.07.29-16.05.14Z-1706317.log)","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753899416,"metadata":{"github-id":"IC_kwDODBZtRc67AKiD","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3137382531"},"message":"Bummer\n\nJust to check really quickly based off of lines around #800 from the log - how are you installing the test branch from https://github.com/dandi/dandi-cli/pull/1664?\n\nStill puzzled as to why we don't see any logger info about attempted retries, such as https://github.com/dandi/dandi-cli/blob/17cc92387a4e5d266ba3441c47cd3aab8b47d239/dandi/dandiapi.py#L231-L232\n\nwhich likely implies they just aren't happening","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753970341,"metadata":{"github-id":"IC_kwDODBZtRc67Kem4","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3140086200"},"message":"I pulled the repo, switched to `add_403_to_retry` branch, and installed it with 'pip install -e ./'. I will try again and see if it gives different result","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753976627,"metadata":{"github-id":"IC_kwDODBZtRc67L5UP","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3140457743"},"message":"Hello dandi team, I recreated the environment and tried uploading again and here is the log. \n\n[2025.07.31-14.00.30Z-2524192.log](https://github.com/user-attachments/files/21533679/2025.07.31-14.00.30Z-2524192.log)\n\nThis time I have this line at the end of the ouput \n```\nError: 403 Client Error: Forbidden for url: https://dandiarchive.s3.amazonaws.com/zarr/ecf0f948-37ed-4d03-8bc8-c8500ffeac3a/0/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250731%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250731T142749Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=74ac5c83a28f653cf47458c5704afc43de7145eb90009b4531076d485050a8ec  \n```","files":null},{"type":6,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753977354,"metadata":{"github-id":"UCE_lALODBZtRc67L5UPznIlD-I"},"target":"df1dec3072cd0166995c9f9675aeaebb2ad4cb53019d2a92b7cf21997310c52b","message":"Hello dandi team, I recreated the environment and tried uploading again and here is the log. \n\n[2025.07.31-14.00.30Z-2524192.log](https://github.com/user-attachments/files/21533679/2025.07.31-14.00.30Z-2524192.log)\n\nThis time I have this line at the end of the ouput \n```\nError: 403 Client Error: Forbidden for url: https://dandiarchive.s3.amazonaws.com/zarr/ecf0f948-37ed-4d03-8bc8-c8500ffeac3a/0/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=???us-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250731T142749Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=74ac5c83a28f653cf47458c5704afc43de7145eb90009b4531076d485050a8ec  \n```","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1753977664,"metadata":{"github-id":"IC_kwDODBZtRc67MGQs","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3140510764"},"message":"\u003e  pulled the repo, switched to add_403_to_retry branch, and installed it with 'pip install -e ./'.\n\nYou may want to pull again from the branch just to be sure it includes the latest 400 changes\n\n(usual workflow on fresh clone is `git checkout \u003cbranch\u003e` -\u003e `git pull` -\u003e `pip install -e .`, then re-pulling on any changes to the branch)\n\n\n\n\u003e [2025.07.31-14.00.30Z-2524192.log](https://github.com/user-attachments/files/21533679/2025.07.31-14.00.30Z-2524192.log)\n\nWell, we do see retry attempts as expected this time! That's progress.\n\nBut the 403 occurs so many times that it is never magically resolved. I really don't know at that point... Silly question, (a) are you uploading to an embargoed Dandiset, and (b) are you listed as an owner on that Dandiset, and (c) you are for sure using your own credentials in the DANDI upload environment?\n\nI can try attempting some things on my end to reproduce the issue but it may be tricky...","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1753983883,"metadata":{"github-id":"IC_kwDODBZtRc67NW6u","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3140841134"},"message":"Yes I just checked that I am using the most recent version. \n\n`https://dandiarchive.org/dandiset/001411`\nThis is the dandi set I am uploading to. I have the full permission on the dataset with the correct credentials as most of the uploads were successful.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754081930,"metadata":{"github-id":"IC_kwDODBZtRc67gHGh","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3145757089"},"message":"Hi DANDI team,\n\nWe’ve had the IP of the AWS bucket bypassed on our network, and downloads are now working fine without any issues.\n\nHowever, we're still encountering consistent upload failures, even with the updated dandi-cli client. The uploads return 400/403 errors. I’ve attached the relevant logs for reference.\n\n[2025.08.01-18.15.12Z-3046165.log](https://github.com/user-attachments/files/21554507/2025.08.01-18.15.12Z-3046165.log)\n\n\u003cimg width=\"2543\" height=\"630\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/1ee17484-c911-44b9-918a-51712e418b44\" /\u003e","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754243834,"metadata":{"github-id":"IC_kwDODBZtRc67q9vz","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3148602355"},"message":"Thanks for trying and the logs! quick one while on a bus:  I think it boils down to URLs we got from the server for upload to already expire by the time we get to upload them. E.g. looking at\n\n```shell\n❯ grep '/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/' 2025.08.01-18.15.12Z-3046165.log | head\n2025-08-01T14:16:23-0400 [DEBUG   ] dandi 3046165:140406842980096 GET https://api.dandiarchive.org/api/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/files\n2025-08-01T14:16:23-0400 [DEBUG   ] urllib3.connectionpool 3046165:140406842980096 https://api.dandiarchive.org:443 \"GET /api/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/files HTTP/1.1\" 301 None\n2025-08-01T14:16:23-0400 [DEBUG   ] urllib3.connectionpool 3046165:140406842980096 https://api.dandiarchive.org:443 \"GET /api/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/files/ HTTP/1.1\" 200 5716\n2025-08-01T15:53:29-0400 [DEBUG   ] dandi 3046165:140406842980096 POST https://api.dandiarchive.org/api/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/files/\n2025-08-01T15:53:29-0400 [DEBUG   ] urllib3.connectionpool 3046165:140406842980096 https://api.dandiarchive.org:443 \"POST /api/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/files/ HTTP/1.1\" 200 13057\n2025-08-01T15:53:29-0400 [DEBUG   ] dandi 3046165:140401994356480 PUT https://dandiarchive.s3.amazonaws.com/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/1/6?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=f5b7c2ccb4f61f040941336d8091697b416162f97236eef56db1b555f1b4403a\n2025-08-01T15:53:29-0400 [DEBUG   ] dandi 3046165:140400929007360 PUT https://dandiarchive.s3.amazonaws.com/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/4/1?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=be88266cd8dc265da8516c31a0e30cad045d3979269344d4f40dd7129dbf7d61\n2025-08-01T15:53:29-0400 [DEBUG   ] dandi 3046165:140401985963776 PUT https://dandiarchive.s3.amazonaws.com/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/4/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=0e92de4e7ada2df4bf17423ada0dc23f293ee84323374b19d323496b71a9d315\n2025-08-01T15:53:29-0400 [DEBUG   ] dandi 3046165:140406280931072 PUT https://dandiarchive.s3.amazonaws.com/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/4/4?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=56c67c305bd7b33830b657ae6ba280b770bcc8cf7c3234171498f94b658dea86\n2025-08-01T15:53:29-0400 [DEBUG   ] dandi 3046165:140404678711040 PUT https://dandiarchive.s3.amazonaws.com/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/4/5?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=107563bee01cb52dc61658a6e3ba86b00c38cb30afd5e55cadf0d8e563c7a4f4\n❯ grep '/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/0/5' 2025.08.01-18.15.12Z-3046165.log | head -n 2\n2025-08-01T16:04:01-0400 [DEBUG   ] dandi 3046165:140401985963776 PUT https://dandiarchive.s3.amazonaws.com/zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/0/5?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=51a14a8ffb3e2ee6b25a4a350963df753dbbb5539ccb06203239ef1c964c59f2\n2025-08-01T16:04:10-0400 [DEBUG   ] urllib3.connectionpool 3046165:140401985963776 https://dandiarchive.s3.amazonaws.com:443 \"PUT /zarr/d5a133a3-4a4d-4006-b4ff-4c3d87f9a099/0/c/0/0/5?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250801%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250801T195329Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=51a14a8ffb3e2ee6b25a4a350963df753dbbb5539ccb06203239ef1c964c59f2 HTTP/1.1\" 403 None\n```\n\nI think we are POST to API to get upload URLs at 15:53:29, those URLs come with X-Amz-Expires=600 (10 minutes), we immediately follow with PUTs that are Ok, and the first 403 happens at 16:04:01, so right after that window of 10 minutes after original POST.  \n\nWe need to address it\n- (harder) properly in dandi-cli by re-requesting new/updated upload URLs for those for which we 403 (specifically)\n- (easy, IMHO complimentary) potentially to avoid by extending this arbitrary duration on the server side which mints those URLs: https://github.com/dandi/dandi-archive/pull/2456","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754577769,"metadata":{"github-id":"IC_kwDODBZtRc68nkKO","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3164488334"},"message":"@calvinchai could you try a version from the PR \n- #1674 \n\nwhich is in the branch `bf-zarr-upload`? Let me know if you need more detailed instructions.\n\nIt should address 403 errors, didn't look into 400 (assumed they are just another consequence of the same), so would be interesting to see how well it behaves now with your prior \"heavy parallelization\" --jobs option (and more gentle/serial happen we still experience issues)","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754577846,"metadata":{"github-id":"IC_kwDODBZtRc68nli4","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3164494008"},"message":"will do, thanks!","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754590674,"metadata":{"github-id":"IC_kwDODBZtRc68qhqf","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3165264543"},"message":"[2025.08.07-14.47.45Z-1453583.log](https://github.com/user-attachments/files/21670981/2025.08.07-14.47.45Z-1453583.log)\n\u003cimg width=\"2543\" height=\"466\" alt=\"image\" src=\"https://github.com/user-attachments/assets/55bdeae5-8cde-46c2-9d8a-372a6d4544ca\" /\u003e\nSeems like we only have 400 error now.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754596100,"metadata":{"github-id":"IC_kwDODBZtRc68rfzQ","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3165519056"},"message":"one step forward - hence we can merge the PR on 403s!\n\nI see that you interrupted.  Would you mind carrying it out fully -- I am interested to see if \n\n- we do really get rid of 403s\n- how frequent those 400s, especially if you dial down your --jobs to e.g. `10:10` from `15:15` ;-)\n  - asking your IT on either they have any extra rate limiting inplace on connections might be of benefit to match your `--jobs` to \"correspond\" \n- do we get any clean upload of any zarr for you ;-)\n\nRe `400`s, my observations:  two kinds of 400 happen:\n\n```\n2025-08-07T10:47:48-0400 [ERROR   ] dandi 1453583:140289256302336 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n```\n\nwhich is I guess some collision on the path, since it is used as a name identifying zarr. (current design deficiency, but I think it should have still worked)...  let's tackle it last\n\nAnd the other happens more rapidly on individual paths:\n\n```shell\n❯ grep 'b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2' 2025.08.07-14.47.45Z-1453583.log\n2025-08-07T12:59:25-0400 [DEBUG   ] dandi 1453583:140280703461120 PUT https://dandiarchive.s3.amazonaws.com/zarr/b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T165921Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=21a54bd8ff88bde5d82427f539e2df62b8fafbd7651237e846cf2f3d19919ace\n2025-08-07T13:00:29-0400 [DEBUG   ] urllib3.connectionpool 1453583:140280703461120 https://dandiarchive.s3.amazonaws.com:443 \"PUT /zarr/b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T165921Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=21a54bd8ff88bde5d82427f539e2df62b8fafbd7651237e846cf2f3d19919ace HTTP/1.1\" 400 None\n```\n\nand detail comes in the next line(s)\n\n```\n2025-08-07T13:00:29-0400 [ERROR   ] dandi 1453583:140280703461120 Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T165921Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=21a54bd8ff88bde5d82427f539e2df62b8fafbd7651237e846cf2f3d19919ace: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eRequestTimeout\u003c/Code\u003e\u003cMessage\u003eYour socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed.\u003c/Message\u003e\u003cRequestId\u003e1123142AKNWV9JZ9\u003c/RequestId\u003e\u003cHostId\u003egsKby5XZWnmqVOf6PB2p1ca53dlGjtzC8YUtOFtgGz77grYDK3sydWoSNCtNN7u9zCrm+802gaSnkj8qAXi8S+Ki547Tb+xl24Ogy0A/ESw=\u003c/HostId\u003e\u003c/Error\u003e\n2025-08-07T13:00:29-0400 [DEBUG   ] charset_normalizer 1453583:140280703461120 Encoding detection: utf_8 is most likely the one.\n2025-08-07T13:00:29-0400 [DEBUG   ] charset_normalizer 1453583:140280703461120 Encoding detection: utf_8 is most likely the one.\n```\n\nso - it is again a matter of some time outs.  \n\n\u003cdetails\u003e\n\u003csummary\u003eand even logged by requests itself (in addition to us doing it twice ;-) ):\n\u003c/summary\u003e \n\n```shell\n❯ grep '^requests' 2025.08.07-14.47.45Z-1453583.log\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T165921Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=21a54bd8ff88bde5d82427f539e2df62b8fafbd7651237e846cf2f3d19919ace: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/a3084034-2474-4e2d-b02b-d33d52412146/0/c/0/1/4?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T173754Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=2b3154f72bee62a4128b9ccd1dbde55aca636d95c97053e01a6849de9993db41: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/404cb559-e207-4ad8-9866-04d2d1866596/0/c/0/1/1?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T174024Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=819a48f05bbd20dd363c55017156b94e6cde9455be2bb6a9bec054ae82753bd0: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/cf332c85-b87f-4dfa-908a-85a528fe6a07/0/c/0/2/4?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T175233Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=9b09e21fac80ec486f3491c42c22cc7bcada884ee96ec6aa3c8a86d3f04f1254: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n```\n\u003c/details\u003e\n\nSo\n- we again - time out! (again, the run was quite loaded with `--jobs 15:15`)\n  - workaround, again, might be just lower level of parallelism, as firewall might simply having some rate limiting in place!\n- we might want to increase the timeout and/or do retries for those but not like for 403 since we did not timeout that URL validity duration AFAIK, and rather shorter socket timeout, seems to be in 30 seconds range\n\n```shell\n❯ grep 'b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2' 2025.08.07-14.47.45Z-1453583.log | head -n 2\n2025-08-07T12:59:25-0400 [DEBUG   ] dandi 1453583:140280703461120 PUT https://dandiarchive.s3.amazonaws.com/zarr/b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T165921Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=21a54bd8ff88bde5d82427f539e2df62b8fafbd7651237e846cf2f3d19919ace\n2025-08-07T13:00:29-0400 [DEBUG   ] urllib3.connectionpool 1453583:140280703461120 https://dandiarchive.s3.amazonaws.com:443 \"PUT /zarr/b943c5d4-2e2e-4040-81c0-e2f35e2c496a/1/c/0/0/2?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSOREDF20250807%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250807T165921Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=21a54bd8ff88bde5d82427f539e2df62b8fafbd7651237e846cf2f3d19919ace HTTP/1.1\" 400 None\n```\n\nSo it might be sensible to extend timeout, although if it is firewall rate limiting -- it would be of no help.\n\nSo I will shortly (in the same branch but new PR) propose a solution for that latter kind of 400s, I will ping you there -- please try.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754596351,"metadata":{"github-id":"CE_lADODBZtRc7Brp6gzwAAAARvB1Pb"},"status":2},{"type":4,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1754613031,"metadata":{"github-id":"REE_lADODBZtRc7Brp6gzwAAAARvMufw"},"status":1},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754661142,"metadata":{"github-id":"IC_kwDODBZtRc6808cX","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3167995671"},"message":"@calvinchai please try again from that branch -- there should be less of 400s","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754662074,"metadata":{"github-id":"IC_kwDODBZtRc681MFW","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3168059734"},"message":"Thanks! I am uploading now.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754665482,"metadata":{"github-id":"IC_kwDODBZtRc6814ro","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3168242408"},"message":"I dont think there is a connection limit on our firewall given it has been bypassed. I will confirm with IT if I see that again. We did have some clean upload. From the screenshot, those marked as 100% done are completed successfully.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754920759,"metadata":{"github-id":"IC_kwDODBZtRc69Pk8g","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3174977312"},"message":"Hello Dandi Team,\n\nI do see less 400 Error during upload with updated client. The log file is too big so I will hold it for a moment. Here is a sample line containing the error\n```\n2025-08-08T12:00:29-0400 [WARNING ] dandi 2690118:140244699571968 Will retry: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/87df327c-9c94-492e-a871-9f036963fd2b/0/c/0/5/6?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T155215Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=f831c395a28d362d5ca5b01bc533d6d39a2bafdc2585336d4fcd0f17c723f2d8: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eRequestTimeout\u003c/Code\u003e\u003cMessage\u003eYour socket connection to the server was not read from or written to within the timeout period. Idle connections will be closed.\u003c/Message\u003e\u003cRequestId\u003e6XN9ZT0KG2HAPD5C\u003c/RequestId\u003e\u003cHostId\u003e7oirqTeJOhOumuC0L6e9N4zFgyhyGGaIl0Rp/2U+P3XckWh4zOLxmfPqxSG5zlAlCqJfWfhYbj4=\u003c/HostId\u003e\u003c/Error\u003e\n2025-08-08T12:00:30-0400 [DEBUG   ] urllib3.connectionpool 2690118:140244699571968 Resetting dropped connection: dandiarchive.s3.amazonaws.com\n```\n\n\nI will ask IT at Martinos to see if there is a connection limit.\n\nThank you again for your help!","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1754922013,"metadata":{"github-id":"IC_kwDODBZtRc69P6rZ","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3175066329"},"message":"\u003e  The log file is too big so I will hold it for a moment.\n\nFeel free to email it to me (cody.c.baker.phd@gmail.com) and I can forwrad to others, unless it is even bigger than email attachment limits","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754922783,"metadata":{"github-id":"IC_kwDODBZtRc69QLrI","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3175135944"},"message":"Sent. Thanks!","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1754924537,"metadata":{"github-id":"IC_kwDODBZtRc69Qr9P","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3175268175"},"message":"Did not receive - do you have a google Drive or Dropbox that you can use to share?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754927163,"metadata":{"github-id":"IC_kwDODBZtRc69RYkP","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3175450895"},"message":"here is the link: https://drive.google.com/file/d/12H810LkatKacHkA3IOcstnmGHoEiI_kT/view?usp=drive_link","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754928379,"metadata":{"github-id":"IC_kwDODBZtRc69SAsV","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3175615253"},"message":"Great! #1675 addressed the issue it was aiming to address. Now the rest of 400s there about checksum mismatch, e.g.\n\n```\n❯ grep -A1 'requests.exceptions.HTTPError: Error 400' 2025.08.08-14.00.53Z-2690118.log\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSO%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=SENSOR: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003eSENSO\u003c/RequestId\u003e\u003cHostId\u003e4g1y/SENSOR/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n```\n\nand require more investigation.  E.g. we already had similar cases due to \"odd\" NFS behaviors and thus re-testing for size of the files.    Here, could you please run\n\n```\ndandi digest -d md5 5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3\n```\n\na few times and see if it is `f582944d51bd39d8fd5c75ee4e311671` and/or changes across runs? FWIW `HA4bGwbxSN8WaMC9Tgm7mg==` is base64 of \n```\nIn [8]: b64decode('HA4bGwbxSN8WaMC9Tgm7mg==').hex()\nOut[8]: '1c0e1b1b06f148df1668c0bd4e09bb9a'\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1754928427,"metadata":{"github-id":"IC_kwDODBZtRc69SCPY","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3175621592"},"message":"And I recall observing some IO errors on that filesystem -- I wonder if you have access to logs (`journalctl` ?) to see if anything pops up potentially related from during the upload times?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754933225,"metadata":{"github-id":"IC_kwDODBZtRc69Tj82","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3176021814"},"message":"\u003e And I recall observing some IO errors on that filesystem -- I wonder if you have access to logs (`journalctl` ?) to see if anything pops up potentially related from during the upload times?\n\nI don't have permission for that. I can ask for it. Could you direct me to where you found the IO error?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1754933473,"metadata":{"github-id":"IC_kwDODBZtRc69Tmml","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3176032677"},"message":"\u003e Great! [#1675](https://github.com/dandi/dandi-cli/pull/1675) addressed the issue it was aiming to address. Now the rest of 400s there about checksum mismatch, e.g.\n\u003e \n\u003e ```\n\u003e ❯ grep -A1 'requests.exceptions.HTTPError: Error 400' 2025.08.08-14.00.53Z-2690118.log\n\u003e requests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSO%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=SENSOR: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003e \u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003eSENSO\u003c/RequestId\u003e\u003cHostId\u003e4g1y/SENSOR/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\u003e ```\n\u003e \n\u003e and require more investigation. E.g. we already had similar cases due to \"odd\" NFS behaviors and thus re-testing for size of the files. Here, could you please run\n\u003e \n\u003e ```\n\u003e dandi digest -d md5 5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3\n\u003e ```\n\u003e \n\u003e a few times and see if it is `f582944d51bd39d8fd5c75ee4e311671` and/or changes across runs? FWIW `HA4bGwbxSN8WaMC9Tgm7mg==` is base64 of\n\u003e \n\u003e ```\n\u003e In [8]: b64decode('HA4bGwbxSN8WaMC9Tgm7mg==').hex()\n\u003e Out[8]: '1c0e1b1b06f148df1668c0bd4e09bb9a'\n\u003e ```\n\nDo you mean digest the local file or the one on dandi? I cannot run this command directly as it will just tell me the path does not exist.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755011982,"metadata":{"github-id":"IC_kwDODBZtRc69h_1J","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3179806025"},"message":"\u003e \u003e ```\n\u003e \u003e dandi digest -d md5 5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3\n\u003e \u003e ```\n\u003e \u003e \n\u003e \n\u003e Do you mean digest the local file or the one on dandi? I cannot run this command directly as it will just tell me the path does not exist.\n\non local file. Right, I forgot that the zarr ID is internal. Should be the\n\n```\ndandi digest -d md5 micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr/1/c/0/2/3\n```\n\n**note:** it is not legitimate BIDS standard to have `micr-test-upload-delete-after/` folder... but given the name we are just trying here ;-)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755012710,"metadata":{"github-id":"IC_kwDODBZtRc69iOlx","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3179866481"},"message":"\u003e \u003e And I recall observing some IO errors on that filesystem -- I wonder if you have access to logs (`journalctl` ?) to see if anything pops up potentially related from during the upload times?\n\u003e \n\u003e I don't have permission for that. I can ask for it. Could you direct me to where you found the IO error?\n\nthose came up in the logs and/or communication (display from `dandi download`?) with Kathryn, but I failed to recall details/find on a quick look. Typically would be something observed in the console or in the logs (hence I pointed to journalctl command if systemd is used)...\n\nLooking more -- apparently we get 4 cases at different times for the same error, so it is unlikely to be IO system issue! \n\n```shell\n❯ grep -B1 HA4bGwbxSN8WaMC9Tgm7mg 2025.08.08-14.00.53Z-2690118.log\n2025-08-08T17:31:11-0400 [ERROR   ] dandi 2690118:140248466061056 Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n--\n2025-08-08T17:47:20-0400 [ERROR   ] dandi 2690118:140251427874560 Failed to upload /local_mount/space/megaera/3/users/dandi/001411/micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr/1/c/0/2/3: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n--\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n--\n2025-08-08T23:02:44-0400 [DEBUG   ] dandi 2690118:140258712491008 Caught exception Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n--\nrequests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\n```\n\nwhich is quite odd and thus got never to s3... its neighbors are there ok:\n\n```\n$ aws s3 ls s3://dandiarchive/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/\n2025-08-08 17:24:58  713099119 0\n2025-08-08 17:25:02  706745254 1\n2025-08-08 17:24:56  721242435 2\n```\n\ncould you please just share that file somehow otherwise (`micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr/1/c/0/2/3`) ?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755013744,"metadata":{"github-id":"IC_kwDODBZtRc69ijZC","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3179951682"},"message":"I will get back to you on that. BTW I am wondering do you want me to perform some test for the connection limit? the network engineer we've in contact with is out of office at this moment.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755014997,"metadata":{"github-id":"IC_kwDODBZtRc69jA56","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3180072570"},"message":"well, would not hurt if you could run upload with e.g. `--jobs 5:5` and see if you get many or any of those connection related log lines.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755026350,"metadata":{"github-id":"IC_kwDODBZtRc69lWZy","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3180684914"},"message":"\u003e \u003e \u003e And I recall observing some IO errors on that filesystem -- I wonder if you have access to logs (`journalctl` ?) to see if anything pops up potentially related from during the upload times?\n\u003e \u003e \n\u003e \u003e \n\u003e \u003e I don't have permission for that. I can ask for it. Could you direct me to where you found the IO error?\n\u003e \n\u003e those came up in the logs and/or communication (display from `dandi download`?) with Kathryn, but I failed to recall details/find on a quick look. Typically would be something observed in the console or in the logs (hence I pointed to journalctl command if systemd is used)...\n\u003e \n\u003e Looking more -- apparently we get 4 cases at different times for the same error, so it is unlikely to be IO system issue!\n\u003e \n\u003e ❯ grep -B1 HA4bGwbxSN8WaMC9Tgm7mg 2025.08.08-14.00.53Z-2690118.log\n\u003e 2025-08-08T17:31:11-0400 [ERROR   ] dandi 2690118:140248466061056 Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003e \u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\u003e --\n\u003e 2025-08-08T17:47:20-0400 [ERROR   ] dandi 2690118:140251427874560 Failed to upload /local_mount/space/megaera/3/users/dandi/001411/micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr/1/c/0/2/3: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003e \u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\u003e --\n\u003e requests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003e \u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\u003e --\n\u003e 2025-08-08T23:02:44-0400 [DEBUG   ] dandi 2690118:140258712491008 Caught exception Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003e \u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\u003e --\n\u003e requests.exceptions.HTTPError: Error 400 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/3?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20250808%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250808T212446Z\u0026X-Amz-Expires=600\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=4fb81678cb6cfa9ee74509ccec6dba9ab7ef7f45a2f732fea9011d12eb7e709e: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003e \u003cError\u003e\u003cCode\u003eBadDigest\u003c/Code\u003e\u003cMessage\u003eThe Content-MD5 you specified did not match what we received.\u003c/Message\u003e\u003cCalculatedDigest\u003eHA4bGwbxSN8WaMC9Tgm7mg==\u003c/CalculatedDigest\u003e\u003cExpectedDigest\u003ef582944d51bd39d8fd5c75ee4e311671\u003c/ExpectedDigest\u003e\u003cRequestId\u003ePBDNE2DCC524JY77\u003c/RequestId\u003e\u003cHostId\u003e4g1y/a57R05F5otjsuYiXmiCuqHzDKCs0F902pRyvvRMiU1ECzQuxHxQrCZxOXe7oP/DR7Z0X6U=\u003c/HostId\u003e\u003c/Error\u003e\n\u003e \n\u003e which is quite odd and thus got never to s3... its neighbors are there ok:\n\u003e \n\u003e ```\n\u003e $ aws s3 ls s3://dandiarchive/zarr/5adc93d2-bfe6-4133-8281-a947e197863f/1/c/0/2/\n\u003e 2025-08-08 17:24:58  713099119 0\n\u003e 2025-08-08 17:25:02  706745254 1\n\u003e 2025-08-08 17:24:56  721242435 2\n\u003e ```\n\u003e \n\u003e could you please just share that file somehow otherwise (`micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr/1/c/0/2/3`) ?\n\nI checked the digest for a few time. It is constantly 'f582944d51bd39d8fd5c75ee4e311671'. Also, I don't think the checksum is a problem with the file itself because if we reupload it, it can be reuploaded without any issue. \nhttps://drive.google.com/file/d/1Fp-nPL3IlTzSQ3BKfQWU9sp7AhJlc75h/view?usp=sharing","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755029715,"metadata":{"github-id":"UCE_lALODBZtRc69lWZyznQT5RI"},"target":"a0eadaa6611d4d620030c48e2a6042a67d18b95fcebeee692b042c0e400bcd6e","message":"NB: @yarikoptic trimmed the quote\n\n\u003e could you please just share that file somehow otherwise (`micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr/1/c/0/2/3`) ?\n\nI checked the digest for a few time. It is constantly 'f582944d51bd39d8fd5c75ee4e311671'. Also, I don't think the checksum is a problem with the file itself because if we reupload it, it can be reuploaded without any issue. \nhttps://drive.google.com/file/d/1Fp-nPL3IlTzSQ3BKfQWU9sp7AhJlc75h/view?usp=sharing","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755030000,"metadata":{"github-id":"IC_kwDODBZtRc69mLIm","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3180900902"},"message":"THANKS!\nthoughts aloud: I think I might have an idea (multipart upload for these larger files leading to mismatch in how etag is computed) although unclear how this differs from other files which are also large. Thank you!  I will check for that later unless someone beats me to it... also oddly I do not see that zarr among https://webdav.dandiarchive.org/zarrs/5ad/ ... may be because it was never finalized due to the errors...","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755090796,"metadata":{"github-id":"IC_kwDODBZtRc69xhfB","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3183876033"},"message":"[2025.08.12-17.39.08Z-3854446.log](https://github.com/user-attachments/files/21755162/2025.08.12-17.39.08Z-3854446.log)\nThis is the log from uploading the data with `-J 5:5`, all of the files are uploaded without error!","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1755095892,"metadata":{"github-id":"IC_kwDODBZtRc69yyFR","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184206161"},"message":"\u003e also oddly I do not see that zarr among https://webdav.dandiarchive.org/zarrs/5ad/ ... may be because it was never finalized due to the errors...\n\nHi @yarikoptic, this is an embargoed dandiset so thats why it is not showing up on webdav.  Thanks for your help on this.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755097963,"metadata":{"github-id":"IC_kwDODBZtRc69zRgD","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184334851"},"message":"hm, interesting\n\n\u003cdetails\u003e\n\u003csummary\u003ehm, interesting, since besides the retried 403's I do see some which I am not 100% sure yet they are fully kosher \u003c/summary\u003e \n\n```shell\n❯ grep Error 2025.08.12-17.39.08Z-3854446.log | grep -v -e ' 403 ' -e 'AccessDenied'\n2025-08-12T13:39:17-0400 [ERROR   ] dandi 3854446:140049637680896 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T13:39:17-0400 [ERROR   ] dandi 3854446:140049646089984 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T13:39:17-0400 [ERROR   ] dandi 3854446:140049662875392 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T13:39:17-0400 [ERROR   ] dandi 3854446:140049421170432 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T13:39:17-0400 [ERROR   ] dandi 3854446:140049654482688 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T14:26:37-0400 [ERROR   ] dandi 3854446:140049646089984 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T14:32:30-0400 [ERROR   ] dandi 3854446:140049654482688 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T14:45:40-0400 [ERROR   ] dandi 3854446:140049662875392 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T14:49:07-0400 [ERROR   ] dandi 3854446:140049637680896 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T15:00:34-0400 [ERROR   ] dandi 3854446:140049646089984 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T15:03:43-0400 [ERROR   ] dandi 3854446:140049421170432 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T15:34:01-0400 [ERROR   ] dandi 3854446:140049637680896 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T15:40:55-0400 [ERROR   ] dandi 3854446:140049662875392 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T15:49:18-0400 [ERROR   ] dandi 3854446:140049654482688 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T16:24:39-0400 [ERROR   ] dandi 3854446:140049646089984 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T16:42:42-0400 [ERROR   ] dandi 3854446:140049421170432 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T17:05:33-0400 [ERROR   ] dandi 3854446:140049637680896 Error 400 while sending POST request to https://api.dandiarchive.org/api/zarr/: [\"Zarr already exists\"]\n2025-08-12T20:46:32-0400 [WARNING ] dandi 3854446:140048255141632 Will retry: Error 501 while sending PUT request to https://dandiarchive.s3.amazonaws.com/zarr/89037214-190b-4564-b642-de7d6f108578/0/c/0/3/1?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=SENSORE%2F20250813%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20250813T003316Z\u0026X-Amz-Expires=1800\u0026X-Amz-SignedHeaders=content-md5%3Bhost%3Bx-amz-acl\u0026X-Amz-Signature=SENS: \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e\n\u003cError\u003e\u003cCode\u003eNotImplemented\u003c/Code\u003e\u003cMessage\u003eA header you provided implies functionality that is not implemented\u003c/Message\u003e\u003cHeader\u003eTransfer-Encoding\u003c/Header\u003e\u003cRequestId\u003eSENSOR\u003c/RequestId\u003e\u003cHostId\u003eSENSOR+RzSiWrrudIhKSqV9fvEiV5suND2BzKLY+2l8Uuy+R09B8oKppLE79g=\u003c/HostId\u003e\u003c/Error\u003e\n\n```\n\u003c/details\u003e\n\nbut the terminal output showed \"all nice and clean\"? \n\n\u003cdetails\u003e\n\u003csummary\u003ehere is the uploaded zarrs with their checksums as now known to the server\u003c/summary\u003e \n\n```shell\n❯ sed -ne \"/sys.argv/s/.*ignore', //gp\" 2025.08.12-17.39.08Z-3854446.log | sed -e \"s/[]',]//g\" -e 's, ,\\n,g' | sed -e 's,^,dandi://dandi/001411/,g' | xargs dandi ls -f json --metadata assets \u003e /tmp/uploaded-assets-metadata.json\n❯ jq -r '.[] | [ .path, .metadata.digest[\"dandi:dandi-zarr-checksum\"] ] | @tsv' \u003c /tmp/uploaded-assets-metadata.json | sort\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-dBI_OCT.nii.zarr\t708ec24e4c566ccf82fcd34641c58e35-81--80768541623\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-O3D_OCT.nii.zarr\tb7da75a6071f3915d05364e2e954b0d8-81--97777298960\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-R3D_OCT.nii.zarr\tf32e31cb43d54abf844042c6e01681dc-81--92238331306\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-dBI_OCT.nii.zarr\te7b9df21b8d46289c4d6f467d4913e63-100--80801154565\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-O3D_OCT.nii.zarr\t58f6b7dcf3b729f8727426562fa41dbf-100--97913453366\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-R3D_OCT.nii.zarr\ta3df6e8bd19cefcaa23431435248e167-100--92489790217\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-dBI_OCT.nii.zarr\td725babd4b8acc2eb9e73f7270499656-100--80799328410\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-O3D_OCT.nii.zarr\t9c0d7a3ffdd192ce9ae827694d6f66a9-100--97778218152\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-R3D_OCT.nii.zarr\tcdcfb0a49772a5b5972f9fc7a178ead0-100--92148382370\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-dBI_OCT.nii.zarr\t9979e6d974a11791afd4244f299c316b-100--80800766747\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-O3D_OCT.nii.zarr\td8eea08193a92a182bac51ecc93ba42a-100--97898339224\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-R3D_OCT.nii.zarr\te1124989cb736d041434365f181eeab6-100--92412514554\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-dBI_OCT.nii.zarr\tcd1369ac2643b74e350082b2d7d19ebe-100--80798604898\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-O3D_OCT.nii.zarr\tf527b05fc24cb10d686046df38a79353-100--97777522267\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-R3D_OCT.nii.zarr\tb164b6dc693cc8bac78eddbf17ac772b-100--92208483256\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-dBI_OCT.nii.zarr\t1263a21c1cc0b0ba2b7b412cd4f03b14-100--80800589832\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-O3D_OCT.nii.zarr\t646fe51d38b8191339615d84b5efd5a4-100--97923047661\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-R3D_OCT.nii.zarr\t98c5628085227b90bfe3f51ab4a67d6a-100--92469663492\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-dBI_OCT.nii.zarr\t9fea0e7733bcbed0f1508d016143a818-100--80798210192\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-O3D_OCT.nii.zarr\t11bb486ee5338572d4deb1cc05b6a6d7-100--97756470495\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-R3D_OCT.nii.zarr\tf4e4650fd9097eeabf2b2d2610533c5d-100--92113368591\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-dBI_OCT.nii.zarr\t50e97476da9e74d3a4854f40be9072e8-100--80801368645\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-O3D_OCT.nii.zarr\t962083d6f9faeea6165dbd1772fdbe96-100--97930316053\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-R3D_OCT.nii.zarr\t691198a97fc7aac9238d83fa811b1091-100--92429357817\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-dBI_OCT.nii.zarr\tdb27c15321ac6a12619b0a28723d0a93-100--80798554268\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-O3D_OCT.nii.zarr\t7556969764afd6e698686fc7a677449b-100--97787191336\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-R3D_OCT.nii.zarr\t3d048611e16a3d6de5fb8e735eb9a79c-100--92165656234\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-dBI_OCT.nii.zarr\tb5d640997a87ffebbddca0547afbdf90-100--80801687930\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-O3D_OCT.nii.zarr\tf6d5f890fa647aa612c9275382f499ff-100--97950594765\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-R3D_OCT.nii.zarr\ta21556a4d32bf3cc30a5ae549435c51e-100--92494808669\n```\n\u003c/details\u003e\n\nCould you compare that output against the one you would get locally (could just `diff` two of those):\n\n```\ndandi digest -d zarr-checksum micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-R3D_OCT.nii.zarr\n```\n?\n\nNB I filed now https://github.com/dandi/dandi-cli/issues/1677 which could help for similar things in the future\n\n\u003cdetails\u003e\n\u003csummary\u003ebut this batch was different zarrs from what you uploaded before I think.  Here is a full list of checksums for all zarrs which were tried to be uploaded and I see some without checksums, so likely their upload was not finalized and should be reattempted\u003c/summary\u003e \n\n```shell\n❯ dandi -l CRITICAL ls -f json --metadata assets dandi://dandi/001411/micr-test-upload-delete-after/ | jq -r '.[] | [ .path, .metadata.digest[\"dandi:dandi-zarr-checksum\"] ] | @tsv'\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice020_acq-normal_proc-O3D_OCT.nii.zarr\tb6e179d433bb0dd8c1d23eae8feaaf80-100--97581840868\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice021_acq-normal_proc-O3D_OCT.nii.zarr\ta1b96995de815a3f739d40bfebb43ca6-100--97817446670\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice022_acq-normal_proc-dBI_OCT.nii.zarr\tc5c2796c4dcf25dcd5b2f2776608dc95-100--80798677138\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice020_acq-normal_proc-dBI_OCT.nii.zarr\t1dde9011be59f33775107f57bd91d174-100--80797909807\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice022_acq-normal_proc-O3D_OCT.nii.zarr\t31c23e2c13336e966b3681b5795fff0b-100--97677542474\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice021_acq-normal_proc-dBI_OCT.nii.zarr\t86bff3c522fc49131b65b20bf8c17948-100--80801071512\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice021_acq-normal_proc-R3D_OCT.nii.zarr\t0f71ff76f0341f9f0efa438c9f5676da-100--92379333162\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice023_acq-normal_proc-O3D_OCT.nii.zarr\t244024604595dbb8d0211dd80cee12a1-100--97724504030\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice022_acq-normal_proc-R3D_OCT.nii.zarr\t49f266f7bec64d2cc1787d5e838f0b4b-100--92113422099\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice020_acq-normal_proc-R3D_OCT.nii.zarr\t058abe18234a41fe86d5dcd17524c635-100--91952302071\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice023_acq-normal_proc-R3D_OCT.nii.zarr\tf517b62ac6731efba7a89d15774a745d-100--92290013678\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice023_acq-normal_proc-dBI_OCT.nii.zarr\ta5032c39a4d3b0a22453dc92930f1aaf-100--80798145319\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025-slice033_acq-normal_proc-dBI_OCT.ome.zarr\t52be4f821c533f1529c9f9ae48d9b283-22051--125108323951\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-O3D_OCT.nii.zarr\t14e8a344d772567a0c2203c6521dbce8-100--97612789643\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-dBI_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-R3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-O3D_OCT.nii.zarr\t56e91359818a1ac28692a05aa2d677ad-100--97663526409\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-R3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice027_acq-normal_proc-O3D_OCT.nii.zarr\ta1d9ef0c4756c2f6e6aabb5475f1e07a-100--97441466069\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice027_acq-normal_proc-R3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice027_acq-normal_proc-dBI_OCT.nii.zarr\tfe8d94f7ee0f816890cf1107309275c3-100--80798452135\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice028_acq-normal_proc-O3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice028_acq-normal_proc-R3D_OCT.nii.zarr\t1ff6ff55781dd8574bca10dccfa7ff8a-100--92498977598\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice028_acq-normal_proc-dBI_OCT.nii.zarr\td6d9592a92883d0a6996be699b0c8da7-100--80799130595\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice029_acq-normal_proc-O3D_OCT.nii.zarr\te98b3fa2995bcf5f69f08be57fd4770a-100--97683869471\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice029_acq-normal_proc-R3D_OCT.nii.zarr\t0fb848f196dedc5066f7e6da98f2caa5-100--92774883394\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice029_acq-normal_proc-dBI_OCT.nii.zarr\tc816e640f0bbec7592060c20ee537b35-100--80799088696\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-O3D_OCT.nii.zarr\t58f6b7dcf3b729f8727426562fa41dbf-100--97913453366\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-R3D_OCT.nii.zarr\ta3df6e8bd19cefcaa23431435248e167-100--92489790217\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-R3D_OCT.nii.zarr\tf32e31cb43d54abf844042c6e01681dc-81--92238331306\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-dBI_OCT.nii.zarr\t708ec24e4c566ccf82fcd34641c58e35-81--80768541623\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-O3D_OCT.nii.zarr\tb7da75a6071f3915d05364e2e954b0d8-81--97777298960\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-dBI_OCT.nii.zarr\te7b9df21b8d46289c4d6f467d4913e63-100--80801154565\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-O3D_OCT.nii.zarr\t9c0d7a3ffdd192ce9ae827694d6f66a9-100--97778218152\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-R3D_OCT.nii.zarr\tcdcfb0a49772a5b5972f9fc7a178ead0-100--92148382370\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-dBI_OCT.nii.zarr\td725babd4b8acc2eb9e73f7270499656-100--80799328410\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-O3D_OCT.nii.zarr\td8eea08193a92a182bac51ecc93ba42a-100--97898339224\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-R3D_OCT.nii.zarr\te1124989cb736d041434365f181eeab6-100--92412514554\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-dBI_OCT.nii.zarr\t9979e6d974a11791afd4244f299c316b-100--80800766747\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-O3D_OCT.nii.zarr\tf527b05fc24cb10d686046df38a79353-100--97777522267\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-R3D_OCT.nii.zarr\tb164b6dc693cc8bac78eddbf17ac772b-100--92208483256\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-dBI_OCT.nii.zarr\tcd1369ac2643b74e350082b2d7d19ebe-100--80798604898\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-O3D_OCT.nii.zarr\t646fe51d38b8191339615d84b5efd5a4-100--97923047661\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-R3D_OCT.nii.zarr\t98c5628085227b90bfe3f51ab4a67d6a-100--92469663492\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-dBI_OCT.nii.zarr\t1263a21c1cc0b0ba2b7b412cd4f03b14-100--80800589832\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-O3D_OCT.nii.zarr\t11bb486ee5338572d4deb1cc05b6a6d7-100--97756470495\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-R3D_OCT.nii.zarr\tf4e4650fd9097eeabf2b2d2610533c5d-100--92113368591\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-dBI_OCT.nii.zarr\t9fea0e7733bcbed0f1508d016143a818-100--80798210192\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-O3D_OCT.nii.zarr\t962083d6f9faeea6165dbd1772fdbe96-100--97930316053\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-R3D_OCT.nii.zarr\t691198a97fc7aac9238d83fa811b1091-100--92429357817\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-dBI_OCT.nii.zarr\t50e97476da9e74d3a4854f40be9072e8-100--80801368645\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-O3D_OCT.nii.zarr\t7556969764afd6e698686fc7a677449b-100--97787191336\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-R3D_OCT.nii.zarr\t3d048611e16a3d6de5fb8e735eb9a79c-100--92165656234\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-dBI_OCT.nii.zarr\tdb27c15321ac6a12619b0a28723d0a93-100--80798554268\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-O3D_OCT.nii.zarr\tf6d5f890fa647aa612c9275382f499ff-100--97950594765\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-R3D_OCT.nii.zarr\ta21556a4d32bf3cc30a5ae549435c51e-100--92494808669\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-dBI_OCT.nii.zarr\tb5d640997a87ffebbddca0547afbdf90-100--80801687930\n\n```\n\u003c/details\u003e\n\nCould you please try to run `upload --jobs 5:5` for those zarrs?\n\n```\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-dBI_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-R3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-R3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice027_acq-normal_proc-R3D_OCT.nii.zarr\t\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice028_acq-normal_proc-O3D_OCT.nii.zarr\n```\n\n?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755099337,"metadata":{"github-id":"IC_kwDODBZtRc69znBd","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184423005"},"message":"I am running the digest command.\n\nFor the upload, I now received the error saying the dandischema version mismatch.\n`Error: Server requires schema version 0.6.10; client only supports 0.6.9. `\n\n I do have the latest `dandischema` and `dandi-cli` was installed with git. Do you have any idea?","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1755101151,"metadata":{"github-id":"IC_kwDODBZtRc69z_zs","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184524524"},"message":"\u003e I am running the digest command.\n\u003e \n\u003e For the upload, I now received the error saying the dandischema version mismatch. `Error: Server requires schema version 0.6.10; client only supports 0.6.9. `\n\u003e \n\u003e I do have the latest `dandischema` and `dandi-cli` was installed with git. Do you have any idea?\n\n@calvinchai Please upgrade dandischema to 0.11.1.\n\n@yarikoptic Please review: https://github.com/dandi/dandi-cli/pull/1658","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755101273,"metadata":{"github-id":"IC_kwDODBZtRc690BvE","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184532420"},"message":"\u003e \u003e I am running the digest command.\n\u003e \u003e For the upload, I now received the error saying the dandischema version mismatch. `Error: Server requires schema version 0.6.10; client only supports 0.6.9. `\n\u003e \u003e I do have the latest `dandischema` and `dandi-cli` was installed with git. Do you have any idea?\n\u003e \n\u003e [@calvinchai](https://github.com/calvinchai) Please upgrade dandischema to 0.11.1.\n\u003e \n\u003e [@yarikoptic](https://github.com/yarikoptic) Please review: [#1658](https://github.com/dandi/dandi-cli/pull/1658)\n\nI have `dandischema==0.11.1`. Is there anything I could look into?","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1755103615,"metadata":{"github-id":"IC_kwDODBZtRc690kOA","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184673664"},"message":"\u003e \u003e \u003e I am running the digest command.\n\u003e \u003e \u003e For the upload, I now received the error saying the dandischema version mismatch. `Error: Server requires schema version 0.6.10; client only supports 0.6.9. `\n\u003e \u003e \u003e I do have the latest `dandischema` and `dandi-cli` was installed with git. Do you have any idea?\n\u003e \u003e \n\u003e \u003e \n\u003e \u003e [@calvinchai](https://github.com/calvinchai) Please upgrade dandischema to 0.11.1.\n\u003e \u003e [@yarikoptic](https://github.com/yarikoptic) Please review: [#1658](https://github.com/dandi/dandi-cli/pull/1658)\n\u003e \n\u003e I have `dandischema==0.11.1`. Is there anything I could look into?\n\nWhich fork/branch are you running off of?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755105069,"metadata":{"github-id":"IC_kwDODBZtRc6907Vc","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184768348"},"message":"\u003e hm, interesting\n\u003e hm, interesting, since besides the retried 403's I do see some which I am not 100% sure yet they are fully kosher\n\u003e \n\u003e but the terminal output showed \"all nice and clean\"?\n\u003e here is the uploaded zarrs with their checksums as now known to the server\n\u003e \n\u003e Could you compare that output against the one you would get locally (could just `diff` two of those):\n\u003e \n\u003e ```\n\u003e dandi digest -d zarr-checksum micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice011_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice012_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice013_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice014_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice015_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice016_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice017_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice018_acq-normal_proc-R3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-dBI_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-O3D_OCT.nii.zarr micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice019_acq-normal_proc-R3D_OCT.nii.zarr\n\u003e ```\n\u003e \n\u003e ?\n\u003e \n\u003e NB I filed now [#1677](https://github.com/dandi/dandi-cli/issues/1677) which could help for similar things in the future\n\u003e but this batch was different zarrs from what you uploaded before I think. Here is a full list of checksums for all zarrs which were tried to be uploaded and I see some without checksums, so likely their upload was not finalized and should be reattempted\n\u003e \n\u003e Could you please try to run `upload --jobs 5:5` for those zarrs?\n\u003e \n\u003e ```\n\u003e micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-dBI_OCT.nii.zarr\t\n\u003e micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice025_acq-normal_proc-R3D_OCT.nii.zarr\t\n\u003e micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-R3D_OCT.nii.zarr\t\n\u003e micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice026_acq-normal_proc-dBI_OCT.nii.zarr\t\n\u003e micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice027_acq-normal_proc-R3D_OCT.nii.zarr\t\n\u003e micr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice028_acq-normal_proc-O3D_OCT.nii.zarr\n\u003e ```\n\u003e \n\u003e ?\n\nHere is the result from the digest command.\n```\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-dBI_OCT.nii.zarr: 708ec24e4c566ccf82fcd34641c58e35-81--80768541623\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-O3D_OCT.nii.zarr: b7da75a6071f3915d05364e2e954b0d8-81--97777298960\nmicr-test-upload-delete-after/sub-I80_voi-slab1_sample-slice010_acq-normal_proc-R3D_OCT.nii.zarr: f32e31cb43d54abf844042c6e01681dc-81--92238331306\n```","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755105184,"metadata":{"github-id":"IC_kwDODBZtRc6909mO","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3184777614"},"message":"\u003e \u003e \u003e \u003e I am running the digest command.\n\u003e \u003e \u003e \u003e For the upload, I now received the error saying the dandischema version mismatch. `Error: Server requires schema version 0.6.10; client only supports 0.6.9. `\n\u003e \u003e \u003e \u003e I do have the latest `dandischema` and `dandi-cli` was installed with git. Do you have any idea?\n\u003e \u003e \u003e \n\u003e \u003e \u003e \n\u003e \u003e \u003e [@calvinchai](https://github.com/calvinchai) Please upgrade dandischema to 0.11.1.\n\u003e \u003e \u003e [@yarikoptic](https://github.com/yarikoptic) Please review: [#1658](https://github.com/dandi/dandi-cli/pull/1658)\n\u003e \u003e \n\u003e \u003e \n\u003e \u003e I have `dandischema==0.11.1`. Is there anything I could look into?\n\u003e \n\u003e Which fork/branch are you running off of?\n\nI was on first [bf-zarr-upload](https://github.com/dandi/dandi-cli/tree/bf-zarr-upload) and encountered the error. https://github.com/dandi/dandi-cli/pull/1675\nAs it was merged into main, then I switched to main.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755525111,"metadata":{"github-id":"IC_kwDODBZtRc6-juP_","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3197035519"},"message":"Sorry I used the wrong environment again! I kept using the aliased dandi from the production environment. I am running the reupload as @yarikoptic requested now.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755530010,"metadata":{"github-id":"IC_kwDODBZtRc6-k4s_","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3197340479"},"message":"[2025.08.18-13.49.42Z-202891.log](https://github.com/user-attachments/files/21838562/2025.08.18-13.49.42Z-202891.log)\n\nHere is the log. It seems the things became worse. The upload just showed failed after retries.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755553890,"metadata":{"github-id":"IC_kwDODBZtRc6-pb9x","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3198533489"},"message":"It is smth new now, of a \"The request signature we calculated does not match the signature you provided. Check your key and signing method.\" variety...   can you upload anything?\n\n@jjnesbitt have you ever encountered such an error from S3? suggests mismatch in smth but unclear what has changed -- versions of client libraries seems to be ok, but this message just emerged and not present in prior logs (I think, @calvinchai could may be check on his end):\n\n```\n# so - requests and urllib3 are the same\n❯ grep dandi.*requests.*urllib 2025.0*log\n2025.07.25-14.41.44Z-4093715.log:2025-07-25T10:41:44-0400 [INFO    ] dandi 4093715:139790543877120 python 3.13.5, dandi 0.69.3, dandischema 0.11.1, h5py 3.14.0, hdmf 4.1.0, pynwb 3.0.0, requests 2.32.4, urllib3 2.4.0\n2025.08.12-17.39.08Z-3854446.log:2025-08-12T13:39:08-0400 [INFO    ] dandi 3854446:140056922297344 python 3.13.5, dandi 0.69.3+33.g897c420e, dandischema 0.11.1, h5py 3.14.0, hdmf 4.1.0, pynwb 3.1.1, requests 2.32.4, urllib3 2.5.0\n2025.08.18-13.49.42Z-202891.log:2025-08-18T09:49:42-0400 [INFO    ] dandi 202891:140694424892416 python 3.13.5, dandi 0.69.3+30.g7ced26fc, dandischema 0.11.1, h5py 3.14.0, hdmf 4.1.0, pynwb 3.1.1, requests 2.32.4, urllib3 2.5.0\n\n# log just came up now\n❯ grep -l 'The request signature we calculated does not match the signature you provided. Check your key and signing method.' *log\n2025.08.18-13.49.42Z-202891.log\n```\n\nthe only change which comes to mind which we introduced on dandi-archive end was greedy me \n\n- https://github.com/dandi/dandi-archive/pull/2456\n\nbut it was already deployed before and we didn't observe similar problem:\n\n```shell\n❯ grep -l Expires=1800 2025.08.*\n2025.08.12-17.39.08Z-3854446.log\n2025.08.18-13.49.42Z-202891.log\n```\n\n@calvinchai please do not upload logs \"freshier\" than half an hour since they might leak still valid temporary upload urls","files":null},{"type":3,"author":{"id":"a9e2633aeb6d7e2366a97d09712312c2442c6054"},"timestamp":1755556572,"metadata":{"github-id":"IC_kwDODBZtRc6-pxBI","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3198619720"},"message":"It's likely not due to the expiration time increase, as the uploader cannot change the signature that way.\n\nDoes this only occur on embargoed zarr assets? If so it's likely due to \nhttps://github.com/dandi/dandi-archive/pull/2489. The CLI is likely not including the `x-amz-tagging` header in the `PUT` request.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755558832,"metadata":{"github-id":"IC_kwDODBZtRc6-qCFN","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3198689613"},"message":"THANK YOU for the quick reply @jjnesbitt !\n\nthe dandiset in question https://dandiarchive.org/dandiset/001411 is indeed embargoed\n\n\u003cdetails\u003e\n\u003csummary\u003eI confirmed a similar failure to upload to a sample embargoed dandiset\u003c/summary\u003e \n\n```shell\n❯ DANDI_DEVEL=1 dandi upload --allow-any-path sub-private_stain-DAPI_chunk-01_SPIM.ome.zarr\n2025-08-18 19:08:18,537 [    INFO] Found 2 files to consider\nPATH                                                      SIZE    ERRORS PROGRESS STATUS           MESSAGE                  \ndandiset.yaml                                             1.9 kB                  skipped          should be edited online  \nPATH                                                      SIZE    ERRORS PROGRESS STATUS                  MESSAGE                                                                                                                                  \ndandiset.yaml                                             1.9 kB                  skipped                 should be edited online                                                                                                                  \nsub-private/sub-private_stain-DAPI_chunk-01_SPIM.ome.zarr 24.5 kB   0             ERROR                   sub-private/sub-private_stain-DAPI_chunk-01_SPIM.ome.zarr: failed to upload 15 files after 5 retries due to repeated 403 errors          \nSummary:                                                  26.4 kB                 1 skipped               1 should be edited online                                                                                                                \n                                                                                  1 ERROR                 1 sub-private/sub-private_stain-DAPI_chunk-some_SPIM.ome.zarr: failed to upload some files after some retries due to repeated some errors\n2025-08-18 19:08:40,341 [    INFO] Logs saved in /home/yoh/.local/state/dandi-cli/log/2025.08.18-23.08.16Z-268339.log\nTraceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/bin/dandi\", line 10, in \u003cmodule\u003e\n    sys.exit(main())\n             ^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/lib/python3.11/site-packages/click/core.py\", line 1161, in __call__\n    return self.main(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/lib/python3.11/site-packages/click/core.py\", line 1082, in main\n    rv = self.invoke(ctx)\n         ^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/lib/python3.11/site-packages/click/core.py\", line 1697, in invoke\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/lib/python3.11/site-packages/click/core.py\", line 1443, in invoke\n    return ctx.invoke(self.callback, **ctx.params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/lib/python3.11/site-packages/click/core.py\", line 788, in invoke\n    return __callback(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/.venv/lib/python3.11/site-packages/click/decorators.py\", line 45, in new_func\n    return f(get_current_context().obj, *args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/cli/base.py\", line 126, in wrapper\n    return f(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/cli/cmd_upload.py\", line 103, in upload\n    upload(\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/upload.py\", line 461, in upload\n    raise upload_err\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/upload.py\", line 359, in process_path\n    for r in dfile.iter_upload(\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/files/zarr.py\", line 830, in iter_upload\n    raise UploadError(\ndandi.exceptions.UploadError: sub-private/sub-private_stain-DAPI_chunk-01_SPIM.ome.zarr: failed to upload 15 files after 5 retries due to repeated 403 errors\n\n```\n\u003c/details\u003e\n \n\u003cdetails\u003e\n\u003csummary\u003eand upload of the same dummy zarr worked fine for an open dandiset\u003c/summary\u003e \n\n```shell\n❯ DANDI_DEVEL=1 dandi upload --allow-any-path sub-private_stain-DAPI_chunk-01_SPIM.ome.zarr\n2025-08-18 19:09:45,222 [    INFO] Found 2 files to consider\nPATH                                                      SIZE    ERRORS    PROGRESS STATUS                        MESSAGE                  \ndandiset.yaml                                             3.5 kB                     skipped                       should be edited online  \nsub-private/sub-private_stain-DAPI_chunk-01_SPIM.ome.zarr 24.5 kB   0           100% done                                                   \nSummary:                                                  28.0 kB           6.4 kB/s 1 skipped                     1 should be edited online\n                                                                                     1 done \n```\n\u003c/details\u003e\n\n- what should be the content of the `x-amz-tagging` ?\n- why is it specific to embargoed zarrs and not applicable to blobs? \n  - I do not see `x-amz-tagging` anywhere in the dandi-cli codebase so far, assuming that we should have done that for regular blobs too\n\n\u003cdetails\u003e\n\u003csummary\u003eupload of a blob to the same embargoed dandiset worked just fine\u003c/summary\u003e \n\n```shell\n❯ DANDI_DEVEL=1 dandi upload --allow-any-path sub-private.dat\n2025-08-18 19:11:18,005 [    INFO] Found 2 files to consider\nPATH                        SIZE     ERRORS   PROGRESS STATUS                MESSAGE                       \ndandiset.yaml               1.9 kB                     skipped               should be edited online       \nsub-private/sub-private.dat 21 Bytes   0          100% done                  exists (older) - reuploading  \nSummary:                    1.9 kB           9 Bytes/s 1 skipped             1 should be edited online     \n                                                       1 done                1 exists (older) - reuploading\n\n```\n\u003c/details\u003e","files":null},{"type":3,"author":{"id":"a9e2633aeb6d7e2366a97d09712312c2442c6054"},"timestamp":1755566882,"metadata":{"github-id":"IC_kwDODBZtRc6-q3EJ","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3198906633"},"message":"\u003e * what should be the content of the `x-amz-tagging` ?\n\nYou'd need to set the `x-amz-tagging` header to `embargoed=true` if the dandiset is embargoed, and not set it at all if it's not embargoed. An easy way to check this is by searching for `\"x-amz-tagging\"` in the pre-signed URL, but you can also reference the dandiset status if you have it.\n\n\u003e * why is it specific to embargoed zarrs and not applicable to blobs?\n\nThat is because they use separate upload mechanisms. Regular asset blobs use multi-part upload, in which the server creates and completes the multi-part upload itself (which is where the tagging is supplied), and the client it just responsible for uploading the individual parts.\n\nIndividual zarr files are small enough to where multi-part upload doesn't make sense, and so normal file upload is used. For this, the client must directly supply the tagging in the header when making the `PUT` request.\n\n\nIf it makes sense, I could make the PR. I recently looked into that part of the CLI code anyway.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755613759,"metadata":{"github-id":"IC_kwDODBZtRc6-y3gk","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3201005604"},"message":"Thanks!\n\n\u003e If it makes sense, I could make the PR. I recently looked into that part of the CLI code anyway.\n\nThat would be great!  FWIW I would have resorted to `by searching for \"x-amz-tagging\" in the pre-signed URL` (for flexibility) with a check for being embargoed. If embargoed and no expected tag - would have issued a warning (to ease potential troubleshooting if anything goes wrong).\n\n\u003e Individual zarr files are small enough to where multi-part upload doesn't make sense, and so normal file upload is used.\n\nIf I get it right, multi-part upload is not really required but [only recommended](https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpuoverview.html) by AWS for files larger than 100MB. With zarr v3 sharding we might actually \"get there\"!  but that would be a \"new battle\", not here.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755614037,"metadata":{"github-id":"IC_kwDODBZtRc6-y7hW","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3201022038"},"message":"what I also wonder is why our dandi-cli tests didn't fail on `test_upload_sync_zarr` which has `@sweep_embargo` in https://github.com/dandi/dandi-archive/pull/2489 .. apparently we run only ` python -m pytest --dandi-api -v` and in https://github.com/dandi/dandi-archive/actions/runs/16976805154/job/48127895912 I do see it ran\n\n```\n2025-08-14T21:23:11.0145180Z ../../../../../opt/hostedtoolcache/Python/3.13.5/x64/lib/python3.13/site-packages/dandi/tests/test_upload.py::test_upload_sync_zarr[True] PASSED [ 96%]\n2025-08-14T21:23:15.7260527Z ../../../../../opt/hostedtoolcache/Python/3.13.5/x64/lib/python3.13/site-packages/dandi/tests/test_upload.py::test_upload_sync_zarr[False] PASSED [ 96%]\n```\n\nso -- I guess it is minio behaving differently/more forgiving?","files":null},{"type":3,"author":{"id":"a9e2633aeb6d7e2366a97d09712312c2442c6054"},"timestamp":1755614794,"metadata":{"github-id":"IC_kwDODBZtRc6-zGmk","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3201067428"},"message":"\u003e so -- I guess it is minio behaving differently/more forgiving?\n\nYes, Minio behaves differently. While tagging is supported in minio, it doesn't operate in the same way and requires a separate API call. This is a spot where dev and prod unfortunately differ.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1755871687,"metadata":{"github-id":"IC_kwDODBZtRc6_mYKM","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3214508684"},"message":"Hi Dandi Team,\n\nShould I use the linked PR to test if the upload will work now?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1755875555,"metadata":{"github-id":"IC_kwDODBZtRc6_nNeP","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3214727055"},"message":"It would not hurt but \"theoretically\" also not needed -- I tested that it works but I would prefer a slight tune up before we accept it, so behavior might change.  Be ready to test again then (I hope you would have enough data ;) )","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1756158329,"metadata":{"github-id":"IC_kwDODBZtRc7ACVzb","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3221839067"},"message":"@calvinchai now would be good time to try again a fresh release of dandi-cli 0.71.2 . What other surprises await us or may be we could let this issue to RiP!? ;)","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1756217686,"metadata":{"github-id":"IC_kwDODBZtRc7AL9GG","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3224359302"},"message":"\u003e [@calvinchai](https://github.com/calvinchai) now would be good time to try again a fresh release of dandi-cli 0.71.2 . What other surprises await us or may be we could let this issue to RiP!? ;)\n\nsure I will give it a try.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1756316796,"metadata":{"github-id":"IC_kwDODBZtRc7AeQzJ","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3229158601"},"message":"Looks like everything works perfect now. Thanks!","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1756353408,"metadata":{"github-id":"IC_kwDODBZtRc7AoMNs","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3231761260"},"message":"great to hear we finally addressed all upload issues... now need to find time to get back to Katie's download ones ;)","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1756353408,"metadata":{"github-id":"CE_lADODBZtRc7Brp6gzwAAAASDRNV4"},"status":2},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1756353508,"metadata":{"github-id":"IC_kwDODBZtRc7AoNB9","github-url":"https://github.com/dandi/dandi-cli/issues/1662#issuecomment-3231764605"},"message":"Thanks all","files":null}]}