{"version":2,"ops":[{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633098837,"metadata":{"github-id":"IC_kwDODBZtRc43kYjA","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-932284608"},"message":"@jwodder let's make validation identical between `validate` and `upload`, i.e. add nwb validation to `validate` if we haven't done that and then use `validate` within upload.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1633351778,"metadata":{"github-id":"IC_kwDODBZtRc43o1O1","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933450677"},"message":"@yarikoptic The only difference I see between `upload` and `validate`'s validation is that the latter is limited to files with the `.nwb` extension.\n\n@tmchartrand Did the files in question have file extensions of `.nwb` or something else?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633353082,"metadata":{"github-id":"IC_kwDODBZtRc43o5ze","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933469406"},"message":"interesting, I will have a look as well since OP seems to suggest differently.\n\nWe should run dandischema validation for all files, but nwb validation only for .nwb files. We are now also sooner than later add BIDS validation for bids datasets (#431), so overall it should be\n- validate against \"original\" data standard(s) (e.g. there could be BIDS dataset with .nwb files -- we will probably need to validate against nwb, and BIDS)\n- validate extracted / harmonized into dandischema metadata","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1633358402,"metadata":{"github-id":"IC_kwDODBZtRc43pOTC","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933553346"},"message":"@yarikoptic I've submitted [a PR](https://github.com/dandi/dandi-cli/pull/783) to make `validate` validate all files, not just .nwb's.  I'm not clear on what exactly you're suggesting in your bullet points.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633359179,"metadata":{"github-id":"IC_kwDODBZtRc43pRIg","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933564960"},"message":"\u003e @yarikoptic I've submitted [a PR](https://github.com/dandi/dandi-cli/pull/783) to make `validate` validate all files, not just .nwb's.\n\nThank you!\n\n\u003e I'm not clear on what exactly you're suggesting in your bullet points.\n\nNothing specific ATM, just notes for near future (\"sooner than later\") which I will formalize in issues later on.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1633363092,"metadata":{"github-id":"IC_kwDODBZtRc43pftV","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933624661"},"message":"i'm pretty sure these are nwb related errors (age field - i don't know where the nonetype error is coming from). i have a feeling a metadata extraction error is not being seen as invalid in dandi-cli for nwb, and perhaps not being reported during validation.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633366437,"metadata":{"github-id":"CE_lADODBZtRc48W-3TzwAAAAFCL3EF"},"status":2},{"type":3,"author":{"id":"d6410394bf8099fbcfa4e89f02cf578464b468f2"},"timestamp":1633367911,"metadata":{"github-id":"IC_kwDODBZtRc43pv6Y","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933691032"},"message":"@yarikoptic as it says in the title here, these were all NWB related errors, so changing handling of other file types isn't gonna fix this!\n@satra's description sounds like a possible explanation, maybe errors are caught and not reported?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633368349,"metadata":{"github-id":"IC_kwDODBZtRc43pxRx","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933696625"},"message":"may be ... do you have (uploaded) a sample of such a file?","files":null},{"type":3,"author":{"id":"d6410394bf8099fbcfa4e89f02cf578464b468f2"},"timestamp":1633368927,"metadata":{"github-id":"IC_kwDODBZtRc43py_7","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933703675"},"message":"I think any of these files should give the error: https://gui.dandiarchive.org/#/dandiset/000043/draft/files?location=sub-Q19-26-005%2F","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633371928,"metadata":{"github-id":"IC_kwDODBZtRc43p8MB","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933741313"},"message":"I will reopen for now, although so far failed to reproduce\n\n```shell\nlena:/tmp/000018\n$\u003e dandi validate sub-Q19-26-005/sub-Q19-26-005_ses-20190718T211030_icephys.nwb\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.9/site-packages/hdmf/spec/namespace.py:532: UserWarning: Ignoring cached namespace 'hdmf-common' version 1.1.3 because version 1.5.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.9/site-packages/hdmf/spec/namespace.py:532: UserWarning: Ignoring cached namespace 'core' version 2.2.4 because version 2.3.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n2021-10-04 14:23:14,881 [    INFO] sub-Q19-26-005/sub-Q19-26-005_ses-20190718T211030_icephys.nwb: ok\nSummary: No validation errors among 1 file(s)\n2021-10-04 14:23:14,881 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20211004182309Z-1244072.log\ndandi validate sub-Q19-26-005/sub-Q19-26-005_ses-20190718T211030_icephys.nwb  5.84s user 0.17s system 97% cpu 6.144 total\n\n$\u003e DANDI_DEVEL=1 dandi upload -i dandi-staging sub-Q19-26-005/sub-Q19-26-005_ses-20190718T211030_icephys.nwb               \n2021-10-04 14:23:26,433 [    INFO] Found 1 files to consider\nPATH                                                SIZE    ERRORS    UPLOAD STATUS                MESSAGE\n...5/sub-Q19-26-005_ses-20190718T211030_icephys.nwb 21.7 MB   0         100% done                         \nSummary:                                            21.7 MB         8.6 MB/s 1 done                       \n2021-10-04 14:23:28,957 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20211004182324Z-1244106.log\n```","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633371928,"metadata":{"github-id":"REE_lADODBZtRc48W-3TzwAAAAFCNxhA"},"status":1},{"type":3,"author":{"id":"d6410394bf8099fbcfa4e89f02cf578464b468f2"},"timestamp":1633372496,"metadata":{"github-id":"IC_kwDODBZtRc43p9-a","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-933748634"},"message":"actually, on a second look, maybe the ones that failed in that experiment didn't make it up. i suppose i can try to email you one of the failures, but really any NWB with a metadata issue should suffice to reproduce this i think.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633549742,"metadata":{"github-id":"IC_kwDODBZtRc432YhD","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-937003075"},"message":"might be might be... if you could email me (debian  at onerussian.com) -- would be apprecited.","files":null},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1641913668,"metadata":{"github-id":"LE_lADODBZtRc48W-3TzwAAAAFeIDSF"},"added":["blocked"],"removed":[]},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1641913790,"metadata":{"github-id":"UNLE_lADODBZtRc48W-3TzwAAAAFeIGxg"},"added":[],"removed":["blocked"]},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1641913790,"metadata":{"github-id":"LE_lADODBZtRc48W-3TzwAAAAFeIGxi"},"added":["awaiting-user-response"],"removed":[]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1648241134,"metadata":{"github-id":"IC_kwDODBZtRc5AVqoD","github-url":"https://github.com/dandi/dandi-cli/issues/780#issuecomment-1079421443"},"message":"the problematic one @tmchartrand kindly shared is available from http://www.onerussian.com/tmp/Q19.26.005.2A.01.03.03_dandi.nwb\n\n\u003cdetails\u003e\n\u003csummary\u003ehere is my entire protocol (dirty) of trying to reproduce -- still managed to upload. \u003c/summary\u003e \n\n```shell\n(git)lena:/tmp[master]git\n$\u003e dandi download --download dandiset.yaml https://gui-staging.dandiarchive.org/#/dandiset/000018\nPATH                 SIZE DONE    DONE% CHECKSUM STATUS MESSAGE   \ndandiset.yaml                                    done   updated   \nSummary:                  0 Bytes                1 done 1 updated \n                          \u003c0.00%                                  \n2022-03-25 16:42:05,751 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220325204203Z-842925.log\n(dev3) 1 15079.....................................:Fri 25 Mar 2022 04:42:05 PM EDT:.\n(git)lena:/tmp[master]git\n$\u003e cd 000018\ndandiset.yaml\n(dev3) 1 15080.....................................:Fri 25 Mar 2022 04:42:09 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e wget http://www.onerussian.com/tmp/Q19.26.005.2A.01.03.03_dandi.nwb\n--2022-03-25 16:42:15--  http://www.onerussian.com/tmp/Q19.26.005.2A.01.03.03_dandi.nwb\nResolving www.onerussian.com (www.onerussian.com)... 129.170.30.229\nConnecting to www.onerussian.com (www.onerussian.com)|129.170.30.229|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 21804920 (21M) [text/plain]\nSaving to: ‘Q19.26.005.2A.01.03.03_dandi.nwb’\n\nQ19.26.005.2A.01.03.03_dandi.nwb      100%[========================================================================\u003e]  20.79M  4.70MB/s    in 4.5s    \n\n2022-03-25 16:42:20 (4.65 MB/s) - ‘Q19.26.005.2A.01.03.03_dandi.nwb’ saved [21804920/21804920]\n\n(dev3) 1 15081.....................................:Fri 25 Mar 2022 04:42:20 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e dandi --version\n0.37.0\n(dev3) 1 15082.....................................:Fri 25 Mar 2022 04:42:23 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e dandi validate Q19.26.005.2A.01.03.03_dandi.nwb \n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.9/site-packages/hdmf/spec/namespace.py:532: UserWarning: Ignoring cached namespace 'hdmf-common' version 1.1.3 because version 1.5.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.9/site-packages/hdmf/spec/namespace.py:532: UserWarning: Ignoring cached namespace 'core' version 2.2.5 because version 2.4.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n2022-03-25 16:42:33,180 [    INFO] Q19.26.005.2A.01.03.03_dandi.nwb: ok\nSummary: No validation errors among 1 file(s)\n2022-03-25 16:42:33,180 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220325204228Z-843116.log\ndandi validate Q19.26.005.2A.01.03.03_dandi.nwb  5.51s user 1.02s system 117% cpu 5.542 total\n(dev3) 1 15083.....................................:Fri 25 Mar 2022 04:42:33 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e DANDI_DEVEL=1 dandi upload -i dandi-staging  Q19.26.005.2A.01.03.03_dandi.nwb\n2022-03-25 16:43:08,749 [    INFO] Found 1 files to consider\nPATH                             SIZE    ERRORS UPLOAD STATUS           MESSAGE      \nQ19.26.005.2A.01.03.03_dandi.nwb 21.8 MB   0           skipped          file exists  \nSummary:                         21.8 MB               1 skipped        1 file exists\n2022-03-25 16:43:09,101 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220325204306Z-843295.log\n(dev3) 1 15084.....................................:Fri 25 Mar 2022 04:43:09 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e dandi remove Q19.26.005.2A.01.03.03_dandi.nwb\nUsage: dandi [OPTIONS] COMMAND [ARGS]...\nTry 'dandi --help' for help.\n\nError: No such command 'remove'.\n(dev3) 1 15085 -\u003e2.....................................:Fri 25 Mar 2022 04:43:18 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e dandi detele Q19.26.005.2A.01.03.03_dandi.nwb\nUsage: dandi [OPTIONS] COMMAND [ARGS]...\nTry 'dandi --help' for help.\n\nError: No such command 'detele'.\n\nDid you mean one of these?\n    delete\n    digest\n(dev3) 1 15086 -\u003e2.....................................:Fri 25 Mar 2022 04:43:23 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e dandi delete Q19.26.005.2A.01.03.03_dandi.nwb\n2022-03-25 16:43:29,955 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220325204327Z-843442.log\nError: Asset at path 'Q19.26.005.2A.01.03.03_dandi.nwb' not found in Dandiset 000018\n(dev3) 1 15087 -\u003e1.....................................:Fri 25 Mar 2022 04:43:30 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e dandi delete -i dandi-staging Q19.26.005.2A.01.03.03_dandi.nwb\nDelete 1 assets on server from Dandiset 000018? [y/N]: y\nPATH                             STATUS     MESSAGE\nQ19.26.005.2A.01.03.03_dandi.nwb Deleted           \nSummary:                         1 Deleted         \n2022-03-25 16:43:46,422 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220325204341Z-843548.log\n(dev3) 1 15088.....................................:Fri 25 Mar 2022 04:43:46 PM EDT:.\n(git)lena:/tmp[master]000018\n$\u003e DANDI_DEVEL=1 dandi upload -i dandi-staging Q19.26.005.2A.01.03.03_dandi.nwb\n2022-03-25 16:43:52,791 [    INFO] Found 1 files to consider\nPATH                             SIZE    ERRORS UPLOAD STATUS                MESSAGE\nQ19.26.005.2A.01.03.03_dandi.nwb 21.8 MB   0           done                         \nSummary:                         21.8 MB               1 done                       \n2022-03-25 16:43:54,562 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220325204350Z-843601.log\n\n```\n\u003c/details\u003e\n\n\nLet's just assume that we fixed something ;) but if issue persists @tmchartrand with current dandi-cli 0.37.0 or later, certainly reopen!","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1648241135,"metadata":{"github-id":"CE_lADODBZtRc48W-3TzwAAAAF4Gki5"},"status":2}]}