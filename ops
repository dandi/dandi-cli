{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597416586,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDExMTQ2MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674111461"},"message":"It appears that the new release yesterday of pynwb is to blame.  Now, `dandi.pynwb_utils.validate()` fails to validate the NWB test data files, with output such as:\n\n```\n[VectorIndex/description (units/electrodes_index): argument missing, VectorIndex (units/electrodes_index): incorrect type - expected 'uint8', got 'int32', VectorIndex/description (units/electrodes_index): argument missing, VectorIndex (units/electrodes_index): incorrect type - expected 'uint8', got 'int32', VectorIndex/description (units/spike_times_index): argument missing, VectorIndex (units/spike_times_index): incorrect type - expected 'uint8', got 'int32']\n```","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1597416820,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDExMzM0NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674113345"},"message":"woah - the index types definitely look weird - surely indices can exceed 256? i'm not saying we need int32, having indices be unsigned is good. perhaps something to ping on the pynwb issue. i can't remember where the test files originally came from.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597416970,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDExNDUyNQ==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674114525"},"message":"@satra I took the test files used for testing uploads from [Dandiset 000006](https://gui.dandiarchive.org/#/dandiset/000006/draft).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597417491,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDExODcwNg==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674118706"},"message":"It is probably just a matter of pynwb and its schema got \"fixed up\" to use uint instead of int, those files which we use `sub-anm369963_ses-20170228.nwb` were produced with previous version... and in this case they are so old that produced with even older version which didn't cache schema inside the files I guess:\n\n```\n$\u003e dandi ls dandi/**/sub-anm369963_ses-20170228.nwb | grep nwb\n- path: dandi/tests/data/dandifiles/sub-anm369963/sub-anm369963_ses-20170228.nwb\n  nwb_version: 2.0.2\n```\nfor \"permanent fix\" we should just switch to using pre-populated dynamically by fixtures files (as WiP for #182) which would (better) be \"compatible\" with current pynwb  since they would be produced by it.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597418015,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDEyMjgyMA==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674122820"},"message":"@yarikoptic Wouldn't dynamically generated NWB files still need to be \"organized\" before uploading?  How can I generate them with the proper paths?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597418739,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDEyODQ4Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674128487"},"message":"You could call organize as party of the fixture - it shouldn't take too long. Or just run it outside on the file it produced,v and see what name it gives it, but IMHO it would be do in code since we might change organize later","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597418811,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDEyOTA2OA==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674129068"},"message":"Probably would need to be add additional shim fixture in top of the one producing the file to start with - only upload ATM would really need organized file names","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597423539,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDE2MjY2OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674162669"},"message":"I seem to have fixed the upload tests by creating the uploaded files in fixtures, but in the middle of that process, two more unrelated tests started failing:\n\n```\n_____________________________ test_parse_dandi_url _____________________________\ndandi/tests/test_download.py:32: in test_parse_dandi_url\n    assert _assert_parse_girder_url(\"DANDI:000027\") == (\ndandi/tests/test_download.py:17: in _assert_parse_girder_url\n    st, s, a, aid = parse_dandi_url(url)\ndandi/download.py:143: in parse\n    return cls.parse(new_url)\ndandi/download.py:148: in parse\n    return cls.parse(new_url)\ndandi/download.py:155: in parse\n    raise RuntimeError(\nE   RuntimeError: https://gui.dandiarchive.org/#/dandiset/000027 did not redirect to another location which dandi client would know how to handle.\n________________________ test_parse_dandi_url_redirect _________________________\ndandi/tests/test_download.py:124: in test_parse_dandi_url_redirect\n    assert _assert_parse_girder_url(\"https://dandiarchive.org/dandiset/000003\") \n== (\ndandi/tests/test_download.py:17: in _assert_parse_girder_url\n    st, s, a, aid = parse_dandi_url(url)\ndandi/download.py:148: in parse\n    return cls.parse(new_url)\ndandi/download.py:155: in parse\n    raise RuntimeError(\nE   RuntimeError: https://gui.dandiarchive.org/#/dandiset/000003 did not redirect to another location which dandi client would know how to handle.\n```\n\nMy first guess is that something changed on Dandiarchive's end, but there haven't been any changes to it today.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597423539,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkzMTYyMzcz"},"target":"f8af589bc586cf496c230b04f1f83e6ec568e104e155661702938306c4942727","message":"I seem to have fixed the upload tests by creating the uploaded files in fixtures, but in the middle of that process, two more unrelated tests started failing:\n\n```\n_____________________________ test_parse_dandi_url _____________________________\ndandi/tests/test_download.py:32: in test_parse_dandi_url\n    assert _assert_parse_girder_url(\"DANDI:000027\") == (\ndandi/tests/test_download.py:17: in _assert_parse_girder_url\n    st, s, a, aid = parse_dandi_url(url)\ndandi/download.py:143: in parse\n    return cls.parse(new_url)\ndandi/download.py:148: in parse\n    return cls.parse(new_url)\ndandi/download.py:155: in parse\n    raise RuntimeError(\nE   RuntimeError: https://gui.dandiarchive.org/#/dandiset/000027 did not redirect to another location which dandi client would know how to handle.\n________________________ test_parse_dandi_url_redirect _________________________\ndandi/tests/test_download.py:124: in test_parse_dandi_url_redirect\n    assert _assert_parse_girder_url(\"https://dandiarchive.org/dandiset/000003\") \n== (\ndandi/tests/test_download.py:17: in _assert_parse_girder_url\n    st, s, a, aid = parse_dandi_url(url)\ndandi/download.py:148: in parse\n    return cls.parse(new_url)\ndandi/download.py:155: in parse\n    raise RuntimeError(\nE   RuntimeError: https://gui.dandiarchive.org/#/dandiset/000003 did not redirect to another location which dandi client would know how to handle.\n```\n\nMy first guess is that something changed on Dandiarchive's end, but there haven't been any changes to its code today.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597424392,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDE2OTM2OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674169369"},"message":"Redirector had some changes iirc from slack... But also this url we redirected to them redirects to draft version by JS frontend which we can't follow... Can't check ATM what https://dandiarchive.org/dandiset/000003  right now? To specific version (draft or not) or defers it to web client to do (which IMHO it shouldn't)? If defers - IMHO needs fixing in redirector","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597424532,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDE3MDQxNQ==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674170415"},"message":"https://dandiarchive.org/dandiset/000003 is currently an HTTP redirect to https://gui.dandiarchive.org/#/dandiset/000003, which then appears to perform a JavaScript redirect to the same URL with `/draft` added to the end.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1597426898,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDE4NzA3Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674187077"},"message":"there are a few places to get info:\n\nhttps://girder.dandiarchive.org/api/v1/dandi/000027 --\u003e draft info\n\nhttps://publish.dandiarchive.org/api/dandisets/000003/versions/  --\u003e count 0\nhttps://publish.dandiarchive.org/api/dandisets/000027/versions/  --\u003e count 1\n\nhttps://publish.dandiarchive.org/api/dandisets/000027/versions/0.200721.2222/\n\ncurrently the gui logic is, if there is a published version (i.e. count returned from publish api is greater than 0, then the latest version is returned, else draft is returned.\n\nthe CLI can implement this logic directly or we could include it in the redirector (but then we are getting the redirector to look like an api). i would rather see this evolve to be the api itself.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597428340,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDE5Njg1Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/199#issuecomment-674196857"},"message":"Sure we could duplicate logic in the clients but IMHO it is very suboptimal.. Given that dandi cli is installed on clients, updating it for another change in behavior would again require announcement of minimal version for consistency etc. Also note that it is already a change in behavior  - test was passing before.","files":null},{"type":4,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597755084,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzY2NjE5MjM5Nw=="},"status":2}]}