{"version":2,"ops":[{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1655360309,"metadata":{"github-id":"UCE_lAHODBZtRc5L4gO9zi-Lnks"},"target":"8500aea853ea65d97dd74f8ca67492aa7e933bcf458e99ab65b5260723153a37","message":"I am trying to upload this file\n[ecephys_tutorial.nwb.zip](https://github.com/dandi/dandi-cli/files/8916143/ecephys_tutorial.nwb.zip)\n\nbut when I run `dandi upload` I get \n\n```\n(base) MacBook-Pro-5:000121 bendichter$ dandi upload\n2022-06-16 02:18:20,386 [    INFO] Found 2 files to consider\nPATH                        SIZE     ERRORS UPLOAD STATUS           MESSAGE                  \ndandiset.yaml               4.5 kB                 skipped          should be edited online  \nsub-001/sub-001_ecephys.nwb 204.1 kB               pre-validating                            \nSummary:                    208.7 kB               1 skipped        1 should be edited online\nPATH                        SIZE        ERRORS     UPLOAD STATUS           MESSAGE                  \ndandiset.yaml               4.5 kB                        skipped          should be edited online  ecosub-001/sub-001_ecephys.nwb 204.1 kB       1              skipped          failed validation        \nSummary:                    208.7 kB 1 with errors        2 skipped        1 should be edited online\n                                                                           1 failed validation      \n2022-06-16 02:18:20,579 [    INFO] Logs saved in /Users/bendichter/Library/Logs/dandi-cli/20220616061815Z-87466.log\n(base) MacBook-Pro-5:000121 bendichter$ \n```\n\nThe log does not appear to give me any useful information about why validation failed\n\n[20220616060840Z-86009.log](https://github.com/dandi/dandi-cli/files/8916150/20220616060840Z-86009.log)\n\nThe standard way of validating NWB files, `python -m pynwb.validate sub-001/sub-001_ecephys.nwb` yields no errors.\n\nRunning nwbinspector does not help either, as all of the messages are \"best practice suggestions\" and should not prevent an upload:\n\n```\n(base) MacBook-Pro-5:000121 bendichter$ nwbinspector --config dandi sub-001/sub-001_ecephys.nwb \nInspecting NWBFiles...:   0%|                                                                                                                                    | 0/1 [00:00\u003c?, ?it/s]/Users/bendichter/opt/miniconda3/lib/python3.9/site-packages/pynwb/ecephys.py:93: UserWarning: The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"The second dimension of data does not match the length of electrodes. Your data may be \"\n                                                                                                                                                                                       \n\n**************************************************\nNWBInspector Report Summary\n\nTimestamp: 2022-06-16 02:14:22.338099-04:00\nPlatform: macOS-10.16-x86_64-i386-64bit\nNWBInspector version: 0.4.0\n\nFound 5 issues over 1 files:\n       5 - BEST_PRACTICE_SUGGESTION\n**************************************************\n\n\n0  BEST_PRACTICE_SUGGESTION\n===========================\n\n0.0  sub-001/sub-001_ecephys.nwb: None - 'None' object with name 'None'\n       Message: The second dimension of data does not match the length of electrodes. Your data may be transposed.\n\n0.1  sub-001/sub-001_ecephys.nwb: None - 'None' object with name 'None'\n       Message: Description is missing.\n\n0.2  sub-001/sub-001_ecephys.nwb: None - 'None' object with name 'None'\n       Message: Description ('no description') is a placeholder.\n\n0.3  sub-001/sub-001_ecephys.nwb: None - 'None' object with name 'None'\n       Message: Metadata /general/keywords is missing.\n\n0.4  sub-001/sub-001_ecephys.nwb: None - 'None' object with name 'None'\n       Message: Subject.sex is missing.\n\n```\n\nTwo separate issues here.\n1. Why isn't this file validating?\n2. This is a bad user experience. Even if this file is not up to DANDI standards there needs to be a better communication of why.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1667521195,"metadata":{"github-id":"IC_kwDODBZtRc5Np2Ya","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1302816282"},"message":"sorry @bendichter for the late response, I might have been traveling (back then) ;-)  Usually I say we recommend/rely on users running `dandi validate` on those files which failed validation.  In this file case I see\n\n```\n❯ dandi validate /tmp/ecephys_tutorial.nwb\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\n[NWBI.check_electrical_series_dims] /tmp/ecephys_tutorial.nwb — The second dimension of data does not match the length of electrodes. Your data may be transposed.\n2022-11-03 14:54:05,841 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20221103185404Z-355822.log\n```\n\nwhich is I guess was the one.  Note that now we gather it from nwb-inspector whenever before it was plain invocation to pynwb.validate AFAIK.\n\n\u003cdetails\u003e\n\u003csummary\u003eand nwbinspector indeed lists it as CRITICAL ATM\u003c/summary\u003e \n\n```shell\n❯ nwbinspector /tmp/ecephys_tutorial.nwb\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace 'core' version 2.4.0 because version 2.5.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\nInspecting NWBFiles...:   0%|                                                                                                                                                                                                                | 0/1 [00:00\u003c?, ?it/s]/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\n                                                                                                                                                                                                                                                                   \n\n**************************************************\nNWBInspector Report Summary\n\nTimestamp: 2022-11-03 14:56:11.522285-04:00\nPlatform: Linux-5.19.0-2-amd64-x86_64-with-glibc2.35\nNWBInspector version: 0.4.17\n\nFound 7 issues over 1 files:\n       1 - CRITICAL\n       6 - BEST_PRACTICE_SUGGESTION\n**************************************************\n\n\n0  CRITICAL\n===========\n\n0.0  /tmp/ecephys_tutorial.nwb: check_electrical_series_dims - 'ElectricalSeries' object at location '/acquisition/ElectricalSeries'\n       Message: The second dimension of data does not match the length of electrodes. Your data may be transposed.\n\n1  BEST_PRACTICE_SUGGESTION\n===========================\n\n1.1  /tmp/ecephys_tutorial.nwb: check_description - 'Subject' object at location '/general/subject'\n       Message: Description is missing.\n\n1.2  /tmp/ecephys_tutorial.nwb: check_description - 'ElectricalSeries' object at location '/acquisition/ElectricalSeries'\n       Message: Description ('no description') is a placeholder.\n\n1.3  /tmp/ecephys_tutorial.nwb: check_experimenter_form - 'NWBFile' object at location '/'\n       Message: The name of experimenter 'Dr. Bilbo Baggins' does not match any of the accepted DANDI forms: 'LastName, Firstname', 'LastName, FirstName MiddleInitial.' or 'LastName, FirstName, MiddleName'.\n\n1.4  /tmp/ecephys_tutorial.nwb: check_keywords - 'NWBFile' object at location '/'\n       Message: Metadata /general/keywords is missing.\n\n1.5  /tmp/ecephys_tutorial.nwb: check_subject_sex - 'Subject' object at location '/general/subject'\n       Message: Subject.sex is missing.\n\n1.6  /tmp/ecephys_tutorial.nwb: check_col_not_nan - 'DynamicTable' object with name 'electrodes'\n       Message: Column 'imp' has all NaN values. Consider removing it from the table.\n\n```\n\u003c/details\u003e","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1667594436,"metadata":{"github-id":"IC_kwDODBZtRc5NvLZW","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1304213078"},"message":"Thanks @yarikoptic this helped identify an issue in the tutorial","files":null},{"type":4,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1667594436,"metadata":{"github-id":"CE_lADODBZtRc5L4gO9zwAAAAHNkkI1"},"status":2},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1668025432,"metadata":{"github-id":"IC_kwDODBZtRc5OCtsb","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309334299"},"message":"@bendichter - I just had a similar issue, I thought that `nwbinspector --config dandi` should include all dandi-related errors, am I right?","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1668025719,"metadata":{"github-id":"IC_kwDODBZtRc5OCu00","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309338932"},"message":"\u003e  I just had a similar issue, I thought that nwbinspector --config dandi should include all dandi-related errors, am I right?\n\nCan you elaborate on your issue (including, ideally, the report in your case)?\n\nThe point is that a failure in `dandi validate` (which should prevent upload) should be equivalent to seeing any CRITICAL or above results with `nwbinspector --config dandi`","files":null},{"type":6,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1668025733,"metadata":{"github-id":"UCE_lALODBZtRc5OCu00zilbhWM"},"target":"667d45467e75a96d686f621fd33fb8da5e62b6e0a0704a28657c7986a927d35f","message":"\u003e  I just had a similar issue, I thought that nwbinspector --config dandi should include all dandi-related errors, am I right?\n\n@djarecka Can you elaborate on your issue (including, ideally, the report in your case)?\n\nThe point is that a failure in `dandi validate` (which should prevent upload) should be equivalent to seeing any CRITICAL or above results with `nwbinspector --config dandi`","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1668025987,"metadata":{"github-id":"IC_kwDODBZtRc5OCvzZ","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309342937"},"message":"I have an error from `dandi validator`, but no critical file from `nwbinspector` (file from the [user guide](https://github.com/dandi/example-notebooks/blob/master/dandi/DANDI%20User%20Guide%2C%20Part%20I.ipynb))\n\nDo you want me to open an issue in the inspector repo?\n\n```\n(dandi_pip) dhcp-10-31-85-60:205769 dorota$ dandi validate\n2022-11-09 15:30:04,586 [   ERROR] sub-001/sub-001_ecephys.nwb: 1 error(s)\n2022-11-09 15:30:04,586 [   ERROR]   Subject.sex is missing.\nSummary: Validation errors in 1 out of 1 files\n2022-11-09 15:30:04,586 [    INFO] Logs saved in /Users/dorota/Library/Logs/dandi-cli/20221109203003Z-76498.log\n(dandi_pip) dhcp-10-31-85-60:205769 dorota$ nwbinspector . --config dandi\n                                                                                                                                                   \n\n**************************************************\nNWBInspector Report Summary\n\nTimestamp: 2022-11-09 15:30:11.718071-05:00\nPlatform: macOS-12.0.1-arm64-arm-64bit\nNWBInspector version: 0.4.17\n\nFound 7 issues over 1 files:\n       1 - BEST_PRACTICE_VIOLATION\n       6 - BEST_PRACTICE_SUGGESTION\n**************************************************\n\n\n0  BEST_PRACTICE_VIOLATION\n==========================\n\n0.0  sub-001/sub-001_ecephys.nwb: check_regular_timestamps - 'ElectricalSeries' object at location '/acquisition/test_ephys_data'\n       Message: TimeSeries appears to have a constant sampling rate. Consider specifying starting_time=0.0 and rate=0.1 instead of timestamps.\n\n1  BEST_PRACTICE_SUGGESTION\n===========================\n\n1.1  sub-001/sub-001_ecephys.nwb: check_description - 'Subject' object at location '/general/subject'\n       Message: Description is missing.\n\n1.2  sub-001/sub-001_ecephys.nwb: check_description - 'Device' object at location '/general/devices/trodes_rig123'\n       Message: Description is missing.\n\n1.3  sub-001/sub-001_ecephys.nwb: check_experimenter_form - 'NWBFile' object at location '/'\n       Message: The name of experimenter 'Dr. Bilbo Baggins' does not match any of the accepted DANDI forms: 'LastName, Firstname', 'LastName, FirstName MiddleInitial.' or 'LastName, FirstName, MiddleName'.\n\n1.4  sub-001/sub-001_ecephys.nwb: check_keywords - 'NWBFile' object at location '/'\n       Message: Metadata /general/keywords is missing.\n\n1.5  sub-001/sub-001_ecephys.nwb: check_subject_sex - 'Subject' object at location '/general/subject'\n       Message: Subject.sex is missing.\n\n1.6  sub-001/sub-001_ecephys.nwb: check_col_not_nan - 'DynamicTable' object with name 'electrodes'\n       Message: Column 'imp' has all NaN values. Consider removing it from the table.\n```","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1668026132,"metadata":{"github-id":"IC_kwDODBZtRc5OCwVq","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309345130"},"message":"\u003e Do you want me to open an issue in the inspector repo?\n\nSure - it looks like it's not being properly elevated from that usage, will investigate","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1668034067,"metadata":{"github-id":"IC_kwDODBZtRc5ODUD5","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309491449"},"message":"Hm, looking at https://github.com/dandi/dandi-schema/blob/71a8ea3f8231cc8bf4fadcc51ea76db86171925f/dandischema/models.py#L818 where it is \n\n```\nsex: Optional[SexType]\n```\nand we even test https://github.com/dandi/dandi-cli/blob/HEAD/dandi/tests/test_metadata.py#L237 with `\"sex\": None` to be ok.\n\nAnd it seems to be not required but rather \"good practice\" according to nwbinspector.  Having upgraded all versions of dandi-cli, nwbinspector, pynwb, and hdmf I see following\n\n\u003cdetails\u003e\n\u003csummary\u003edandi validate exits with non-0 but with another error () \u003c/summary\u003e \n\n\n```shell\n❯ dandi validate ecephys_tutorial.nwb\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\n[NWBI.check_electrical_series_dims] ecephys_tutorial.nwb — The second dimension of data does not match the length of electrodes. Your data may be transposed.\n[NWBI.check_subject_sex] ecephys_tutorial.nwb — Subject.sex is missing.\n2022-11-09 17:38:48,387 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20221109223846Z-1414634.log\n❯ echo $?\n1\n```\n\ncolors aren't copy/pasted but  `NWBI.check_electrical_series_dims` is the red one and sex is blue, so I guess just a warning, right @TheChymera ?\n\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003enwbinspector also has the same CRITICAL error and sex among other recommended practices issues (not sure why we have only sex warning and not the others,,, need to check)\u003c/summary\u003e \n\n```shell\n❯ nwbinspector ecephys_tutorial.nwb\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace 'core' version 2.4.0 because version 2.5.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\nInspecting NWBFiles...:   0%|                                                                                                   | 0/1 [00:00\u003c?, ?it/s]/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\n                                                                                                                                                      \n\n**************************************************\nNWBInspector Report Summary\n\nTimestamp: 2022-11-09 17:46:36.829704-05:00\nPlatform: Linux-5.19.0-2-amd64-x86_64-with-glibc2.35\nNWBInspector version: 0.4.17\n\nFound 7 issues over 1 files:\n       1 - CRITICAL\n       6 - BEST_PRACTICE_SUGGESTION\n**************************************************\n\n\n0  CRITICAL\n===========\n\n0.0  ecephys_tutorial.nwb: check_electrical_series_dims - 'ElectricalSeries' object at location '/acquisition/ElectricalSeries'\n       Message: The second dimension of data does not match the length of electrodes. Your data may be transposed.\n\n1  BEST_PRACTICE_SUGGESTION\n===========================\n\n1.1  ecephys_tutorial.nwb: check_description - 'Subject' object at location '/general/subject'\n       Message: Description is missing.\n\n1.2  ecephys_tutorial.nwb: check_description - 'ElectricalSeries' object at location '/acquisition/ElectricalSeries'\n       Message: Description ('no description') is a placeholder.\n\n1.3  ecephys_tutorial.nwb: check_experimenter_form - 'NWBFile' object at location '/'\n       Message: The name of experimenter 'Dr. Bilbo Baggins' does not match any of the accepted DANDI forms: 'LastName, Firstname', 'LastName, FirstName MiddleInitial.' or 'LastName, FirstName, MiddleName'.\n\n1.4  ecephys_tutorial.nwb: check_keywords - 'NWBFile' object at location '/'\n       Message: Metadata /general/keywords is missing.\n\n1.5  ecephys_tutorial.nwb: check_subject_sex - 'Subject' object at location '/general/subject'\n       Message: Subject.sex is missing.\n\n1.6  ecephys_tutorial.nwb: check_col_not_nan - 'DynamicTable' object with name 'electrodes'\n       Message: Column 'imp' has all NaN values. Consider removing it from the table.\n\n```\n\u003c/details\u003e\n\nso -- the question remains - how are we getting absent sex to be an error?","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1668034625,"metadata":{"github-id":"IC_kwDODBZtRc5ODWgW","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309501462"},"message":"\u003e so -- the question remains - how are we getting absent sex to be an error?\n\nThat was upgraded to CRITICAL a while back at the discretion of @bendichter at @satra's request, I believe: https://github.com/NeurodataWithoutBorders/nwbinspector/pull/247\n\nWe've required subject species, age, and sex ever since that was merged.\n\nThat's also the state it was left in (and checked by me last time I worked with this stuff) after https://github.com/dandi/dandi-cli/pull/1108 (in which I also mentioned the heightened metadata requirements).\n\n\n\u003e /home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/pynwb/ecephys.py:90: UserWarning: ElectricalSeries 'ElectricalSeries': The second dimension of data does not match the length of electrodes. Your data may be transposed.\n  warnings.warn(\"%s '%s': The second dimension of data does not match the length of electrodes. \"\n[NWBI.check_electrical_series_dims] ecephys_tutorial.nwb — The second dimension of data does not match the length of electrodes. Your data may be transposed.\n[NWBI.check_subject_sex] ecephys_tutorial.nwb — Subject.sex is missing.\n\nI'm unsure about all this newfangled display of the suggestion-level stuff or coloration, but you'd expect to see both of them there as CRITICAL level things preventing dandi validation. The first is a problem with the tutorial itself, though.\n\n\n\u003e nwbinspector ecephys_tutorial.nwb\n/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/lib/python3.10/site-packages/hdmf/spec/namespace.py:531: UserWarning: Ignoring cached namespace 'core' version 2.4.0 because version 2.5.0 is already loaded.\n\nAs @djarecka pointed out, you need to run it with `--config dandi` to see the configuration that the validation should be using. That's not working as expected which is what I'm trying to fix ATM","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1668046663,"metadata":{"github-id":"IC_kwDODBZtRc5OEBGl","github-url":"https://github.com/dandi/dandi-cli/issues/1031#issuecomment-1309675941"},"message":"Fix is now merged and available in NWB Inspector v0.4.18","files":null}]}