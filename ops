{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1651613624,"metadata":{"github-id":"I_kwDODBZtRc5I_yBu","github-url":"https://github.com/dandi/dandi-cli/issues/996","origin":"github"},"title":"upload: Channel back error message from server","message":"I tried to upload a 0-length file into staging (again hitting the old sore point of https://github.com/dandi/dandi-archive/issues/168), and got:\n\n```shell\nlena:/tmp/200589\n$\u003e DANDI_DEVEL=1 dandi upload --allow-any-path -i dandi-staging 123.txt\n2022-05-03 17:23:19,397 [    INFO] Found 1 files to consider\nPATH                 SIZE    ERRORS UPLOAD STATUS                MESSAGE                                                                                               \n123.txt              0 Bytes   0           ERROR                 Error 400 while sending POST request to https://api-staging.dandiarchive.org/api/uploads/initialize/  \nSummary:             0 Bytes               1 ERROR               1 Error 400 while sending POST request to https://api-staging.dandiarchive.org/api/uploads/initialize/\n2022-05-03 17:23:19,728 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20220503212317Z-2206752.log\n```\nwhich isn't very telling.  The (very verbose DEBUG) log file did have the actual reason present\n\n```\n2022-05-03T17:23:19-0400 [DEBUG   ] urllib3.connectionpool 2206752:139731256288832 https://api-staging.dandiarchive.org:443 \"POST /api/uploads/initialize/ HTTP/1.1\" 400 68\n2022-05-03T17:23:19-0400 [ERROR   ] dandi 2206752:139731256288832 Error 400 while sending POST request to https://api-staging.dandiarchive.org/api/uploads/initialize/: {\"contentSize\":[\"Ensure this value is greater than or equal to 1.\"]}\n```\n\nI wonder what should we do.  Possibilities\n\n- do similar check on client size and ensure that filesize \u003e 0.  But I would prefer avoid such ad-hoc checks, especially since it is simply due to a shortcoming  in current server implementation (https://github.com/dandi/dandi-archive/issues/168)\n- somehow channel body of the error back to the user. May be instead of \n\n```\nError 400 while sending POST request to https://api-staging.dandiarchive.org/api/uploads/initialize/\n```\n\ndisplay \n\n```\nError 400: {\"contentSize\":[\"Ensure this value is greater than or equal to 1.\"]}\n```\n\nWDYT @jwodder and @satra ?","files":null}]}