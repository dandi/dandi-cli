{"version":2,"ops":[{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1738687262,"metadata":{"github-id":"IC_kwDODBZtRc6dB2z1","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2634509557"},"message":"@yarikoptic - what are the use cases for navigating zarrs or for downloading, over streaming/visualization/computation, or the validator service that exists?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1738695163,"metadata":{"github-id":"IC_kwDODBZtRc6dC-AX","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2634801175"},"message":"@satra This is for providing URLs pointing to part of a Zarr in order to enable partial Zarr download (#1461).","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1738695538,"metadata":{"github-id":"IC_kwDODBZtRc6dDBBv","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2634813551"},"message":"@yarikoptic \n\n* Should this support downloading URLs pointing to folders within Zarrs as well as URLs pointing to individual files?\n* Is this functionality going to play any role in partial Zarr upload?  If so, how?\n* Should any `dandidav` URL be accepted for download or only those underneath Zarrs?\n* Note that the reason the web view provides direct download links for files is simply to avoid `dandidav` having to resolve another request when a user clicks the link; the code could be changed to instead link to a `dandidav` URL that redirects to S3.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1739194009,"metadata":{"github-id":"IC_kwDODBZtRc6d1ROx","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2647987121"},"message":"@yarikoptic Ping.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1739207050,"metadata":{"github-id":"IC_kwDODBZtRc6d381v","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2648690031"},"message":"\u003e * Should this support downloading URLs pointing to folders within Zarrs as well as URLs pointing to individual files?\n\nideally -- yes, unless you see some factors forbidding that\n\n\u003e * Is this functionality going to play any role in partial Zarr upload?  If so, how?\n\nyes. \n\nMy thinking was: with `--preserve-tree` should recreate a full path, then for `upload` we would just allow pointing to that path within zarr and instance and I think that should provide sufficient information to implement such partial upload. Currently it would need to rely on \"shortcomings\" of current zarr support design when seeing S3 URLs:\n\n- zarr is associated with a single dandiset\n- there is a single zarr within a dandiset\n  - note that `path` within `zarr` record does not necessarily correspond to current zarr path.  It could be used as initial guess, to check if it is still there for the same zarr id, if not -- would probably need listing of all zarrs using `glob` option for `/assets/` end-point, unless you see a more efficient way.\n\n\u003e * Should any `dandidav` URL be accepted for download or only those underneath Zarrs?\n\n*any* unless you see some factors forbidding that\n\n\u003e * Note that the reason the web view provides direct download links for files is simply to avoid `dandidav` having to resolve another request when a user clicks the link; the code could be changed to instead link to a `dandidav` URL that redirects to S3.\n\nThank you for mentioning that!  IIRC we decided on direct S3 links to facilitate efficient access to zarrs (e.g. from zarr capable tools).  So adding such redirection would slow down such operations and thus should be avoided...  Possibly facilitate to not bothering with S3 URLs for now , filed \n\n- https://github.com/dandi/dandidav/issues/248","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1739207592,"metadata":{"github-id":"IC_kwDODBZtRc6d4Cqe","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2648713886"},"message":"@yarikoptic \n\n\u003e then for `upload` we would just allow pointing to that path within zarr and instance\n\nPointing how?  Via a URL passed on the command line?  What role does `--preserve-tree` play in this?\n\n\u003e there is a single zarr within a dandiset\n\nUh... what?  Do you mean that a given Zarr only appears at a single path within its Dandiset?  That used to not be the case, and I can't recall if it was changed or not.\n\n\u003e note that `path` within `zarr` record does not necessarily correspond to current zarr path\n\nDo you mean the `name` field?  The Zarr objects returned by the API don't have `path` fields.\n\n\u003e\u003e * Should any `dandidav` URL be accepted for download or only those underneath Zarrs?\n\u003e\n\u003e *any* unless you see some factors forbidding that\n\nIf we do this, I think it's highly likely someone will at some point accidentally try to download all of https://webdav.dandiarchive.org, which would not be good for anyone.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1739229326,"metadata":{"github-id":"IC_kwDODBZtRc6d67KA","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2649469568"},"message":"\u003e [@yarikoptic](https://github.com/yarikoptic)\n\u003e \n\u003e \u003e then for `upload` we would just allow pointing to that path within zarr and instance\n\u003e \n\u003e Pointing how? Via a URL passed on the command line? \n\nyes. Cut-paste url from browser into invocation of `dandi download`\n\n\u003e What role does `--preserve-tree` play in this?\n\nit simplifies user's life as to specify later target location where to upload since our `upload` does not provide target destination path -- we can only specify instance, need having `dandiset.yaml`, and path is taken as on local filesystem. Hence we have https://docs.dandiarchive.org/12_download/#download-the-dandisetyaml-file-and-a-specific-file-within-the-directory-tree-of-the-dandiset and I think it would work out nicely in this case\n\n\u003e \u003e there is a single zarr within a dandiset\n\u003e \n\u003e Uh... what? Do you mean that a given Zarr only appears at a single path within its Dandiset? \n\nyes\n\n\u003e That used to not be the case, and I can't recall if it was changed or not.\n\nI do not think it is restricted anywhere/how formally but it is a virtue that nobody would re-use the same zarr at different locations in the dandiset.  Anyways -- for this purpose we could even potentially just go \"for the first one\".\n\n\u003e \u003e note that `path` within `zarr` record does not necessarily correspond to current zarr path\n\u003e \n\u003e Do you mean the `name` field? The Zarr objects returned by the API don't have `path` fields.\n\nyes, I meant `name`.\n\n\u003e \u003e \u003e * Should any `dandidav` URL be accepted for download or only those underneath Zarrs?\n\u003e \u003e \n\u003e \u003e \n\u003e \u003e _any_ unless you see some factors forbidding that\n\u003e \n\u003e If we do this, I think it's highly likely someone will at some point accidentally try to download all of https://webdav.dandiarchive.org, which would not be good for anyone.\n\nthey already can with `wget` or alike.  But here I do not see how we would facilitate it further -- we should limit to urls within dandisets and/or zarrs as to figure which particular dandiset and its version, hence for eg.\n\n- https://webdav.dandiarchive.org, https://webdav.dandiarchive.org/dandisets/ -- fail since no specific dandiset\n- https://webdav.dandiarchive.org/dandisets/000003/releases/ - fail since no specific version\n- https://webdav.dandiarchive.org/dandisets/000003/draft, or any particular version -- similar to what we already support via various other URLs\n- https://webdav.dandiarchive.org/zarrs/001/e3b/001e3b6d-26fb-463f-af28-520a25680ab4/ -- not sure, since ATM we have pretty much just one version of zarr, but let's assume we would want explicit thus requiring https://webdav.dandiarchive.org/zarrs/001/e3b/001e3b6d-26fb-463f-af28-520a25680ab4/326273bcc8730474323a66ea4e3daa49-113328--97037755426.zarr/","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1739984334,"metadata":{"github-id":"IC_kwDODBZtRc6fGTnW","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2669230550"},"message":"- let's forget about \"zarr versioning\" here, i.e. if a specific version of file within zarr requested -- we still just provide access to \"draft\" (latest) version ATM. We would need to file a separate issue to be addressed though\n- difficulty on \"partial download\" within zarr: requires code review to assess how difficult would be to implement it.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1740754401,"metadata":{"github-id":"IC_kwDODBZtRc6gYvhH","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2690840647"},"message":"@yarikoptic Please state here exactly what you currently want me to do for this issue.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1741199646,"metadata":{"github-id":"IC_kwDODBZtRc6hCY3w","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2701757936"},"message":"For this particular issue -- add to our `dandi` client command ability to understand and download from URLs coming from webdav instance as e.g. outlined per different types of urls in the [comment above](https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2649469568).  But given that it would not be applicable to non-yet-webdav powered instances like LINC and with private access only -- it would not provide remedy there , so it is \"lower priority\"","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1741200126,"metadata":{"github-id":"IC_kwDODBZtRc6hCdQ-","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2701775934"},"message":"@yarikoptic In the meeting notes, you stated:\n\n\u003e forget about “versioning” for now, and may be even S3 urls, review zarr download implementation re partial download possibility – and provide possibility to simply provide list of paths to be downloaded (instead of a full zarr content)\n\nHow am I supposed to square this with your latest comment?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1741201352,"metadata":{"github-id":"IC_kwDODBZtRc6hCock","github-url":"https://github.com/dandi/dandi-cli/issues/1572#issuecomment-2701821732"},"message":"That let's postpone work on this feature, and proceed with implementation of download/upload following the discussion in\n\n- https://github.com/dandi/dandi-cli/issues/1462#issuecomment-2701769126","files":null}]}