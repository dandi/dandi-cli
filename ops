{"version":2,"ops":[{"type":6,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653480730,"metadata":{"github-id":"UCE_lAHODBZtRc5KYwnOzi52794"},"target":"d6b3c3cf5d611cdfcd5e41de0205dbbc2c0f7d22885de136b51e1f6a6c085f07","message":"```python\n    ...: for asset in ds.get_assets():\n    ...:     if asset.path.endswith(\"ngff\"):\n    ...:         try:\n    ...:             meta = asset.get_metadata()\n    ...:         except ValidationError:\n    ...:             check.append(asset)\n    ...:             print(f\"invalid: {asset.path}\")\n    ...:         else:\n    ...:             meta.path = meta.path.replace(\".ngff\", \".ome.zarr\")\n    ...:             asset.set_metadata(meta)\n    ...:             print(meta.path)\n    ...: \n```\nin this code `ds.get_assets()` does not go through all the assets in a dandiset. i have had to run the block multiple times on dandiset 108.","files":null},{"type":6,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653480766,"metadata":{"github-id":"UCE_lAHODBZtRc5KYwnOzi528dY"},"target":"d6b3c3cf5d611cdfcd5e41de0205dbbc2c0f7d22885de136b51e1f6a6c085f07","message":"```python\n    ...: for asset in ds.get_assets():\n    ...:     if asset.path.endswith(\"ngff\"):\n    ...:         try:\n    ...:             meta = asset.get_metadata()\n    ...:         except ValidationError:\n    ...:             check.append(asset)\n    ...:             print(f\"invalid: {asset.path}\")\n    ...:         else:\n    ...:             meta.path = meta.path.replace(\".ngff\", \".ome.zarr\")\n    ...:             asset.set_metadata(meta)\n    ...:             print(meta.path)\n    ...: \n```\nin this code `ds.get_assets()` does not go through all the assets in a dandiset. i have had to run the block multiple times on dandiset 108.\n\nthere are no errors, it just stops.","files":null},{"type":5,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653480718,"metadata":{"github-id":"LE_lADODBZtRc5KYwnOzwAAAAGN_kLG"},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653480718,"metadata":{"github-id":"LE_lADODBZtRc5KYwnOzwAAAAGN_kLL"},"added":["severity-important"],"removed":[]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653484663,"metadata":{"github-id":"IC_kwDODBZtRc5DyLXD","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137227203"},"message":"@satra The following code runs fine for me:\n\n```python\nimport logging\nfrom dandi.dandiapi import DandiAPIClient\n\nlogging.basicConfig(\n    format=\"%(asctime)s [%(levelname)-8s] %(name)s: %(message)s\",\n    datefmt=\"%H:%M:%S\",\n    level=logging.DEBUG,\n)\n\nwith DandiAPIClient.for_dandi_instance(\"dandi\") as client:\n    d = client.get_dandiset(\"000108\")\n    for a in d.get_assets():\n        print(a.path)\n```\n\nCan you determine exactly where your code is stopping?  Or produce an MVCE?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653484793,"metadata":{"github-id":"IC_kwDODBZtRc5DyL87","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137229627"},"message":"it just stops after roughly 300ish assets, and i restart and it runs another set and then returns. do you get all 6000 assets in your loop?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653484837,"metadata":{"github-id":"IC_kwDODBZtRc5DyMLo","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137230568"},"message":"@satra I get 6040 assets, yes.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1653484889,"metadata":{"github-id":"UCE_lALODBZtRc5DyMLoziOT-ZU"},"target":"d68b8f1a5cf718e70717095a06a47bb330c2a93a2b7c06637ebe07d04f4dc6f7","message":"@satra I get 6040 assets, yes.\n\nIf you turn on DEBUG logging, is anything relevant shown?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653485703,"metadata":{"github-id":"IC_kwDODBZtRc5DyQdu","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137248110"},"message":"the api server is under load at this point i think (i can't even get to the archive at the moment, the api is responding but slowly). \n\na few resetting dropped connection. but since i have changed the names for most things, it's no longer doing the fetch metadata operation. once the load dies down, let me get metadata again.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653507406,"metadata":{"github-id":"IC_kwDODBZtRc5D0Q1t","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137773933"},"message":"FWIW - snippet worked out for me just fine, and inspired to file #1019.\n\nmeanwhile, I wonder if we should increase default page_size and where  -- server or client?\n\nwe do 25 items by default (server) ATM. That takes that script 40 sec to run. Changing to 100 (on client side to be specified explicitly) -- goes down to 25 sec. Making it 500 -- 18 sec.  Overall, it feels that we should at least make it a hundred.  That should also reduce load on the server/logging.  I think we better change it on server side.  Most likely it would also affect default pagination of files in file navigator (which is imho ok).\n\nWDYT? meanwhile also filed https://github.com/dandi/dandi-archive/pull/1107 to increase it on server side","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653508074,"metadata":{"github-id":"IC_kwDODBZtRc5D0TKF","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137783429"},"message":"increasing number and parallelizing requests is good. it may be useful to also put in a throttle factor so one can control based on busy level of the server. \n\nunfortunately in a realistic scenario (i.e. when i first ran it), it was doing 3 calls per asset. in the current scenario it is only iterating over the assets endpoint, not making those other calls. i think the issue i ran into may have had something to do with the get/set metadata operations (more likely the latter). but there was no reported error, just that the loop stopped at about 5% of total number of assets.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653513025,"metadata":{"github-id":"IC_kwDODBZtRc5D0jyl","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137851557"},"message":"\u003e ... just that the loop stopped at about 5% of total number of assets.\n\nmay be some `GET` call never returned/stalled?  I do not think we have any \"stall\" detection implemented yet. Not sure if `requests` which we IIRC use does, does it?  (I thought that there should be some stall detection at the level of TCP layer or smth like that for GET, but recently got `annex get` stalled  as well : https://git-annex.branchable.com/bugs/get_is_busy_doing_nothing/#comment-a9dd3fbeee226bff1a93048aed27f4f1)","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653513365,"metadata":{"github-id":"IC_kwDODBZtRc5D0k0Y","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1137855768"},"message":"in this situation, i did get the ipython prompt back, so whatever happened, happened silently without exception.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658932513,"metadata":{"github-id":"IC_kwDODBZtRc5HVmKd","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1196843677"},"message":"@satra Can this issue be considered resolved?","files":null},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658935290,"metadata":{"github-id":"LE_lADODBZtRc5KYwnOzwAAAAGlpHPa"},"added":["Python API"],"removed":[]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658936758,"metadata":{"github-id":"IC_kwDODBZtRc5HV7wq","github-url":"https://github.com/dandi/dandi-cli/issues/1018#issuecomment-1196932138"},"message":"I would say yes - there were good number of related changes on client and server sides and nobody but @satra ran into it, and we got no more detail to be able to resolve it to full satisfaction. @satra please reopen if you still observe this issue.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1658936758,"metadata":{"github-id":"CE_lADODBZtRc5KYwnOzwAAAAGlp3IL"},"status":2}]}