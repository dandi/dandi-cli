{"version":2,"ops":[{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1643583798,"metadata":{"github-id":"UCE_lAHODBZtRc5Crrqmzik3A98"},"target":"adc5449d4a231b2a054a092b67a5783eb3020952c1c4f26276a63116aba2526f","message":"`dandi upload --help` mentions a `--dandiset-path` arg, but I don't see one in the options. What is the proper way to set this without being in that directory?\n\n```\n$ dandi upload --help\nUsage: dandi upload [OPTIONS] [PATHS]...\n\n  Upload Dandiset files to DANDI Archive.\n\n  The target Dandiset to upload to must already be registered in the archive,\n  and a `dandiset.yaml` file must exist in the local `--dandiset-path`.\n\n  Local Dandiset should pass validation.  For that, the assets should first be\n  organized using the `dandi organize` command.\n\n  By default all .nwb files in the Dandiset (excluding directories starting\n  with a period) will be considered for the upload.  You can point to specific\n  files you would like to validate and have uploaded.\n\nOptions:\n  -e, --existing [error|skip|force|overwrite|refresh]\n                                  What to do if a file found existing on the\n                                  server. 'skip' would skipthe file, 'force' -\n                                  force reupload, 'overwrite' - force upload\n                                  if either size or modification time differs;\n                                  'refresh' - upload only if local\n                                  modification time is ahead of the remote.\n                                  [default: refresh]\n  -J, --jobs N[:M]                Number of files to upload in parallel and,\n                                  optionally, number of upload threads per\n                                  file\n  --sync                          Delete assets on the server that do not\n                                  exist locally\n  --validation [require|skip|ignore]\n                                  Data must pass validation before the upload.\n                                  Use of this option is highly discouraged.\n                                  [default: require]\n  -i, --dandi-instance [dandi|dandi-api-local-docker-tests|dandi-devel|dandi-staging]\n                                  DANDI instance to use  [env var:\n                                  DANDI_INSTANCE;default: dandi]\n  --help                          Show this message and exit.\n```","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1643584604,"metadata":{"github-id":"IC_kwDODBZtRc49HCq_","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1025256127"},"message":"@bendichter The code that adds the `--dandiset-path` option is currently commented out for some reason, so you have no choice but to be in the Dandiset directory or a subdirectory thereof.\n\n@yarikoptic Should the `--dandiset-path` option be uncommented, or should the references to it be removed from the documentation?","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1643584751,"metadata":{"github-id":"IC_kwDODBZtRc49HC0p","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1025256745"},"message":"@jwodder thanks for the quick response! I would very much like to be able to upload a directory that is not the cwd","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1643585110,"metadata":{"github-id":"IC_kwDODBZtRc49HDTj","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1025258723"},"message":"@bendichter What exactly is preventing you from `cd`ing to that directory before running `dandi upload`?\n\nIf you really need to upload a non-PWD directory, you'll have to call `dandi.upload.upload()` yourself; [cf. how `dandi upload` does it](https://github.com/dandi/dandi-cli/blob/415670f215412d6d0b248bf34194657e7187e9db/dandi/cli/cmd_upload.py#L99-L111).","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1643896436,"metadata":{"github-id":"IC_kwDODBZtRc49VX_m","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1029013478"},"message":"@jwodder \n\nI am confused by the upload function as well. It has a required arg of `paths` and an optional arg of `dandiset_path`, and no docstring to explain the difference between these args. There is also no type hint to indicate what type \"paths\" should be. A list of strings? Should I pass in an empty list and use the `dandiset_path` optional arg?","files":null},{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1643896462,"metadata":{"github-id":"UCE_lALODBZtRc49VX_mziChHUY"},"target":"bf8a9bce366aee037f4e8fe2ad508210c8f01be39fce18482af46070b034f529","message":"@jwodder \n\nI am confused by the `upload` function as well. It has a required arg of `paths` and an optional arg of `dandiset_path`, and no docstring to explain the difference between these args. There is also no type hint to indicate what type \"paths\" should be. A list of strings? Should I pass in an empty list and use the `dandiset_path` optional arg? Could you please add a docstring so I know how to use this function?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1643897786,"metadata":{"github-id":"IC_kwDODBZtRc49Vc6p","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1029033641"},"message":"@bendichter Type hints were added in #887; the function looks like this now:\n\nhttps://github.com/dandi/dandi-cli/blob/11a95f184de1c482c4c3a073a1c59fdeaca02fce/dandi/upload.py#L29-L41\n\nI'm not going to write out a full docstring right now, but for the arguments in question:\n\n* `dandiset_path` needs to be the directory containing the uploaded Dandiset's `dandiset.yaml` or a subdirectory thereof; if not specified, it defaults to the current directory.\n* `paths` is a list of files \u0026 directories inside `dandiset_path` to upload; if it's empty, all assets in the Dandiset are uploaded.","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1643898630,"metadata":{"github-id":"IC_kwDODBZtRc49VgT3","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1029047543"},"message":"@jwodder ok thanks that's what I needed to know","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1643980932,"metadata":{"github-id":"IC_kwDODBZtRc49ZEO1","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1029981109"},"message":"@jwodder how would you feel about making `paths` optional?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1643982059,"metadata":{"github-id":"IC_kwDODBZtRc49ZHuf","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1029995423"},"message":"@bendichter Done: https://github.com/dandi/dandi-cli/pull/899","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1644594753,"metadata":{"github-id":"IC_kwDODBZtRc49xYac","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1036355228"},"message":"\u003e @bendichter What exactly is preventing you from `cd`ing to that directory before running `dandi upload`?\n\nand wouldn't `dandi upload the-path-to-dandiset-top-directory/` work?  `--dandiset-path` is really to just establish where the \"top\" of the dandiset is, may be too inspired by datalad's UI.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1644594776,"metadata":{"github-id":"UCE_lALODBZtRc49xYacziDYWX4"},"target":"0e49444e9694da1b1f811009aded1a7d50c8b6b1da03a5faaede7a09d248d9f8","message":"\u003e @bendichter What exactly is preventing you from `cd`ing to that directory before running `dandi upload`?\n\nand wouldn't `dandi upload the-path-to-dandiset-top-directory/` work?  `--dandiset-path` is really to just establish where the \"top\" of the dandiset is, may be too inspired by datalad's UI.\n\nedit: i.e. should we do anything extra for this issue or just consider it resolved?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1644932061,"metadata":{"github-id":"IC_kwDODBZtRc4-AWu9","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1040280509"},"message":"@yarikoptic That wouldn't work, as `upload` would still start looking in the current directory for the `dandiset.yaml` file.  If an explicit path given on the command line isn't under that, you'll get an error.\n\n\u003e should we do anything extra for this issue or just consider it resolved?\n\nWe need to decide whether to uncomment `--dandset-path` or remove its references from the documentation.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1644958646,"metadata":{"github-id":"IC_kwDODBZtRc4-CR9g","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1040785248"},"message":"`Dandiset.find` (which is ran on `dandiset_path`) already uses `find_parent_directory_containing` and thus possibly ascending path hierarchy, so `dandiset_path` can point to some other location within dandiset and thus being not really \"strict\" for what `--dandiset-path` points to.\n\nSo, overall I am still not sure on whether we should keep that `dandiset_path` at all since it doesn't really serve any pragmatic purpose (unlike in datalad where it might define the \"scope\" of operation in particular across dataset boundaries), and instead just make handling of `paths` a bit smarter.\n\n- if `paths`  not specified -- take `cwd`\n- if `paths` is specified \n   - take common prefix of all of them (might end up being `/` or empty string on Windows having different drives ;-))\n   - call `Dandiset.find()` on that common prefix.  If nothing found -- just inform user on what was that common path in the error to be issued.\n\nWDYT @jwodder ?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1644958788,"metadata":{"github-id":"UCE_lALODBZtRc4-CR9gziDxeHQ"},"target":"220e47f58d9c92d66bc089fbc878706b431bdc0572b5ae3fdb5b2744c3a469c0","message":"`Dandiset.find` (which is ran on `dandiset_path`) already uses `find_parent_directory_containing` and thus possibly ascending path hierarchy, so `dandiset_path` can point to some other location within dandiset and thus being not really \"strict\" for what `--dandiset-path` points to.\n\nSo, overall I am still not sure on whether we should keep that `dandiset_path` at all since it doesn't really serve any pragmatic purpose (unlike in datalad where it might define the \"scope\" of operation in particular across dataset boundaries), and instead just make handling of `paths` a bit smarter.\n\n- if `paths`  not specified -- take `cwd` (so -- current behavior)\n- if `paths` is specified \n   - take common prefix of all of them (might end up being `/` or empty string on Windows having different drives ;-))\n   - call `Dandiset.find()` on that common prefix.  If nothing found -- just inform user on what was that common path in the error to be issued.\n\nWDYT @jwodder ?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1644960374,"metadata":{"github-id":"IC_kwDODBZtRc4-CX5L","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1040809547"},"message":"@yarikoptic That sounds like a good strategy, but I think we should keep the Dandiset-finding behavior the same between `dandi upload` and `dandi organize` (the only command that currently has a `--dandiset-path` option).  For the record, its current behavior is: if `--dandiset-path` is specified, use that (without recursing upwards); otherwise, recurse upwards from the current directory in search of `dandiset.yaml`.  What strategy should be preferred for both commands?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1645042797,"metadata":{"github-id":"IC_kwDODBZtRc4-Hiid","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1042163869"},"message":"re behavior if command has a `--dandiset-path`  argument -- totally agree, they should behave identically. `organize` seems to use `Dandiset.find` from CWD only no dataset-path is specified, and if specified -- takes it as is, not search is performed.  I think such behavior is ok and explicit.\n\n`organize` does need `--dandiset-path` as the one to provide location where to organize into if cannot be deduced from CWD.  \n\n`upload` -- I feel it does not need `--dandiset-path` since if `paths`  are specified -- they pretty much instruct about the location of `dandiset-path` (hence [above comment](https://github.com/dandi/dandi-cli/issues/892#issuecomment-1040785248)), and if not specified -- deduce from CWD to upload entire dandiset user is under.  Then we could just remove handling of `dandiset_path` from upload and not bother harmonizing its behavior to `organize`.  Agree?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1645113587,"metadata":{"github-id":"IC_kwDODBZtRc4-LLXy","github-url":"https://github.com/dandi/dandi-cli/issues/892#issuecomment-1043117554"},"message":"@yarikoptic Agreed: https://github.com/dandi/dandi-cli/pull/916","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1645126769,"metadata":{"github-id":"CE_lADODBZtRc5CrrqmzwAAAAFrKnsH"},"status":2}]}