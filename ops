{"version":2,"ops":[{"type":2,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1659470191,"metadata":{"github-id":"RTE_lADODBZtRc5PDktNzwAAAAGn9pwv"},"title":"age metadata extraction preventing upload","was":"age metadata extraction preventing upload"},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1659473219,"metadata":{"github-id":"IC_kwDODBZtRc5Ht1tH","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1203198791"},"message":"i do agree that any metadata failure should be clearly communicated.\n\nhowever, i would prefer not to leave it blank since age is one of those filters that's absolutely necessary in most of neuroscience and structuring it is hard. the ISO 8601 standard allows range, and i believe dandi allows it as well (will need to check). so if they stick age in ISO8601 as a duration i believe that should work. \n\nsee 1 and 2 here: https://en.wikipedia.org/wiki/ISO_8601#Time_intervals (i'll check if we support it in the CLI extractor).\n\nmore importantly, it would be really helpful if such issues were posted or slacked. we really do not mind any help requests.","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1659474913,"metadata":{"github-id":"IC_kwDODBZtRc5Ht7MA","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1203221248"},"message":"\u003e age is one of those filters that's absolutely necessary in most of neuroscience\n\nI would like to push back on this claim. In my experience, it really depends. I can see why some labs do not track precise age information for their subjects. I have never done a study where I used age as a parameter. If you are doing developmental neurobiology age is obviously important, but for sensory, motor, memory, etc. it might not be.\n\n\u003e the ISO 8601 standard allows range.\n\nYes, the ISO 8601 standard does allow for time intervals. As you can see from the link you provided, the options they have are \n1. start and end\n2. start and duration\n3. duration and end\n4. a single duration\n\nNone of these would not be appropriate for age, where we would need two durations, a lower bound and an upper bound. I do not see anything in the ISO8601 standard that could be used for a range of durations. I suppose we could use 1 or 2 for the date of birth, but we I think it would be a bit awkward to indicate a time range for date of birth without an explanation that this is for approximating age.\n\n\u003e more importantly, it would be really helpful if such issues were posted or slacked. we really do not mind any help requests.\n\nFor non-programmers, it is difficult to post on Slack because 1) the are embarrassed and 2) they don't know what went wrong or what to post. The initial report that I got from this user was that they ran all the commands in the command window and no data showed up on DANDI. Upon meeting, there were several issues I discovered over multiple hours-long support sessions:\n1. the user was using the default command prompt and should have been using the Anaconda command window.\n2. the user was trying to form symlinks from an external drive, which was failing\n3. the user was trying to set age as \"24-48 hours\" which is now failing.\n\nNone of these issues were clear to the user, and working with them honestly they weren't clear to me either until I really dug in.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1659486504,"metadata":{"github-id":"IC_kwDODBZtRc5HuaDo","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1203347688"},"message":"since you posted the other issues, let's focus this one on age.\n\n- regarding the representation of age ranges, yes, while not ideal one could potentially use `start/duration` for it. we would have to build semantics, which i don't like, but possible.\n- we could change the participant model to support age range, it does come up in some contexts, and for humans provides some pseudonomization as well.  we can use a representation like `\u003cduration\u003e/\u003cduration\u003e` (e.g., `P24H/P48H`). @djarecka - since you wrote the age parser, what did we do with ranges? i remember there were some dandisets with ranges.\n- btw, what does the inspector do? since this would require an nwb fix, i would expect the dandi config of the inspector to raise an exception, not just for age, but subject id, sex, genotype, instrument info, etc.,. we may want to revisit the inspector. because this should have been caught at the validation stage. which also makes me think that the inspector should be called before metadata extraction (@yarikoptic). \n\nwe should start moving the age parser to expect these formats or raise an exception. the only reason we wrote the rules was to move to this schema for existing files.","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1659490974,"metadata":{"github-id":"IC_kwDODBZtRc5HukCx","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1203388593"},"message":"I believe we had some discussion about it but we didn't reach the conclusion. I believe the parses would give an error now...\n\nI've checked again the ISO document and I can't find what we need, but I believe using `\u003cduration\u003e/\u003cduration\u003e` would be the closest to the iso8601 spirit. A single hyphen should not be used for it, but double hyphens could be an option \n\nBased on section 3.3.4 and 4.4.2 of [this document](https://web.archive.org/web/20171020084445/https://www.loc.gov/standards/datetime/ISO_DIS%208601-1.pdf)\nbtw. this is not the final version, but the final is paid...","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1659549124,"metadata":{"github-id":"IC_kwDODBZtRc5Hx_-y","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1204289458"},"message":"Allowing `\u003cduration\u003e/\u003cduration\u003e` would be an improvement. It's not official ISO 8601 but I agree it is in the spirit. However, even with this improvement there are still three additional use-cases we would not cover:\n1. In some species, e.g. with *C. Elegens*, the actual time since birth is not that important, since the organism ages differently depending on environment. In this case, it might be better to indicate what stage the animal is in rather than the actual age in time.\n2. Studies of embryonic development study neural tissue from organisms that have not been born yet. How would be indicate age here? This is one of those cases where age is obviously essential to the study, so we should make sure to capture it.\n3. Age of a human is considered HIPPA-protected if it is over 89 and should be reported as \"90 or older\".\n\nIt really does not make sense for us to enforce that age must follow a formal system if that formal system does not handle these three use-cases. Doing so will cause a lot of frustration for many of our users and for me as I try to help them.\n\nHere is a way we could change the NWB schema that could cover all of the use-cases:\n\n- age (str)\n  - lower_bound (str, optional)\n  - upper_bound (str, optional)\n  - reference (str, optional)\n\nDANDI would check if `age` is valid ISO 8601 duration. If not, it would check for upper and lower bounds, both of which, if supplied, must be ISO 8601 duration. `age.reference` is by default assumed to be \"birth\" but can be set to \"fertilization.\" Other terms may be added for age.reference for studying species with different types of reproductive patterns as these cases are brought to our attention. \n\nHere are some examples of how the system would be used:\n\nA human over 90 would be:\n\n- age: \"90 or older\"\n  - lower_bound: \"P90Y\"\n\nAn embryo of 2 months would be:\n\n- age: \"P2M\"\n  - reference: \"fertilization\"\n\nThe fly use-case that started this thread would be:\n\n- age: \"24 to 48 hrs\"\n  - lower_bound: \"P1D\"\n  - upper_bound: \"P2D\"\n\nAn alternative approach here could be the `\u003cduration\u003e/\u003cduration\u003e` format:\n\n- age: \"P1D/P2D\"\n\nA *C. Elegens* might be:\n\n- age: \"L3\"\n  - lower_bound: \"P1D\"\n  - upper_bound: \"P5D\"\n\n\nThe question then is what do we allow vs. not? In the human case, you would be missing an upper bound. Is that acceptable? Would be require *C. Elegens* to include a lower and upper bound?","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1659561796,"metadata":{"github-id":"IC_kwDODBZtRc5Hyy-d","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1204498333"},"message":"@satra to answer your question about the nwb inspector, we do have a check for this. It raises the message:\n\n\u003e 2.7  check_subject_age - 'Subject' object at location '/general/subject'\n       Message: Subject age, '24-48 Hrs', does not follow ISO 8601 duration format, e.g. 'P2Y' for 2 years or 'P23W' for 23 weeks.\n       \nHowever this is listed as a Best Practice Suggestion and we had planned to promote it to Critical for the DANDI but I don't think. I have created a draft PR for that [here](https://github.com/NeurodataWithoutBorders/nwbinspector/pull/247) but again, I don't think we should make strict requirements like this until we really consider the different use-cases of our users.","files":null},{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1659561834,"metadata":{"github-id":"UCE_lALODBZtRc5Hyy-dziXTK8I"},"target":"e38fa88f8aadfe7b1e8bb66cea94fabb496388204222965b5fcc07836b8821f2","message":"@satra to answer your question about the nwb inspector, we do have a check for this. It raises the message:\n\n\u003e 2.7  check_subject_age - 'Subject' object at location '/general/subject'\n       Message: Subject age, '24-48 Hrs', does not follow ISO 8601 duration format, e.g. 'P2Y' for 2 years or 'P23W' for 23 weeks.\n       \nHowever this is listed as a Best Practice Suggestion. I have created a draft PR to promote these checks to Critical [here](https://github.com/NeurodataWithoutBorders/nwbinspector/pull/247) but again, I don't think we should make strict requirements like this until we really consider the different use-cases of our users.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1659566321,"metadata":{"github-id":"IC_kwDODBZtRc5HzAe9","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1204553661"},"message":"i like changing the age structure. it would be nice if NWB changed age, genotype, and others to match dandi for example, but if we keep str we can structure it as \n\n`\u003cduration\u003e/reference` would be the default for precise age\n`\u003cduration\u003e~/reference` (the `~` is an ISO8601 extension for approximate)\n`\u003cduration\u003e/\u003cduration\u003e/reference` the first / would be required to indicate bounds and therefore two //s would be required when reference is provided. to avoid this, we could consider a different symbol for the reference separator, but it cannot be anything in the iso standard.\n\nwhere reference is in [\"Birth\", \"Gestation\", ??\"Culture\"] what is the age of an organoid?\nwhen reference is not provided, birth is assumed, and the inspector could say so in it's report.\n\ni would say for age range, either side could be optional to indicate, younger than or older than.\n\nregarding reference, currently dandi uses `BirthReference` or `GestationalReference`.\n\n\u003e I don't think we should make strict requirements like this until we really consider the different use-cases of our users.\n\nuse-cases are going to evolve, but making something capture current use-cases is a sufficient approach for strictness. we can adjust as new use cases come up instead of trying to be exhaustive. that's what versioning a schema gives us.","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1659567642,"metadata":{"github-id":"IC_kwDODBZtRc5HzDRr","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1204565099"},"message":"Instead of using lower bound, upper bound we can use a syntax with `../upper_bound`, `lower_bound/..` as suggested by ISO in [the extension](https://web.archive.org/web/20171020085148/https://www.loc.gov/standards/datetime/ISO_DIS%208601-2.pdf), see part 4.4.\n\nHowever there is a question what are the form we accept from the user. Previously was making some effort to guess what a user had in mind when using free text (e.g. `2 weeks 1day`), but when we want to cover more examples, the guessing will be harder if not impossible and we might need to enforce ISO8601-dandi syntax. What might be a good thing.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1659567844,"metadata":{"github-id":"IC_kwDODBZtRc5HzDuD","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1204566915"},"message":"\u003e However there is a question what are the form we accept from the user. \n\ni believe the plan here is not to interpret, so as of some version of our schema, we would not allow any age metadata interpretation, beyond what we are discussing here. so no free text. that would always generate critical dandi-related warnings, hopefully at the inspector level.","files":null},{"type":3,"author":{"id":"bc8a3197725c0467cd24911ff10ce52a2905729e"},"timestamp":1659984876,"metadata":{"github-id":"IC_kwDODBZtRc5ICBQ1","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1208489013"},"message":"should I start changing the function? some previous dandisets will fail if we enforce  ISO8601 and remove my \"guessing\" part","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1659989050,"metadata":{"github-id":"IC_kwDODBZtRc5ICRfQ","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1208555472"},"message":"i think we should start a PR, but let's not remove the guessing part yet. let's first implement range support and tests based on this discussion.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1660841713,"metadata":{"github-id":"CE_lADODBZtRc5PDktNzwAAAAGuG8B9"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1660845056,"metadata":{"github-id":"IC_kwDODBZtRc5ItDXX","github-url":"https://github.com/dandi/dandi-cli/issues/1090#issuecomment-1219769815"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.46.1`](https://github.com/dandi/dandi-cli/releases/tag/0.46.1) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1660845056,"metadata":{"github-id":"LE_lADODBZtRc5PDktNzwAAAAGuILv0"},"added":["released"],"removed":[]}]}