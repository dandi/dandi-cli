{"version":2,"ops":[{"type":6,"author":{"id":"f3856669ae05db18871381e4a2bf44e84858d017"},"timestamp":1701159450,"metadata":{"github-id":"UCE_lAHODBZtRc54CYPhzk8XClY"},"target":"70767de9e360c752e35beeeb7bc1dd6decf90a182be768d818e259040be45662","message":"tell me when you're getting sick of me \u003c3\n\nDownloads happen by [iterating](https://github.com/dandi/dandi-cli/blob/0971d02a0725d5e22c76e1bf32c45ca32e666c92/dandi/download.py#L685) over some `downloader` object, wrapped in some number of [`attempt`](https://github.com/dandi/dandi-cli/blob/0971d02a0725d5e22c76e1bf32c45ca32e666c92/dandi/download.py#L669)s, catching [`HTTPErrors`](https://github.com/dandi/dandi-cli/blob/0971d02a0725d5e22c76e1bf32c45ca32e666c92/dandi/download.py#L706)\n\nThe core of the downloading logic for the default downloader is here, standard `requests` streaming:\n\nhttps://github.com/dandi/dandi-cli/blob/0971d02a0725d5e22c76e1bf32c45ca32e666c92/dandi/dandiapi.py#L1473-L1480\n\nThe zarr downloader is I think identical in this block?\n\nhttps://github.com/dandi/dandi-cli/blob/0971d02a0725d5e22c76e1bf32c45ca32e666c92/dandi/dandiapi.py#L1903-L1911\n\nA timeout is not used in either case, and the [`requests` docs](https://docs.python-requests.org/en/latest/user/quickstart/#timeouts) warn:\n\n\u003e Nearly all production code should use this parameter in nearly all requests. Failure to do so can cause your program to hang indefinitely\n\nand elaborates further on how timeouts are handled after the initial connection [here](https://docs.python-requests.org/en/latest/user/advanced/#timeouts)\n\nIf the connection is interrupted, the downloader hangs indefinitely even if the connection is re-established. \n\n## MWE\n\n- systems tested: MacOS and Debian 12\n- dandi version: `0.58.0`\n\nTo replicate:\n- Start downloading any dandiset with the `dandi download` command\n- Toggle WiFi off and on or disconnect and reconnect ethernet cable briefly.\n\n## Expected Behavior\n\nSince there is already retry logic around the download command, I think it would be straightforward to\n- set some timeout value in consts or read from env variable\n- pass timeout value to `session.get` call\n- catch `requests.exceptions.Timeout` in existing `requests.exceptions.HTTPError` block, which should already sleep for 5 seconds and retry.\n\nHappy to PR this very minimal change :)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1701196324,"metadata":{"github-id":"IC_kwDODBZtRc5tGnLg","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1830449888"},"message":"@yarikoptic What should the timeout be set to?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1701197550,"metadata":{"github-id":"IC_kwDODBZtRc5tGvTx","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1830483185"},"message":"what would be your judgement?  I think `60 sec` is good enough to say that connection is dead if no response.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1701198100,"metadata":{"github-id":"IC_kwDODBZtRc5tGyox","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1830496817"},"message":"@yarikoptic That seems high.  I was expecting something more like 5 or 10 seconds, but I'm having difficulty finding any resources on optimal timeout values.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1701198748,"metadata":{"github-id":"UCE_lALODBZtRc5tGyoxzjugQQo"},"target":"5eda73b9c8160923ccd8933c3a017a527655a8c4a0b6e31d64d33405c84c0138","message":"@yarikoptic That seems high.  I was expecting something more like 5 or 10 seconds, but I'm having difficulty finding any resources on optimal timeout values.\n\nEDIT: For the record, [httpx's default timeout is 5 seconds](https://www.python-httpx.org/quickstart/#timeouts).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1701200253,"metadata":{"github-id":"IC_kwDODBZtRc5tG_2y","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1830550962"},"message":"https://www.python-httpx.org/advanced/#fine-tuning-the-configuration gives an example of using 60 sec for connection time out... Ok, what about mid-ground of 30? ;)  here we are to prevent a complete \"hang\" - waiting for a minute or half of it is IMHO ok compromise.","files":null},{"type":3,"author":{"id":"f3856669ae05db18871381e4a2bf44e84858d017"},"timestamp":1701201554,"metadata":{"github-id":"IC_kwDODBZtRc5tHTBM","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1830629452"},"message":"`requests` has two timeouts :) one timeout for connections, and one timeout for read timeout (the amount of time to wait between bytes sent from the server after a connection is established).\n\nSo maybe a shorter connection timeout to raise on a nonresponsive server and a longer read timeout to let a connection heal?","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1701273062,"metadata":{"github-id":"CE_lADODBZtRc54CYPhzwAAAAKVgrwQ"},"status":2},{"type":3,"author":{"id":"f3856669ae05db18871381e4a2bf44e84858d017"},"timestamp":1701301061,"metadata":{"github-id":"IC_kwDODBZtRc5tP10r","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1832869163"},"message":"Thanks y'all !","files":null},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1702492260,"metadata":{"github-id":"IC_kwDODBZtRc5uiXX0","github-url":"https://github.com/dandi/dandi-cli/issues/1366#issuecomment-1854502388"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.58.2`](https://github.com/dandi/dandi-cli/releases/tag/0.58.2) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1702492262,"metadata":{"github-id":"LE_lADODBZtRc54CYPhzwAAAAKd6_v_"},"added":["released"],"removed":[]}]}