{"version":2,"ops":[{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1744317674,"metadata":{"github-id":"IC_kwDODBZtRc6mmhDh","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2795114721"},"message":"Thanks @calvinchai.  For now on the LINC project, please use the `--validation ignore` flag.","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1744318802,"metadata":{"github-id":"IC_kwDODBZtRc6mmrKz","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2795156147"},"message":"Migration guide to v3: https://zarr.readthedocs.io/en/stable/user-guide/v3_migration.html","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744319665,"metadata":{"github-id":"IC_kwDODBZtRc6mmxg6","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2795182138"},"message":"ATM it is (partially?) blocked also by\n- https://github.com/hdmf-dev/hdmf-zarr/issues/202\n\nIn principle we could potentially allow installation with Zarr v3 for cases without nwb in those dandisets..","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1744375293,"metadata":{"github-id":"IC_kwDODBZtRc6ms-VI","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2796807496"},"message":"@yarikoptic - one possibility in this case is to use tensorstore in the cli (which can read/write both v2 and v3 - and could be more efficient), and thus decouple it (for now) from hdmf-zarr.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744384730,"metadata":{"github-id":"IC_kwDODBZtRc6mug-K","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2797211530"},"message":"Looking at this particular case -- I think we would be just fine with whatever support zarr library 2. provides for opening zarr v3.  @candleindark let's address this by\n\n- figuring out what would be an alternative to `if isinstance(data, zarr.Group) and not data` validation test for having some data for v3\n- actually start using `get_zarr_format_version` function (apparently unused)\n  - need to make sure that it works correctly on v3 zarrs!  From my quick try it still returned v2 on a sample\n  - it is trivial to produce v3 zarr even with 2.11.x library -- see https://zarr.readthedocs.io/en/v2.18.1/api/v3.html \n- make sure code works with both v2 and v3 zarr (add / improve tests to create/operate on v3 zarr) and both versions of zarr library","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744397794,"metadata":{"github-id":"IC_kwDODBZtRc6mwuOy","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2797790130"},"message":"A few notes here:\n\n1. To enable the Zarr V3 Specification in the zarr Python package at V2. The env var, `ZARR_V3_EXPERIMENTAL_API` must be set to `1`.\n\u003cdetails\u003e\n\n```shell\n➜  scratches pyenv shell dandi-cli\n(dandi-cli) ➜  scratches python scratch_2.py\nTraceback (most recent call last):\n  File \"/Users/isaac/Library/Application Support/JetBrains/PyCharm2024.3/scratches/scratch_2.py\", line 6, in \u003cmodule\u003e\n    z1 = zarr.open(\n         ^^^^^^^^^^\n  File \"/Users/isaac/.pyenv/versions/dandi-cli/lib/python3.11/site-packages/zarr/convenience.py\", line 123, in open\n    return open_array(_store, mode=mode, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/.pyenv/versions/dandi-cli/lib/python3.11/site-packages/zarr/creation.py\", line 685, in open_array\n    z = Array(\n        ^^^^^^\n  File \"/Users/isaac/.pyenv/versions/dandi-cli/lib/python3.11/site-packages/zarr/core.py\", line 134, in __init__\n    assert_zarr_v3_api_available()\n  File \"/Users/isaac/.pyenv/versions/dandi-cli/lib/python3.11/site-packages/zarr/_storage/store.py\", line 48, in assert_zarr_v3_api_available\n    raise NotImplementedError(\nNotImplementedError: # V3 reading and writing is experimental! To enable support, set:\nZARR_V3_EXPERIMENTAL_API=1\n```\n\u003c/details\u003e\n\n2. After the `ZARR_V3_EXPERIMENTAL_API` is set to `1`, the zarr Python package will still raise a warning.\n\u003cdetails\u003e\n```shell\n(dandi-cli) ➜  scratches python scratch_2.py\n/Users/isaac/.pyenv/versions/dandi-cli/lib/python3.11/site-packages/zarr/_storage/store.py:39: FutureWarning: The experimental Zarr V3 implementation in this version of Zarr-Python is not in alignment with the final V3 specification. This version will be removed in Zarr-Python 3 in favor of a spec compliant version.\n  warnings.warn(\n```\n\u003c/details\u003e\n\n3. The previous two points are related to the following warning in https://zarr.readthedocs.io/en/v2.18.1/api/v3.html.\n\n\u003e The experimental v3 implementation included in Zarr Python \u003e2.12,\u003c3 is not aligned with the final V3 specification. This version is deprecated and will be removed in Zarr Python 3.0 in favor of a spec compliant version.\n\n4. `get_zarr_format_version()` needs to be improved. It is not able to handle the Zarr V3 Specification as implemented by the Zarr Python v2 package.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744406215,"metadata":{"github-id":"IC_kwDODBZtRc6mxn2l","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2798026149"},"message":"Yep, I saw the info about env var. If we verify that it provides sufficient support for our minimal tasks, we can set it before importing zarr but after checking its version using packaging module or alike","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744410526,"metadata":{"github-id":"IC_kwDODBZtRc6mx9K4","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2798113464"},"message":"I found a few issues with using the zarr Python package at V2 for the Zarr V3 Specification. One among them, in my opinion, disallows us from using it to read Zarr objects/files that are of the Zarr V3 Specification. It is the fact that the zarr Python package at V2 is actually incompatible with the final Zarr V3 specification.\n\nConsider the following files and commands.\n\n\u003cdetails\u003e\n\u003csummary\u003ecreate.py\u003c/summary\u003e\n\n```py\n# To be used for creating a Zarr object with Zarr V3 Specification using the\n# zarr Python package at version 3 or later\n\nimport zarr\nimport numpy as np\n\nz1 = zarr.create_array(\n    store=\"data/example-1.zarr\",\n    shape=(10000, 10000),\n    chunks=(1000, 1000),\n    dtype=\"int32\",\n)\n\n\nz1[:] = 42\nz1[0, :] = np.arange(10000)\nz1[:, 0] = np.arange(10000)\n\nz2 = zarr.open(\"data/example-1.zarr\", mode=\"r\")\nprint(z2.info)\n\n\n# Can be invoked with the following command:\n# python3.11 -m venv .venv \u0026\u0026 source .venv/bin/activate \u0026\u0026 pip install zarr~=3.0 \u0026\u0026 python -c \"import zarr;print(f'zarr version: {zarr.__version__}')\" \u0026\u0026 python3.11 create.py; deactivate; rm -rf .venv\n```\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003eread.py\u003c/summary\u003e\n\n```py\n# To be used for reading a Zarr object with Zarr V3 Specification using the\n# zarr Python package at before version 3\n\nimport zarr\n\nz1 = zarr.open(\"data/example-1.zarr\", mode=\"r\", zarr_version=3)\n\n# Can be invoked with the following command:\n# python3.11 -m venv .venv \u0026\u0026 source .venv/bin/activate \u0026\u0026 pip install \"zarr\u003c3.0\" \u0026\u0026 python -c \"import zarr;print(f'zarr version: {zarr.__version__}')\" \u0026\u0026 python3.11 read.py; deactivate; rm -rf .venv\n```\n\u003c/details\u003e\n\n\nRun the following to write a Zarr object in the final Zarr V3 Specification to the file system using the zarr Python package at V3.\n```shell\npython3.11 -m venv .venv \u0026\u0026 source .venv/bin/activate \u0026\u0026 pip install zarr~=3.0 \u0026\u0026 python -c \"import zarr;print(f'zarr version: {zarr.__version__}')\" \u0026\u0026 python3.11 create.py; deactivate; rm -rf .venv\n```\n\nRun the following to read the written Zarr object using the zarr Python package at V2, and  an error will result due to incompatiblity.\n```shell\npython3.11 -m venv .venv \u0026\u0026 source .venv/bin/activate \u0026\u0026 pip install \"zarr\u003c3.0\" \u0026\u0026 python -c \"import zarr;print(f'zarr version: {zarr.__version__}')\" \u0026\u0026 python3.11 read.py; deactivate; rm -rf .venv\n```\n\nPlease note that I used `python3.11` because the zarr Python package at V3 requires Python at 3.11 or above.\n\nThis result is in agreement with the observation that zarr objects written by the zarr Python package at V2 with the experimental Zarr V3 Specification enabled look very different than those written by the zarr Python package at V3.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744412355,"metadata":{"github-id":"IC_kwDODBZtRc6myEx3","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2798144631"},"message":"We should just generate minimal Zarr v3 with v3 library and commit it to reuse in tests. What error did you encounter, can't run code ATM?","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744417870,"metadata":{"github-id":"IC_kwDODBZtRc6mygeV","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2798258069"},"message":"The error resulted from running\n\n```py\npython3.11 -m venv .venv \u0026\u0026 source .venv/bin/activate \u0026\u0026 pip install \"zarr\u003c3.0\" \u0026\u0026 python -c \"import zarr;print(f'zarr version: {zarr.__version__}')\" \u0026\u0026 python3.11 read.py; deactivate; rm -rf .venv\n```\n\nis \n\n```shell\nTraceback (most recent call last):\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/read.py\", line 6, in \u003cmodule\u003e\n    z1 = zarr.open(\"data/example-1.zarr\", mode=\"r\", zarr_version=3)\n         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/.venv/lib/python3.11/site-packages/zarr/convenience.py\", line 134, in open\n    if contains_array(_store, path):\n       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/.venv/lib/python3.11/site-packages/zarr/storage.py\", line 120, in contains_array\n    key = _prefix_to_array_key(store, prefix)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/.venv/lib/python3.11/site-packages/zarr/_storage/store.py\", line 683, in _prefix_to_array_key\n    sfx = _get_metadata_suffix(store)  # type: ignore\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/.venv/lib/python3.11/site-packages/zarr/_storage/store.py\", line 592, in _get_metadata_suffix\n    return _get_hierarchy_metadata(store)[\"metadata_key_suffix\"]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/.venv/lib/python3.11/site-packages/zarr/_storage/store.py\", line 587, in _get_hierarchy_metadata\n    return store._metadata_class.decode_hierarchy_metadata(store[\"zarr.json\"])\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/isaac/Developer/Dartmouth/workshop/zarr/.venv/lib/python3.11/site-packages/zarr/meta.py\", line 393, in decode_hierarchy_metadata\n    raise ValueError(f\"Unexpected keys in metadata. meta={meta}\")\nValueError: Unexpected keys in metadata. meta={'shape': [10000, 10000], 'data_type': 'int32', 'chunk_grid': {'name': 'regular', 'configuration': {'chunk_shape': [1000, 1000]}}, 'chunk_key_encoding': {'name': 'default', 'configuration': {'separator': '/'}}, 'fill_value': 0, 'codecs': [{'name': 'bytes', 'configuration': {'endian': 'little'}}, {'name': 'zstd', 'configuration': {'level': 0, 'checksum': False}}], 'attributes': {}, 'zarr_format': 3, 'node_type': 'array', 'storage_transformers': []}\n```\n\nI think it is due to the difference in expectation of data in `zarr.json`","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744582064,"metadata":{"github-id":"IC_kwDODBZtRc6m5trg","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2800147168"},"message":"@candleindark please file an issue against [zarr](https://github.com/zarr-developers/zarr-python/issues) with hope to address that in the 2.x series of the library -- they seems to still release bugfixes there (which is good and responsible approach). Upon a [quick search](https://github.com/search?q=repo%3Azarr-developers%2Fzarr-python+open+zarr+v3\u0026type=issues\u0026p=4) dealing with opening zarr v3 in v2 -- would be good to know if that is anyhow supported or not.  If not supported -- there should be a NotImplementedError or alike to inform user.","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744604449,"metadata":{"github-id":"IC_kwDODBZtRc6m60Kq","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2800435882"},"message":"@yarikoptic Filed https://github.com/zarr-developers/zarr-python/issues/2981 regarding support of Zarr V3 Specification in zarr-python 2.x and https://github.com/zarr-developers/zarr-python/issues/2982 related to experimental implementation of Zarr V3 Specification in zarr-python 2.x.","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744658236,"metadata":{"github-id":"IC_kwDODBZtRc6nDqxs","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2802756716"},"message":"Below are two points I gathered from https://github.com/zarr-developers/zarr-python/issues/2981 and https://github.com/zarr-developers/zarr-python/issues/2982.\n\n1. zarr-python 2.x doesn't support the real/final Zarr V3 Specification. The experimental version of Zarr V3 Specification in zarr-python 2.x is really a version of its own. To support both Zarr V2 Specification and the real Zarr V3 Specification, we need to upgrade to zarr-python 3.x. (See https://github.com/zarr-developers/zarr-python/issues/2982#issuecomment-2802631933 for details)\n2. To upgrade to zarr-python 3.x, we will need to drop support for Python 3.9 and 3.10 in dandi-cli. (See https://github.com/zarr-developers/zarr-python/issues/2981#issuecomment-2802655877 for details)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744659052,"metadata":{"github-id":"IC_kwDODBZtRc6nDzf6","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2802792442"},"message":"thanks for the analysis @candleindark . Could you please also have a look at the https://pypi.org/project/tensorstore/ - could we provide similar basic validation with it and also get the version of the zarr, across v2 and v3 zarr formats?  if yes, may be for now we should indeed listen to wise @satra and just switch to using it instead for our purposes here thus avoiding the vicious circle with python versions and hdmf-zarr absent support for zarr v3?","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744660040,"metadata":{"github-id":"IC_kwDODBZtRc6nD7xz","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2802826355"},"message":"@yarikoptic If that's the case, I will postpone https://github.com/dandi/dandi-cli/issues/1610 for now since it may no longer be relevant or its implementation will depend on tensorstore if it is selected to be used.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744662920,"metadata":{"github-id":"IC_kwDODBZtRc6nETn3","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2802924023"},"message":"makes sense, or in other words -- while solving this you would solve #1610 as well since it is one of the features we need -- to extract zarr file format version.","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744664356,"metadata":{"github-id":"IC_kwDODBZtRc6nEfhr","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2802972779"},"message":"One quick note regarding Python support in TensorStore.\n\nTensorStore has dropped support for Python 3.9, which dandi-cli currently supports. The removal of support for Python 3.9 starts at TensorStore 0.1.71 (three releases up to this point). This drop of support is also documented at https://google.github.io/tensorstore/installation.html.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744666256,"metadata":{"github-id":"IC_kwDODBZtRc6nE39m","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2803072870"},"message":"Good to know. If that version supports Zarr v3, we are good. If not, we can write out when validating v3 zarrs with older version","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744667222,"metadata":{"github-id":"IC_kwDODBZtRc6nE_Bz","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2803101811"},"message":"\u003e Good to know. If that version supports Zarr v3, we are good. If not, we can write out when validating v3 zarrs with older version\n\nDo you mean to pin tensorstore to [0.1.69](https://pypi.org/project/tensorstore/0.1.69/#files), the latest version that supports Python 3.9, and see if it supports Zarr format V3?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744677950,"metadata":{"github-id":"IC_kwDODBZtRc6nGQth","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2803436385"},"message":"not to pin but to try that version and see if supports.  AFAIK we do not need to pin -- just that with python 3.9 that is I guess the version which would get installed.\n\n\u003cdetails\u003e\n\u003csummary\u003eand indeed it does\u003c/summary\u003e \n\n```shell\n❯ mamba activate py3.9\n❯ python --version\nPython 3.9.0\n❯ pip install tensorstore\nCollecting tensorstore\n  Downloading tensorstore-0.1.69-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (3.0 kB)\nCollecting numpy\u003e=1.22.0 (from tensorstore)\n  Downloading numpy-2.0.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (60 kB)\nCollecting ml-dtypes\u003e=0.3.1 (from tensorstore)\n  Downloading ml_dtypes-0.5.1-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (21 kB)\nDownloading tensorstore-0.1.69-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (17.5 MB)\n   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 17.5/17.5 MB 24.6 MB/s eta 0:00:00\nDownloading ml_dtypes-0.5.1-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.7 MB)\n   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.7/4.7 MB 36.2 MB/s eta 0:00:00\nDownloading numpy-2.0.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (19.5 MB)\n   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 19.5/19.5 MB 39.3 MB/s eta 0:00:00\nInstalling collected packages: numpy, ml-dtypes, tensorstore\nSuccessfully installed ml-dtypes-0.5.1 numpy-2.0.2 tensorstore-0.1.69\n\n```\n\u003c/details\u003e\n\nwith that in mind, can you just implement basic validation as we have now with zarr library @candleindark ?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1744679117,"metadata":{"github-id":"IC_kwDODBZtRc6nGWK3","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2803458743"},"message":"just fyi for numpy:\n\n```\nOn Apr 05, 2024 drop support for Python 3.9 (initially released on Oct 05, 2020)\nOn Jun 22, 2024 drop support for NumPy 1.23 (initially released on Jun 22, 2022)\nOn Dec 18, 2024 drop support for NumPy 1.24 (initially released on Dec 18, 2022)\nOn Apr 04, 2025 drop support for Python 3.10 (initially released on Oct 04, 2021)\n```","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744740848,"metadata":{"github-id":"IC_kwDODBZtRc6nUKce","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2807080734"},"message":"\u003e with that in mind, can you just implement basic validation as we have now with zarr library [@candleindark](https://github.com/candleindark) ?\n\nIt is confirmed that tensorstore can open both Zarr format V2 and V3 array objects in Python 3.9 and above.\n\nTwo caveats:\n\n1. tensorstore can determine which Zarr format, V2 or V3, to open an object with. We have to make that determination.\n2. tensorstore doesn't have the concept of groups that exists in Zarr. However, when we are given a directory that is a group, we can do validation of it by making sure all contained arrays validates.","files":null},{"type":6,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744760659,"metadata":{"github-id":"UCE_lALODBZtRc6nUKcezmOWeAQ"},"target":"679025db47a2ff0b0a9e8d3f604a026907b62261aba8c3da9ce3570f6c12d122","message":"\u003e with that in mind, can you just implement basic validation as we have now with zarr library [@candleindark](https://github.com/candleindark) ?\n\nIt is confirmed that tensorstore can open both Zarr format V2 and V3 array objects in Python 3.9 and above.\n\nTwo caveats:\n\n1. tensorstore ~~can~~ can NOT determine which Zarr format, V2 or V3, to open an object with. We have to make that determination.\n2. tensorstore doesn't have the concept of groups that exists in Zarr. However, when we are given a directory that is a group, we can do validation of it by making sure all contained arrays validates.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744753935,"metadata":{"github-id":"IC_kwDODBZtRc6nWL8f","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2807611167"},"message":"so it seems there is no ideal!  I feel that in the long run we ideally stick with `zarr` library.  For now we could add a WARNING whenever zarr library raises exception, and then try to validate using tensorstore, potentially sequentially trying different backends (v2 and v3) to ensure we do not need to code in any zarr comprehension logic.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1745434478,"metadata":{"github-id":"CE_lADODBZtRc6yBHc6zwAAAAQLvKxT"},"status":2},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1745434510,"metadata":{"github-id":"IC_kwDODBZtRc6oZYcu","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2825226030"},"message":"we just merged #1614 which should trigger release where we do have basic support for validating zarr v3.  Please test it out.","files":null},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1745434522,"metadata":{"github-id":"IC_kwDODBZtRc6oZYuE","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2825227140"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.68.0`](https://github.com/dandi/dandi-cli/releases/tag/0.68.0) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1745434523,"metadata":{"github-id":"LE_lADODBZtRc6yBHc6zwAAAAQLvNhK"},"added":["released"],"removed":[]},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1745447034,"metadata":{"github-id":"IC_kwDODBZtRc6oa5S5","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2825622713"},"message":"Hi @calvinchai, when you have a chance, can you please upload a Zarr v3 with the latest DANDI Client version and see if it works?","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1745503576,"metadata":{"github-id":"IC_kwDODBZtRc6ojCEw","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2827755824"},"message":"Sure. I will let you know. The workstation at building 75 is occupied at this moment but I will created a new one locally.","files":null},{"type":3,"author":{"id":"5b791aa6b01c2b9dfe9f033b09866230d6b477b7"},"timestamp":1745504746,"metadata":{"github-id":"IC_kwDODBZtRc6ojY16","github-url":"https://github.com/dandi/dandi-cli/issues/1609#issuecomment-2827849082"},"message":"It works perfectly now!","files":null}]}