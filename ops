{"version":2,"ops":[{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619552398,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2NTI4MTE1NTQ="},"added":["bug"],"removed":[]},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1619556101,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyNzkxNTc1Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-827915753"},"message":"do you want to support paths at `dandiarchive.org`? we should perhaps consider.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619559621,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyNzk0OTIzMw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-827949233"},"message":"\u003e do you want to support paths at `dandiarchive.org`? we should perhaps consider.\n\n\u003cdetails\u003e\n\u003csummary\u003ewell, we already do, but apparently not for all types of URIs\u003c/summary\u003e \n\n```shell\n$\u003e dandi ls -r 'https://gui.dandiarchive.org/#/dandiset/000027/draft/files?location=sub-RAT123%2F'\n- asset_count: 1\n  created: '2020-07-08T21:54:42.543000Z'\n  metadata:\n    access:\n    - status: dandi:Open\n    contributor:\n    - identifier: 0000-0003-3456-2493\n      includeInCitation: true\n      name: Last, First\n      roleName:\n      - dandi:Author\n      schemaKey: Person\n    description: 'Should be ignored by regular mortals.\n\n\n      ATM contains only a few files from http://github.com/dandi-datasets/nwb_test_data\n      which more or less appropriate (do not lack critical metadata) for testing'\n    id: DANDI:000027/draft\n    identifier: DANDI:000027\n    keywords:\n    - development\n    name: Test dataset for testing dandi-cli.\n    repository: https://dandiarchive.org/\n    schemaVersion: 0.3.0\n  modified: '2020-08-31T21:41:16.957000Z'\n  name: Test dataset for testing dandi-cli.\n  path: '000027'\n  size: 18792\n  version: draft\n- asset_id: ff453f4c-a435-4a5d-a48b-128abca5ec47\n  created: '2021-04-21T09:38:11.327899Z'\n  modified: '2021-04-21T09:38:11.327928Z'\n  path: sub-RAT123/sub-RAT123.nwb\n  size: 18792\n```\n\u003c/details\u003e","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1619559850,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyNzk1MTA1Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-827951053"},"message":"i meant at the redirector level.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619561003,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyNzk2NjEyMw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-827966123"},"message":"ah, sure, why not ... but would be useless somewhat until either gui adopts them (no `#`) or dandiarchive.org becomes a reverse proxy on top of `gui.` ;-)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1619620120,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyODUwMjA5Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-828502097"},"message":"@yarikoptic This is because a path without a trailing slash is treated as an exact path to an asset, and there is no `sub-I46` asset in 000026.  If you invoke the command as `dandi ls -F path -r \"dandi://dandi/000026/sub-I46/\"` (with trailing slash), you get all of the assets beneath the `sub-I46/` folder.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619635627,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyODY5NTIxNw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-828695217"},"message":"since, unlike girder etc, we do not have a notion of a \"directory\" -- let's add logic that if `location` is specified, but no assets returned and does not end with `/` -- try the one with `/`.\n\nedited/changed original additional note: Also, whenever some location (path) is provided (but not just the trailing /, which should then include `dandiset.yaml` thus - dandiset meta) no dandiset record should be shown.  So if someone points to a directory - we show that directory assets only","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619635649,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50NDY1ODY1MDA3MA=="},"added":[],"removed":["bug"]},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619635649,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2NTg2NTAwNzI="},"added":["enhancement"],"removed":[]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1619703829,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyOTI0OTkwOQ==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-829249909"},"message":"@yarikoptic I'll implement this change as part of #554.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1619715122,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyOTQyNjk4Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-829426987"},"message":"@yarikoptic \n\n\u003e since, unlike girder etc, we do not have a notion of a \"directory\" -- let's add logic that if location is specified, but no assets returned and does not end with / -- try the one with /.\n\nThis would create issues when determining the path to download an asset to.  Currently, if `download` is given a URL with an asset path component of, say, `foo/bar/baz/`, then the `foo/bar/` is stripped off and the assets are placed in `baz/` in the output directory.  However, if the path is an item path without a trailing slash, it is used as-is, so `foo/bar/baz` gets downloaded to `foo/bar/baz` in the output directory.  The determination of whether to treat a URL as pointing to a single asset or not is based on how it's parsed, and there isn't really any room to indicate whether the asset-retrieval is falling back to treating an item path as a folder path.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619723159,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgyOTUxMzYzMQ==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-829513631"},"message":"well, to not introduce such \"heterogeneity\" ATM let's then do the query with `/` and if returns any asset just crash with e.g.\n```\nValueError(f\"Provided {url} points to a path} which is a directory but lacks trailing /\")\n```\nMy reasoning is: we must not just silently do nothing about the path whenever URL has it: it should be either some analog of `FileNotFoundError` or `ValueError`.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619723178,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDU2MzUxMDQ0"},"target":"e2b683ef14b54d9506c2b313cc8e827b1eeaad76ccb6c8fc149f6b373961bdcf","message":"well, to not introduce such \"heterogeneity\" ATM let's then do the query with `/` and if returns any asset just crash with e.g.\n```\nValueError(f\"Provided {url} points to a path} which is a directory but lacks trailing /\")\n```\nMy reasoning is: we must not just silently do nothing about the path whenever URL has it: it should be either some analog of `FileNotFoundError` (whenever there is indeed no assets under that path) or `ValueError`.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619788609,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMDA4NzgxNg==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-830087816"},"message":"probably related:  does not list assets if no path is provided but `-r` given\n\n\u003cdetails\u003e\n\u003csummary\u003e`$\u003e dandi ls -f json_pp -r dandi://dandi/000027/draft/`\u003c/summary\u003e \n\n```shell\n{\n  \"asset_count\": 1,\n  \"created\": \"2020-07-08T21:54:42.543000Z\",\n  \"metadata\": {\n    \"access\": [\n      {\n        \"status\": \"dandi:Open\"\n      }\n    ],\n    \"contributor\": [\n      {\n        \"identifier\": \"0000-0003-3456-2493\",\n        \"includeInCitation\": true,\n        \"name\": \"Last, First\",\n        \"roleName\": [\n          \"dandi:Author\"\n        ],\n        \"schemaKey\": \"Person\"\n      }\n    ],\n    \"description\": \"Should be ignored by regular mortals.\\n\\nATM contains only a few files from http://github.com/dandi-datasets/nwb_test_data which more or less appropriate (do not lack critical metadata) for testing\",\n    \"id\": \"DANDI:000027/draft\",\n    \"identifier\": \"DANDI:000027\",\n    \"keywords\": [\n      \"development\"\n    ],\n    \"name\": \"Test dataset for testing dandi-cli.\",\n    \"repository\": \"https://dandiarchive.org/\",\n    \"schemaVersion\": \"0.3.0\"\n  },\n  \"modified\": \"2020-08-31T21:41:16.957000Z\",\n  \"name\": \"Test dataset for testing dandi-cli.\",\n  \"path\": \"000027\",\n  \"size\": 18792,\n  \"version\": \"draft\"\n}\n\n```\n\u003c/details\u003e","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1619788754,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMDA4OTIxMg==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-830089212"},"message":"@yarikoptic Is that on the master branch or #605?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619789228,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMDA5Mzk4Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-830093983"},"message":"master as of 0.14.2-33-g914a9cf","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1619789471,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMDA5NjM5OA==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-830096398"},"message":"@yarikoptic And your desired behavior is that the Dandiset is listed if \u0026 only if there is no path in the URL and `-r` is not given, and otherwise (if there is a path *or* `-r` is given) the assets (and only the assets) are listed?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619797370,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMDE4NDM3MA==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-830184370"},"message":"yes.  \nNote - if `-r` and path points to the top (i.e. empty or just just trailing `/` in dandi://dandi/000027/draft/) - we should list dandiset metadata as well, since it is what we would provide locally for/from `dandiset.yaml`.   if there is a path which limits to some directory -- then indeed no dandiset metadata","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1619798436,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMDE5NTQzMg==","github-url":"https://github.com/dandi/dandi-cli/issues/598#issuecomment-830195432"},"message":"@yarikoptic #605 updated.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1619817926,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDY3MjA5MTEzMg=="},"status":2}]}