{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1681937381,"metadata":{"github-id":"UCE_lAHODBZtRc5j38R0zkCziVY"},"target":"064d04bfc775cb43220c1f572ac15f378d4b417df4b44a1fc81ff76c608ff554","message":"In our today's meeting attended by @waxlamp @bendichter @asmacdo and @weiglszonja we decided that https://github.com/dandi/dandi-archive/issues/1423 would be approached by first implementing needed logic in dandi-cli, at large reusing prototypes coded up in https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1373745996 and https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1408669132 .\n\nIn this issue we would **not** work to address https://github.com/dandi/dandi-archive/issues/772 , as to enhance authors' metadata with records from ORCID. For that we might later craft a dedicated `update-dandiset-contributors-from-orcid` or alike to be either chained or integrated with in `update-dandiset-from-doi`.\n\nI think we need \n\n```shell\ndandi service-scripts update-dandiset-from-doi -d|--dandiset DANDISET_ID[ --existing ask,overwrite,skip][ --fields contributor,name,description,relatedResource]  DOI\n```\n\n- decided to keep `-d|--dandiset DANDISET_ID` and option (not positional) so later if desired we could just pipe through stdin etc\n- `--existing` is to instruct on how to behave while intending to place a value where there is a **different** value already. If \"ask\" - show existing value, offer a new one, ask it should be overwritten.  if \"overwrite\" -- just overwrite without interaction. if \"skip\" - skip\n- `--fields` -- by default go through all listed below, but if option is specified (comma separated values?) - consider only those\n\nThe command will\n- get metadata for DANDISET_ID\n- request citation record from DOI\n- based on information in DOI record\n  - add \"authors\" to the `contributor:` list\n    - while considering an author, check if there is already one which matches either by ORCID or if not present - name matches an already known contributor.  If so and not identical -- act based on `existing` value\n    - if corresponding author of the paper (if record provides that information) -- add with `dcite:ContactPerson` role,  for all - add as `dcite:Author`\n    - see e.g. https://github.com/dandisets/000402/blob/b5e4ab7e991e1f91476da31c722be276ec08c8f3/dandiset.yaml#L121 for a sample of such automatically added entries and what default fields to take\n  - use \"title\" for the \"name:\"\n  - use \"abstract\" for the \"description:\"\n  - add a record to `relatedResource:` list alike\n ```yaml\n- identifier: {DOI}\n  name: {title}\n  relation: dcite:IsDescribedBy\n  schemaKey: Resource\n  url: https://doi.org/{DOI}\n```\n   - first check if there is one among possibly present and identify based on \"identifier\", act based on `--existing` \n- if anything was actually changed in the metadata record\n  - add to `wasGeneratedBy:` a record like the one we are adding while extracting metadata for assets:\n\n```json\n        {\n          \"description\": \"Metadata ({','.join(modified_fields)}) was enhanced by DANDI cli from DOI {doi}\",\n          \"endDate\": \"{now}\",\n          \"id\": \"urn:uuid:{iirc random UUID}\",\n          \"name\": \"Metadata extraction from DOI\",\n          \"schemaKey\": \"Activity\",\n          \"startDate\": \"{when started doing the mess}\",\n          \"wasAssociatedWith\": [\n            {\n              \"identifier\": \"RRID:SCR_019009\",\n              \"name\": \"DANDI Command Line Interface\",\n              \"schemaKey\": \"Software\",\n              \"url\": \"https://github.com/dandi/dandi-cli\",\n              \"version\": \"{version}\"\n            }\n          ]\n        }\n ```\n    which would then allow us to figure out dandisets which used this functionality.\n   - ask to either show simple unified diff in rendering of the original and modified records\n   - ask to either update dandiset record with this modified record, and if yes - do so\n\n@bendichter @satra any other fields possibly to re-use or reference to from  dandiset?  Anything to add/remove from above?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682347953,"metadata":{"github-id":"UCE_lAHODBZtRc5j38R0zkDulsw"},"target":"064d04bfc775cb43220c1f572ac15f378d4b417df4b44a1fc81ff76c608ff554","message":"In our today's meeting attended by @waxlamp @bendichter @asmacdo and @weiglszonja we decided that https://github.com/dandi/dandi-archive/issues/1423 would be approached by first implementing needed logic in dandi-cli, at large reusing prototypes coded up in https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1373745996 and https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1408669132 .\n\nIn this issue we would **not** work to address https://github.com/dandi/dandi-archive/issues/772 , as to enhance authors' metadata with records from ORCID. For that we might later craft a dedicated `update-dandiset-contributors-from-orcid` or alike to be either chained or integrated with in `update-dandiset-from-doi`.\n\nI think we need \n\n```shell\ndandi service-scripts update-dandiset-from-doi -d|--dandiset DANDISET_ID[ --existing ask,overwrite,skip][ --fields contributor,name,description,relatedResource]  DOI\n```\n\n- decided to keep `-d|--dandiset DANDISET_ID` and option (not positional) so later if desired we could just pipe through stdin etc\n- `--existing` is to instruct on how to behave while intending to place a value where there is a **different** value already. If \"ask\" - show existing value, offer a new one, ask it should be overwritten.  if \"overwrite\" -- just overwrite without interaction. if \"skip\" - skip\n- `--fields` -- by default go through all listed below, but if option is specified (comma separated values?) - consider only those\n\nThe command will\n- get metadata for DANDISET_ID\n- request citation record from DOI\n- based on information in DOI record\n  - add \"authors\" to the `contributor:` list\n    - while considering an author, check if there is already one which matches either by ORCID or if not present - name matches an already known contributor.  If so and not identical -- act based on `existing` value\n    - ~~if corresponding author of the paper (if record provides that information) -- add with `dcite:ContactPerson` role,~~  for all - add as `dcite:Author`\n    - see e.g. https://github.com/dandisets/000402/blob/b5e4ab7e991e1f91476da31c722be276ec08c8f3/dandiset.yaml#L121 for a sample of such automatically added entries and what default fields to take\n  - use \"title\" for the \"name:\"\n  - use \"abstract\" for the \"description:\"\n  - add a record to `relatedResource:` list alike\n ```yaml\n- identifier: {DOI}\n  name: {title}\n  relation: dcite:IsDescribedBy\n  schemaKey: Resource\n  url: https://doi.org/{DOI}\n```\n   - first check if there is one among possibly present and identify based on \"identifier\", act based on `--existing` \n- if anything was actually changed in the metadata record\n  - add to `wasGeneratedBy:` a record like the one we are adding while extracting metadata for assets:\n\n```json\n        {\n          \"description\": \"Metadata ({','.join(modified_fields)}) was enhanced by DANDI cli from DOI {doi}\",\n          \"endDate\": \"{now}\",\n          \"id\": \"urn:uuid:{iirc random UUID}\",\n          \"name\": \"Metadata extraction from DOI\",\n          \"schemaKey\": \"Activity\",\n          \"startDate\": \"{when started doing the mess}\",\n          \"wasAssociatedWith\": [\n            {\n              \"identifier\": \"RRID:SCR_019009\",\n              \"name\": \"DANDI Command Line Interface\",\n              \"schemaKey\": \"Software\",\n              \"url\": \"https://github.com/dandi/dandi-cli\",\n              \"version\": \"{version}\"\n            }\n          ]\n        }\n ```\n    which would then allow us to figure out dandisets which used this functionality.\n   - ask to either show simple unified diff in rendering of the original and modified records\n   - ask to either update dandiset record with this modified record, and if yes - do so\n\n@bendichter @satra any other fields possibly to re-use or reference to from  dandiset?  Anything to add/remove from above?","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1681947477,"metadata":{"github-id":"IC_kwDODBZtRc5aVNqf","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1515510431"},"message":"@yarikoptic this looks great! I looked up the metadata for a few DOIs and this looks like the key metadata to extract.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682090194,"metadata":{"github-id":"IC_kwDODBZtRc5aeqgK","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1517987850"},"message":"@yarikoptic @dorota Where can I find documentation on the schema of the doi.org API's responses?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682092995,"metadata":{"github-id":"IC_kwDODBZtRc5ae3a7","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1518040763"},"message":"I think the ultimate source of knowledge we can dig up is https://citation.crosscite.org/docs.html . Unfortunately\n- link there to [Citeproc JSON](http://gsl-nagoya-u.net/http/pub/citeproc-doc.html) is 404 due to entire domain gone  -- I will file a ticket.  \n- googling lead me to https://citeproc-js.readthedocs.io/en/latest/csl-json/markup.html which lead to yet another 404 (https://github.com/citation-style-language/schema/blob/master/csl-types.rnc) (I need to add to my quest adding linkchecking like we have in bids, uff) which is probably now https://github.com/citation-style-language/schema/blob/master/schemas/styles/csl-types.rnc but that one is not the one anyways\n- https://github.com/citation-style-language/schema#csl-json-schema there lads to  https://github.com/citation-style-language/schema/blob/master/schemas/input/csl-data.json and https://github.com/citation-style-language/schema/blob/master/schemas/input/csl-citation.json which is I guess what you want?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682341867,"metadata":{"github-id":"IC_kwDODBZtRc5am2l7","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520134523"},"message":"@yarikoptic https://github.com/citation-style-language/schema/blob/master/schemas/input/csl-data.json doesn't indicate how corresponding authors are denoted.  How can I determine whether an author is a corresponding author?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682346345,"metadata":{"github-id":"IC_kwDODBZtRc5anXbM","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520269004"},"message":"hm, csl-data.json doesn't even describe `\"sequence\"` or `\"ORCID\"` or affiliation which I observe in sample output of https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1373745996 . So may be that is either incomplete or some other schema used? don't know yet","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682347926,"metadata":{"github-id":"IC_kwDODBZtRc5anmdQ","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520330576"},"message":"so far failed to find information about correspondence author anyways, so let's forget about that aspect.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682365781,"metadata":{"github-id":"IC_kwDODBZtRc5apJpg","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520736864"},"message":"@yarikoptic \n\n* To be clear, where should the service script get the DOI for a Dandiset from?  I assumed that this would be using the `\"doi\"` field found only in published Dandiset metadata, but that doesn't square with your comment [here](https://github.com/dandi/dandi-cli/pull/1283#issuecomment-1520599853).\n* How should authors with just a `\"name\"` field and no `\"family\"` or `\"given\"` field, like the below, be handled?  What about handling of other name-related fields?\n\n```json\n{\n  \"name\": \"The International Brain Laboratory\",\n  \"sequence\": \"first\",\n  \"affiliation\": []\n}\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682367402,"metadata":{"github-id":"IC_kwDODBZtRc5apSVI","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520772424"},"message":"\u003e * To be clear, where should the service script get the DOI for a Dandiset from?  I assumed that this would be using the `\"doi\"` field found only in published Dandiset metadata, but that doesn't square with your comment [here](https://github.com/dandi/dandi-cli/pull/1283#issuecomment-1520599853).\n\nIt is a positional CLI  argument as I listed it in original https://github.com/dandi/dandi-cli/issues/1280 (CLI spec is too long, so might need to horizontally scroll)\n\n\u003e * How should authors with just a `\"name\"` field and no `\"family\"` or `\"given\"` field, like the below, be handled? \n\nit would probably only those composite names, probably pointing to institutions etc. For now -- let's just skip with a WARNING. May be later we would add them somehow (not as authors though).\n\n\u003e  What about handling of other name-related fields?\n\n- `sequence` - I think we can just ignore\n- `affiliation` - so far I saw only empty ones, didn't check those sample DOIs though. did you see a non empty one?   we should add to `affiliation` list for that person\n\nwhat other fields do you have in mind? we seems do not have much more to enter in our dandischema for a `Person`","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682367728,"metadata":{"github-id":"IC_kwDODBZtRc5apTxg","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520778336"},"message":"@yarikoptic `csl-data.json` also lists \"dropping-particle\", \"non-dropping-particle\", \"suffix\", \"comma-suffix\", \"static-ordering\", \"literal\", and \"parse-names\".","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682367815,"metadata":{"github-id":"IC_kwDODBZtRc5apUKB","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520779905"},"message":"@yarikoptic \n\n\u003e let's just skip with a WARNING\n\nShould the warning include any information about the skipped author entry?  If so, what?  Should the message just show the `repr()` for the structure?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682369785,"metadata":{"github-id":"IC_kwDODBZtRc5apcYb","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1520813595"},"message":"\u003e \u003e let's just skip with a WARNING\n\u003e \n\u003e Should the warning include any information about the skipped author entry? If so, what? Should the message just show the `repr()` for the structure?\n\nif `repr` provides the `name` etc -- sure, could be that.\n\n\u003e @yarikoptic `csl-data.json` also lists \"dropping-particle\", \"non-dropping-particle\", \"suffix\", \"comma-suffix\", \"static-ordering\", \"literal\", and \"parse-names\".\n\nhard to say since none of those I have downloaded\n\n\u003cdetails\u003e\n\u003csummary\u003eusing this script\u003c/summary\u003e \n\n```shell\n#!/bin/bash\n\nd=doi-citations\nmkdir -p $d\n\nfor doi in 10.1101/2020.01.17.909838 10.1523/JNEUROSCI.6157-08.2009 10.1016/j.neuron.2019.10.012 10.7554/eLife.48198 10.1038/s41467-023-37704-5; do\n    out=\"$d/$(echo $doi | sed -e 's,/,--,g').json\"\n    curl --silent -L -d \"\" --header \"Accept: application/vnd.citationstyles.csl+json; charset=utf-8\" \"https://doi.org/$doi\" | jq . \u003e| \"$out\"\n    echo $out\ndone\n\n```\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003eseems to have no hits for any of those fields\u003c/summary\u003e \n\n```shell\n‚ùØ (for f in \"dropping-particle\" \"non-dropping-particle\" \"suffix\" \"comma-suffix\" \"static-ordering\" \"literal\" \"parse-names\"; do /bin/grep \"$f\" doi-citations/*; done; )\n... no output\n```\n\u003c/details\u003e\n\ncould you please add a WARNING stating that the `f\"A non-empty value {!r} for the field {} was not used for the {!r} co-author\"` or alike.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682430123,"metadata":{"github-id":"IC_kwDODBZtRc5atQbV","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1521813205"},"message":"@yarikoptic \n\n\u003e could you please add a WARNING stating that the `f\"A non-empty value {!r} for the field {} was not used for the {!r} co-author\"` or alike.\n\nWhat is the last `{!r}` supposed to be filled in with?  Replacing it with the entire author entry from the DOI data would mean that the field \u0026 value would appear twice in the log message, and this would get worse if there are multiple leftover fields.\n\n\u003e affiliation - so far I saw only empty ones, didn't check those sample DOIs though. did you see a non empty one? we should add to affiliation list for that person\n\nI have not seen a non-empty one.  Should the script just assume that the elements of `affiliation` in DOI data are strings and use them as the `name` field of an `Affiliation` object?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682433845,"metadata":{"github-id":"IC_kwDODBZtRc5atpaf","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1521915551"},"message":"\u003e \u003e could you please add a WARNING stating that the `f\"A non-empty value {!r} for the field {} was not used for the {!r} co-author\"` or alike.\n\u003e \n\u003e What is the last `{!r}` supposed to be filled in with? Replacing it with the entire author entry from the DOI data would mean that the field \u0026 value would appear twice in the log message, and this would get worse if there are multiple leftover fields.\n\nThe target our `Person` record which would have only the fields we added so there should be no duplication.\n\n\u003e \u003e affiliation - so far I saw only empty ones, didn't check those sample DOIs though. did you see a non empty one? we should add to affiliation list for that person\n\u003e \n\u003e I have not seen a non-empty one. Should the script just assume that the elements of `affiliation` in DOI data are strings and use them as the `name` field of an `Affiliation` object?\n\nI think so. Then either users can extend with `RORID` for those institutions or we might even become fancy and match some.  Looking at https://ror.org/ -- it is over 100k records, so we are unlikely to download/cache the full list... well -- separate issue/development some time and may be","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1684355286,"metadata":{"github-id":"CE_lADODBZtRc5j38R0zwAAAAIovX5M"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1684441560,"metadata":{"github-id":"IC_kwDODBZtRc5cmh9T","github-url":"https://github.com/dandi/dandi-cli/issues/1280#issuecomment-1553604435"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.55.0`](https://github.com/dandi/dandi-cli/releases/tag/0.55.0) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1684441561,"metadata":{"github-id":"LE_lADODBZtRc5j38R0zwAAAAIpV0hP"},"added":["released"],"removed":[]}]}