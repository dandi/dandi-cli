{"version":2,"ops":[{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617290415,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxMTk4MTA3MA==","github-url":"https://github.com/dandi/dandi-cli/issues/529#issuecomment-811981070"},"message":"`DANDI_API_KEY` is for the new archive.  To upload to \"official\" archive it should have been `DANDI_GIRDER_API_KEY` but that is AFAIK a \"hidden knowledge\" -- `dandi` should have just asked for the key, didn't it?  If it doesn't -- it is something for us to fix (please run as `DANDI_DEVEL=1 dandi -l debug upload --devel-debug` and shared output may be via email debian@onerussian.com if you spot any secrets - might help).  As a temporary test/workaround -- try to specify key in the `DANDI_GIRDER_API_KEY` env var","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617290620,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxMTk4MzI0OA==","github-url":"https://github.com/dandi/dandi-cli/issues/529#issuecomment-811983248"},"message":"As @satra's question pointed out -- it indeed used to be `DANDI_API_KEY` but since not widely advocated for use, it was renamed  to that `DANDI_GIRDER_API_KEY` in 0.11.0 to prepare for transition to the new server","files":null},{"type":3,"author":{"id":"b47d70447f48e9670debced52b0983080ea7199d"},"timestamp":1617305630,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxMjEyNTY5Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/529#issuecomment-812125693"},"message":"I tried also with `DANDI_GIRDER_API_KEY` but it's still not working. This time however I was asked for the API key and to create a keyring. But again not working. Here is the stack trace:\n\n```\nTraceback (most recent call last):\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/dandi/girder.py\", line 535, in lock_dandiset\n    resp = self.post(f\"dandi/{dandiset_identifier}/lock\")\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/girder_client/__init__.py\", line 478, in post\n    return self.sendRestRequest('POST', path, parameters, files=files,\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/girder_client/__init__.py\", line 463, in sendRestRequest\n    raise HttpError(\ngirder_client.HttpError: HTTP error 401: POST https://girder.dandiarchive.org/api/v1/dandi/000026/lock\nResponse text: {\"message\": \"You must be logged in.\", \"type\": \"access\"}\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/home/ubuntu/venv_dandi/bin/dandi\", line 8, in \u003cmodule\u003e\n    sys.exit(main())\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/click/core.py\", line 829, in __call__\n    return self.main(*args, **kwargs)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/click/core.py\", line 782, in main\n    rv = self.invoke(ctx)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/click/core.py\", line 1259, in invoke\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/click/core.py\", line 1066, in invoke\n    return ctx.invoke(self.callback, **ctx.params)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/click/core.py\", line 610, in invoke\n    return callback(*args, **kwargs)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/click/decorators.py\", line 33, in new_func\n    return f(get_current_context().obj, *args, **kwargs)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/dandi/cli/base.py\", line 109, in wrapper\n    return f(*args, **kwargs)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/dandi/cli/cmd_upload.py\", line 98, in upload\n    upload(\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/dandi/upload.py\", line 556, in upload\n    with out, client.lock_dandiset(dandiset.identifier):\n  File \"/usr/lib/python3.8/contextlib.py\", line 113, in __enter__\n    return next(self.gen)\n  File \"/home/ubuntu/venv_dandi/lib/python3.8/site-packages/dandi/girder.py\", line 539, in lock_dandiset\n    raise LockingError(\ndandi.exceptions.LockingError: Failed to lock dandiset 000026 due to: You must be logged in.\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617308546,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxMjE1MDQ4Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/529#issuecomment-812150487"},"message":"sorry for my short memory -- this is a lingering issue with repectfully old accounts on dandiarchive's girder server, which require regeneration of the key.  Here is the https://github.com/dandi/dandi-cli/issues/238#issuecomment-693478473 on how to regenerate the key (so you get \"Full scope\") and should be able to upload.  Please reopen if issue persists","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617308546,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDU0MzIyNDYxMg=="},"status":2},{"type":3,"author":{"id":"b47d70447f48e9670debced52b0983080ea7199d"},"timestamp":1617720248,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxNDE3ODgyMA==","github-url":"https://github.com/dandi/dandi-cli/issues/529#issuecomment-814178820"},"message":"Hi, thanks for your help. I can confirm that uploading now works using the newly generated API key. Thanks again!","files":null}]}