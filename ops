{"version":2,"ops":[{"type":3,"author":{"id":"a9e2633aeb6d7e2366a97d09712312c2442c6054"},"timestamp":1668458030,"metadata":{"github-id":"IC_kwDODBZtRc5Oa0qG","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1315654278"},"message":"How are you downloading assets? Through the browser, or through the [CLI](https://github.com/dandi/dandi-cli)?","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1668466403,"metadata":{"github-id":"IC_kwDODBZtRc5Oa0qM","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1315654284"},"message":"Downloading via the Python API on a Jupyter notebook.","files":null},{"type":3,"author":{"id":"a9e2633aeb6d7e2366a97d09712312c2442c6054"},"timestamp":1668533818,"metadata":{"github-id":"IC_kwDODBZtRc5Oa0qR","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1315654289"},"message":"Yeah that's the CLI, this is the repo for the API. I'll transfer this issue to that repo.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679945341,"metadata":{"github-id":"IC_kwDODBZtRc5YjrEG","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1485746438"},"message":"@rcpeene could you please give specific snippet of your Python code so we can see at which level of the API we might want to expose ability to add progress indicator.","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1679945451,"metadata":{"github-id":"IC_kwDODBZtRc5Yjrls","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1485748588"},"message":"In general, the code I use for downloading files looks like this\n```\nmy_dandiset = dandiapi.DandiAPIClient().get_dandiset(dandiset_id)\nfile = my_dandiset.get_asset_by_path(dandi_path)\nfile.download(local_path)\n```","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1679945616,"metadata":{"github-id":"UCE_lALODBZtRc5Yjrlszi8jL5E"},"target":"859d4eab2ce884bfd63ad2dd5b677a35003471cd00e42ffff470392899955bc1","message":"In general, the code I use for downloading files looks like this\n```python\nmy_dandiset = dandiapi.DandiAPIClient().get_dandiset(dandiset_id)\nfile = my_dandiset.get_asset_by_path(dandi_path)\nfile.download(local_path)\n```\nAlthough I'd imagine you might also be interested in adding loading bars to the other download methods as well.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679952625,"metadata":{"github-id":"IC_kwDODBZtRc5YkNau","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1485887150"},"message":"@jwodder -- how do you think we should enable users to get themselves the progress indication they want?  we could add, similar to how `girder` did, a callback which would make it possible to update a tqdm progress bar in the code, or we could of cause just add some `tqdm_progressbar: bool=False` but IMHO that would be too inflexible etc.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1680013066,"metadata":{"github-id":"IC_kwDODBZtRc5YoZEz","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1486983475"},"message":"@yarikoptic I think if users want progress displayed while downloading, they should use `dandi download` or the `download()` function instead of the low-level `BaseRemoteAsset.download()` method.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680016975,"metadata":{"github-id":"IC_kwDODBZtRc5Yo1jI","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1487100104"},"message":"those high level interfaces are too strict.  I think we should give possibility for progress reporting (if users want) at the lower levels as well.  The only question on how flexible/interfaced:  allowing for a callback on update might be the easiest.  If we give the callback the entire data block we could even allow for some desired processing they (or us?) might want","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1680025951,"metadata":{"github-id":"IC_kwDODBZtRc5Yp1Wn","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1487361447"},"message":"I didn't a loading bar with the default usage of the `dandi.download.download()` method, nor any explanation in the docs of how I might utilize a loading bar with this method. Additionally, I wasn't sure if embargoed data could be accessed with this method; I didn't see a description of how to provide credentials with this method in the documentation.","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1680025992,"metadata":{"github-id":"UCE_lALODBZtRc5Yp1Wnzi8yPmQ"},"target":"598deb2654f07ecaecfb432cbefeabcec67ef9343f52f757e97bb6aadd6667b0","message":"My usage of the dandi python API is in Jupyter notebook, where I commonly access embargoed data. I didn't a loading bar with the default usage of the `dandi.download.download()` method, nor any explanation in the docs of how I might utilize a loading bar with this method. Additionally, I wasn't sure if embargoed data could be accessed with this method; I didn't see a description of how to provide credentials with this method in the documentation.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680029293,"metadata":{"github-id":"IC_kwDODBZtRc5YqH7y","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1487437554"},"message":"\u003e nor any explanation in the docs of how I might utilize a loading bar with this method.\n\nbecause there is no way yet, thus there is no explanation.\n\n\u003e Additionally, I wasn't sure if embargoed data could be accessed with this method; \n\nyes it can.\n\n\u003e I didn't see a description of how to provide credentials with this method in the documentation.\n\n https://dandi.readthedocs.io/en/latest/modref/dandiapi.html#dandi-dandiapi  ?","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1680032603,"metadata":{"github-id":"IC_kwDODBZtRc5YqXFk","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1487499620"},"message":"Ah perhaps I'm misunderstanding. I'm aware of authentication with the `dandiapi` class, but I was discussing the `dandi.download.download()` method external to the `dandiapi` class.","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1680032629,"metadata":{"github-id":"UCE_lALODBZtRc5YqXFkzi8zo5U"},"target":"d628e3323e370608f7bb78c845bece5b637b26665d89ccf971f566294aa2ced4","message":"Ah perhaps I'm misunderstanding. I'm aware of authentication with the `dandiapi` class, but I was discussing the `dandi.download.download()` method external to the `dandiapi` class that @jwodder mentioned above.","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1680032802,"metadata":{"github-id":"UCE_lALODBZtRc5YqXFkzi8zrMQ"},"target":"d628e3323e370608f7bb78c845bece5b637b26665d89ccf971f566294aa2ced4","message":"Ah perhaps I'm misunderstanding. I'm aware of authentication with the `dandiapi` class, but I was discussing the `dandi.download.download()` method external to the `dandiapi` class that @jwodder mentioned above. Is there some way to authenticate with `dandiapi` that affects `download.download()`?","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1680032838,"metadata":{"github-id":"UCE_lALODBZtRc5YqXFkzi8zrsA"},"target":"d628e3323e370608f7bb78c845bece5b637b26665d89ccf971f566294aa2ced4","message":"Ah perhaps I'm misunderstanding. I'm aware of authentication with the `dandiapi` class, but I was discussing the `dandi.download.download()` method external to the `dandiapi` class that @jwodder mentioned above as an alternative to using `BaseRemoteAsset.download()`. Is there some way to authenticate with `dandiapi` that affects `download.download()`?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680097240,"metadata":{"github-id":"IC_kwDODBZtRc5YutKj","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1488638627"},"message":"all API levels use the same credentials handling/storage mechanism.  The high level `download.download()` mechanism would query user for it, e.g. \n![image](https://user-images.githubusercontent.com/39889/228553762-85679a4d-330e-4f9e-8bb3-e004c1b282fe.png)\n\nbut if you want to pre-authenticate and want to avoid prompt -- either cause dandi to store credential by doing some `dandi download` in CLI or Jupyter to prompt you for the key (e.g. via `DandiAPIClient.for_dandi_instance(\"dandi\").dandi_authenticate()` which would prompt and store in keyring) or  just export DANDI_API_KEY env variable for that jupyter session.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682548406,"metadata":{"github-id":"IC_kwDODBZtRc5a2D_F","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1524121541"},"message":"Now you can authenticate and store key in api: see #1268  . So if you auth and store in keyring, then download shouldn't prompt AFAIK","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1690236169,"metadata":{"github-id":"IC_kwDODBZtRc5iRPgZ","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1648687129"},"message":"I've switched to using Dandi.download.download. Originally it had a analog to a loading bar (printing the download percentage and checksum every so often). However, it's stopped printing these _during_ the download now and only once the download is complete, which isn't so useful. Any ideas as to the cause?","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1690236228,"metadata":{"github-id":"UCE_lALODBZtRc5iRPgZzjSx1h4"},"target":"52c1eb7a7df51a19b44aa5848e949323de9fbe7fff861bf9d7b60e02c3b5a710","message":"I've switched to using Dandi.download.download. Originally it had a analog to a loading bar (printing the download percentage and checksum every so often). However, it's stopped printing these _during_ the download now and only once the download is complete, which isn't so useful. Any ideas as to the cause? I don't suspect it has anything to do with my Jupyter kernel's I/O buffering, as other prints in the same cell get printed during the cell's runtime.","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1693933263,"metadata":{"github-id":"IC_kwDODBZtRc5lvoOs","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1706984364"},"message":"Any investigation into this?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1694113531,"metadata":{"github-id":"IC_kwDODBZtRc5l9ktE","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1710639940"},"message":"sorry, didn't look into it.  Do you have ready cut/paste-able example -- it would expedite/stimulate looking into it ;-)","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1695931060,"metadata":{"github-id":"IC_kwDODBZtRc5ntS1L","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-1739926859"},"message":"The following code is representative of my use case in a notebook:\n```python\ndandiset_id = \"000488\"\ndandi_filepath = \"sub-416366/sub-416366_ses-768476976_behavior+image+ophys.nwb\"\ndownload_loc = \".\"\ndandi_api_key = None\n\n# downloads an NWB file from DANDI to download_loc, opens it, and returns the IO object for the NWB\n# dandi_api_key is required to access files from embargoed dandisets\ndef dandi_download_open(dandiset_id, dandi_filepath, download_loc, dandi_api_key=None, force_overwrite=False):\n    from dandi import dandiapi\n    import os\n    from dandi import download\n    client = dandiapi.DandiAPIClient(token=dandi_api_key)\n    dandiset = client.get_dandiset(dandiset_id)\n\n    file = dandiset.get_asset_by_path(dandi_filepath)\n    file_url = file.download_url\n\n    filename = dandi_filepath.split(\"/\")[-1]\n    filepath = f\"{download_loc}/{filename}\"\n\n    if os.path.exists(filepath) and not force_overwrite:\n        print(\"File already exists\")\n    else:\n        download.download(file_url, output_dir=download_loc)\n        print(f\"Downloaded file to {filepath}\")\n\n    print(\"Opening file\")\n    io = NWBHDF5IO(filepath, mode=\"r\", load_namespaces=True)\n    return io\n\n# This can sometimes take a while depending on the size of the file\nio = dandi_download_open(dandiset_id, dandi_filepath, download_loc, dandi_api_key=dandi_api_key)\nnwb = io.read()\n```\n\nNote that dandi_download_open is actually defined in a separate file, but when I run it within the same file, this problem still exists and loading bar output isn't printed until after the download is complete.","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1718126126,"metadata":{"github-id":"IC_kwDODBZtRc6A0htP","github-url":"https://github.com/dandi/dandi-cli/issues/1159#issuecomment-2161253199"},"message":"Any updates here? It would be very useful to have a loading bar for downloading files","files":null}]}