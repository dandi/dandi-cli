{"version":2,"ops":[{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618504439,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2MDAzNzUyMjM="},"added":["cmd-download"],"removed":[]},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618504439,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2MDAzNzUyMjQ="},"added":["cmd-organize"],"removed":[]},{"type":5,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1618504439,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ2MDAzNzUyMjY="},"added":["cmd-upload"],"removed":[]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620140662,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMjAxMzc2OA==","github-url":"https://github.com/dandi/dandi-cli/issues/365#issuecomment-832013768"},"message":"I think any deletion should be done with explicit instruction/option for that .  That is what `rsync` requires as well\n```\n$\u003e rsync --help | grep delete\n--del                    an alias for --delete-during\n--delete                 delete extraneous files from dest dirs\n--delete-before          receiver deletes before xfer, not during\n--delete-during          receiver deletes during the transfer\n--delete-delay           find deletions during, delete after\n--delete-after           receiver deletes after transfer, not during\n--delete-excluded        also delete excluded files from dest dirs\n--delete-missing-args    delete missing source args from destination\n--ignore-errors          delete even if there are I/O errors\n--max-delete=NUM         don't delete more than NUM files\n```\n(and iirc other tools for s3 etc support similar option(s)).  I think we could add a `--delete=(None|during|after)` and which would invoke now existing `delete` functionality","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620140674,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50NDY4Mzk1NzUxMA=="},"added":[],"removed":["waiting"]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1620224204,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMjcyNDY1NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/365#issuecomment-832724655"},"message":"@yarikoptic So what exactly are the desired semantics for the `--sync` option?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620228765,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMjc4Nzg3Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/365#issuecomment-832787876"},"message":"`--sync` pretty much just implies `delete` for assets in the target location if not present in the source location.  E.g. `upload --sync`: of entire dandiset should delete assets on the server not present locally, of a folder(s) -- delete assets in those folder(s) if not present locally, and if an asset - kinda a no-op.\n\nI think there is not much sense in `--delete` for now.  Let's just do \"after\": collect information about assets we are to delete, ask user for confirmation (\"{len(to_delete)} assets are to be removed from {destination}\" or alike) and delete them.  \"during\" might come handy later if someone runs out of space on local hard drive I guess.  And we do still possibly overwrite the assets at the destination (`--existing` option present in both `download` and `upload` still applies).","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620228797,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDU3ODk4MDg3"},"target":"643e886b9f72c6011e386e0ce5920597bd2077ee26e8dd28ee1923bbf38a2007","message":"`--sync` pretty much just implies `delete` for assets in the target location if not present in the source location.  E.g. `upload --sync`: of entire dandiset should delete assets on the server not present locally, of a folder(s) -- delete assets in those folder(s) if not present locally, and if an asset - kinda a no-op.\n\nI think there is not much sense in adding `--delete` option for now.  Let's just do \"after\": collect information about assets we are to delete, ask user for confirmation (\"{len(to_delete)} assets are to be removed from {destination}\" or alike) and delete them.  \"during\" might come handy later if someone runs out of space on local hard drive I guess.  And we do still possibly overwrite the assets at the destination (`--existing` option present in both `download` and `upload` still applies).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620229288,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMjc5NDM5MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/365#issuecomment-832794391"},"message":"renames: (if e.g. dandiset is reorganized but content is the same).\n\nFor `upload` we do not need to be anyhow clever since we would not reupload blobs if already known, and since we are not tracking any kind of \"provenance asset id\" ATM, we have no need to do anything special.\n\nFor `download` it does get trickier. Initial implementation can avoid doing that (figuring out renames), but then we would need to add the logic:\n- match assets between source/destination based on size first (fast and can reduce need for checksumming?).  Those which have matches - compute digest(s) (the one known on remote end) for local files to establish final mapping.  \n- Establish sequence of renamings (tricky one to not overwrite smth which is yet to be renamed; if to be downloaded, I guess could be the `--delete=during` kind of behavior)\n- Do renames  + downloads of what is missing\n\nThis `--sync` code, in particular renaming -- might be reusable for `organize` as well where we do have source (just differently named files) and then we pretty much sync them while giving them new filenames.  \"source\" and \"destination\" location though might be the same if re-organizing an existing dandiset with `--files-mode move` and which would entail bunch of renames.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1620315252,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMzYyMDIxOA==","github-url":"https://github.com/dandi/dandi-cli/issues/365#issuecomment-833620218"},"message":"@yarikoptic For `download --sync`, what local files should be treated as assets?  Should only `*.nwb` files be treated as assets, or should all files be, with some filtering out of VCS files?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620316530,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgzMzYzNTYxMg==","github-url":"https://github.com/dandi/dandi-cli/issues/365#issuecomment-833635612"},"message":"great question.  For `upload` we have devel option which triggers the switch between \n```python\npaths = find_files(\".*\", paths) if allow_any_path else find_dandi_files(paths)\n```\nI think we should just use the same `find_files` invocation here (it should ignore VCS, dot files and dirs, etc) and see how that works out ;)","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1620659684,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDcxODAwNDY1MA=="},"status":2}]}