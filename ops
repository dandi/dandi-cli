{"version":2,"ops":[{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1691593644,"metadata":{"github-id":"IC_kwDODBZtRc5jonhP","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671592015"},"message":"\u003e Should I create my own naming convention and figure out how to upload while bypassing the \"organize\" step?\n\n`dandi organize` is just a helper to put contents into a fashion compatible with `dandi validate`\n\nIf running `dandi organize` does not make use of the session ID as `ses-{session_id}` (say, when run on a single file in isolation of other dandiset contents), then you can just manually add `ses-{session_id}` to the filename; this is exactly how the [automatic dandi upload](https://github.com/catalystneuro/neuroconv/blob/main/src/neuroconv/tools/data_transfers.py#L269-L275) helper function in NeuroConv works\n\nI point this out because what I would do is just append `-{name_of_sorter}` to the session ID of the file, which will then show up on the name of the file as well.\n\nSee https://github.com/dandi/dandi-cli/issues/1265 for a more detailed discuussion on the similar topic of separating raw from processed files, which we're currently experimenting with different approaches as examples in https://dandiarchive.org/dandiset/000568?pos=3 and https://dandiarchive.org/dandiset/000552?pos=4","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1691594079,"metadata":{"github-id":"IC_kwDODBZtRc5joqkc","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671604508"},"message":"Believe it or not but I am thrilled to hear all your arguments for storing raw and processed spike sorted data in different .nwb files -- that is how I kept suggesting it should be done so \"great minds think alike\" ;)\n\n- `dandi organize` is just a helper - *it is not mandatory to be used*.  As long as naming of the folders files follows either DANDI (output of `dandi organize`) or BIDS convention -- we should be good!\n   - DANDI convention: we use only a set of fields based on the metadata we extract from nwb files - https://github.com/dandi/dandi-cli/blob/HEAD/dandi/consts.py#L189 . ATM there is no \"semantic\" (there is `_obj-`  field) which would meaningfully distinguish raw from spike sorted files indeed.  \n   - At BIDS level, work is only ongoing to formalize for animal ephys data within https://bids.neuroimaging.io/bep032 . AFAIK it did not yet go to \"spike sorted\" data.  Since it is a common case, I would expect some dedicated entity or even suffix (e.g. `_unites`) to annotate files. I left a comment/question in that  BEP032 google doc. I see meeting coming up next Wed (right @SylvainTakerkart?) so may be we could briefly discuss.  But meanwhile we could introduce both a suffix (`_unit`?) and use of [`_desc-`](https://bids-specification.readthedocs.io/en/stable/appendices/entities.html#desc)  entities. And see if we could teach `dandi organize` to even automagically populate them?  Do you have some sample files (raw + 2 different spike sorting ones)?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1691594181,"metadata":{"github-id":"UCE_lALODBZtRc5joqkczjWCPfs"},"target":"aa1659fa298b49aa28ee8d158689da65840f9ca60a90df13215196511f6f02f5","message":"Believe it or not but I am thrilled to hear all your arguments for storing raw and processed spike sorted data in different .nwb files -- that is how I kept suggesting it should be done so \"great minds think alike\" ;)\n\n- `dandi organize` is just a helper - *it is not mandatory to be used*.  As long as naming of the folders files follows either DANDI (output of `dandi organize`) or BIDS convention -- we should be good!\n   - DANDI convention: we use only a set of fields based on the metadata we extract from nwb files - https://github.com/dandi/dandi-cli/blob/HEAD/dandi/consts.py#L189 . ATM there is no \"semantic\" (there is `_obj-`  field) which would meaningfully distinguish raw from spike sorted files indeed.  \n   - At BIDS level, work is only ongoing to formalize for animal ephys data within https://bids.neuroimaging.io/bep032 . AFAIK it did not yet go to \"spike sorted\" data.  Since it is a common case, I would expect some dedicated entity or even suffix (e.g. `_units`) to annotate files. I left a comment/question in that  BEP032 google doc. I see meeting coming up next Wed (right @SylvainTakerkart?) so may be we could briefly discuss.  But meanwhile we could introduce both a suffix (`_units`?) and use of [`_desc-`](https://bids-specification.readthedocs.io/en/stable/appendices/entities.html#desc)  entities (so e.g., `sub-mice1_ses-1_ephys.nwb` and `sub-mice1_ses-1_desc-kilosort1_units.nwb`). And see if we could teach `dandi organize` to even automagically populate them?  Do you have some sample files (raw + 2 different spike sorting ones)?\n\nedit 1: fixed typos and added an example","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1691594374,"metadata":{"github-id":"IC_kwDODBZtRc5josqV","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671613077"},"message":"Oh, that reminds me - the only caveat is that the session ID cannot contain underscores, since those are used as separator characters in the DANDI filename convention; I just replace them with dashes usually","files":null},{"type":3,"author":{"id":"0557f4eaf35c04fc4e0ebbb3e3a2181677949ca1"},"timestamp":1691596310,"metadata":{"github-id":"IC_kwDODBZtRc5jo7WL","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671673227"},"message":"@yarikoptic that makes sense.\n\nI prepared a file called `sub-paired-english/sub-paired-english_ses-paired-english-m108-191125-163508_desc-ms5-units_ecephys.nwb`\n\nand I tried to upload with the cli using\n\n```bash\ndandi upload\n```\n\nBut I get an error because the name does not conform. Is there a different way I can upload?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1691598148,"metadata":{"github-id":"IC_kwDODBZtRc5jpNkO","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671747854"},"message":"\u003e But I get an error because the name does not conform. Is there a different way I can upload?\n\nit would not conform until we allow for `_desc` field.  just disable validation for now. What API do you use for upload and what error do you get?","files":null},{"type":3,"author":{"id":"0557f4eaf35c04fc4e0ebbb3e3a2181677949ca1"},"timestamp":1691600334,"metadata":{"github-id":"IC_kwDODBZtRc5jpdG7","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671811515"},"message":"Thanks, I have disabled validation and then the command went through. I have the example data here!\n\nhttps://dandiarchive.org/dandiset/000618/draft/files?location=sub-paired-english\n\nYou can view the raster plot in neurosift.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1691601663,"metadata":{"github-id":"IC_kwDODBZtRc5jplF9","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671844221"},"message":"oh neurosift is nice! but can't see anything interesting for units seems to me -- please guide me:\n\n![image](https://github.com/dandi/dandi-cli/assets/39889/ee7c5282-acc7-41b6-b926-23a9196be9dd)\n\nmay be errors in console are of relevance?\n\n![image](https://github.com/dandi/dandi-cli/assets/39889/e6014d64-6c23-4127-8220-a278e9d5313a)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1691601779,"metadata":{"github-id":"IC_kwDODBZtRc5jplrw","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671846640"},"message":"on 2nd try, when I clicked right away on \"raster plot\" it worked!","files":null},{"type":3,"author":{"id":"0557f4eaf35c04fc4e0ebbb3e3a2181677949ca1"},"timestamp":1691603297,"metadata":{"github-id":"IC_kwDODBZtRc5jptwj","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671879715"},"message":"\u003e on 2nd try, when I clicked right away on \"raster plot\" it worked!\n\nGreat! You can also click on autocorrelograms.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1691603953,"metadata":{"github-id":"IC_kwDODBZtRc5jpxOQ","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671893904"},"message":"support for `_desc` should come in https://github.com/dandi/dandi-cli/pull/1315 .  I think, as it is a very generic and useful entity in BIDS, we should adopt it too.  Yet to see if it would be feasible for `dandi organize` to automagically figure some label though. Ideas?","files":null},{"type":3,"author":{"id":"0557f4eaf35c04fc4e0ebbb3e3a2181677949ca1"},"timestamp":1691604784,"metadata":{"github-id":"IC_kwDODBZtRc5jp1k_","github-url":"https://github.com/dandi/dandi-cli/issues/1314#issuecomment-1671911743"},"message":"\u003e support for `_desc` should come in #1315 . I think, as it is a very generic and useful entity in BIDS, we should adopt it too. Yet to see if it would be feasible for `dandi organize` to automagically figure some label though. Ideas?\n\nMaybe there could be an optional dandi_desc attribute in the NWB file? But maybe it shouldn't have the word \"dandi\", not sure.","files":null}]}