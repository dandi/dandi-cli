{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1635340914,"metadata":{"github-id":"IC_kwDODBZtRc44zHc4","github-url":"https://github.com/dandi/dandi-cli/issues/817#issuecomment-952923960"},"message":"@yarikoptic How exactly should the `download()` function report such a failure (keeping in mind that it's called directly by a number of tests)?  Should it raise an exception, return `False`, or something else?\n\nAlso, what exactly should be regarded as a \"failed download\"?  For the record, this is what currently happens when the various URL types refer to non-existent resources (at least according to my reading of the code):\n\n| URL type | Dandiset does not exist | Dandiset exists but asset(s) do(es) not exist |\n| --- | --- | --- |\n| Dandiset URL | NotFoundError when trying to populate `dandiset.yaml` | — |\n| Asset ID URL w/Dandiset ID | 404 error discarded, nothing downloaded | 404 error discarded, nothing downloaded |\n| Asset ID URL w/o Dandiset ID | — | 404 error discarded, nothing downloaded |\n| Asset path prefix or folder path URL | No error (https://github.com/dandi/dandi-api/issues/559), no assets downloaded | No assets downloaded |\n| Asset path URL | No error (https://github.com/dandi/dandi-api/issues/559), no assets downloaded | Internal `NotFoundError` discarded, no assets downloaded |","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635364712,"metadata":{"github-id":"IC_kwDODBZtRc440aRk","github-url":"https://github.com/dandi/dandi-cli/issues/817#issuecomment-953263204"},"message":"\u003e @yarikoptic How exactly should the `download()` function report such a failure (keeping in mind that it's called directly by a number of tests)?\n\nwell, we have 3 of those ;)\n\n```\n$\u003e git grep 'def download('\ndandi/cli/cmd_download.py:def download(\ndandi/dandiapi.py:    def download(\ndandi/download.py:def download(\n```\nthe one of direct  concern here is the `dandi/cli/cmd_download.py:def download(` , which is a thin wrapper around `dandi/download.py:def download(`.  I think that the `dandi.download.download` should raise an exception (dandi.exceptions.FailedToDownload to be created. probably with `.failed` and `.succeeded` records?) at the end if any file (in the loop) errorred to download.  That would instruct (which need to try/except) outside `cmd_download.download` that something went wrong and still provide information on what succeeded and what not.\n\nIf you could offer a PR to fix that https://github.com/dandi/dandi-api/issues/559 -- would be great. Otherwise, I guess we could assume that empty return from API for some specific asset == 404 (not there).","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1635436925,"metadata":{"github-id":"IC_kwDODBZtRc443KwM","github-url":"https://github.com/dandi/dandi-cli/issues/817#issuecomment-953986060"},"message":"@yarikoptic So, in order to implement this, I've given `dandi.dandiarchive.navigate_url()` a `strict` argument for raising `NotFoundError`s instead of suppressing them.  If `dandi.download.download()` calls `navigate_url()` with `strict` set to true, then any attempt to download anything from a nonexistent Dandiset or to download a nonexistent asset by ID or path will result in a `NotFoundError`.  As `download()` currently only supports taking a single URL, and as all of the 404 cases occur when an entire URL is bogus, a `NotFoundError` means that there are no assets that could have been successfully downloaded, and so creating a special exception with \"failed\" and \"succeeded\" counts won't be of much use for handling 404's.  (It may be of use in cases where assets fail for other reasons, but those are a separate matter from the motivating case for this issue.)\n\nSo, is it OK if the behavior of `dandi download` on nonexistent URLs simply becomes:\n\n```\n$ dandi download https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/download/\n2021-10-28 11:59:56,277 [    INFO] Logs saved in /Users/jwodder/Library/Logs/dandi-cli/20211028155955Z-31866.log\nError: No such asset: '9d9f379d-9fd1-4872-8c49-3891dfb693ab' for DANDI:000004/draft\n```\n\n?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635438133,"metadata":{"github-id":"IC_kwDODBZtRc443Ozn","github-url":"https://github.com/dandi/dandi-cli/issues/817#issuecomment-954002663"},"message":"although motivating case is indeed different, I wonder:\n\n- since URL could point to some `draft` version of a huge dandiset (e.g. 000108) which would take weeks to download, and then particular asset might get \"GCed\" if replaced/changed -- we still can encounter `NotFoundError` for an asset even though top level URL was Ok. Can't we make it handle such cases properly as well right away?\n\nIf you think that it couldn't be done easily ATM or unrelated, let's postpone. If could be done -- suggested RFing should take that into account (I guess could test \"manually\" by screwing up uuid for some asset in the list of assets for a sample dandiset and see what happens). But with that in mind may be #819 is related -- it did show `pyout` output and then actual error not depicted in it and only after.\n\nAn let me answer to myself re\n\n\u003e pyout interfacing code should be adjusted to show the \"table\" with ERROR shown\n\nif initial URL is bogus, we do not even know path or any other metadata which pyout displays, so nothing to display and having just an Error message is warranted.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1635439390,"metadata":{"github-id":"IC_kwDODBZtRc443Sr1","github-url":"https://github.com/dandi/dandi-cli/issues/817#issuecomment-954018549"},"message":"@yarikoptic I don't think that can be done very easily.  File a separate issue, and I'll open a PR with my strictness changes to close this one.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635449229,"metadata":{"github-id":"CE_lADODBZtRc49yk-FzwAAAAFJ_LdN"},"status":2}]}