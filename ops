{"version":2,"ops":[{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597330763,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM2NTI0ODgwNzc="},"added":["UX"],"removed":[]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597333252,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MzU1MTg3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-673551879"},"message":"I seem to have gotten the `local_docker_compose` fixture to handle being run in parallel using a recipe from the pytest-xdist README, but then the tests fail because multiple tests are trying to lock Dandiset 000001 at once.  I don't think this test suite is parallelizable.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597333252,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkyODYzNzMz"},"target":"671105d9aba08ad4c14cfc5ec6330b54a12b0cb770a70dc0e9b99778cb091a92","message":"I seem to have gotten the `local_docker_compose` fixture to handle being run in parallel using a recipe from the pytest-xdist README, but then the tests fail because multiple tests are trying to lock Dandiset 000001 at once.  I don't think this test suite is parallelizable.  (Would you like me to push my code anyway?)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597334915,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MzU2NzU5Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-673567597"},"message":"And there is no way to eg create a fixture (eg `needs_lock`) which could be used only by a single test at a time? Alternative is to use different dandisets across tests where locking is needed, but probably that would be sub optimal burden","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597337137,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3MzU4NDg2OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-673584869"},"message":"I managed to write a `needs_lock` fixture that holds a lock on a lockfile while the test runs, and the tests do seem to be succeeding, but now the coverage is coming out at 10%.  Basic googling doesn't offer an explanation.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597337137,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkyODgyNDE5"},"target":"8f32d498cc55c4829507b391558a808df3d8abee80913a9807df82ac5471004e","message":"I managed to write a `needs_lock` fixture that holds a lock on a lockfile while the test runs, and the tests do seem to be succeeding, but now, when running in parallel, the coverage is coming out at 10%.  Basic googling doesn't offer an explanation.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597337520,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzkyODg0MDc0"},"target":"8f32d498cc55c4829507b391558a808df3d8abee80913a9807df82ac5471004e","message":"I managed to write a `needs_lock` fixture that holds a lock on a lockfile while the test runs, and the tests do seem to be succeeding, but now, when running in parallel, the coverage is coming out at 10%.  Basic googling doesn't offer an explanation.\n\nEdit: Coverage remains at 80% if I use pytest-cov instead of plain coverage, but then there are a dozen `.coverage.$HOSTNAME.#.#` files left lying around after the tests are done, with or without parallelization.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597376925,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3Mzg2NzY3Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-673867676"},"message":"Great!\n\nre coverage files: may be smth here could come handy? https://github.com/pytest-dev/pytest-cov/issues/250#issuecomment-464375768","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597408041,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA0OTkzMw==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674049933"},"message":"The page linked to there seems to have moved to https://pytest-cov.readthedocs.io/en/latest/subprocess-support.html.  The only element of `multiprocessing` we use directly is `Lock`; do any of our dependencies use `multiprocessing`?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597412051,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA3NzMzNg==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674077336"},"message":"joblib? (#191)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597412282,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA3OTE0MA==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674079140"},"message":"[This says](https://joblib.readthedocs.io/en/latest/parallel.html#thread-based-parallelism-vs-process-based-parallelism) `joblib.Parallel` uses loky by default, which in turn seems to be a mix of `multiprocessing` and custom code.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597412329,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA3OTUwOA==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674079508"},"message":"BTW, if it becomes too \"involved\" to make it work smoothly, may be it is not worth it at this point?  Getting tests run fast via parallelization is a great DX feature to have but our tests aren't that long ATM anyways, so it is not that critical, we could get back to it later when more pressing need arises.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597412446,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA4MDM4MA==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674080380"},"message":"\u003e [This says](https://joblib.readthedocs.io/en/latest/parallel.html#thread-based-parallelism-vs-process-based-parallelism) `joblib.Parallel` uses loky by default, which in turn seems to be a mix of `multiprocessing` and custom code.\n\nalso there is use inside joblib itself:\n```\n$\u003e git grep multiprocessing | grep import | grep -v /loky/\nCHANGES.rst:    Fix joblib import setting the global start_method for multiprocessing.\ncontinuous_integration/run_tests.sh:python -c \"import multiprocessing as mp; print('multiprocessing.cpu_count():', mp.cpu_count())\"\njoblib/_memmapping_reducer.py:from multiprocessing import util\njoblib/_multiprocessing_helpers.py:\"\"\"Helper module to factorize the conditional multiprocessing import logic\njoblib/_multiprocessing_helpers.py:        import multiprocessing as mp\njoblib/_multiprocessing_helpers.py:        from _multiprocessing import SemLock\njoblib/_multiprocessing_helpers.py:    from multiprocessing.context import assert_spawning\njoblib/_parallel_backends.py:from ._multiprocessing_helpers import mp\njoblib/_parallel_backends.py:    from multiprocessing.pool import ThreadPool\njoblib/_parallel_backends.py:    from multiprocessing import TimeoutError\njoblib/backports.py:from multiprocessing import util\njoblib/disk.py:from multiprocessing import util\njoblib/parallel.py:from ._multiprocessing_helpers import mp\njoblib/pool.py:This module should not be imported if multiprocessing is not\njoblib/pool.py:from ._multiprocessing_helpers import mp, assert_spawning\njoblib/pool.py:from multiprocessing.pool import Pool\njoblib/test/common.py:from joblib._multiprocessing_helpers import mp\njoblib/test/test_memmapping.py:from joblib.test.common import with_multiprocessing\njoblib/test/test_memory.py:from joblib.test.common import with_multiprocessing\njoblib/test/test_module.py:        import multiprocessing as mp\njoblib/test/test_module.py:        from multiprocessing import semaphore_tracker\njoblib/test/test_module.py:        msg = \"multiprocessing.semaphore_tracker has been spawned on import\"\njoblib/test/test_parallel.py:from multiprocessing import TimeoutError\njoblib/test/test_parallel.py:from joblib.test.common import with_multiprocessing\njoblib/test/test_parallel.py:    from multiprocessing import get_context\njoblib/test/test_parallel.py:        from multiprocessing import get_context\njoblib/test/test_parallel.py:import multiprocessing as mp\njoblib/test/test_store_backends.py:from joblib.test.common import with_multiprocessing\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1597412516,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA4MDkwMg==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674080902"},"message":"also -- we use `joblib` ATM as a very rudimentary mass parallelization helper... at some point we might just code up our own thus having better control over our needs and avoiding joblib shortcomings (no generator support for Parallel yet)","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1597414996,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDA5OTUyMA==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674099520"},"message":"consider pydra as well, depending on needs.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1597429544,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY3NDIwNTAwMA==","github-url":"https://github.com/dandi/dandi-cli/issues/194#issuecomment-674205000"},"message":"If I disable `joblib.Parallel` by setting `DANDI_DEVEL=1` and adding the `--devel-debug` option to the command in `test_organize_nwb_test_data`, testing with pytest-cov still creates a bunch of (though fewer) `.coverage.$HOSTNAME.#.#` files, so it seems that something else is also responsible.","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1600117094,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM3NjUzMTU3Njg="},"added":["no solution identified"],"removed":[]}]}