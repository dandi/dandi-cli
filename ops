{"version":2,"ops":[{"type":6,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625597416,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDo1Njc0MzE4OTY="},"target":"0c904b6a8af8294314cd8e969e2254c8258028e6dadf31179bbcb2033fbd7d6e","message":"something like below could be added to the cli api to find bad assets.  also see this api change request: https://github.com/dandi/dandi-api/issues/396\n\nfor example the code below returns that assets are failing because they are missing a sha256.  (https://github.com/dandi/dandi-api/issues/254)\n\n```python\ndef get_assets(dandiset, baseurl=\"api\"):\n    url = f\"https://{baseurl}.dandiarchive.org/api/dandisets/{dandiset}/versions/draft/assets/\"\n    querystring = {\"page_size\":\"100\"}\n    headers = {\"Accept\": \"application/json\"}\n    resp = requests.request(\"GET\", url, headers=headers, params=querystring).json()\n    results = resp[\"results\"]\n    while resp[\"next\"]:\n        resp = requests.request(\"GET\", resp[\"next\"], headers=headers).json()\n        results.extend(resp[\"results\"])\n    assert len(results) == resp[\"count\"]\n    url = f\"https://{baseurl}.dandiarchive.org/api/dandisets/{dandiset}/versions/draft/assets/\"\n    assetmeta = []\n    for val in results:\n        resp = requests.request(\"GET\", url + val[\"asset_id\"] + \"/validation\", headers=headers).json()\n        resp.update(**{\"identifier\": val[\"asset_id\"]})\n        assetmeta.append(resp)\n    return results, assetmeta\nres, vs = get_assets(\"000003\")\nvs\n[val for val in vs if val[\"validation_error\"]]\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1625607748,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3NTEwMTYxMQ==","github-url":"https://github.com/dandi/dandi-cli/issues/699#issuecomment-875101611"},"message":"well, we have `get_assets` but here it is pretty much also \n- query them (one at a time?) be valid or not\n- show validation errors\n\nI wonder if that checking validity should be an option on `/assets` end point ? may be even analogously on `/paths` (WiP in https://github.com/dandi/dandi-api/pull/312).  Otherwise, even though we can do it on client, it would be expensive in terms of requests, and would take awhile for any sizeable (in number of assets) dandiset.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1625609002,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDc2MDIzMjgz"},"target":"1333291e4f8d26dc2d21a16ef1a3800c0802a236df51ad70481096dccdd2d961","message":"well, we have `get_assets` but here it is pretty much also \n- query them (one at a time?) be valid or not\n- show validation errors\n\nI wonder if that checking validity should be an option on `/assets` end point ? may be even analogously on `/paths` (WiP in https://github.com/dandi/dandi-api/pull/312).  Otherwise, even though we can do it on client, it would be expensive in terms of requests, and would take awhile for any sizeable (in number of assets) dandiset.\n\nedit: filed https://github.com/dandi/dandi-api/issues/397 . We could provide a workaround on client level (like we already do for `metadata` but I wonder if we should -- it might cause even more load on the API server with all the queries per asset -- we better address it right there!)","files":null}]}