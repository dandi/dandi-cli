{"version":2,"ops":[{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730306097,"metadata":{"github-id":"UCE_lAHODBZtRc6ccQ-izmjCw5o"},"target":"0bad44071849d7e4615a8cc3078d9883ad9b71f7f5519ab8abd0f9c43c09df3b","message":"@yarikoptic @jwodder -- wanted to start a GitHub Issue to get consolidation of `linc-cli` https://github.com/lincbrain/linc-cli back to `dandi-cli` -- working with @satra @kabilar here to merge LINC work back into DANDI as Ember approaches\n\nPrior to coding a potential solution, wanted to get your thoughts. The only 2 differences that exist between `dandi-cli` and `linc-cli` are:\n\n• `client.dandi_authenticate()` is called upon every command in `linc-cli` due to the locked-down nature of LINC assets for now\n• LINC has an API Key called `LINCBRAIN_API_KEY`\n\nThere are no other differences, other than the API that is hit of course (`api.lincbrain.org/.....`)\n\nMy proposal here would be to:\n\n1. Expand the `DandiInstance` object offerings to include `LINC` in `consts.py` -- [code reference](https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/dandi/consts.py#L119-L135)\n2. Add a `is_private_archive` boolean to the `DandiInstance` -- [code reference](https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/dandi/consts.py#L99). This bool value would be used to decide upon what commands in `dandi-cli` would require `client.dandi_authenticate()`\n3. Include an `--api-key` flag that could be passed in the CLI commands to handle the API key for any extending instance (would go against the `keyring` pattern a bit, so curious to get your thoughts especially here)\n\nLet me know -- I'll default to some of your wisdom here as you've authored most of the CLI tool\n\nCc @waxlamp -- tagging for visibility for Kitware folks","files":null},{"type":2,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730306074,"metadata":{"github-id":"RTE_lADODBZtRc6ccQ-izwAAAAN-ynDc"},"title":"Extend `DandiInstance` to support APIs outside of `dandiarchive.org` subdomains","was":"Extend `DandiInstance` to support APIs outside of `dandiarchive.org` subdomains"},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1730315766,"metadata":{"github-id":"IC_kwDODBZtRc6R67Mq","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2448143146"},"message":"Additional aspect on user level visible interface/configuration:\n\n- do we want to see `linc`* instances as just sample instances of dandi and otherwise still use `dandi` CLI  and determine which instance to operate based on dandiset metadata at hands or `--instance` option provided . If it stays so `DANDI_API_KEY` could still be used for LINC key specification IMHO.\n\nor \n\n- still have a dedicated `linc` CLI entry point installed along with `dandi` which would automagically favor `linc` and `LINC_API_KEY` to be the env var?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1730316133,"metadata":{"github-id":"IC_kwDODBZtRc6R6_95","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2448162681"},"message":"\u003e do we want to see linc* instances as just sample instances of dandi and otherwise still use dandi CLI \n\ngenerally speaking yes. although one could release a linc cli that effectively is a very lightweight wrapper around dandi cli, changing some configs. i think dandi has become quite synonymous with the neurophysiology repository, and it may take some work to turn it into a more general framework. however, i would be keen to do so, if possible. \n\ntechnically as you raise, naming things like api keys and instances would require some thought and cli awareness.","files":null},{"type":3,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730316917,"metadata":{"github-id":"IC_kwDODBZtRc6R7Gx4","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2448190584"},"message":"\u003e \u003e do we want to see linc* instances as just sample instances of dandi and otherwise still use dandi CLI\n\u003e \n\u003e generally speaking yes. although one could release a linc cli that effectively is a very lightweight wrapper around dandi cli, changing some configs. i think dandi has become quite synonymous with the neurophysiology repository, and it may take some work to turn it into a more general framework. however, i would be keen to do so, if possible.\n\u003e \n\u003e technically as you raise, naming things like api keys and instances would require some thought and cli awareness.\n\n@satra Could you provide some base case abstractions you'd like to accomplish here?","files":null},{"type":3,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730317105,"metadata":{"github-id":"IC_kwDODBZtRc6R7IdO","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2448197454"},"message":"\u003e Additional aspect on user level visible interface/configuration:\n\u003e \n\u003e * do we want to see `linc`* instances as just sample instances of dandi and otherwise still use `dandi` CLI  and determine which instance to operate based on dandiset metadata at hands or `--instance` option provided . If it stays so `DANDI_API_KEY` could still be used for LINC key specification IMHO.\n\u003e \n\u003e or\n\u003e \n\u003e * still have a dedicated `linc` CLI entry point installed along with `dandi` which would automagically favor `linc` and `LINC_API_KEY` to be the env var?\n\n@yarikoptic I think the idea of inferring the API via reading from the dandiset metadata serves as the lowest cognitive overhead for the end user -- as far as routing the `dandi` CLI command\n\n@satra my hesitancy of `although one could release a linc cli that effectively is a very lightweight wrapper` is that this will just lead to a handful of forks still. DANDI CLI (and LINC) are strongly coupled to the data models and prescribed validations","files":null},{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730317242,"metadata":{"github-id":"UCE_lALODBZtRc6R7IdOzlPHqUU"},"target":"a64abe6d98c26be263ad33970c47fa9f9f8f3369366a03530caeabf08df1e80c","message":"\u003e Additional aspect on user level visible interface/configuration:\n\u003e \n\u003e * do we want to see `linc`* instances as just sample instances of dandi and otherwise still use `dandi` CLI  and determine which instance to operate based on dandiset metadata at hands or `--instance` option provided . If it stays so `DANDI_API_KEY` could still be used for LINC key specification IMHO.\n\u003e \n\u003e or\n\u003e \n\u003e * still have a dedicated `linc` CLI entry point installed along with `dandi` which would automagically favor `linc` and `LINC_API_KEY` to be the env var?\n\n@yarikoptic I think the idea of inferring the API via reading from the dandiset metadata serves as the lowest cognitive overhead for the end user -- as far as routing the `dandi` CLI command\n\n@satra @yarikoptic my hesitancy of `although one could release a linc cli that effectively is a very lightweight wrapper` is that this will just lead to a handful of forks still. DANDI CLI (and LINC) are strongly coupled to the data models and analagous prescribed validations, thus, from an end user perspective, I'd be inclined to just use a cloud-vendored issued CLI tool for file management instead of `dandi-cli`, etc.\n\nYou _could_ say -- \"ok, users can also bring their own dandischema-ish library\" -- however, abstraction at that level seems arduous without user research","files":null},{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730317271,"metadata":{"github-id":"UCE_lALODBZtRc6R7IdOzlPHrHQ"},"target":"a64abe6d98c26be263ad33970c47fa9f9f8f3369366a03530caeabf08df1e80c","message":"\u003e Additional aspect on user level visible interface/configuration:\n\u003e \n\u003e * do we want to see `linc`* instances as just sample instances of dandi and otherwise still use `dandi` CLI  and determine which instance to operate based on dandiset metadata at hands or `--instance` option provided . If it stays so `DANDI_API_KEY` could still be used for LINC key specification IMHO.\n\u003e \n\u003e or\n\u003e \n\u003e * still have a dedicated `linc` CLI entry point installed along with `dandi` which would automagically favor `linc` and `LINC_API_KEY` to be the env var?\n\n@yarikoptic I think the idea of inferring the API via reading from the dandiset metadata serves as the lowest cognitive overhead for the end user -- as far as routing the `dandi` CLI command\n\n@satra @yarikoptic my hesitancy of `although one could release a linc cli that effectively is a very lightweight wrapper` is that this will just lead to a handful of forks still. DANDI CLI (and LINC) are strongly coupled to the data models and analagous prescribed validations, thus, from an end user perspective, I'd be inclined to just use a cloud-vendored issued CLI tool for file management instead of `dandi-cli`, etc.\n\nYou _could_ say -- \"ok, users can also bring their own dandischema-ish library\" too -- thus all data uploaded to their buckets would have uniformity -- however, abstraction at this time and level seems arduous without user research","files":null},{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730317302,"metadata":{"github-id":"UCE_lALODBZtRc6R7IdOzlPHr7Y"},"target":"a64abe6d98c26be263ad33970c47fa9f9f8f3369366a03530caeabf08df1e80c","message":"\u003e Additional aspect on user level visible interface/configuration:\n\u003e \n\u003e * do we want to see `linc`* instances as just sample instances of dandi and otherwise still use `dandi` CLI  and determine which instance to operate based on dandiset metadata at hands or `--instance` option provided . If it stays so `DANDI_API_KEY` could still be used for LINC key specification IMHO.\n\u003e \n\u003e or\n\u003e \n\u003e * still have a dedicated `linc` CLI entry point installed along with `dandi` which would automagically favor `linc` and `LINC_API_KEY` to be the env var?\n\n@yarikoptic I think the idea of inferring the API via reading from the dandiset metadata serves as the lowest cognitive overhead for the end user -- as far as routing the `dandi` CLI command\n\n@satra @yarikoptic my hesitancy of `although one could release a linc cli that effectively is a very lightweight wrapper` is that this will just lead to a handful of forks still. DANDI CLI (and LINC) are strongly coupled to the data models and analagous prescribed validations, thus, from an end user perspective, at a certain point, I'd be inclined to rather just use a cloud-vendored issued CLI tool for file management instead of `dandi-cli`, etc.\n\nYou _could_ say -- \"ok, users can also bring their own dandischema-ish library\" too -- thus all data uploaded to their buckets would have uniformity -- however, abstraction at this time and level seems arduous without user research","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1730662223,"metadata":{"github-id":"IC_kwDODBZtRc6SPjTJ","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2453550281"},"message":"\u003e Could you provide some base case abstractions you'd like to accomplish here?\n\ni'm not sure what this means, but the process of uploading is the same for all instances (the data models are the same - to speak to the next comment). so the abstractions are really about where to send and do you have authorization to send there.\n\ni don't think native cloud vendor CLIs (e.g. aws CLI) work for our use cases for various reasons (e.g. we need data model checks, we need validation, and we need to support for objects like zarr). also we don't expect our work to be completely general purpose. the focus would still be neuroscience domain for now, with the scope of the data model being modifiable. also our backend datamodel is relatively simple (blob/container blob + jsonld metadata), and intentionally different from the metadata models for dandiset/asset.","files":null},{"type":3,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730737757,"metadata":{"github-id":"IC_kwDODBZtRc6SVtdr","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2455164779"},"message":"\u003e \u003e Could you provide some base case abstractions you'd like to accomplish here?\n\u003e \n\u003e i'm not sure what this means, but the process of uploading is the same for all instances (the data models are the same - to speak to the next comment). so the abstractions are really about where to send and do you have authorization to send there.\n\u003e \n\u003e i don't think native cloud vendor CLIs (e.g. aws CLI) work for our use cases for various reasons (e.g. we need data model checks, we need validation, and we need to support for objects like zarr). also we don't expect our work to be completely general purpose. the focus would still be neuroscience domain for now, with the scope of the data model being modifiable. also our backend datamodel is relatively simple (blob/container blob + jsonld metadata), and intentionally different from the metadata models for dandiset/asset.\n\n@satra sounds good to me -- I do want to note the frequent usage of `--skip-validation` flag (Cc @kabilar)  for the LINC project, as `dandischema` is very coupled to all-things DANDI -- are you envisioning all clones conforming to `dandischema` rules? Do you envision clones submitting PRs to `dandischema` associated with the API that is routed to via `dandi-cli`?\n\n`with the scope of the data model being modifiable` -- are you envisioning clones defining their own Django models? Are you envisioning clones leveraging JSON fields to conform to some of DANDI's current data model constructs?","files":null},{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730739423,"metadata":{"github-id":"UCE_lALODBZtRc6SVtdrzlQdXqI"},"target":"372cf1fada01f224f73b96beae144cc4c75d7268d8d687b5e34f37440c96141e","message":"\u003e \u003e Could you provide some base case abstractions you'd like to accomplish here?\n\u003e \n\u003e i'm not sure what this means, but the process of uploading is the same for all instances (the data models are the same - to speak to the next comment). so the abstractions are really about where to send and do you have authorization to send there.\n\u003e \n\u003e i don't think native cloud vendor CLIs (e.g. aws CLI) work for our use cases for various reasons (e.g. we need data model checks, we need validation, and we need to support for objects like zarr). also we don't expect our work to be completely general purpose. the focus would still be neuroscience domain for now, with the scope of the data model being modifiable. also our backend datamodel is relatively simple (blob/container blob + jsonld metadata), and intentionally different from the metadata models for dandiset/asset.\n\n@satra sounds good to me -- I do want to note the frequent usage of `--skip-validation` flag (Cc @kabilar)  for the LINC project, as `dandischema` is very coupled to all-things DANDI -- are you envisioning all clones conforming to `dandischema` rules? Do you envision clones submitting PRs to `dandischema` (e.g. more lenient schema validation) associated with the API that is routed to via `dandi-cli`?\n\n`with the scope of the data model being modifiable` -- are you envisioning clones defining their own Django models? Are you envisioning clones leveraging JSON fields to conform to some of DANDI's current data model constructs?","files":null},{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1730741068,"metadata":{"github-id":"UCE_lALODBZtRc6SVtdrzlQeLoQ"},"target":"372cf1fada01f224f73b96beae144cc4c75d7268d8d687b5e34f37440c96141e","message":"\u003e \u003e Could you provide some base case abstractions you'd like to accomplish here?\n\u003e \n\u003e i'm not sure what this means, but the process of uploading is the same for all instances (the data models are the same - to speak to the next comment). so the abstractions are really about where to send and do you have authorization to send there.\n\u003e \n\u003e i don't think native cloud vendor CLIs (e.g. aws CLI) work for our use cases for various reasons (e.g. we need data model checks, we need validation, and we need to support for objects like zarr). also we don't expect our work to be completely general purpose. the focus would still be neuroscience domain for now, with the scope of the data model being modifiable. also our backend datamodel is relatively simple (blob/container blob + jsonld metadata), and intentionally different from the metadata models for dandiset/asset.\n\n@satra sounds good to me -- I do want to note the frequent usage of `--skip-validation` flag (Cc @kabilar)  for the LINC project, as `dandischema` is very coupled to all-things DANDI -- are you envisioning all clones conforming to `dandischema` rules? Do you envision clones submitting PRs to `dandischema` (for more lenient schema validation) associated with the API that is routed to via `dandi-cli`?\n\n`with the scope of the data model being modifiable` -- are you envisioning clones defining their own Django models? Are you envisioning clones leveraging JSON fields to conform to some of DANDI's current data model constructs?","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1730764710,"metadata":{"github-id":"IC_kwDODBZtRc6SYsBj","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2455945315"},"message":"Thanks team.  Echoing the points above.  For the use case of the LINC project, I think that the following behavior would be straightforward from the user perspective.\n\n1. A single client (i.e. `dandi`) that can interact with either the DANDI or LINC instance.  \n    ```\n    dandi download -i linc \u003cURL\u003e\n    ```\n2. Users would define the `DANDI_API_KEY` with the API key from https://dandiarchive.org or https://lincbrain.org.  If we get feedback from LINC users that having a single environment variable for both the DANDI and LINC API keys is cumbersome then we can re-evaluate supporting a `LINC_API_KEY`.\n\nSince `dandischema` changes are not currently needed for the LINC project, perhaps we can defer that discussion to the upcoming `Generalization of DANDI` meetings?\n\n@aaronkanzer Your proposal on how to implement this feature sounds right (quoted below).  Would you be able to submit a pull request for this work?\n\n\u003e My proposal here would be to:\n\u003e \n\u003e 1. Expand the `DandiInstance` object offerings to include `LINC` in `consts.py` -- [code reference](https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/dandi/consts.py#L119-L135)\n\u003e 2. Add a `is_private_archive` boolean to the `DandiInstance` -- [code reference](https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/dandi/consts.py#L99). This bool value would be used to decide upon what commands in `dandi-cli` would require `client.dandi_authenticate()`","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1730766142,"metadata":{"github-id":"IC_kwDODBZtRc6SYyJG","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2455970374"},"message":"\u003e dandischema is very coupled to all-things DANDI\n\nit is and it isn't. since dandischema supports the lightsheet + mri datasets on DANDI proper, it should also be fine for validating linc datasets. essentially any bids dataset should be supported by the DANDI schema and should upload without skip validation. if that's not the case, something is off and should highlight a reconciliation.","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1730777580,"metadata":{"github-id":"IC_kwDODBZtRc6SZgHi","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2456158690"},"message":"We will also have to update the DANDI and LINC docs.  A few examples are below.\n\n1. Update the DANDI Client docs to explain that the DANDI Client can interact with the DANDI Archive and other instances.\n    1. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/docs/source/index.rst?plain=1#L4-L6\n    2. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/docs/source/cmdline/dandi.rst?plain=1#L8-L9\n    3. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/docs/source/modref/dandiapi.rst?plain=1#L6\n    4. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/dandi/cli/command.py#L73\n    5. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/setup.cfg#L21\n    6. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/README.md?plain=1#L17-L19\n2. Update the DANDI Client docs to replace `--dandi-instance` with `--instance`.\n    1. https://github.com/dandi/dandi-cli/blob/6aa414c4db47394970f586cc4fb9758a634aef87/docs/source/cmdline/instances.rst?plain=1#L8-L10\n3. Update the LINC web app example download commands to replace `lincbrain` with `dandi`.\n    1. https://github.com/lincbrain/linc-archive/blob/66f867b3b18553b9b8311e0b5bc0e7e1f57ea778/web/src/views/DandisetLandingView/DownloadDialog.vue#L128-L135\n    2. https://github.com/lincbrain/linc-archive/blob/66f867b3b18553b9b8311e0b5bc0e7e1f57ea778/web/src/components/FileBrowser/FileUploadInstructions.vue#L63\n4. Update the LINC docs to replace `lincbrain-cli`/`lincbrain` with `dandi`.\n    1. https://docs.lincbrain.org/upload/\n    2. https://docs.lincbrain.org/#about-this-doc","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1730777915,"metadata":{"github-id":"IC_kwDODBZtRc6SZhTs","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2456163564"},"message":"5. Remove `lincbrain-cli` installation from the LINC Hub\n    1. https://github.com/dandi/dandi-hub/blob/ddde7ba3dc0cd0d4927b839dbd7aaac5ff20670f/envs/linc/jupyterhub-overrides.yaml#L96","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1730781290,"metadata":{"github-id":"IC_kwDODBZtRc6SZtlk","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2456213860"},"message":"\u003e • `client.dandi_authenticate()` is called upon every command in `linc-cli` due to the locked-down nature of LINC assets for now \n\nHi @aaronkanzer, I may have missed it but I didn't notice these calls in the diff pull request (https://github.com/lincbrain/linc-cli/pull/63).  We only added `client.dandi_authenticate()` for the `lincbrain move` command to fix a bug, but those changes are now also upstream in `dandi/dandi-cli`.","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1733852173,"metadata":{"github-id":"IC_kwDODBZtRc6W8Orp","github-url":"https://github.com/dandi/dandi-cli/issues/1517#issuecomment-2532371177"},"message":"Fixed in #1527","files":null},{"type":4,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1733852173,"metadata":{"github-id":"CE_lADODBZtRc6ccQ-izwAAAAOiHI05"},"status":2}]}