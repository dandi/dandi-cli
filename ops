{"version":2,"ops":[{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1652989996,"metadata":{"github-id":"UCE_lAHODBZtRc5KC0Gyzi4zv4o"},"target":"883cb1ed6caae9354dbbb387514bf00216e58d39b74842dc8d767792498694d1","message":"e.g. https://dandiarchive.org/dandiset/000109 contains neurodata type VoltageClampSeries. This is supposed to add VoltageClampSeries to the variableMeasured attribute of the assetsSummary ([here](https://github.com/dandi/dandi-cli/blob/d061e3a02f51e0e2067a7ca0cf450b269f2f008e/dandi/tests/test_metadata.py#L456-L460)), however this field is not populated. This problem shows up in many of the icephys datasets, and does not appear to be a problem for ecephys and ophys.\n\nThis is a roadblock for me to generate proper figures summarizing dandisets for the DANDI paper","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1652992023,"metadata":{"github-id":"IC_kwDODBZtRc5De5dW","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132173142"},"message":"the metadata extraction wasn't available in the earliest days of the archive. that's an old dandiset. was it run through the current cli ? can you re-upload the asset with the current cli with `--existing replace` (i think), and see if it changes?","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653003457,"metadata":{"github-id":"IC_kwDODBZtRc5DfYqT","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132300947"},"message":"\"replace\" is not an option. The options are: error|skip|force|overwrite|refresh. Do you mean \"force\"?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653003541,"metadata":{"github-id":"IC_kwDODBZtRc5DfY0d","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132301597"},"message":"i think `overwrite`","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653003576,"metadata":{"github-id":"IC_kwDODBZtRc5DfY4k","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132301860"},"message":"if it works the asset metadata should contain the voltageclampseries.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653003599,"metadata":{"github-id":"IC_kwDODBZtRc5DfY64","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132302008"},"message":"you can also test by using dandi ls locally on the nwb file","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653003741,"metadata":{"github-id":"IC_kwDODBZtRc5DfZKn","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132303015"},"message":"dandi ls seems to work:\n```\n(base) MacBook-Pro-3:sub-mouse-AAYYT bendichter$ dandi ls sub-mouse-AAYYT_ses-20180420-sample-2_slice-20180420-slice-2_cell-20180420-sample-2_icephys.nwb\n- age: P148D\n  cell_id: 20180420_sample_2\n  date_of_birth: 2017-11-23 00:00:00-05:00\n  experiment_description: Current clamp square\n  experimenter:\n  - Matteo Bernabucci\n  genotype: wt/wt\n  identifier: dcf5e2ab-2b96-492f-beb8-1f4dc6fabd52\n  institution: Baylor College of Medicine\n  keywords: null\n  lab: Tolias\n  nd_types:\n  - CreSubject\n  - CurrentClampSeries (79)\n  - CurrentClampStimulusSeries (79)\n  - DandiIcephysMetadata\n  - Device (161)\n  - IZeroClampSeries\n  - IntracellularElectrode (160)\n  - SweepTable\n  number_of_electrodes: 0\n  number_of_units: 0\n  nwb_version: 2.2.5\n  path: sub-mouse-AAYYT_ses-20180420-sample-2_slice-20180420-slice-2_cell-20180420-sample-2_icephys.nwb\n  related_publications: null\n  session_description: Current clamp square\n  session_id: 20180420_sample_2\n  session_start_time: 2018-04-20 00:00:00-04:00\n  sex: F\n  size: 9337840\n  slice_id: 20180420_slice_2\n  species: null\n  subject_id: mouse_AAYYT\n```\n\nHere is the description of the options:\n\n\u003e What to do if a file found existing on the\nserver.\n'skip' would skip the file,\n'force' - force reupload, 'overwrite' - force upload\nif either size or modification time differs;\n'refresh' - upload only if local\nmodification time is ahead of the remote.\n\noverwrite does not do anything because there is no difference in size or modification time. Should I try replace?","files":null},{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653003759,"metadata":{"github-id":"UCE_lALODBZtRc5DfZKnziNuV78"},"target":"31e40daeeb1f08447379a49a3a63d823e1a06e190d83fc8ca436f17d87473bcb","message":"dandi ls seems to work:\n```\n(base) MacBook-Pro-3:sub-mouse-AAYYT bendichter$ dandi ls sub-mouse-AAYYT_ses-20180420-sample-2_slice-20180420-slice-2_cell-20180420-sample-2_icephys.nwb\n- age: P148D\n  cell_id: 20180420_sample_2\n  date_of_birth: 2017-11-23 00:00:00-05:00\n  experiment_description: Current clamp square\n  experimenter:\n  - Matteo Bernabucci\n  genotype: wt/wt\n  identifier: dcf5e2ab-2b96-492f-beb8-1f4dc6fabd52\n  institution: Baylor College of Medicine\n  keywords: null\n  lab: Tolias\n  nd_types:\n  - CreSubject\n  - CurrentClampSeries (79)\n  - CurrentClampStimulusSeries (79)\n  - DandiIcephysMetadata\n  - Device (161)\n  - IZeroClampSeries\n  - IntracellularElectrode (160)\n  - SweepTable\n  number_of_electrodes: 0\n  number_of_units: 0\n  nwb_version: 2.2.5\n  path: sub-mouse-AAYYT_ses-20180420-sample-2_slice-20180420-slice-2_cell-20180420-sample-2_icephys.nwb\n  related_publications: null\n  session_description: Current clamp square\n  session_id: 20180420_sample_2\n  session_start_time: 2018-04-20 00:00:00-04:00\n  sex: F\n  size: 9337840\n  slice_id: 20180420_slice_2\n  species: null\n  subject_id: mouse_AAYYT\n```\n\nHere is the description of the options:\n\n\u003e What to do if a file found existing on the\nserver.\n'skip' would skip the file,\n'force' - force reupload, 'overwrite' - force upload\nif either size or modification time differs;\n'refresh' - upload only if local\nmodification time is ahead of the remote.\n\noverwrite does not do anything because there is no difference in size or modification time. Should I try force?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653004024,"metadata":{"github-id":"IC_kwDODBZtRc5DfZog","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132304928"},"message":"\u003e Should I try force?\n\nseems like that's the only option.","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653004142,"metadata":{"github-id":"IC_kwDODBZtRc5DfZ0J","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132305673"},"message":"yes, that works! There are ~15 datasets that need this. Should I go through and download then re-upload them?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653004884,"metadata":{"github-id":"IC_kwDODBZtRc5Dfa_I","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132310472"},"message":"\u003e Should I go through and download then re-upload them?\n\nthat would be the simplest option. \n\nsince this process only updates the metadata and not the blobs, it is possible to do this more programmatically by using remote reading of the nwb file. but i don't think there is an \"easy\" option for extracting metadata from a remote file.  @yarikoptic @jwodder any suggestions.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653006021,"metadata":{"github-id":"IC_kwDODBZtRc5DfdSS","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132319890"},"message":"https://github.com/datalad/datalad-fuse if datalad version of dandiset is up to date (we might be a few days behind due to bottleneck...)","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653006258,"metadata":{"github-id":"IC_kwDODBZtRc5Dfduq","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132321706"},"message":"how would this help with the metadata issue? Are you proposing that we continue to download and then re-upload, but do it instead through datalad?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653006688,"metadata":{"github-id":"IC_kwDODBZtRc5DfejW","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132325078"},"message":"If you use datalad-fuse and mount that dandiset, you don't need to download entire content. dandi upload would extract metadata and only needed blocks would be downloaded... But if size isn't an issue, I guess indeed download/reupload is an option","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653007651,"metadata":{"github-id":"IC_kwDODBZtRc5DfgeJ","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132332937"},"message":"I fixed the ones that I could but the issue is that I don't have write permission for most of the dandisets that have this problem. Also, several of them are quite recent. Is it possible that users are using an older version of the dandi-cli that is not properly extracting metadata?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653011268,"metadata":{"github-id":"IC_kwDODBZtRc5Dfnwh","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132362785"},"message":"Iirc we add metadata generatedBy or alike with version of dandi CLI , worth checking... Need to look at code - could be pynwb version related?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1653011277,"metadata":{"github-id":"UCE_lALODBZtRc5DfnwhziNu7oc"},"target":"3bcbfc4f6ee4fcebaec683a6f83567cab09fd23ce07ddb0f572b94ccb66f8d77","message":"Iirc we add metadata generatedBy or alike with version of dandi CLI , worth checking... Need to look at code - could it be pynwb version related?","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1653011500,"metadata":{"github-id":"IC_kwDODBZtRc5DfoIv","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132364335"},"message":"I doubt it. Those types haven't changed since 2.0. Also reposting the exact same files fixes the metadata issue on DANDI","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1653011508,"metadata":{"github-id":"IC_kwDODBZtRc5DfoJi","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1132364386"},"message":"i don't think we have turned prior versions bad, so some of the changes in the latest cli with respect to metadata extraction (issue that addressed neural data types with parentheses) are not in place and hence it is possible people are using version where the metadata is not as complete.\n\nregarding updating asset metadata, ideally this is something someone with admin privileges + datalad can do perhaps for all dandisets ;)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1657719918,"metadata":{"github-id":"IC_kwDODBZtRc5GhuKb","github-url":"https://github.com/dandi/dandi-cli/issues/1016#issuecomment-1183244955"},"message":"@bendichter is this issue still persist?  I feel like we might want some generic helper (thus possibly in a client, one of the service-commands) to re-extract and re-upload metadata using remote access (via fsspec so works for any file) for specific dandisets/assets.  I feel like we already did something like that in the glorious past but I bet it relied on data copy on drogon.","files":null}]}