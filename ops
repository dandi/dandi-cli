{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1739371574,"metadata":{"github-id":"I_kwDODBZtRc6pyCG3","github-url":"https://github.com/dandi/dandi-cli/issues/1575","origin":"github"},"title":"\"sense\" video files as for the quality of their compression, seekability, ...","message":"Came up in a meetup with @talmo re their experiences in SLEAP working with video recordings of behavioral data.  In their experience, many, if not most, videos coming from audio/video recording hardware would be either uncompressed or badly compressed, resulting in those recordings taking LOTS of space (placing the aspect of number of files aside for now).  For that reason in https://sleap.ai/help.html#does-my-data-need-to-be-in-a-particular-format they provide recommended settings for ffmpeg to see such files compressed:\n\n```\nffmpeg -y -i \"input.mp4\" -c:v libx264 -pix_fmt yuv420p -preset superfast -crf 23 \"output.mp4\"\n```\n\nSimilarly, for ReproNim's reprostim project, where we capture audio/video of presented to MRI experiment stimuli using cheap magewell capture card, and on a small underpowered hardware, with @vmdocua we specify default settings in https://github.com/ReproNim/reprostim/blob/master/src/reprostim-capture/videocapture/config.yaml#L105 for ffmpeg video component as\n\n```\n-c:v libx264 -flush_packets 1 -preset ultrafast -crf 18 -tune zerolatency -b:v 8M -maxrate 8M -bufsize 16M -vf setpts=PTS-STARTPTS\n```\n\nATM.\n\nIn DANDI we already have 15 dandisets with video (.mkv or .mp4; might have missed others, invocation was `for f in 00*; do find 00* -iname '*.avi' -o -iname '*.mkv'; done \u003e /tmp/videos.txt`)\n\n```shell\ndandi@drogon:/tmp$ grep -v '\\.git' videos.txt | sed -e  's,/.*,,g' | sort | uniq -c | sort -n | nl\n     1\t    810 000167\n     2\t    810 000360\n     3\t    810 000691\n     4\t    810 000892\n     5\t   4050 000689\n     6\t   4050 001190\n     7\t   7290 000576\n     8\t   7290 000727\n     9\t  12960 001172\n    10\t  15390 000624\n    11\t  51840 001084\n    12\t  66420 000568\n    13\t  93150 000231\n    14\t 400950 000540\n    15\t2011230 000559\n```\n\n(note  000559 contains over 2M files!) \n\nI think it would be \n\n- useful to provide some guidance at the time of validation/upload to ensure that videos uploaded to archive are appropriately compressed and we are not blowing up the size of the archive with loosely or uncompressed videos.  Yet to figure out usable procedures for that but could be pretty much taking a sample video and recompressing with \"recommended\" settings and seeing how well it compresses\n- reviewing current videos in the archive and issue such recommendations?","files":null}]}