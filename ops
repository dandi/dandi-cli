{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1645038075,"metadata":{"github-id":"I_kwDODBZtRc5D-beq","github-url":"https://github.com/dandi/dandi-cli/issues/913","origin":"github"},"title":"multithread digest'ing of zarr folders","message":"ATM, if I run `dandi digest` on a hot (was done before, so IO is fast) folder, `dandi digest` gets just 30% CPU busy and takes \u003e 20 sec, whenever a parallelized example for checksumming takes about x20 times less, and goes above 100% CPU.\n\n```\n(dandi-devel) jovyan@jupyter-yarikoptic:/shared/ngffdata$ time DANDI_CACHE=ignore dandi digest -d zarr-checksum test64.ngff/0/0/0/0\ntest64.ngff/0/0/0/0: 53ad9d9fe8b4f34882fdaea76599da22\n2022-02-16 18:51:44,202 [    INFO] Logs saved in /home/jovyan/.cache/dandi-cli/log/20220216185120Z-4990.log\n\nreal    0m24.034s\nuser    0m8.524s\nsys     0m5.120s\n(dandi-devel) jovyan@jupyter-yarikoptic:/shared/ngffdata$ time DANDI_CACHE=ignore dandi digest -d zarr-checksum test64.ngff/0/0/0/0\ntest64.ngff/0/0/0/0: 53ad9d9fe8b4f34882fdaea76599da22\n2022-02-16 18:52:24,406 [    INFO] Logs saved in /home/jovyan/.cache/dandi-cli/log/20220216185202Z-5127.log\n\nreal    0m22.499s\nuser    0m8.369s\nsys     0m6.190s\n\n(dandi-devel) jovyan@jupyter-yarikoptic:/shared/ngffdata$ time python /shared/io-utils/fastio_md5.py test64.ngff/0/0/0/0\nTotal: 7200\n\nreal    0m1.358s\nuser    0m1.545s\nsys     0m2.164s\n```\n\nrelated PR introducing multithreaded walk in fscacher (benefit is not yet 100% clear): https://github.com/con/fscacher/pull/67","files":null}]}