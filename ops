{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611260131,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NDkwOTc2Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-764909767"},"message":"\u003e add a function to validate metadata given provided json schema directory\n\nWhat format should this function take the metadata in?  Deserialized JSON?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1611263526,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NDk0NDYxNw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-764944617"},"message":"yes","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1611263571,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NDk0NTA2Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-764945067"},"message":"dandi-api does not do any schema validation yet. @AlmightyYakob has been working on the metadata editor which lives in dandiarchive, but I have no idea what schema he has been using.","files":null},{"type":3,"author":{"id":"be5d9cd197657770bbbabb5faa204fd4dcdcba01"},"timestamp":1611264573,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NDk1MzIwMA==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-764953200"},"message":"\u003e dandi-api does not do any schema validation yet. @AlmightyYakob has been working on the metadata editor which lives in dandiarchive, but I have no idea what schema he has been using.\n\nI'm using this version https://github.com/dandi/schema/blob/master/releases/1.0.0-rc1/dandiset.json","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611325074,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTQzMDQ2NA==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765430464"},"message":"@yarikoptic The asset and metadata samples in `test_metadata.py` do not validate against the JSON Schema; they appear to have various fields set to `None` that shouldn't be `None`.  What should be done about this?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1611328303,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTQ3MjAwNQ==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765472005"},"message":"could you please give some example(s)? most likely then they should be announced `Optional` and thus allow to be None, or am I misunderstanding?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611329522,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTQ4NzA2NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765487065"},"message":"@yarikoptic Example, from trying to validate the object in `test_dandimeta_migration`:\n\n```\nE   jsonschema.exceptions.ValidationError: None is not of type 'array'\nE\nE   Failed validating 'type' in schema['properties']['studyTarget']:\nE       {'description': 'What the study is related to',\nE        'items': {'anyOf': [{'format': 'uri',\nE                             'maxLength': 65536,\nE                             'minLength': 1,\nE                             'type': 'string'},\nE                            {'type': 'string'}]},\nE        'nskey': 'dandi',\nE        'title': 'Study Target',\nE        'type': 'array'}\nE\nE   On instance['studyTarget']:\nE       None\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1611331097,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTUwNjYxNg==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765506616"},"message":"aha -- so here it is `None` vs `array`.  While serializing, use `meta.json(exclude_unset=True, exclude_none=True)` - should help","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611331302,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTUwOTQ2MA==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765509460"},"message":"@yarikoptic With that change, I instead get the error \"`'citation' is a required property`\".  Apparently, a required field is missing.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1611332615,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTUyNjAzMw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765526033"},"message":"hm, I thought we would be failing at pydantic level... strange.  To move forward, let's make any such optional as well but with obvious annotation, e.g. via\n\n```diff\ndiff --git a/dandi/models.py b/dandi/models.py\nindex c08bc39..7ecae73 100644\n--- a/dandi/models.py\n+++ b/dandi/models.py\n@@ -16,6 +16,7 @@ from .model_types import (\n \n from .utils import name2title\n \n+TempOptional = Optional\n \n def create_enum(data):\n     \"\"\"Convert a JSON-LD enumeration to an Enum\"\"\"\n@@ -592,7 +593,7 @@ class DandiMeta(CommonModel):\n         min_items=1,\n     )\n \n-    citation: str = Field(readOnly=True, nskey=\"schema\")\n+    citation: TempOptional[str] = Field(readOnly=True, nskey=\"schema\")\n \n     # From assets\n     assetsSummary: AssetsSummary = Field(readOnly=True, nskey=\"dandi\")\n```","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611333582,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTUzODM3Nw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765538377"},"message":"@yarikoptic I've now run into this error, and I'm not sure what part should be modified to address it:\n\n```\nE   jsonschema.exceptions.ValidationError: 'CC-BY-4.0' is not of type 'array'\nE       \nE   Failed validating 'type' in schema['properties']['license']:\nE       {'description': 'License of item.',\nE        'items': {'$ref': '#/definitions/LicenseType'},\nE        'nskey': 'schema',\nE        'title': 'License',\nE        'type': 'array'}\nE\nE   On instance['license']:\nE       'CC-BY-4.0'\n```","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1611335411,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTU1OTk2OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765559969"},"message":"@jwodder - feel free to make up a fake dandiset that validates. in this instance the input should be a list i believe.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611335615,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTU2MTg2OA==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765561868"},"message":"@satra Shouldn't the Dandiset that's already used in the tests be the one that should validate?  Is the problem that the input to `migrate2newschema()` is wrong, that `migrate2newschema()` doesn't convert its input correctly, or that the field type is wrong?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1611335755,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTU2MzI3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765563279"},"message":"the current tests all use unvalidated. for them to validate, we would need to fix the inputs and/or the conversion piece. would probably be good to move towards a valid, even if made up, input.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1611340947,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTYxMTgwNw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765611807"},"message":"@satra Why is `AssetMeta.contentSize` defined as a `str` instead of an `int`?  Note that `nwb2asset()` currently sets that field to an integer.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1611341905,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTYyMDQ5Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765620493"},"message":"good catch. actually it should be defined as https://pydantic-docs.helpmanual.io/usage/types/#bytesize .","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1611342419,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc2NTYyNDg0MA==","github-url":"https://github.com/dandi/dandi-cli/issues/332#issuecomment-765624840"},"message":"\u003e @yarikoptic I've now run into this error, and I'm not sure what part should be modified to address it:\n\u003e \n\u003e ```\n\u003e E   jsonschema.exceptions.ValidationError: 'CC-BY-4.0' is not of type 'array'\n\u003e E       \n\u003e E   Failed validating 'type' in schema['properties']['license']:\n\u003e E       {'description': 'License of item.',\n\nI think conversion and/or test should be adjusted so that license is a list not a singular entity.  Alternatively we could may be adjust model to allow for a singular or a List of licenses (but better not for now)","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1611360578,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDI0MDg1NjQ5Ng=="},"status":2}]}