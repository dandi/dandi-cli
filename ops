{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1723564256,"metadata":{"github-id":"IC_kwDODBZtRc6ISnzm","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2286583014"},"message":"\u003e Do not just use docker image, install `master` of dandi-archive into it (I think we do smth similar already)\n\nThe Docker image is built from dandi-archive's `master` already.\n\n\u003e Before cleaning up the env in the fixture taking care about docker compose, connect to postgres DB and dump `Audit` table as a list of json records into the file pointed to by `DANDI_TESTS_AUDIT_JSON` env var\n\nAnd then what?  Is this feature going to be used as part of the GitHub Actions CI — in which case, should the file be uploaded as a build artifact?\n\nAlso, how exactly is the dump supposed to be performed?  [`pg_dump`](https://www.postgresql.org/docs/current/app-pgdump.html) doesn't have a JSON option, and I do not want to add a Python database library to dandi-cli's test dependencies just for this feature, which I honestly don't expect to be used very much.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723564588,"metadata":{"github-id":"IC_kwDODBZtRc6ISqkq","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2286594346"},"message":"\u003e \u003e Before cleaning up the env in the fixture taking care about docker compose, connect to postgres DB and dump `Audit` table as a list of json records into the file pointed to by `DANDI_TESTS_AUDIT_JSON` env var\n\u003e \n\u003e And then what? Is this feature going to be used as part of the GitHub Actions CI — in which case, should the file be uploaded as a build artifact?\n\nnah, just locally ATM\n\n\u003e Also, how exactly is the dump supposed to be performed? [pg_dump](https://www.postgresql.org/docs/current/app-pgdump.html) doesn't have a JSON option, and I do not want to add a Python database library to dandi-cli's test dependencies just for this feature, which I honestly don't expect to be used very much.\n\ncould you just add it to some optional extras_require (e.g. `dbdump`)?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1723564744,"metadata":{"github-id":"IC_kwDODBZtRc6ISrzh","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2286599393"},"message":"@yarikoptic \n\n\u003e \u003e Also, how exactly is the dump supposed to be performed? [pg_dump](https://www.postgresql.org/docs/current/app-pgdump.html) doesn't have a JSON option, and I do not want to add a Python database library to dandi-cli's test dependencies just for this feature, which I honestly don't expect to be used very much.\n\u003e \n\u003e could you just add it to some optional extras_require (e.g. `dbdump`)?\n\nYou're focusing on the wrong part of my comment.  How do you want the dump to be performed?  Or are you trying to say that it should be done all in Python?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723565048,"metadata":{"github-id":"IC_kwDODBZtRc6ISuRr","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2286609515"},"message":"I thought that indeed we could just connect to DB from python and perform the dump. Is that too tricky?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1723565140,"metadata":{"github-id":"IC_kwDODBZtRc6ISvAk","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2286612516"},"message":"@yarikoptic If you're OK with CSV instead of JSON, it would be far easier to just do a `SELECT` via [`psql`](https://www.postgresql.org/docs/current/app-psql.html) instead of futzing with DB libraries.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723661931,"metadata":{"github-id":"IC_kwDODBZtRc6IeK_j","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2289610723"},"message":"sure, csv would be just fine!","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723662057,"metadata":{"github-id":"IC_kwDODBZtRc6IeL37","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2289614331"},"message":"note though that `details` is a json record so would be full of `,` so within csv those should be handled appropriately (not just dumped via ad-hoc `print`).","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723734025,"metadata":{"github-id":"CE_lADODBZtRc6S2KHazwAAAAM8V5d2"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1725905723,"metadata":{"github-id":"IC_kwDODBZtRc6LZwmy","github-url":"https://github.com/dandi/dandi-cli/issues/1484#issuecomment-2338785714"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.63.1`](https://github.com/dandi/dandi-cli/releases/tag/0.63.1) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1725905723,"metadata":{"github-id":"LE_lADODBZtRc6S2KHazwAAAANNphb6"},"added":["released"],"removed":[]}]}