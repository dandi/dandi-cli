{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1659384606,"metadata":{"github-id":"I_kwDODBZtRc5O-Jw0","github-url":"https://github.com/dandi/dandi-cli/issues/1089","origin":"github"},"title":"Allow to extract basic metadata such as size + date modified from git/annex instead of a physical file","message":"whenever we just want to extract/update metadata possibly based just on what we have in the filename/git/git-annex we would not have a blob available.  should we allow for extraction of that metadata from git/annex instead?\n\n\u003cdetails\u003e\n\u003csummary\u003ethat is the code spot\u003c/summary\u003e \n\n```patch\ndiff --git a/dandi/metadata.py b/dandi/metadata.py\nindex c1a13a6..f387726 100644\n--- a/dandi/metadata.py\n+++ b/dandi/metadata.py\n@@ -925,18 +925,26 @@ def add_common_metadata(\n     start_time: datetime,\n     end_time: datetime,\n     digest: Optional[Digest] = None,\n+    include_content_based: bool = False,\n ) -\u003e None:\n     if digest is not None:\n         metadata[\"digest\"] = digest.asdict()\n     else:\n         metadata[\"digest\"] = {}\n     metadata[\"dateModified\"] = get_utcnow_datetime()\n-    metadata[\"blobDateModified\"] = ensure_datetime(os.stat(path).st_mtime)\n-    if metadata[\"blobDateModified\"] \u003e metadata[\"dateModified\"]:\n-        lgr.warning(\n-            \"mtime %s of %s is in the future\", metadata[\"blobDateModified\"], path\n-        )\n-    metadata[\"contentSize\"] = os.path.getsize(path)\n+    if include_content_based:\n+        metadata[\"blobDateModified\"] = ensure_datetime(os.stat(path).st_mtime)\n+        if metadata[\"blobDateModified\"] \u003e metadata[\"dateModified\"]:\n+            lgr.warning(\n+                \"mtime %s of %s is in the future\", metadata[\"blobDateModified\"], path\n+            )\n+        metadata[\"contentSize\"] = os.path.getsize(path)\n+    else:\n+        # TODO: get for annexed stuff\n+        # blobDateModified -- commit date based on git log -1 ?  (see\n+        # https://github.com/datalad/datalad-metalad/issues/257)\n+        # size -- from key\n+        pass\n     metadata.setdefault(\"wasGeneratedBy\", []).append(\n         get_generator(start_time, end_time)\n     )\n\n```\n\u003c/details\u003e","files":null}]}