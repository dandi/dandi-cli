{"version":2,"ops":[{"type":1,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1744663853,"metadata":{"github-id":"I_kwDODBZtRc6yd36W","github-url":"https://github.com/dandi/dandi-cli/issues/1611","origin":"github"},"title":"Validation failing for most recent 0.67.3 release on assets not listed","message":"This error was observed by @ayendiki when uploading data to LINC Archive on version `0.67.3` -- all issues were resolved once downgrading to `0.67.0` -- both commands failed:\n\n```\ndandi upload -i linc 000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz\n```\n\nand \n\n```\nDANDI_DEVEL=1 dandi upload -i linc --validation skip 000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz\n```\n\nInvestigating now -- but the errors that came about signaled that BIDS validation was occuring on all files in the directory, even though upload was centered purely on `000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz` with a error shown down below:\n\n```\n$ dandi upload -i linc 000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz\n2025-04-14 15:19:54,352 [    INFO] Found 2 files to consider\n$\u003c2\u003ePATH$\u003c2\u003e $\u003c2\u003e$\u003c2\u003ePATH$\u003c2\u003e                                                                                       $\u003c2\u003eSIZE$\u003c2\u003e    $\u003c2\u003eERRORS$\u003c2\u003e $\u003c2\u003ePROGRESS$\u003c2\u003e $\u003c2\u003eSTATUS$\u003c2\u003e $\u003c2\u003eMESSAGE$$\u003c2\u003e$\u003c2\u003ePATH$\u003c2\u003e                                                                                       $\u003c2\u003eSIZE$\u003c2\u003e    $\u003c2\u003eERRORS$\u003c2\u003e $\u003c2\u003ePROGRESS$\u003c2\u003e $\u003c2\u003eSTATUS$\u003c2\u003e    $\u003c2\u003eM$\u003c2\u003e$\u003c2\u003ePATH$\u003c2\u003e                                                                                       $\u003c2\u003eSIZE$\u003c2\u003e    $\u003c2\u003eERRORS$\u003c2\u003e $\u003c2\u003ePROGRESS$\u003c2\u003e $\u003c2\u003eSTATUS$\u003c2\u003e           $\u003c2\u003eMESSAGE$\u003c2\u003e                                                                     1.6 kB                  skipped   should be edited online\n$\u003c2\u003e$\u003c2\u003edandiset.yaml$\u003c2\u003e                                                                              1.6 kB                  skipped          should be edited online\n$\u003c2\u003e$\u003c2\u003ederivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz$\u003c2\u003e 4.9 MB                  pre-validating\nSummary:                                                                                   4.9 MB                  1 skipped        1 should be edited online\n                                                                                                                   1 pre-validating\n--- Logging error ---\nTraceback (most recent call last):\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 1160, in emit\n    msg = self.format(record)\n          ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 999, in format\n    return fmt.format(record)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 703, in format\n    record.message = record.getMessage()\n                     ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 392, in getMessage\n    msg = msg % self.args\n          ~~~~^~~~~~~~~~~\nValueError: unsupported format character '`' (0x60) at index 25\nCall stack:\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/threading.py\", line 1032, in _bootstrap\n    self._bootstrap_inner()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/threading.py\", line 1075, in _bootstrap_inner\n    self.run()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/threading.py\", line 1012, in run\n    self._target(*self._args, **self._kwargs)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/concurrent/futures/thread.py\", line 92, in _worker\n    work_item.run()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/upload.py\", line 264, in process_path\n    validation_statuses = dfile.get_validation_errors()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 285, in get_validation_errors\n    return GenericAsset.get_validation_errors(\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bases.py\", line 185, in get_validation_errors\n    asset = self.get_metadata(digest=self._DUMMY_DIGEST)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 199, in get_metadata\n    metadata = self.bids_dataset_description.get_asset_metadata(self)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 128, in get_asset_metadata\n    self._validate()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 90, in _validate\n    results = validate_bids(self.bids_root)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/validate.py\", line 47, in validate_bids\n    validation_result = validate_bids_(paths, exclude_files=[\"dandiset.yaml\"])\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/bidsschematools/validator.py\", line 644, in validate_bids\n    validation_result = validate_all(\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/bidsschematools/validator.py\", line 432, in validate_all\n    lgr.debug(\"\\t* `%s`, with pattern: `%`\", target_path, target_regex)\nMessage: '\\t* `%s`, with pattern: `%`'\nArguments: ('/autofs/space/aspasia_002/users/linc/000003/participants.tsv', '(?:.*/)?(?P\u003cpath\u003edataset_description\\\\.json)(?:/.*)?\\\\Z')\n--- Logging error ---\nTraceback (most recent call last):\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 1160, in emit\n    msg = self.format(record)\n          ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 999, in format\n    return fmt.format(record)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 703, in format\n    record.message = record.getMessage()\n                     ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 392, in getMessage\n    msg = msg % self.args\n```","files":null}]}