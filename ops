{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1711978050,"metadata":{"github-id":"IC_kwDODBZtRc54-6p7","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2029759099"},"message":"@yarikoptic My investigations found the following Archive bugs which are probably to blame:\n\n* https://github.com/dandi/dandi-archive/issues/1914\n* https://github.com/dandi/dandi-archive/issues/1915","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1711988046,"metadata":{"github-id":"IC_kwDODBZtRc55AID8","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2030076156"},"message":"@yarikoptic The Archive bugs appear to be fixed now.  Are you still having any problems deleting?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1711990256,"metadata":{"github-id":"IC_kwDODBZtRc55AZD9","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2030145789"},"message":"it seems to look consistent and matches the number now:\n\n```\n❯ dandi delete dandi://dandi/000876/code/venvs/\nDelete 28259 assets on server from Dandiset 000876? [y/N]: N\n2024-04-01 12:31:50,822 [    INFO] Logs saved in /home/yoh/.local/state/dandi-cli/log/20240401160956Z-640400.log\n\n❯ dandi delete dandi://dandi/000876/code/venvs/\nDelete 28259 assets on server from Dandiset 000876? [y/N]: \n```\n\nI am running it now.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1711990256,"metadata":{"github-id":"CE_lADODBZtRc6EHzxyzwAAAALd6uR1"},"status":2},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1711996830,"metadata":{"github-id":"IC_kwDODBZtRc55BHTL","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2030335179"},"message":"```\nSummary:                                                            28259 Deleted  \n```\nbut I still see \nhttps://dandiarchive.org/dandiset/000876/draft/files?location=code%2Fvenvs\u0026page=1\nin the browser ...   rerunning gives me\n\n```\n❯ dandi delete dandi://dandi/000876/code/venvs/\nDelete 4145 assets on server from Dandiset 000876? [y/N]: \n```\n\nso seems not working \"fully\". running this one again... but it seems that issue is not really resolved fully thus reopening","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1711996830,"metadata":{"github-id":"REE_lADODBZtRc6EHzxyzwAAAALd_d87"},"status":1},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1711998163,"metadata":{"github-id":"IC_kwDODBZtRc55BPPX","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2030367703"},"message":"and after that --\n```\n❯ dandi delete dandi://dandi/000876/code/venvs/\nDelete 636 assets on server from Dandiset 000876? [y/N]: \n```\n\nFTR the prior log was /home/yoh/.local/state/dandi-cli/log/20240401183902Z-667577.log \n\n```shell\n❯ grep 'Response: ' /home/yoh/.local/state/dandi-cli/log/20240401183902Z-667577.log | sed -e 's,.*:,,g' | sort | uniq -c\n     44  200\n   4145  204\n```\nso we got 4145 204 responses... and in previous\n\n```shell\n❯ grep 'Response: ' /home/yoh/.local/state/dandi-cli/log/20240401163152Z-648330.log | sed -e 's,.*:,,g' | sort | uniq -c\n    285  200\n  28259  204\n```\n\n\nmay be not all just were removed on server side ??  I thought I would find duplicate DELETE requests between two runs but no:\n\n```\n❯ grep 'DELETE https://api.dandiarchive.org/api/dandisets/000876/versions/draft/' /home/yoh/.local/state/dandi-cli/log/20240401163152Z-648330.log /home/yoh/.local/state/dandi-cli/log/20240401183902Z-667577.log | sed -e 's,.*DELETE,,g' | sort | uniq -c | sort -n | nl | tail -n 3\n 32402\t      1  https://api.dandiarchive.org/api/dandisets/000876/versions/draft/assets/fff6ae06-d8b1-4fb2-88c2-91231583fec5/\n 32403\t      1  https://api.dandiarchive.org/api/dandisets/000876/versions/draft/assets/fffc0e83-b5ec-43f3-9851-c8ce83f18376/\n 32404\t      1  https://api.dandiarchive.org/api/dandisets/000876/versions/draft/assets/ffff4674-212c-4e41-87ef-497e830fd0d0/\n```\nso it seems that we have unique asset ids between those two runs... odd.  needs more troubleshooting -- I am not running another `delete` so you could try... let me know if you think those log files would come handy","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1712062550,"metadata":{"github-id":"IC_kwDODBZtRc55HWv9","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2031971325"},"message":"@yarikoptic If you run the `dandi delete` command now but don't confirm the deletion, how many assets does the command say it'll delete?  I'm getting 7089, which appears to be the correct amount.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1712062943,"metadata":{"github-id":"IC_kwDODBZtRc55HaAm","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2031984678"},"message":"yikes, it grew indeed:\n```shell\n❯ dandi delete dandi://dandi/000876/code/venvs/\nDelete 7089 assets on server from Dandiset 000876? [y/N]: \n```\n@TheChymera is your upload process still running by some chance?  \n@jwodder might be worth checking dandi-api logs under `/mnt/backup/dandi/heroku-logs/dandi-api` to possibly gain more insight.\nreminder: I will be traveling, please figure it out - I believe if @TheChymera adds you @jwodder as co-owner on the dandiset, you should be able to perform those actions too!","files":null},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1712085206,"metadata":{"github-id":"IC_kwDODBZtRc55KzRn","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2032874599"},"message":"@yarikoptic yes, I startded it again to see if I can reproduce the error.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1712085224,"metadata":{"github-id":"UCE_lALODBZtRc55KzRnzkNcuUc"},"target":"c00ea8ca623ab490f059adf272d8892038399a45098075f3d5f651445f12f9fc","message":"@yarikoptic yes, I startded it again to see if I can reproduce the error, but if finished now, and yes, I get the same error.","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1712085235,"metadata":{"github-id":"UCE_lALODBZtRc55KzRnzkNcukg"},"target":"c00ea8ca623ab490f059adf272d8892038399a45098075f3d5f651445f12f9fc","message":"@yarikoptic yes, I started it again to see if I can reproduce the error, but if finished now, and yes, I get the same error.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1712330787,"metadata":{"github-id":"IC_kwDODBZtRc55mUKG","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040087174"},"message":"@yarikoptic I see logs of assets still being uploaded to 000876 on April 1 around 16:00 EDT, when you were running `dandi delete`, which seems to confirm that what happened was that @TheChymera was still uploading assets while you were deleting them.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1712345263,"metadata":{"github-id":"IC_kwDODBZtRc55n5PQ","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040501200"},"message":"Uff... @TheChymera - can you then now remove those assets in one try?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1712345309,"metadata":{"github-id":"IC_kwDODBZtRc55n5d_","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040502143"},"message":"I meant your code/venvs, not entire dandiset","files":null},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1712349491,"metadata":{"github-id":"IC_kwDODBZtRc55oQR8","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040595580"},"message":"ok","files":null},{"type":6,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1712349567,"metadata":{"github-id":"UCE_lALODBZtRc55oQR8zkOj1-w"},"target":"0c2b570ddb11904de0b38069548664c080ec41e06a0aaf70f21a38025e7fa3ed","message":"ok, deleting right now. Seems to be working thus far.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1712351190,"metadata":{"github-id":"IC_kwDODBZtRc55oXs9","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040625981"},"message":"and did it work out?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1712351294,"metadata":{"github-id":"IC_kwDODBZtRc55oYJi","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040627810"},"message":"ok, it seems that now lists 0 assets.  let's assume resolved.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1712351294,"metadata":{"github-id":"CE_lADODBZtRc6EHzxyzwAAAALh3KYA"},"status":2},{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1712363961,"metadata":{"github-id":"IC_kwDODBZtRc55pI9j","github-url":"https://github.com/dandi/dandi-cli/issues/1426#issuecomment-2040827747"},"message":"Yep, it worked.","files":null}]}