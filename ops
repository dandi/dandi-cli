{"version":2,"ops":[{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1585873242,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDMxOTQzODMzMTg="},"added":["enhancement"],"removed":[]},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1585873291,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwODE2MjQzNA==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-608162434"},"message":"this is the relevant dictionary to re-order / update: https://github.com/dandi/dandi-cli/blob/master/dandi/organize.py#L23","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1585873421,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwODE2MzExMA==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-608163110"},"message":"also if a disambiguating key is the same at a given level, it could be automatically removed. so for example if session was the same for all files within a subject, it would not be used in the filename.\n\nperhaps this already happens, but after ben fixes the id's, we should check.","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1586127887,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwOTQ5NDc2NA==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-609494764"},"message":"So for the case of the Tolias lab, here are the IDs as I receive them:\n\n ... | Mouse | Slice | Cell\n-- | -- | -- | --\n1310 | mouse_ZNDVW | 20191108_slice_4 | 20191108_sample_4\n1311 | mouse_ZNDVW | 20191108_slice_5 | 20191108_sample_5\n1312 | mouse_YAVWS | 20191114_slice_1 | 20191114_sample_1\n1313 | mouse_YAVWS | 20191114_slice_2 | 20191114_sample_2\n1314 | mouse_YAVWS | 20191114_slice_2 | 20191114_sample_3\n1315 | mouse_YAVWS | 20191114_slice_3 | 20191114_sample_4\n1316 | mouse_YAVWS | 20191114_slice_4 | 20191114_sample_5\n1317 | mouse_YAVWS | 20191114_slice_6 | 20191114_sample_7\n1318 | mouse_YAVWS | 20191114_slice_7 | 20191114_sample_8\n1319 | mouse_YAVWS | 20191114_slice_8 | 20191114_sample_9\n\nSo how should be restructure these? Keep in mind, this is part of a cross-modality metadata table, and changing any of these will make it hard to match up with other sources. I think we may be creating more problems than it is worth by changing any of these metadata values. If our scope structure is dandiset \u003e subject \u003e slice \u003e cell, then this could transform to:\n\n ... | subject_id | slice_id | cell_id\n-- | -- | -- | --\n1310 | ZNDVW | 4 | 1\n1311 | ZNDVW | 5 | 1\n1312 | YAVWS | 1 | 1\n1313 | YAVWS | 2 | 1\n1314 | YAVWS | 2 | 2\n1315 | YAVWS | 3 | 1\n1316 | YAVWS | 4 | 1\n1317 | YAVWS | 6 | 1\n1318 | YAVWS | 7 | 1\n1319 | YAVWS | 8 | 1\n\nIf I understand @satra correctly, I think this is what you want. We could start counting at 0 too if we want to get really crazy. The way they give it to us, it is entirely denormalized and all of the ids are unique (scoped to the dandiset). This new way, not only have we changed all of the id's, but also they will need to do a 3-way concatenation to recover unique ids (subject_id+slice_id+cell_id). I am of course capable of making this change, but I would not expect the Tolias Lab to be enthusiastic about this. We'd also have to convince BICCN and the other repos to use this convention. Thoughts? Do we want to move forward with the change as described above, or am I misunderstanding something?","files":null},{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1586127887,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzYzMDk3Nzg0"},"target":"a3d12a3e1d663b149237ebad2f4c448664cad5a44d21d26519bd2c1a30ab5d68","message":"So for the case of the Tolias lab, here are the IDs as I receive them:\n\n ... | Mouse | Slice | Cell\n-- | -- | -- | --\n1310 | mouse_ZNDVW | 20191108_slice_4 | 20191108_sample_4\n1311 | mouse_ZNDVW | 20191108_slice_5 | 20191108_sample_5\n1312 | mouse_YAVWS | 20191114_slice_1 | 20191114_sample_1\n1313 | mouse_YAVWS | 20191114_slice_2 | 20191114_sample_2\n1314 | mouse_YAVWS | 20191114_slice_2 | 20191114_sample_3\n1315 | mouse_YAVWS | 20191114_slice_3 | 20191114_sample_4\n1316 | mouse_YAVWS | 20191114_slice_4 | 20191114_sample_5\n1317 | mouse_YAVWS | 20191114_slice_6 | 20191114_sample_7\n1318 | mouse_YAVWS | 20191114_slice_7 | 20191114_sample_8\n1319 | mouse_YAVWS | 20191114_slice_8 | 20191114_sample_9\n\nSo how should we restructure these? Keep in mind, this is part of a cross-modality metadata table, and changing any of these will make it hard to match up with other sources. I think we may be creating more problems than it is worth by changing any of these metadata values. If our scope structure is dandiset \u003e subject \u003e slice \u003e cell, then this could transform to:\n\n ... | subject_id | slice_id | cell_id\n-- | -- | -- | --\n1310 | ZNDVW | 4 | 1\n1311 | ZNDVW | 5 | 1\n1312 | YAVWS | 1 | 1\n1313 | YAVWS | 2 | 1\n1314 | YAVWS | 2 | 2\n1315 | YAVWS | 3 | 1\n1316 | YAVWS | 4 | 1\n1317 | YAVWS | 6 | 1\n1318 | YAVWS | 7 | 1\n1319 | YAVWS | 8 | 1\n\nIf I understand @satra correctly, I think this is what you want. We could start counting at 0 too if we want to get really crazy. The way they give it to us, it is entirely denormalized and all of the ids are unique (scoped to the dandiset). This new way, not only have we changed all of the id's, but also they will need to do a 3-way concatenation to recover unique ids (subject_id+slice_id+cell_id). I am of course capable of making this change, but I would not expect the Tolias Lab to be enthusiastic about this. We'd also have to convince BICCN and the other repos to use this convention. Thoughts? Do we want to move forward with the change as described above, or am I misunderstanding something?","files":null},{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1586127902,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzYzMDk3ODAx"},"target":"a3d12a3e1d663b149237ebad2f4c448664cad5a44d21d26519bd2c1a30ab5d68","message":"So for the case of the Tolias lab, here are the IDs as I received them:\n\n ... | Mouse | Slice | Cell\n-- | -- | -- | --\n1310 | mouse_ZNDVW | 20191108_slice_4 | 20191108_sample_4\n1311 | mouse_ZNDVW | 20191108_slice_5 | 20191108_sample_5\n1312 | mouse_YAVWS | 20191114_slice_1 | 20191114_sample_1\n1313 | mouse_YAVWS | 20191114_slice_2 | 20191114_sample_2\n1314 | mouse_YAVWS | 20191114_slice_2 | 20191114_sample_3\n1315 | mouse_YAVWS | 20191114_slice_3 | 20191114_sample_4\n1316 | mouse_YAVWS | 20191114_slice_4 | 20191114_sample_5\n1317 | mouse_YAVWS | 20191114_slice_6 | 20191114_sample_7\n1318 | mouse_YAVWS | 20191114_slice_7 | 20191114_sample_8\n1319 | mouse_YAVWS | 20191114_slice_8 | 20191114_sample_9\n\nSo how should we restructure these? Keep in mind, this is part of a cross-modality metadata table, and changing any of these will make it hard to match up with other sources. I think we may be creating more problems than it is worth by changing any of these metadata values. If our scope structure is dandiset \u003e subject \u003e slice \u003e cell, then this could transform to:\n\n ... | subject_id | slice_id | cell_id\n-- | -- | -- | --\n1310 | ZNDVW | 4 | 1\n1311 | ZNDVW | 5 | 1\n1312 | YAVWS | 1 | 1\n1313 | YAVWS | 2 | 1\n1314 | YAVWS | 2 | 2\n1315 | YAVWS | 3 | 1\n1316 | YAVWS | 4 | 1\n1317 | YAVWS | 6 | 1\n1318 | YAVWS | 7 | 1\n1319 | YAVWS | 8 | 1\n\nIf I understand @satra correctly, I think this is what you want. We could start counting at 0 too if we want to get really crazy. The way they give it to us, it is entirely denormalized and all of the ids are unique (scoped to the dandiset). This new way, not only have we changed all of the id's, but also they will need to do a 3-way concatenation to recover unique ids (subject_id+slice_id+cell_id). I am of course capable of making this change, but I would not expect the Tolias Lab to be enthusiastic about this. We'd also have to convince BICCN and the other repos to use this convention. Thoughts? Do we want to move forward with the change as described above, or am I misunderstanding something?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1586126920,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwOTQ5Nzg4OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-609497889"},"message":"i would keep the cell id as whatever the lab wants to call it for now. especially because that is what would link presently to the other archives.   for this dataset, iirc they didn't have subject or slice ids, only cell ids to begin with.  the original filename looked like 20191108_sample_4.nwb\n\nso a file could look like (if i were interpreting these values)\n`sub-ZNDVW_ses-20191108_slice-4_cell-20191108_sample_4.nwb`\n\nbut if ses and slice are not helping with disambiguation within a subject it should simply look like:\n`sub-ZNDVW_cell-20191108_sample_4.nwb`\n\nso i don't want to enforce the values of those keys to the labs. i want a simple principle that says:\n1. `sub` is mandatory\n2. the rest are provided in order to disambiguate the filename as necessary and if my suggestion in this issue is implemented, then users will get to use what the disambiguating key order is.\n3. try not to encode too much provenance into the value. keep the value simple.\n4. the values of these keys should be in the nwb file.\n\nyes, in the ideal world folks would label their metadata in a consistent way - unique id (not necessarily uuid) for subject, slice, and cell -  and not include additional metadata into every key (e.g., datestamp or species) \n\nany uuid should be up to the data format and the archive not the lab.","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1586128195,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwOTUwMDUzMA==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-609500530"},"message":"OK so I'm glad I checked because I was misunderstanding. It sounds like we will not be changing IDs at all and this is all a matter of `dandi organize` settings. @yarikoptic looks like the ball is in your court here.","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1586129089,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwOTUwMjQ5Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-609502496"},"message":"Though to be clear, given the current way the metadata is, the filename would be\n `sub-mouse_ZNDVW_cell-20191108_sample_4.nwb`. Not perfect but much better than it is now.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1586198482,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYwOTk2ODY1Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-609968656"},"message":"\u003e so a file could look like (if i were interpreting these values)\n\u003e `sub-ZNDVW_ses-20191108_slice-4_cell-20191108_sample_4.nwb`\n \n(un)fortunately not -- `_` is a separator between `_key-value` pairs. In https://github.com/dandi/dandi-cli/blob/master/dandi/organize.py#L221 we sanitize values by replacing `_` with `-`, so should become something (I might have failed to parse now the boundaries above, since `slice` seems to not have simple index `4`) like:\n\n`sub-ZNDVW_ses-20191108_slice-4_cell-20191108-sample-4.nwb`.\n\nIt seems to such cases what could work is using the \"lowest\" level, here would be `cell` if it is sufficient to disambiguate between all the files, and thus (if we relax further to not make ses required):\n\n```shell\n`sub-ZNDVW_cell-20191108-sample-4.nwb`.\n```\n\nWith above sanitization though - we should \n\n- make it clear that metadata in file names might not 100% correspond to the metadata in the files.  Actual values should be picked up from the metadata within files.\n- recommend not using `_` (and other tricky symbols and spaces ?!) in the metadata values.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1586210492,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMDA2MDE4Mw==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-610060183"},"message":"@yarikoptic - so should sub be mandatory in the filename? i don't have strong feelings about this, but would be willing to leave this as optional to the user if we have a sub folder.\n\nsecond, do we deploy ordering option to user and use the simplest disambiguation within a folder? i.e. if ses doesn't matter across files in a folder it gets removed.\n\nalso how would we handle incremental updates?  so today ses doesn't matter, but tomorrow it does, etc.,.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1586213028,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMDA3NDk3NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-610074975"},"message":"\u003e @yarikoptic - so should sub be mandatory in the filename? i don't have strong feelings about this, but would be willing to leave this as optional to the user if we have a sub folder.\n\nwell, that is what I was proposing also in the early days of BIDS - to avoid duplication etc.  I have love/hate feeling to having `sub` and `ses` in both directories structure and filename.  On one hand -- redundant.  On another, I could just copy/share some (selected) files and not worry about renaming or placing them into subfolders to disambiguate.  With reasonable subject ids, `sub` usually does not add much to the filename length. I would prefer to avoid it to be \"optional\" but rather prefer for us to decide one way or another.\n\n\u003e second, do we deploy ordering option to user and use the simplest disambiguation within a folder? i.e. if ses doesn't matter across files in a folder it gets removed.\n\nsorry -- not entirely following on what \"ordering option\"?  I think the order of the fields is pretty much from larger to smaller (whole subject -\u003e session -\u003e tissue -\u003e cell ) and I do not think so far we saw need for an alternative order.\n\n\u003e also how would we handle incremental updates? so today ses doesn't matter, but tomorrow it does, etc.,.\n\nthat is exactly the concern I had against \"minimized\" version or allowing any other optional flexibility.  ATM, besides disambiguation via .nwb object id (before might not needed, then becomes needed or vise versa if files acquire new metadata) everything is consistent.  You can incrementally `organize` into an existing dandiset an additional file, and it would take its place in the right location, as if when you reorganized full collection of files. In case of symlink or hardlink file mode, it is quite feasible to just `rm sub-*; dandi organize -d . /path/to/full-collection` quickly, thus to do incremental via full \"redo\".  But then users might not see explicitly what actually has changed/got renamed.  I have now added a [comments to an existing issue](https://github.com/dandi/dandi-cli/issues/47#issuecomment-610074164) on that topic.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1586213028,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzYzMzc5NjM3"},"target":"0618d868d9f39345cb460b0ba48d19e1d036470caa37bc0b9528ddfb223e071c","message":"\u003e @yarikoptic - so should sub be mandatory in the filename? i don't have strong feelings about this, but would be willing to leave this as optional to the user if we have a sub folder.\n\nwell, that is what I was proposing also in the early days of BIDS - to avoid duplication etc.  I now have love/hate feeling to having `sub` and `ses` in both directories structure and filename.  On one hand -- redundant.  On another, I could just copy/share some (selected) files and not worry about renaming or placing them into subfolders to disambiguate.  With reasonable subject ids, `sub` usually does not add much to the filename length. I would prefer to avoid it to be \"optional\" but rather prefer for us to decide one way or another.\n\n\u003e second, do we deploy ordering option to user and use the simplest disambiguation within a folder? i.e. if ses doesn't matter across files in a folder it gets removed.\n\nsorry -- not entirely following on what \"ordering option\"?  I think the order of the fields is pretty much from larger to smaller (whole subject -\u003e session -\u003e tissue -\u003e cell ) and I do not think so far we saw need for an alternative order.\n\n\u003e also how would we handle incremental updates? so today ses doesn't matter, but tomorrow it does, etc.,.\n\nthat is exactly the concern I had against \"minimized\" version or allowing any other optional flexibility.  ATM, besides disambiguation via .nwb object id (before might not needed, then becomes needed or vise versa if files acquire new metadata) everything is consistent.  You can incrementally `organize` into an existing dandiset an additional file, and it would take its place in the right location, as if when you reorganized full collection of files. In case of symlink or hardlink file mode, it is quite feasible to just `rm sub-*; dandi organize -d . /path/to/full-collection` quickly, thus to do incremental via full \"redo\".  But then users might not see explicitly what actually has changed/got renamed.  I have now added a [comments to an existing issue](https://github.com/dandi/dandi-cli/issues/47#issuecomment-610074164) on that topic.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1586213094,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6MzYzMzc5ODE3"},"target":"0618d868d9f39345cb460b0ba48d19e1d036470caa37bc0b9528ddfb223e071c","message":"\u003e @yarikoptic - so should sub be mandatory in the filename? i don't have strong feelings about this, but would be willing to leave this as optional to the user if we have a sub folder.\n\nwell, that is what I was proposing also in the early days of BIDS - to avoid duplication etc.  I now have love/hate feeling to having `sub` and `ses` in both directories structure and filename.  On one hand -- redundant.  On another, I could just copy/share some (selected) files and not worry about renaming or placing them into subfolders to disambiguate.  With reasonable subject ids, `sub` usually does not add much to the filename length. I would prefer to avoid it to be \"optional\" but rather prefer for us to decide one way or another.\n\nAnd given large typical sizes of .nwb files, I do see people download/copying just a handful of files.  If they start mixing up and overwriting one with another -- data loss, pain and suffering would come.\n\n\u003e second, do we deploy ordering option to user and use the simplest disambiguation within a folder? i.e. if ses doesn't matter across files in a folder it gets removed.\n\nsorry -- not entirely following on what \"ordering option\"?  I think the order of the fields is pretty much from larger to smaller (whole subject -\u003e session -\u003e tissue -\u003e cell ) and I do not think so far we saw need for an alternative order.\n\n\u003e also how would we handle incremental updates? so today ses doesn't matter, but tomorrow it does, etc.,.\n\nthat is exactly the concern I had against \"minimized\" version or allowing any other optional flexibility.  ATM, besides disambiguation via .nwb object id (before might not needed, then becomes needed or vise versa if files acquire new metadata) everything is consistent.  You can incrementally `organize` into an existing dandiset an additional file, and it would take its place in the right location, as if when you reorganized full collection of files. In case of symlink or hardlink file mode, it is quite feasible to just `rm sub-*; dandi organize -d . /path/to/full-collection` quickly, thus to do incremental via full \"redo\".  But then users might not see explicitly what actually has changed/got renamed.  I have now added a [comments to an existing issue](https://github.com/dandi/dandi-cli/issues/47#issuecomment-610074164) on that topic.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1586478189,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMTgxNDkxOQ==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-611814919"},"message":"As https://github.com/dandi/dandi-cli/issues/69#issuecomment-609494764 comment from @bendichter hints, we still might like to come back to https://github.com/dandi/dandi-core/issues/1 and also agree on specifying scopes of any `id` in the `dandiset.yaml`, which some defaults we assume stated somewhere. \nThat information could also assist in automatically deciding what keys are useful for deciding keys to use in the file name.  E.g. if `cell_id` scope is `tissue` -- both must be present from the first file since their pair constitutes a unique ID (scope of which is the scope `cell_id` defined in).  If `cell_id`'s scope is anything higher than a session - could be used alone. If any of the  `id` is higher than a subject -- `sub-` theoretically be omitted.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1586485862,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDYxMTg0NjU4MQ==","github-url":"https://github.com/dandi/dandi-cli/issues/69#issuecomment-611846581"},"message":"i think we came to the conclusion when discussing with @bendichter that IDs are specific to the user/lab/consortium and we should not be overriding them.  so they have no scope, just ids - whatever they decide to embed in the nwb file.","files":null}]}