{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1617034131,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwOTUxMDk2Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-809510966"},"message":"@yarikoptic With the default threading settings, I see numerous threads being used for uploads, and `py-spy top` seems to indicate that most time is spent in the `send()` method of some `ssl.py`.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1617034293,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDQ3MDcxNzEz"},"target":"8e1802d9e1acd7d77a13cbac209c2755030cbbe5159479f216361e7f4de0c67e","message":"@yarikoptic With the default threading settings, I see numerous threads being used for uploads, and `py-spy top` seems to indicate that most time is spent in the `send()` method of `ssl.py`.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1617034450,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwOTUxNDQ4Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-809514486"},"message":"@yarikoptic I believe I've figured out why you were only seeing one thread: https://github.com/dandi/dandi-cli/pull/519","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617039903,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwOTU3ODYyMw==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-809578623"},"message":"oh -- I wonder if that is all the encryption for ssl which spends the time...  I wonder if it is worth it in our case at all given that I do not think we really need encryption and I would prefer to see higher throughput .  I guess we could parallelize through subprocess pool instead of threads, but before jumping on trying that: @satra @dchiquito - do you see https transport to see mandatory (e.g. S3 allows only for https uploads?) or could it be just http?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617039976,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwOTU3OTM5NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-809579395"},"message":"\u003e @yarikoptic I believe I've figured out why you were only seeing one thread: #519\n\nGREAT! Trying out on that 3.6TB but now it would take time to redigest it again...","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617040536,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwOTU4NTU1NA==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-809585554"},"message":"tried instead on 000019 meanwhile.  With a single file at `1:5` -- rocketed to 230MBps.  With multiple and without `--devel-debug` and `4:5` speeds spiked to 500-600 MBps with nice stable rates of 200-400MBps whenever multiple files upload in progress. `dandi-cli` cpu wise was spiking over 100% (parallel processes across files if I got it right) but never very much over 100%.  So may be https is not that much of a bottleneck overall.","files":null},{"type":3,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1617303726,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxMjEwOTM3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-812109379"},"message":"@yarikoptic I think using HTTP may be possible, but it would be difficult and involve a whole lot of personalized network configuration in AWS. I would consider that an absolute last resort for speeding up uploads.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617313265,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgxMjE4NzQzMw==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-812187433"},"message":"Thank you @dchiquito . With the fixed up multi-threaded upload (thanks @jwodder) I see reasonable upload speeds per file (3.6TB file upload was averaged at 283.3MBps) so let's indeed then not bother with http.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617313265,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDU0MzQ5MTQxNA=="},"status":2}]}