{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1609893202,"metadata":{"github-id":"MDU6SXNzdWU3Nzk3ODk2NTQ=","github-url":"https://github.com/dandi/dandi-cli/issues/327","origin":"github"},"title":"more spots to guard for girder's 502 bad gateway?","message":"happens in the context of cron backup to datalad, and reminiscent of https://github.com/dandi/dandisets/issues/31 but seems to be at girder client/dandi-cli level this time.  I do not think we should jump to fix/address it just yet.  meanwhile I have upgraded dandi-cli installation there from 0.8.0-3-g8d49cf3 to 0.10.0-40-gcee1cbd although I do not think there are any relevant changes in this period which could have somehow assisted\n\n```\nTraceback (most recent call last):                                                                                                                                                                                                                                 \n  File \"tools/backups2datalad.py\", line 573, in \u003cmodule\u003e                                                                                                                                                                                                           \n    main()                                                                                                                                                                                                                                                         \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/click/core.py\", line 829, in __call__                                                                                                                                                    \n    return self.main(*args, **kwargs)                                                                                                                                                                                                                              \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/click/core.py\", line 782, in main                                                                                                                                                        \n    rv = self.invoke(ctx)                                                                                                                                                                                                                                          \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/click/core.py\", line 1066, in invoke                                                                                                                                                     \n    return ctx.invoke(self.callback, **ctx.params)                                                                                                                                                                                                                 \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/click/core.py\", line 610, in invoke                                                                                                                                                      \n    return callback(*args, **kwargs)                                                                                                                                                                                                                               \n  File \"tools/backups2datalad.py\", line 131, in main                                                                                                                                                                                                               \n    di.run(dandisets, exclude)                                                                                                                                                                                                                                     \n  File \"tools/backups2datalad.py\", line 201, in run                                                                                                                                                                                                                \n    if self.sync_dataset(did, ds):                                                                                                                                                                                                                                 \n  File \"tools/backups2datalad.py\", line 283, in sync_dataset                                                                                                                                                                                                       \n    for a in assets:                                                                                                                                                                                                                                               \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/girder.py\", line 524, in \u003cgenexpr\u003e                                                                                                                                                                                  \n    (                                                                                                                                                                                                                                                              \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/utils.py\", line 198, in flatten                                                                                                                                                                                     \n    yield from flattened(i)                                                                                                                                                                                                                                        \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/utils.py\", line 205, in flattened                                                                                                                                                                                   \n    return list(flatten(it))                                                                                                                                                                                                                                       \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/utils.py\", line 196, in flatten                                                                                                                                                                                     \n    for i in it:                                                                                                                                                                                                                                                   \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/girder.py\", line 476, in \u003cgenexpr\u003e                                                                                                                                                                                  \n    files = (e for e in entities if e[\"type\"] == \"file\")                                                                                                                                                                                                           \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/girder.py\", line 278, in traverse_asset                                                                                                                                                                             \n    yield from self._traverse_asset_girder(g, parent_path, recursive=recursive)                                                                                                                                                                                    \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/girder.py\", line 321, in _traverse_asset_girder                                                                                                                                                                     \n    for child_a in self._traverse_asset_girder(child, a[\"path\"]):                                                                                                                                                                                                  \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/girder.py\", line 321, in _traverse_asset_girder                                                                                                                                                                     \n    for child_a in self._traverse_asset_girder(child, a[\"path\"]):                                                                                                                                                                                                  \n  File \"/home/dandi/proj/dandi/dandi-cli/dandi/girder.py\", line 293, in _traverse_asset_girder                                                                                                                                                                     \n    file_recs = list(self.listFile(g[\"_id\"]))                                                                                                                                                                                                                      \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/girder_client/__init__.py\", line 578, in listResource                                                                                                                                    \n    records = self.get(path, params)                                                                                                                                                                                                                               \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/girder_client/__init__.py\", line 503, in get                                                                                                                                             \n    return self.sendRestRequest('GET', path, parameters, jsonResp=jsonResp)                                                                                                                                                                                        \n  File \"/home/dandi/miniconda3/envs/dandisets/lib/python3.8/site-packages/girder_client/__init__.py\", line 495, in sendRestRequest                                                                                                                                 \n    raise HttpError(                                                                                                                                                                                                                                               \ngirder_client.HttpError: HTTP error 502: GET https://girder.dandiarchive.org/api/v1/item/5e7543314309d765da614e8d/files?id=5e7543314309d765da614e8d\u0026offset=0\u0026limit=50                                                                                              \nResponse text: \u003chtml\u003e                                                                                                                                                                                                                                              \n\u003chead\u003e\u003ctitle\u003e502 Bad Gateway\u003c/title\u003e\u003c/head\u003e                                                                                                                                                                                                                        \n\u003cbody bgcolor=\"white\"\u003e                                                                                                                                                                                                                                             \n\u003ccenter\u003e\u003ch1\u003e502 Bad Gateway\u003c/h1\u003e\u003c/center\u003e                                                                                                                                                                                                                          \n\u003chr\u003e\u003ccenter\u003enginx/1.14.0 (Ubuntu)\u003c/center\u003e                                                                                                                                                                                                                         \n\u003c/body\u003e                                                                                                                                                                                                                                                            \n\u003c/html\u003e                \n```","files":null}]}