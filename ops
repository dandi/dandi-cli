{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1626895791,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDo1NzU2NjA3MDM="},"target":"79f3a20c35f2ee7da7a67b9d74f162400b82d0fceddc8154b196d305144852bb","message":"web-ui in the recent past switched to use top level `/assets/\u003cid\u003e/download/` end point for download urls, from previous original one which was bound to a particular dandiset version.  A quick attempt to just add a new url pattern:\n```diff\ndiff --git a/dandi/dandiarchive.py b/dandi/dandiarchive.py\nindex 6d183f9..41ff4e6 100644\n--- a/dandi/dandiarchive.py\n+++ b/dandi/dandiarchive.py\n@@ -289,6 +289,13 @@ class _dandi_url_parser:\n             \"https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e/versions/\u003cversion\u003e\"\n             \"/assets/\u003casset id\u003e[/download]\",\n         ),\n+        (\n+            re.compile(\n+                rf\"{server_grp}api/assets/(?P\u003casset_id\u003e[^?/]+)/download/?\"\n+            ),\n+            {},\n+            \"https://\u003cserver\u003e/api/assets/\u003casset id\u003e/download\",\n+        ),\n         (\n             re.compile(\n                 rf\"{server_grp}(?P\u003casset_type\u003edandiset)s/{dandiset_id_grp}\"\n```\nis not sufficient since then logic \"downstream\" expects knowing dandiset, and also needs adjustments.\n\nedit: example url \n```\nhttps://api.dandiarchive.org/api/assets/2847011b-f9fb-4933-a6b5-1641e0c1886b/download/                                              \n```","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1626895806,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDo1NzU2NjA4NTc="},"target":"79f3a20c35f2ee7da7a67b9d74f162400b82d0fceddc8154b196d305144852bb","message":"web-ui in the recent past switched to use top level `/assets/\u003cid\u003e/download/` end point for download urls, from previous original one which was bound to a particular dandiset version.  A quick attempt to just add a new url pattern:\n```diff\ndiff --git a/dandi/dandiarchive.py b/dandi/dandiarchive.py\nindex 6d183f9..41ff4e6 100644\n--- a/dandi/dandiarchive.py\n+++ b/dandi/dandiarchive.py\n@@ -289,6 +289,13 @@ class _dandi_url_parser:\n             \"https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e/versions/\u003cversion\u003e\"\n             \"/assets/\u003casset id\u003e[/download]\",\n         ),\n+        (\n+            re.compile(\n+                rf\"{server_grp}api/assets/(?P\u003casset_id\u003e[^?/]+)/download/?\"\n+            ),\n+            {},\n+            \"https://\u003cserver\u003e/api/assets/\u003casset id\u003e/download\",\n+        ),\n         (\n             re.compile(\n                 rf\"{server_grp}(?P\u003casset_type\u003edandiset)s/{dandiset_id_grp}\"\n```\nis not sufficient since then logic \"downstream\" expects knowing dandiset, and also needs adjustments.\n\nedit: example url https://api.dandiarchive.org/api/assets/2847011b-f9fb-4933-a6b5-1641e0c1886b/download/                                              \n```","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1626895718,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDUwNTIxNTI0NDk="},"added":["cmd-download"],"removed":[]},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1626961197,"metadata":{"github-id":"IC_kwDODBZtRc40vtHE","github-url":"https://github.com/dandi/dandi-cli/issues/723#issuecomment-884920772"},"message":"@yarikoptic The download process requires the asset's metadata in order to check the digest, but getting the metadata requires knowing the Dandiset and version IDs, which the `/assets/\u003cid\u003e/download/` endpoint does not provide.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1626961217,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDgwNzI2MTU3"},"target":"369bea0280f677069d9550bfb04b734b72e3b49c7a85c71cf6487bdd88fe5c91","message":"@yarikoptic The download process requires the asset's metadata in order to check the digest and set the mtime, but getting the metadata requires knowing the Dandiset and version IDs, which the `/assets/\u003cid\u003e/download/` endpoint does not provide.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1626967380,"metadata":{"github-id":"IC_kwDODBZtRc40wAs5","github-url":"https://github.com/dandi/dandi-cli/issues/723#issuecomment-885001017"},"message":"eh heh -- filed https://github.com/dandi/dandi-api/issues/436","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1626967388,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDUwNTYzNzc2NTY="},"added":["blocked"],"removed":[]},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1627604563,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50NTA4ODg1NTkxOQ=="},"added":[],"removed":["blocked"]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1627604581,"metadata":{"github-id":"IC_kwDODBZtRc41BVR9","github-url":"https://github.com/dandi/dandi-cli/issues/723#issuecomment-889541757"},"message":"removed `blocked`, support is implemented in dandi-api (https://github.com/dandi/dandi-api/pull/450)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1627922140,"metadata":{"github-id":"IC_kwDODBZtRc41HiJ5","github-url":"https://github.com/dandi/dandi-cli/issues/723#issuecomment-891167353"},"message":"@yarikoptic The dandi-api Docker image on Docker Hub seems to have stopped building, so the latest image does not include support for the new endpoint.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1627924727,"metadata":{"github-id":"IC_kwDODBZtRc41HpNM","github-url":"https://github.com/dandi/dandi-cli/issues/723#issuecomment-891196236"},"message":"\u003e @yarikoptic The dandi-api Docker image on Docker Hub seems to have stopped building, so the latest image does not include support for the new endpoint.\n\ndoh -- right. I guess we need to setup github action to build/push to docker hub. https://hub.docker.com/repository/docker/dandiarchive/dandiarchive-api shows that it was updated last time 10 days ago. [dandihub](https://hub.docker.com/repository/docker/dandiarchive/dandihub) - 4 days ago.  @satra - did you push it manually?\nI remember you @satra mentioned setting up some \"open source privileges\" with docker for some of the repos etc.  Is that something we could do for `dandiarchive`  organization to bring back automated builds or we are doomed to build in github actions and push?","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1628093956,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NTExMjI4NTA5MQ=="},"status":2}]}