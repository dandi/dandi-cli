{"version":2,"ops":[{"type":1,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1724180010,"metadata":{"github-id":"I_kwDODBZtRc6Tmaq8","github-url":"https://github.com/dandi/dandi-cli/issues/1491","origin":"github"},"title":"Remotely read/stream embargoed Zarr","message":"Hi team, @aaronkanzer and I are trying to read the metadata and chunks of an embargoed Zarr (on DANDI and LINC) and am unable to.  What would be the best approach to remotely access a Zarr that is apart of an embargoed Dandiset?\n\nFor the code snippet below, I can get the `zarr_path` in the `dandiarchive` S3 bucket from the File Browser of a Dandiset using the `View Asset Metadata` button, but `s3fs` also requires AWS credentials.\n\n```python \nimport zarr, s3fs\n\naccess_key = 'your-access-key-id'\nsecret_key = 'your-secret-access-key'\nsession_token = 'your-session-token'  # Optional, if using temporary credentials\n\ns3 = s3fs.S3FileSystem(key=access_key, secret=secret_key, token=session_token)\n\nbucket_name = 'dandiarchive'\nzarr_path = 'path/to/your/zarr/data.zarr'\n\nstore = s3fs.S3Map(root=f'{bucket_name}/{zarr_path}', s3=s3, check=False)\n\nzarr_array = zarr.open_array(store, mode='r')\n```\n\nFor reference, I am also hitting a blocker using the DANDI API when trying to access a Zarr.  I am not sure if this would be related to my use case.  Using the code snippet below (which is a derivative of the [OpenScope Databook streaming section](https://alleninstitute.github.io/openscope_databook/basics/stream_nwb.html)) I receive a `Response [400]`.  I presume that this is because the asset is a Zarr and the response is set in [lines 143-148](https://github.com/dandi/dandi-archive/blob/6e4bf727a02985aceb0fb896736883c00929c142/dandiapi/api/views/asset.py#L143-L148).  And perhaps this is related to https://github.com/dandi/dandi-cli/issues/1455.\n\n```python\nfrom dandi import dandiapi\n\ndataset = \"000026\"\nfilepath = \"sub-I58/ses-Hip-CT/micr/sub-I58_sample-01_chunk-01_hipCT.ome.zarr\"\ndandi_api_key = \u003cdandi_api_key\u003e\n\nclient = dandiapi.DandiAPIClient(api_url=\"https://api.dandiarchive.org/api\", token=dandi_api_key)\n\nmy_dandiset = client.get_dandiset(dandiset_id=dataset, version_id=\"draft\")\n\nfile = my_dandiset.get_asset_by_path(filepath)\n\nbase_url = file.client.session.head(file.base_download_url)\n```\n\nThank you.","files":null}]}