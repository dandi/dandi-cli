{"version":2,"ops":[{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1723777972,"metadata":{"github-id":"IC_kwDODBZtRc6Ipxlg","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2292652384"},"message":"Hi @nrsc, thanks for the report.  I am not familiar with MIES, but I can try to help.  Which version of `pynwb` is installed in your development environment?  You can run `pip list | grep nwb` in your terminal window to find the version.  It looks like [PyPI](https://pypi.org/project/pynwb/#history) does not have version `2.2.4` released.\n\nHi @CodyCBakerPhD, have you used [Igor/MIES](https://github.com/AllenInstitute/MIES) before?  Thank you.","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1723778647,"metadata":{"github-id":"IC_kwDODBZtRc6IpzoM","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2292660748"},"message":"\u003e It looks like [PyPI](https://pypi.org/project/pynwb/#history) does not have version 2.2.4 released.\n\nThe 2.2.4 reference is of the [NWB Schema](https://github.com/NeurodataWithoutBorders/nwb-schema/releases/tag/2.2.4), not the `pynwb` API version\n\n2.2.4 is also pretty old by now (by more than 4 years) so I'd strongly recommend updating the files to an even newer schema version, which might just magically fix this issue\n\n\u003e [pywnb.GENERIC] ... error: nwb_version \"b'2.2.4'\" is not a proper semantic version. See http://semver.org\n\nI can't recall how the DANDI CLI maps invalidations/errors/etc from NWB Inspector to their convention, but that's not a standard check that I know of\n\nMost likely that the call to `NWBHDF5IO.read()` on the file failed (that is, modern `pynwb` versions are unable to read the file)","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1723780102,"metadata":{"github-id":"IC_kwDODBZtRc6Ip3yw","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2292677808"},"message":"Thank you, @CodyCBakerPhD.  What would be the easiest way to update the files to a newer schema version?  Installing a newer version of Igor/MIES and exporting from the `pxp` files? (Assuming a newer version of `pynwb` and `nwb-schema` are supported by a later version of Igor/MIES.)","files":null},{"type":3,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1723781783,"metadata":{"github-id":"IC_kwDODBZtRc6IqI3T","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2292747731"},"message":"I'd check with @rly (I think we saw a similar issue recently with someone trying to write a file using custom R code) but I think all string datasets just need to be written using encoding like `utf-8`","files":null},{"type":3,"author":{"id":"24891a1a9a6057dee135acf783d3b5f6d886008e"},"timestamp":1723783513,"metadata":{"github-id":"IC_kwDODBZtRc6IqVKf","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2292798111"},"message":"This might be a bug in the MIES converter to NWB where the \"nwb_version\" attribute is written as ASCII instead of UTF-8, and the dandi semantic version validator expects UTF-8 (which is what the NWB schema says it should be). \n\n@nrsc Can you share an example file to confirm? Or share a screenshot of HDFView when selecting the root of the file and selecting the \"nwb_version\" attribute on the root?","files":null},{"type":3,"author":{"id":"5abab4dc6d21919c4a74bdcfda7d268fdd9b9da7"},"timestamp":1723785297,"metadata":{"github-id":"IC_kwDODBZtRc6IqbRi","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2292823138"},"message":"Will follow up on this tomorrow. Thanks for the insight. Have a good nigh everyone.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723813952,"metadata":{"github-id":"IC_kwDODBZtRc6Is9Mo","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2293486376"},"message":"\u003e ASCII instead of UTF-8\n\nor just a `repr` of it really after encoding.\n\n```\n‚ùØ python -c 'print(repr(\"2.2.4\".encode()))'\nb'2.2.4'\n```\n\nbut overall indeed smells with software bug of a layer creating .nwb here.","files":null},{"type":3,"author":{"id":"5abab4dc6d21919c4a74bdcfda7d268fdd9b9da7"},"timestamp":1723832295,"metadata":{"github-id":"IC_kwDODBZtRc6IuvKG","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2293953158"},"message":"Hey all. \n\n@kabilar Thanks for checking in on this. As @CodyCBakerPhD mentioned 2.2.4 is the nwb version\n\n@rly here is the version from HDFView\n\n![nwb_version](https://github.com/user-attachments/assets/2318ec1c-76b3-4b19-b57f-3ef91478716a)\n\nI'm not sure how much control I have over the version @CodyCBakerPhD, since I've been using MEIS to convert these pxp files to nwb.  The functions are built into the software. That being said I would be interested in finding a way to either update the current files I have, or, if possible, mass convert the pxp files using another scripting option. \n\nCheers","files":null},{"type":6,"author":{"id":"5abab4dc6d21919c4a74bdcfda7d268fdd9b9da7"},"timestamp":1723832461,"metadata":{"github-id":"UCE_lALODBZtRc6IuvKGzk1vccc"},"target":"b2ab0c7940a68666271ce7efdf29c10d7b03077ad39bf5fae46491bb48822333","message":"Hey all. \n\n@kabilar Thanks for checking in on this. As @CodyCBakerPhD mentioned 2.2.4 is the nwb version\n\n@rly here is the version from HDFView \n\n![nwb_version](https://github.com/user-attachments/assets/18765b34-6972-4115-86bc-20b22e2a0d36)\n\nI'm not sure how much control I have over the version @CodyCBakerPhD, since I've been using MEIS to convert these pxp files to nwb.  The functions are built into the software. That being said I would be interested in finding a way to either update the current files I have, or, if possible, mass convert the pxp files using another scripting option. \n\nCheers","files":null},{"type":3,"author":{"id":"24891a1a9a6057dee135acf783d3b5f6d886008e"},"timestamp":1723833180,"metadata":{"github-id":"IC_kwDODBZtRc6Iu0CO","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2293973134"},"message":"It looks like `nwb_version` is a fixed-length string with UTF-8 encoding. All strings in NWB should be [variable-length](https://schema-language.readthedocs.io/en/latest/description.html#dtype). That's a bug in the MIES conversion. Can you raise an issue on https://github.com/AllenInstitute/MIES? You can fix this for your files by reading that attribute and rewriting that attribute as a variable length string across all your files. It is possible that other strings will have the same issue in your file. (`namespace`, `neurodata_type`, and `object_id` should probably also be variable-length strings but those are not critical, and that spec is not written anywhere.) Does the `session_description` dataset that is in the root of the file have a fixed-length or variable-length string dtype?","files":null},{"type":3,"author":{"id":"5abab4dc6d21919c4a74bdcfda7d268fdd9b9da7"},"timestamp":1723835538,"metadata":{"github-id":"IC_kwDODBZtRc6IvAad","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2294023837"},"message":"@rly I can look to fix the issue when writing the files. That seems like a good option for now.\n\nAs for the `session_description`, looks like it is a variable length string, though I haven't written anything into it yet. \n![sesssion_description](https://github.com/user-attachments/assets/56aca31d-e040-4b39-873a-657285932217)\n\nI will follow up with the MEIS devs and let them know of this issue, and see whether I can get some more info on updating the nwb version export.","files":null},{"type":3,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1724910959,"metadata":{"github-id":"IC_kwDODBZtRc6KFyJa","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2316771930"},"message":"I'm one of the developers of MIES. We check all our data produced in CI against pynwb.validate. So if fixed length strings are not accepted anymore, the pynwb validator should complain. Same for the encoding: ASCII vs. UTF8\n\nA similiar issue was fixed in pynwb last year, https://github.com/NeurodataWithoutBorders/pynwb/issues/1668, so I'm suprised to see this bug.","files":null},{"type":6,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1724911817,"metadata":{"github-id":"UCE_lALODBZtRc6KFyJazk5ig4E"},"target":"8e1a68b89ea12fe0c5cb0b14d613cba71c4d3b020638e73f2f78e6ca1b95b08e","message":"I'm one of the developers of MIES. We check all our data produced in CI against pynwb.validate. So if fixed length strings are not accepted anymore, the pynwb validator should complain. Same for the encoding: ASCII vs. UTF8\n\nA similiar issue was fixed in pynwb last year, https://github.com/NeurodataWithoutBorders/pynwb/issues/1668, so I'm suprised to see this bug.\n\nEdit: We always use the latest released pynwb version for the validation step.","files":null},{"type":3,"author":{"id":"afe62dd154b2234eb7c5cdf636d46b27c2c2760e"},"timestamp":1726248873,"metadata":{"github-id":"IC_kwDODBZtRc6MC_ln","github-url":"https://github.com/dandi/dandi-cli/issues/1485#issuecomment-2349594983"},"message":"The bug in MIES was fixed. We now also use dandi validate, with some ignore pattern, to catch similiar issues.\n\nIMHO this  issue can be closed.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1726250947,"metadata":{"github-id":"CE_lADODBZtRc6S4iSVzwAAAANRhEwZ"},"status":2}]}