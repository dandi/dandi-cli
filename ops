{"version":2,"ops":[{"type":1,"author":{"id":"818a29386a430d42cbb57ad6dcccbe0fb486ffc3"},"timestamp":1614009075,"metadata":{"github-id":"MDU6SXNzdWU4MTM2MjQ4NTQ=","github-url":"https://github.com/dandi/dandi-cli/issues/406","origin":"github"},"title":"Add delay between polls while waiting for asset validation","message":"Right now, the CLI needs to wait for an asset to validate after uploading. This is what the code looks like:\n```\n        while True:\n            lgr.debug(\"Waiting for server-side validation to complete\")\n            resp = self.get(f\"/uploads/validations/{filehash}/\")\n            if resp[\"state\"] != \"IN_PROGRESS\":\n                if resp[\"state\"] == \"FAILED\":\n                    raise RuntimeError(\n                        \"Server-side asset validation failed!\"\n                        f\"  Error reported: {resp.get('error')}\"\n                    )\n                break\n            yield {\"status\": \"validating\"}\n```\nThis loop will constantly be executing queries with no delay. Considering that 10 files are uploaded/validated simultaneously, this results in substantial server load and hundreds of GB of log spam per day when large uploads are being done. \n\nThrottling this loop a little, even `time.sleep(1)`, would go a long way to making the server happier.","files":null}]}