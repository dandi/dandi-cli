{"version":2,"ops":[{"type":1,"author":{"id":"f3856669ae05db18871381e4a2bf44e84858d017"},"timestamp":1698203061,"metadata":{"github-id":"I_kwDODBZtRc502e5c","github-url":"https://github.com/dandi/dandi-cli/issues/1339","origin":"github"},"title":"Missing term in ETA calculation","message":"Hello hello :) nice tool, am currently hypnotized watching the download counters complete.\n\nI'm noticing the ETA timer counts up rather than down. a tiny tiny fix  that should hopefully be easy :)\n\nThis line: \nhttps://github.com/dandi/dandi-cli/blob/04e7c2011a95679baca696f1faa22f70e84cee17/dandi/download.py#L447\n\ncalculates ETA by dividing elapsed time by the proportion completed:\nhttps://github.com/dandi/dandi-cli/blob/04e7c2011a95679baca696f1faa22f70e84cee17/dandi/download.py#L431\n\nSo ETA slowly converges to the time elapsed (rather than to 0) and then spikes to 0 once `r == 1`\n\nI think we're missing a term there. Assuming a constant rate...\n\n$t_{elapsed} = p_{completed} * t_{total}$\n$t_{total} = t_{elapsed} + t_{remaining}$\n\nSubstituting...\n\n$t_{elapsed} = p_{completed} * ( t_{elapsed} + t_{remaining} )$\n\n$\\frac{t_{elapsed}}{p_{completed}} =  t_{elapsed} + t_{remaining} $\n\n$\\frac{t_{elapsed}}{p_{completed}} - t_{elapsed} =  t_{remaining} $\n\nor `(dt/r)-dt`\n\nso say we are 10% complete after 1 second. we should have 9 seconds left.\n\n`1/.1 - 1 = 9`\n\nour download speed fluctuates wildly, and after 90 seconds we are 90% complete, we should have 10 seconds left (since we're not tracking download speed and can't make a better estimate based on recent history, we just use the average rate which converges to correct at 100%)\n\n`90/.9 - 90 = 10`\n\nThanks again for the tool and the archive!","files":null}]}