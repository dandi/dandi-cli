{"version":2,"ops":[{"type":3,"author":{"id":"2db4f5da888e2bc30bfef7de9879ca52bb0fac9e"},"timestamp":1749147749,"metadata":{"github-id":"IC_kwDODBZtRc6vkjVH","github-url":"https://github.com/dandi/dandi-cli/issues/1650#issuecomment-2945594695"},"message":"Can confirm that after resetting everything repeating these steps without `dandi organize`  completes without traceback.\n```\ndandi upload .\n2025-06-05 13:21:19,498 [    INFO] Found 2 files to consider\nPATH                                                                     SIZE    ERRORS PROGRESS STATUS           MESSAGE                  \ndandiset.yaml                                                            2.3 kB                  skipped          should be edited online  \n...mp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb 9.3 MB                  pre-validating                            \nSummary:                                                                 9.3 MB                  1 skipped        1 should be edited online\n                                                                                                 1 pre-validating                          \n/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/hdmf/spec/namespace.py:583: UserWarning: Ignoring the PATH                                                                SIZE    ERRORS PROGRESS STATUS                MESSAGE                  \ndandiset.yaml                                                       2.3 kB                  skipped               should be edited online  \n...ef-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb 9.3 MB    0        100% done                                           \nSummary:                                                            9.3 MB         7.7 MB/s 1 skipped             1 should be edited online\n                                                                                            1 done                                         \n2025-06-05 13:21:20,716 [    INFO] Logs saved in /home/austin/.local/state/dandi-cli/log/2025.06.05-18.21.18Z-556248.log\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1749155068,"metadata":{"github-id":"IC_kwDODBZtRc6vmZXL","github-url":"https://github.com/dandi/dandi-cli/issues/1650#issuecomment-2946078155"},"message":"apparently hdmf really likes to use `warnings.warn` (and not `logging.warn`) and this particular one is  from https://github.com/hdmf-dev/hdmf/blob/HEAD/src/hdmf/spec/namespace.py#L582  .\n\n@asmacdo am I right to assume that (without `dandi organize`) if there is any symlink to a file with the same content - we get the same problem?","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1749155087,"metadata":{"github-id":"LE_lADODBZtRc66GMebzwAAAAQxcila"},"added":["UX"],"removed":[]},{"type":3,"author":{"id":"2db4f5da888e2bc30bfef7de9879ca52bb0fac9e"},"timestamp":1749156035,"metadata":{"github-id":"IC_kwDODBZtRc6vmpa1","github-url":"https://github.com/dandi/dandi-cli/issues/1650#issuecomment-2946143925"},"message":"I was not able to replicate by naively creating a symlink, which simply failed validation.\n```\nls -lah sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac \ntotal 9.0M\ndrwxr-xr-x. 1 austin austin  170 Jun  5 15:27 .\ndrwxr-xr-x. 1 austin austin  110 Jun  5 13:19 ..\nlrwxrwxrwx. 1 austin austin   75 Jun  5 15:27 mylink.nwb -\u003e sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb\n-rw-r--r--. 1 austin austin 9.0M Nov 10  2023 sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb\n```\n\n```\n$ dandi upload .\n```\n\n\u003cdetails\u003e\u003csummary\u003e Validation error\u003c/summary\u003e\n\n```\n2025-06-05 15:30:07,867 [    INFO] Found 3 files to consider\nPATH                                                                     SIZE    ERRORS PROGRESS STATUS           MESSAGE                  \ndandiset.yaml                                                            2.3 kB                  skipped          should be edited online  \nsub-Temp-pref-F30-B30-5dpf-01-unsorted-nac/mylink.nwb                    9.3 MB                  pre-validating                            \n...mp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb 9.3 MB                  pre-validating                            \nSummary:                                                                 18.7 MB                 1 skipped        1 should be edited online\n                                                                                                 2 pre-validating                          \nPATH                                                        SIZE       ERRORS      PROGRESS STATUS                MESSAGE                  dandiset.yaml                                               2.3 kB                          skipped               should be edited online  \nsub-Temp-pref-F30-B30-5dpf-01-unsorted-nac/mylink.nwb       9.3 MB        1                 ERROR                 failed validation        \n...30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb 9.3 MB        0            100% done                                           \nSummary:                                                    18.7 MB 1 with errors  8.1 MB/s 1 skipped             1 should be edited online\n                                                                                            1 ERROR               1 failed validation      \n                                                                                            1 done                                         \n2025-06-05 15:30:09,021 [ WARNING] One or more assets failed validation.  Consult the logfile for details.\n2025-06-05 15:30:09,086 [    INFO] Logs saved in /home/austin/.local/state/dandi-cli/log/2025.06.05-20.30.07Z-577300.log\nTraceback (most recent call last):\n  File \"/home/austin/.pyenv/versions/tmp-dandi-cli/bin/dandi\", line 8, in \u003cmodule\u003e\n    sys.exit(main())\n             ^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1161, in __call__\n    return self.main(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1082, in main\n    rv = self.invoke(ctx)\n         ^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1697, in invoke\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1443, in invoke\n    return ctx.invoke(self.callback, **ctx.params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 788, in invoke\n    return __callback(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/decorators.py\", line 45, in new_func\n    return f(get_current_context().obj, *args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/cli/base.py\", line 126, in wrapper\n    return f(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/cli/cmd_upload.py\", line 103, in upload\n    upload(\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/upload.py\", line 461, in upload\n    raise upload_err\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/upload.py\", line 282, in process_path\n    raise UploadError(\"failed validation\")\ndandi.exceptions.UploadError: failed validation\n```\n\u003c/details\u003e\n\n\nHowever I was able to replicate by using the same symlink name that dandi organize produces.\n\n```\nls -lah sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac \ntotal 9.0M\ndrwxr-xr-x. 1 austin austin  260 Jun  5 15:35 .\ndrwxr-xr-x. 1 austin austin  110 Jun  5 13:19 ..\nlrwxrwxrwx. 1 austin austin   75 Jun  5 15:35 sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac_behavior.nwb -\u003e sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb\n-rw-r--r--. 1 austin austin 9.0M Nov 10  2023 sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nw\n```\n```\n$ dandi upload .\n```\n\u003cdetails\u003e \u003csummary\u003e Duplicate blob error\u003c/summary\u003e\n\n```\n2025-06-05 15:36:53,937 [    INFO] Found 3 files to consider\nPATH                                                                     SIZE    ERRORS PROGRESS STATUS           MESSAGE                  \ndandiset.yaml                                                            2.3 kB                  skipped          should be edited online  \n...-unsorted-nac/sub-Temp-pref-F30-B30-5dpf-01-unsorted-nac_behavior.nwb 9.3 MB                  pre-validating                            \n...mp-pref-F30-B30-5dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb 9.3 MB                  pre-validating                            \nSummary:                                                                 18.7 MB                 1 skipped        1 should be edited online\n                                                                                                 2 pre-validating                          \nPATH                                                    SIZE    ERRORS  PROGRESS STATUS                MESSAGE                             dandiset.yaml                                           2.3 kB                   skipped               should be edited online             \n...-Temp-pref-F30-B30-5dpf-01-unsorted-nac_behavior.nwb 9.3 MB    0         100% ERROR                 Error 409 while sending POST requ...\n...dpf-01-unsorted-nac_ses-20230808T111800_behavior.nwb 9.3 MB    0         100% done                                                      \nSummary:                                                18.7 MB        17.1 MB/s 1 skipped             1 should be edited online           \n                                                                                 1 ERROR               1 Error some while sending POST r...\n                                                                                 1 done                                                    \n2025-06-05 15:36:55,094 [    INFO] Logs saved in /home/austin/.local/state/dandi-cli/log/2025.06.05-20.36.53Z-579257.log\nTraceback (most recent call last):\n  File \"/home/austin/.pyenv/versions/tmp-dandi-cli/bin/dandi\", line 8, in \u003cmodule\u003e\n    sys.exit(main())\n             ^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1161, in __call__\n    return self.main(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1082, in main\n    rv = self.invoke(ctx)\n         ^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1697, in invoke\n    return _process_result(sub_ctx.command.invoke(sub_ctx))\n                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 1443, in invoke\n    return ctx.invoke(self.callback, **ctx.params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/core.py\", line 788, in invoke\n    return __callback(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/click/decorators.py\", line 45, in new_func\n    return f(get_current_context().obj, *args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/cli/base.py\", line 126, in wrapper\n    return f(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/cli/cmd_upload.py\", line 103, in upload\n    upload(\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/upload.py\", line 461, in upload\n    raise upload_err\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/upload.py\", line 359, in process_path\n    for r in dfile.iter_upload(\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/files/bases.py\", line 448, in iter_upload\n    resp = client.post(f\"/uploads/{upload_id}/validate/\")\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/dandiapi.py\", line 317, in post\n    return self.request(\"POST\", path, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/austin/.pyenv/versions/3.11.12/envs/tmp-dandi-cli/lib/python3.11/site-packages/dandi/dandiapi.py\", line 287, in request\n    raise requests.HTTPError(msg, response=result)\nrequests.exceptions.HTTPError: Error 409 while sending POST request to http://localhost:8000/api/uploads/20bfdcd5-4c7a-4de6-a1e9-89fbd83b867a/validate/: \"An identical blob has already been uploaded.\"\n```\n\u003c/details\u003e","files":null}]}