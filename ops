{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1677593919,"metadata":{"github-id":"I_kwDODBZtRc5fjlmd","github-url":"https://github.com/dandi/dandi-cli/issues/1230","origin":"github"},"title":"service-scripts reextract-metadata","message":"https://github.com/dandi/dandi-cli/pull/1202/ stripped `service-scripts` devel top level command , I think might be worth returning it now for this.\n\nGiven https://github.com/dandi/dandi-cli/pull/1214 functionality, we would need following command\n\n```\nreextract-metadata [--when newer-schema-version,always] [--diff show-united] URL\n```\n\nURL \n- if points to dandiset - take draft version and all assets of it\n- if points to specific dandiset version which isn't draft - error out\n- if points to some sub-paths within dandiset - take only assets under that path (recursively, so we could re-extract within some folder for faster testing etc)\n- if points to specific file (asset) - works only on that asset\n\ngiven a \"list\" of those assets it would\n- get current `metadata` record\n- if `when==\"always\": do_reextract = True\n- if `when == \"newer-schema-version\"`:\n  -  `if semver(metadata[\"schemaVersion\"]) \u003c DANDI_SCHEMA_VERSION`: `do_reextract = True`\n  - `if semver(metadata[\"schemaVersion\"]) \u003e DANDI_SCHEMA_VERSION`: log warning that asset has higher version and which one\n- `if do_reextract:` re-extract metadata using functionality of #1214 from remote location in the archive reusing current `digest` value and `path` and replace the asset with new asset with re-extracted metadata\n\nif optional `--diff show-united`, before uploading a new asset show the diff between old and new one extracting useful https://docs.python.org/3/library/difflib.html for showing united diff between two formatted json records - old and new.\n\nI still wonder if we need some extra check to prevent unnecessary changes (like if nothing changed really with re-extraction) , but so far let's try as this.\n\nRef: https://github.com/dandi/dandi-archive/issues/1450","files":null}]}