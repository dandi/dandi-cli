{"version":2,"ops":[{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1674152726,"metadata":{"github-id":"UCE_lAHODBZtRc5cdi_Vzjs8Swg"},"target":"7e1404bb958bd2e8823b461d784ade686cf55ec91f53860b458e2fc86152f205","message":"I'm using the Python dandi api version 0.46.3 in a Jupyter notebook. I'm attempting to access the metadata of an embargoed file with the following code;\n```\nfor file in my_dandiset.get_assets():\n    print(file.get_metadata())\n```\nwhere `my_dandiset` is a RemoteDandiset. But this fails and I get the following error;\n```\nValidationError                           Traceback (most recent call last)\nCell In [9], line 2\n      1 for file in my_dandiset.get_assets():\n----\u003e 2     print(file.get_metadata())\n\nFile ~\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\dandi\\dandiapi.py:1267, in BaseRemoteAsset.get_metadata(self)\n   1262 def get_metadata(self) -\u003e models.Asset:\n   1263     \"\"\"\n   1264     Fetch the metadata for the asset as a `dandischema.models.Asset`\n   1265     instance\n   1266     \"\"\"\n-\u003e 1267     return models.Asset.parse_obj(self.get_raw_metadata())\n\nFile ~\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\pydantic\\main.py:526, in pydantic.main.BaseModel.parse_obj()\n\nFile ~\\AppData\\Local\\Programs\\Python\\Python39\\lib\\site-packages\\pydantic\\main.py:342, in pydantic.main.BaseModel.__init__()\n\nValidationError: 1 validation error for Asset\nencodingFormat\n  field required (type=value_error.missing)\n```\nIs this me misusing the api or just using too old a version?","files":null},{"type":3,"author":{"id":"1d7d442aa1925df5e89cbf71d597eb72205cfee1"},"timestamp":1674226967,"metadata":{"github-id":"IC_kwDODBZtRc5TXzkF","github-url":"https://github.com/dandi/dandi-cli/issues/1189#issuecomment-1398749445"},"message":"Hey @rcpeene, thanks for filing the issue. We will look into it ðŸ˜ƒ","files":null},{"type":3,"author":{"id":"1d7d442aa1925df5e89cbf71d597eb72205cfee1"},"timestamp":1674237615,"metadata":{"github-id":"IC_kwDODBZtRc5TXzkJ","github-url":"https://github.com/dandi/dandi-cli/issues/1189#issuecomment-1398749449"},"message":"@rcpeene: this may just be the intended behavior. The idea is that if there are validation errors in the metadata, the Python API wouldn't want to just hand you bad data, so you get an exception instead. I have two general bits of advice for this situation that might help:\n1. In your code, catch that `ValidationError` as you call `get_metadata()` so that you can report the error (along with the file that triggered it, etc.) and then move on to the rest of the files.\n2. Visit the embargoed Dandiset on the archive itself so you can see the asset validation error there and then use the file browser to find the failing asset and examine its metadata through that interface.\n\nThis may help you to correct the problem with the asset. If you run into trouble, please let us know.\n\nAlso, I'm calling on @jwodder to help answer the question about whether the Python API is indeed showing correct behavior in this case.\n\n(@jwodder, I am also moving this issue to the dandi-cli repository.)","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1674240514,"metadata":{"github-id":"IC_kwDODBZtRc5TX_hN","github-url":"https://github.com/dandi/dandi-cli/issues/1189#issuecomment-1398798413"},"message":"Yes, if the asset metadata is invalid, `get_metadata()` will raise an exception.  To get around this, use the `get_raw_metadata()` method instead, which uses dicts instead of classes.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1674512029,"metadata":{"github-id":"IC_kwDODBZtRc5TgqT2","github-url":"https://github.com/dandi/dandi-cli/issues/1189#issuecomment-1401070838"},"message":"I will close this issue but there is something to fix on dandi side, feel welcome to chime back in @rcpeene !","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1674512029,"metadata":{"github-id":"CE_lADODBZtRc5cdi_VzwAAAAHxBsIN"},"status":2}]}