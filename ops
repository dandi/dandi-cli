{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1734659437,"metadata":{"github-id":"UCE_lAHODBZtRc6kBG_1zm1C9kM"},"target":"a1529c1f64414609011405a99bdd6f8a28551003b5aee80cd2a1b1a189df5af7","message":"From a lengthy download logs (5GB of them) we get 28 500 errors\n\n```shell\n❯ grep '500 Server Error' 2024.12.17-14.32.09Z-1959582.log | wc -l\n28\n```\n\nthey come from\n\n```\n❯ sed -e 's,.*sub-I48/,,g' -e 's,\\.zarr.*,.zarr,g' 500s | sort | uniq -c | nl\n     1\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS02_stain-NeuN_SPIM.ome.zarr\n     2\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS04_stain-Calretinin_SPIM.ome.zarr\n     3\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Nuclei_SPIM.ome.zarr\n     4\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Somatostatin_SPIM.ome.zarr\n     5\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS10_stain-NeuN_SPIM.ome.zarr\n     6\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS12_stain-Somatostatin_SPIM.ome.zarr\n     7\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS14_stain-Somatostatin_SPIM.ome.zarr\n     8\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS15_stain-NeuN_SPIM.ome.zarr\n     9\t      4 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr\n    10\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS17_stain-NeuN_SPIM.ome.zarr\n    11\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS29_stain-Nuclei_SPIM.ome.zarr\n    12\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS31_stain-Nuclei_SPIM.ome.zarr\n    13\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS38_stain-Nuclei_SPIM.ome.zarr\n```\n\n13 zarrs.   Full \"logs\" for a sample among those:\n\n```\n❯ grep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64 2024.12.17-14.32.09Z-1959582.log\n2024-12-17T22:29:53-0500 [DEBUG   ] dandi 1959582:140295117711104 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64.dandidownload - no prior digests found; starting new download\n2024-12-17T22:29:58-0500 [DEBUG   ] dandi 1959582:140295117711104 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.HTTPError'\u003e, 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/15edef21-d0ed-448a-9006-4fe0470538e1/0/0/11/64?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241218%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241218T032953Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8295582119ab052a6ced62b33dcb1eb05824d32ed70d91c409172c5a804585b3\n2024-12-17T22:29:58-0500 [DEBUG   ] dandi 1959582:140295117711104 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64 - download failed: 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/15edef21-d0ed-448a-9006-4fe0470538e1/0/0/11/64?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241218%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241218T032953Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8295582119ab052a6ced62b33dcb1eb05824d32ed70d91c409172c5a804585b3\n```\n\nso we see that there is no indication of retrying anything and it is only 5 seconds from \"starting\" to 500 so likely we didn't retry at all?!\n\n\u003cdetails\u003e\n\u003csummary\u003e21 errors overall were reported\u003c/summary\u003e \n\n@Kevancic reported:  \"21 errors overall. 3 of them were complete errors and 18 were partial errors\" so they include some of those above due to non-retried 500s\n\nComplete Error:\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS03_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr\n\nPartial/Downloading Error:\n\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS02_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS04_stain-Calretinin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS09_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS10_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS12_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS14_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS17_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS15_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Calretinin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Calretinin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS29_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS31_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS38_stain-Nuclei_SPIM.ome.zarr\n```\n\n\u003c/details\u003e\n\nfor some of those \"Complete error\" we apparently didn't retry on 503, e.g.\n\n```shell\n❯ grep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57 2024.12.17-14.32.09Z-1959582.log\n2024-12-18T12:07:46-0500 [DEBUG   ] dandi 1959582:140290945971968 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57.dandidownload - no prior digests found; starting new download\n2024-12-18T12:07:46-0500 [DEBUG   ] dandi 1959582:140290945971968 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.HTTPError'\u003e, 503 Server Error: Service Unavailable for url: https://api.dandiarchive.org/api/zarr/70654e08-8aef-4526-bc5c-87c5b5adb660/files/?prefix=0/0/31/57\u0026download=true\n2024-12-18T12:07:46-0500 [DEBUG   ] dandi 1959582:140290945971968 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57 - download failed: 503 Server Error: Service Unavailable for url: https://api.dandiarchive.org/api/zarr/70654e08-8aef-4526-bc5c-87c5b5adb660/files/?prefix=0/0/31/57\u0026download=true\n```\n\nif we look across ALL 50X errors, we get to cover \n```\n❯ sed -e 's,.*sub-I48/,,g' -e 's,\\.zarr.*,.zarr,g' 50.s | sort | uniq -c | nl\n     1\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS02_stain-NeuN_SPIM.ome.zarr\n     2\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS03_stain-Somatostatin_SPIM.ome.zarr\n     3\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS04_stain-Calretinin_SPIM.ome.zarr\n     4\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Nuclei_SPIM.ome.zarr\n     5\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Somatostatin_SPIM.ome.zarr\n     6\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS09_stain-NeuN_SPIM.ome.zarr\n     7\t      4 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS10_stain-NeuN_SPIM.ome.zarr\n     8\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS12_stain-Somatostatin_SPIM.ome.zarr\n     9\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS14_stain-Somatostatin_SPIM.ome.zarr\n    10\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS15_stain-NeuN_SPIM.ome.zarr\n    11\t      4 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr\n    12\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS17_stain-NeuN_SPIM.ome.zarr\n    13\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Calretinin_SPIM.ome.zarr\n    14\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Somatostatin_SPIM.ome.zarr\n    15\t      8 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Calretinin_SPIM.ome.zarr\n    16\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr\n    17\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr\n    18\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS29_stain-Nuclei_SPIM.ome.zarr\n    19\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS31_stain-Nuclei_SPIM.ome.zarr\n    20\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS38_stain-Nuclei_SPIM.ome.zarr\n```\n\n20 zarrs.  and the only one which errored for some other reason is\n\n```\n❯ cat allerrored | while read errored; do grep -q \"${errored//sub-I48\\//}\" errored.50x || echo $errored; done\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr\n```\n\n\u003cdetails\u003e\n\u003csummary\u003ebut I can't figure out what is wrong with it from the logs\n\u003c/summary\u003e \n\n```shell\n❯ grep 'sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr' 2024.12.17-14.32.09Z-1959582.log | grep Error\n2024-12-19T01:03:37-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/50.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:03:54-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/52.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:04:57-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/60.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:05:03-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/61.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:05:45-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:07:04-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:07:30-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/69.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:07:35-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:08:21-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/69.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:11:01-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/9.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:11:59-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/23.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:14:48-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/33.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:16:02-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/33.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:16:41-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/38.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:17:30-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/45.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:18:29-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/49.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:18:32-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/4.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:20:25-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/60.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:21:11-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/62.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:23:31-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/13.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:25:37-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/11.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:26:10-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/19.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:31:30-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/67.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:33:43-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/59/25.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:35:59-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/59/53.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:38:18-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/6/59.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:40:12-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/60/12.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:40:25-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/60/14.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ChunkedEncodingError'\u003e, (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 - download failed on attempt #1: (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n❯ grep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 2024.12.17-14.32.09Z-1959582.log\n2024-12-19T02:09:40-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - no prior digests found; starting new download\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ChunkedEncodingError'\u003e, (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 - download failed on attempt #1: (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n2024-12-19T02:09:45-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - download directory exists and has matching checksum(s) {'md5'}; resuming download\n2024-12-19T02:09:47-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - entered __exit__ with position 1167620 without any exception\n2024-12-19T02:09:47-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 - verified that has correct md5 75e4a0fa34c3820a5802bc0f62a76a3a\n\n```\n\u003c/details\u003e\n\nbut the end of the logs looks truncated to me... could you run similar 3 commands on your copy of the log @Kevancic\n\n```\ngrep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 2024.12.17-14.32.09Z-1959582.log\ngrep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr[^/] 2024.12.17-14.32.09Z-1959582.log\ngrep 'sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr[^/]' 2024.12.17-14.32.09Z-1959582.log\n```\n\n?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1734659470,"metadata":{"github-id":"UCE_lAHODBZtRc6kBG_1zm1C-MA"},"target":"a1529c1f64414609011405a99bdd6f8a28551003b5aee80cd2a1b1a189df5af7","message":"From a lengthy download logs (5GB of them) we get 28 500 errors\n\n```shell\n❯ grep '500 Server Error' 2024.12.17-14.32.09Z-1959582.log | wc -l\n28\n```\n\nthey come from\n\n```\n❯ sed -e 's,.*sub-I48/,,g' -e 's,\\.zarr.*,.zarr,g' 500s | sort | uniq -c | nl\n     1\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS02_stain-NeuN_SPIM.ome.zarr\n     2\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS04_stain-Calretinin_SPIM.ome.zarr\n     3\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Nuclei_SPIM.ome.zarr\n     4\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Somatostatin_SPIM.ome.zarr\n     5\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS10_stain-NeuN_SPIM.ome.zarr\n     6\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS12_stain-Somatostatin_SPIM.ome.zarr\n     7\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS14_stain-Somatostatin_SPIM.ome.zarr\n     8\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS15_stain-NeuN_SPIM.ome.zarr\n     9\t      4 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr\n    10\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS17_stain-NeuN_SPIM.ome.zarr\n    11\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS29_stain-Nuclei_SPIM.ome.zarr\n    12\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS31_stain-Nuclei_SPIM.ome.zarr\n    13\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS38_stain-Nuclei_SPIM.ome.zarr\n```\n\n13 zarrs.   Full \"logs\" for a sample among those:\n\n```\n❯ grep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64 2024.12.17-14.32.09Z-1959582.log\n2024-12-17T22:29:53-0500 [DEBUG   ] dandi 1959582:140295117711104 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64.dandidownload - no prior digests found; starting new download\n2024-12-17T22:29:58-0500 [DEBUG   ] dandi 1959582:140295117711104 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.HTTPError'\u003e, 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/15edef21-d0ed-448a-9006-4fe0470538e1/0/0/11/64?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241218%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241218T032953Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8295582119ab052a6ced62b33dcb1eb05824d32ed70d91c409172c5a804585b3\n2024-12-17T22:29:58-0500 [DEBUG   ] dandi 1959582:140295117711104 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr/0/0/11/64 - download failed: 500 Server Error: Internal Server Error for url: https://dandiarchive.s3.amazonaws.com/zarr/15edef21-d0ed-448a-9006-4fe0470538e1/0/0/11/64?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAUBRWC5GAEKH3223E%2F20241218%2Fus-east-2%2Fs3%2Faws4_request\u0026X-Amz-Date=20241218T032953Z\u0026X-Amz-Expires=21600\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8295582119ab052a6ced62b33dcb1eb05824d32ed70d91c409172c5a804585b3\n```\n\nso we see that there is no indication of retrying anything and it is only 5 seconds from \"starting\" to 500 so likely we didn't retry at all?!\n\n\u003cdetails\u003e\n\u003csummary\u003e21 errors overall were reported\u003c/summary\u003e \n\n@Kevancic reported:  \"21 errors overall. 3 of them were complete errors and 18 were partial errors\" so they include some of those above due to non-retried 500s\n\n```\nComplete Error:\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS03_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr\n\nPartial/Downloading Error:\n\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS02_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS04_stain-Calretinin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS09_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS10_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS12_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS14_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS17_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS15_stain-NeuN_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Calretinin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Somatostatin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Calretinin_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS29_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS31_stain-Nuclei_SPIM.ome.zarr\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS38_stain-Nuclei_SPIM.ome.zarr\n```\n\n\u003c/details\u003e\n\nfor some of those \"Complete error\" we apparently didn't retry on 503, e.g.\n\n```shell\n❯ grep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57 2024.12.17-14.32.09Z-1959582.log\n2024-12-18T12:07:46-0500 [DEBUG   ] dandi 1959582:140290945971968 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57.dandidownload - no prior digests found; starting new download\n2024-12-18T12:07:46-0500 [DEBUG   ] dandi 1959582:140290945971968 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.HTTPError'\u003e, 503 Server Error: Service Unavailable for url: https://api.dandiarchive.org/api/zarr/70654e08-8aef-4526-bc5c-87c5b5adb660/files/?prefix=0/0/31/57\u0026download=true\n2024-12-18T12:07:46-0500 [DEBUG   ] dandi 1959582:140290945971968 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr/0/0/31/57 - download failed: 503 Server Error: Service Unavailable for url: https://api.dandiarchive.org/api/zarr/70654e08-8aef-4526-bc5c-87c5b5adb660/files/?prefix=0/0/31/57\u0026download=true\n```\n\nif we look across ALL 50X errors, we get to cover \n```\n❯ sed -e 's,.*sub-I48/,,g' -e 's,\\.zarr.*,.zarr,g' 50.s | sort | uniq -c | nl\n     1\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS02_stain-NeuN_SPIM.ome.zarr\n     2\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS03_stain-Somatostatin_SPIM.ome.zarr\n     3\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS04_stain-Calretinin_SPIM.ome.zarr\n     4\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Nuclei_SPIM.ome.zarr\n     5\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS05_stain-Somatostatin_SPIM.ome.zarr\n     6\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS09_stain-NeuN_SPIM.ome.zarr\n     7\t      4 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS10_stain-NeuN_SPIM.ome.zarr\n     8\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS12_stain-Somatostatin_SPIM.ome.zarr\n     9\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS14_stain-Somatostatin_SPIM.ome.zarr\n    10\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS15_stain-NeuN_SPIM.ome.zarr\n    11\t      4 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS16_stain-Nuclei_SPIM.ome.zarr\n    12\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS17_stain-NeuN_SPIM.ome.zarr\n    13\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Calretinin_SPIM.ome.zarr\n    14\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS27_stain-Somatostatin_SPIM.ome.zarr\n    15\t      8 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Calretinin_SPIM.ome.zarr\n    16\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Nuclei_SPIM.ome.zarr\n    17\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS28_stain-Somatostatin_SPIM.ome.zarr\n    18\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS29_stain-Nuclei_SPIM.ome.zarr\n    19\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS31_stain-Nuclei_SPIM.ome.zarr\n    20\t      2 ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS38_stain-Nuclei_SPIM.ome.zarr\n```\n\n20 zarrs.  and the only one which errored for some other reason is\n\n```\n❯ cat allerrored | while read errored; do grep -q \"${errored//sub-I48\\//}\" errored.50x || echo $errored; done\nsub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr\n```\n\n\u003cdetails\u003e\n\u003csummary\u003ebut I can't figure out what is wrong with it from the logs\n\u003c/summary\u003e \n\n```shell\n❯ grep 'sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr' 2024.12.17-14.32.09Z-1959582.log | grep Error\n2024-12-19T01:03:37-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/50.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:03:54-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/52.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:04:57-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/60.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:05:03-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/61.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:05:45-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:07:04-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:07:30-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/69.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:07:35-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/57.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:08:21-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/69.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:11:01-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/56/9.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:11:59-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/23.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:14:48-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/33.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:16:02-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/33.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:16:41-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/38.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:17:30-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/45.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:18:29-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/49.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:18:32-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/4.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:20:25-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/60.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:21:11-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/57/62.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:23:31-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/13.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:25:37-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/11.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:26:10-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/19.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:31:30-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/58/67.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:33:43-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/59/25.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:35:59-0500 [DEBUG   ] dandi 1959582:140297671284480 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/59/53.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:38:18-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/6/59.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:40:12-0500 [DEBUG   ] dandi 1959582:140291449272064 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/60/12.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T01:40:25-0500 [DEBUG   ] dandi 1959582:140297398621952 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/0/60/14.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ConnectionError'\u003e, HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out.\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ChunkedEncodingError'\u003e, (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 - download failed on attempt #1: (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n❯ grep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 2024.12.17-14.32.09Z-1959582.log\n2024-12-19T02:09:40-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - no prior digests found; starting new download\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - entered __exit__ with position 0 with exception: \u003cclass 'requests.exceptions.ChunkedEncodingError'\u003e, (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer'))\n2024-12-19T02:09:41-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 - download failed on attempt #1: (\"Connection broken: ConnectionResetError(104, 'Connection reset by peer')\", ConnectionResetError(104, 'Connection reset by peer')), will sleep a bit and retry\n2024-12-19T02:09:45-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - download directory exists and has matching checksum(s) {'md5'}; resuming download\n2024-12-19T02:09:47-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19.dandidownload - entered __exit__ with position 1167620 without any exception\n2024-12-19T02:09:47-0500 [DEBUG   ] dandi 1959582:140293596755712 sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 - verified that has correct md5 75e4a0fa34c3820a5802bc0f62a76a3a\n\n```\n\u003c/details\u003e\n\nbut the end of the logs looks truncated to me... could you run similar 3 commands on your copy of the log @Kevancic\n\n```\ngrep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr/0/1/1/19 2024.12.17-14.32.09Z-1959582.log\ngrep sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr[^/] 2024.12.17-14.32.09Z-1959582.log\ngrep 'sub-I48/ses-SPIM/micr/sub-I48_ses-SPIM_sample-BrocaAreaS43_stain-Calretinin_SPIM.ome.zarr[^/]' 2024.12.17-14.32.09Z-1959582.log\n```\n\n?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1734700895,"metadata":{"github-id":"IC_kwDODBZtRc6YaMdI","github-url":"https://github.com/dandi/dandi-cli/issues/1556#issuecomment-2557003592"},"message":"@yarikoptic Yes, this seems to be how `_check_if_more_attempts_allowed()` currently works.  Unless `DANDI_DOWNLOAD_AGGRESSIVE_RETRY` is set, any 5xx errors (which typically don't have \"Retry-After\" headers) will fall through to [here](https://github.com/dandi/dandi-cli/blob/29009f6811056561e7905ccf29b1480571b488a5/dandi/download.py#L1143) and return `None`, signifying no more attempts.  Isn't that how you wrote the code?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1734708782,"metadata":{"github-id":"IC_kwDODBZtRc6YbDth","github-url":"https://github.com/dandi/dandi-cli/issues/1556#issuecomment-2557229921"},"message":"thanks for the analysis, indeed it seems that I have refactored code in https://github.com/dandi/dandi-cli/pull/1509/files not reflecting that codepath. Could you please suggest a PR to fix?","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1734730046,"metadata":{"github-id":"CE_lADODBZtRc6kBG_1zwAAAAOqAg4T"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1737599371,"metadata":{"github-id":"IC_kwDODBZtRc6bfdsb","github-url":"https://github.com/dandi/dandi-cli/issues/1556#issuecomment-2608716571"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.66.4`](https://github.com/dandi/dandi-cli/releases/tag/0.66.4) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1737599371,"metadata":{"github-id":"LE_lADODBZtRc6kBG_1zwAAAAO75z9S"},"added":["released"],"removed":[]}]}