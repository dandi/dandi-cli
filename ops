{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1633536946,"metadata":{"github-id":"I_kwDODBZtRc48t8OX","github-url":"https://github.com/dandi/dandi-cli/issues/791","origin":"github"},"title":"Consider/use typer for CLI/Python API?","message":"On my way to NYC I have listened to the podcast (may be it was this one https://talkpython.fm/episodes/show/284/modern-and-fast-apis-with-fastapi) and discovered `typer`: \"Typer, build great CLIs. Easy to code. Based on Python type hints.\"\n\nI think it might be a nice match for dandi-cli and beyond to \"replace\" (it uses `click` underneath) `click` to\n- avoid duplication of params specification in decorators AND function signature\n- **provide both Python and CLI interfaces to the same functionality**! (which click AFAIK doesn't give us)\n- there is automated shell completion support for virtually all used shells -- quite nice\n\nHere is an example from https://typer.tiangolo.com/#an-example-with-two-subcommands which I ran from CL, and also imported as python module in \n\n\u003cdetails\u003e\n\u003csummary\u003ethe example and use in CLI, python, ipython\u003c/summary\u003e \n\n```shell\nlena:~/proj/dandi/trash\n$\u003e cat trytyper.py\n#!/usr/bin/env python3\nimport typer\n\napp = typer.Typer()\n\n\n@app.command()\ndef hello(name: str):\n    \"\"\"hello docstring\n\n    very long\n    \"\"\"\n    typer.echo(f\"Hello {name}\")\n\n\n@app.command()\ndef goodbye(name: str, formal: bool = False):\n    \"\"\"goodbye will be short\"\"\"\n    if formal:\n        typer.echo(f\"Goodbye Ms. {name}. Have a good day.\")\n    else:\n        typer.echo(f\"Bye {name}!\")\n\n\nif __name__ == \"__main__\":\n    app()\n1 18481.....................................:Wed 06 Oct 2021 11:59:37 AM EDT:.\nlena:~/proj/dandi/trash\n$\u003e ./trytyper.py goodbye --help\nUsage: trytyper.py goodbye [OPTIONS] NAME\n\n  goodbye will be short\n\nArguments:\n  NAME  [required]\n\nOptions:\n  --formal / --no-formal  [default: False]\n  --help                  Show this message and exit.\n1 18482.....................................:Wed 06 Oct 2021 12:00:00 PM EDT:.\nlena:~/proj/dandi/trash\n$\u003e ./trytyper.py goodbye --formal me\nGoodbye Ms. me. Have a good day.\n1 18483.....................................:Wed 06 Oct 2021 12:00:07 PM EDT:.\nlena:~/proj/dandi/trash\n$\u003e python3 -c 'import trytyper as m; m.goodbye(\"me\", True)'\nGoodbye Ms. me. Have a good day.\n1 18484.....................................:Wed 06 Oct 2021 12:00:16 PM EDT:.\nlena:~/proj/dandi/trash\n$\u003e ipython3\nPython 3.9.7 (default, Sep  3 2021, 06:18:44) \nType 'copyright', 'credits' or 'license' for more information\nIPython 7.20.0 -- An enhanced Interactive Python. Type '?' for help.\n\nIn [1]: import trytyper as m\n\nIn [2]: m.goodbye?\nSignature: m.goodbye(name: str, formal: bool = False)\nDocstring: goodbye will be short\nFile:      ~/proj/dandi/trash/trytyper.py\nType:      function\n\nIn [3]: m.hello?\nSignature: m.hello(name: str)\nDocstring:\nhello docstring\n\nvery long\nFile:      ~/proj/dandi/trash/trytyper.py\nType:      function\n\nIn [4]: m.hello??\nSignature: m.hello(name: str)\nSource:   \n@app.command()\ndef hello(name: str):\n    \"\"\"hello docstring\n\n    very long\n    \"\"\"\n    typer.echo(f\"Hello {name}\")\nFile:      ~/proj/dandi/trash/trytyper.py\nType:      function\n\nIn [5]:                                                                                                   \nDo you really want to exit ([y]/n)? \n1 18485.....................................:Wed 06 Oct 2021 12:00:48 PM EDT:.\nlena:~/proj/dandi/trash\n$\u003e ./trytyper.py --help\nUsage: trytyper.py [OPTIONS] COMMAND [ARGS]...\n\nOptions:\n  --install-completion [bash|zsh|fish|powershell|pwsh]\n                                  Install completion for the specified shell.\n  --show-completion [bash|zsh|fish|powershell|pwsh]\n                                  Show completion for the specified shell, to\n                                  copy it or customize the installation.\n\n  --help                          Show this message and exit.\n\nCommands:\n  goodbye  goodbye will be short\n  hello    hello docstring very long\n```\n\u003c/details\u003e\n\nso the only gotcha I spotted right away in above with typer 0.3.2-1 in Debian -- multiline docstring was not shown in ipython for `?`.\n\nWDYT @jwodder ?","files":null}]}