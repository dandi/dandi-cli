{"version":2,"ops":[{"type":3,"author":{"id":"0ab0e40999605aa8d5ec6be68372511fdc4a2fdf"},"timestamp":1680543412,"metadata":{"github-id":"IC_kwDODBZtRc5ZF51j","github-url":"https://github.com/dandi/dandi-cli/issues/1252#issuecomment-1494719843"},"message":"I think I located this one. It seems to work with `--allow-any-path` and this is by design because [we don't just want to accept `GenericAsset`s](https://github.com/dandi/dandi-cli/blob/47e9d97e2535d66d89edafa3d0a83603f3966dac/dandi/files/__init__.py#L146-L147). @jwodder  Should I create a built-in whitelist for known `GenericAsset`s, or is the solution to just make sure they're detected as something else? \n\n```\n(dev) [deco]~/src/bids-examples/asl003 ‚ù± DANDI_DEVEL=1 dandi upload -i dandi-staging --allow-any-path README\n2023-04-03 12:53:01,245 [    INFO] Note: NumExpr detected 12 cores but \"NUMEXPR_MAX_THREADS\" not set, so enforcing safe limit of 8.\n2023-04-03 12:53:01,245 [    INFO] NumExpr defaulting to 8 threads.\n/home/chymera/src/bids-examples/asl003/README\nGenericAsset(filepath=PosixPath('/home/chymera/src/bids-examples/asl003/README'), dandiset_path=PosixPath('/home/chymera/src/bids-examples/asl003'), path='README')\n2023-04-03 12:53:03,101 [    INFO] Found 1 files to consider\nPATH                 SIZE      ERRORS UPLOAD STATUS                MESSAGE\nREADME               232 Bytes   0           ERROR                 Error 404 while sending POST request to https://api-staging.dandiarchi...\nSummary:             232 Bytes               1 ERROR               1 Error 404 while sending POST request to https://api-staging.dandiarc...\n```","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1680544745,"metadata":{"github-id":"IC_kwDODBZtRc5ZGAGp","github-url":"https://github.com/dandi/dandi-cli/issues/1252#issuecomment-1494745513"},"message":"@TheChymera - given bids support, we should no longer need to use either `DANDI_DEVEL`, `--allow-any-path` or `--validation ignore`. thus in this case i expect the system to automatically detect that the `README` file is within a dandiset, and that it's a BIDS dandiset.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680549760,"metadata":{"github-id":"IC_kwDODBZtRc5ZGaVR","github-url":"https://github.com/dandi/dandi-cli/issues/1252#issuecomment-1494852945"},"message":"Given that we have odd behavior of silently ignoring non-nwb/video files in DANDI I think we should change/generalize behavior of `validate` and `upload` to be\n- walk the dandiset, possibly just the provided directory within, for all non-dotdirectories (i.e. `.dandi/`, `.git/`, `.datalad/` ATM) and discover all paths\n- validate those paths according to either DANDI or BIDS (as already implemented) and \n  - report failed validation on non-compliant (now we simply silently ignore non .nwb/video files in DANDI or BIDS seems to me)\n  - upload the ones which are valid","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1681740101,"metadata":{"github-id":"IC_kwDODBZtRc5aFlaS","github-url":"https://github.com/dandi/dandi-cli/issues/1252#issuecomment-1511413394"},"message":"@yarikoptic @TheChymera To be clear, if the user passes to `dandi upload` only some of the paths in a BIDS dataset, we still need to take all files in the BIDS dataset into account for validation purposes, correct?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1681764504,"metadata":{"github-id":"IC_kwDODBZtRc5aIElJ","github-url":"https://github.com/dandi/dandi-cli/issues/1252#issuecomment-1512065353"},"message":"Your question/comment @jwodder above is in agreement with what I said during our standup today because in principle (since probably not yet implemented in the bids validator code) validating some files in BIDS dandiset might require knowledge/content of other files in BIDS dataset (e.g. while uploading `_scans.tsv` files to ensure that they point to the correct/existing files etc).  That is partially why the \"canonical\" bids-validator operates AFAIK only on the entire/complete BIDS datasets which has pros and cons to it.\n\nSome *naive utopian*, but somewhat an ideal solution could have probably been: run validator on all files but then filter results/errors only for the paths which were provided by the user.  It would be \"naive utopian\" in that it would indeed account for any possible intricate dependencies within BIDS dataset hierarchy, while \"affecting\" upload of only the paths user points to. If user does not restrict to any paths -- all validation errors are \"in affect\".\n\nGiven the \"hierarchical\" organization of BIDS and its inheritance principle that metadata could be inherited from directories up the hierarchy, I think we could \"optimize\" aforementioned *naive* to: take only the files from the top of the dataset to the paths pointed to by the user, validate this \"subset\" of the dataset, and filter for the records specifically for the paths limited to by the user.  An example: `dandi upload sub-12*/sub-2` would \n- pass following subset of paths for validation\n  - all files in the top folder (`README`, `dataset_description.json`, `task-*.json` etc), so possibly required metadata fields etc do become available while validating individual files under specific `sub-12*/ses-2` folders\n  - all files under `sub-12*/` folders (might have some extra metadata overloads for inheritance principle)\n  - all files/subfolders under `sub-12*/sub-2`.\n- I think upload of individual files should not fail for validation at dandiset/dataset scope, and only consider results for individual files, subselecting results for [ValidationResult.path](https://github.com/dandi/dandi-cli/blob/HEAD/dandi/validate_types.py#L51) to be among the ones user specificed, so in this case matching to be under all those `sub-12*/sub-2` folders which shell expanded to.\n\nMay be @TheChymera or @effigies sees immediately where such \"optimization\" of validation could potentially fail?","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1684441485,"metadata":{"github-id":"CE_lADODBZtRc5hKLRCzwAAAAIpVye4"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1684441563,"metadata":{"github-id":"IC_kwDODBZtRc5cmh-Y","github-url":"https://github.com/dandi/dandi-cli/issues/1252#issuecomment-1553604504"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.55.0`](https://github.com/dandi/dandi-cli/releases/tag/0.55.0) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1684441564,"metadata":{"github-id":"LE_lADODBZtRc5hKLRCzwAAAAIpV0mI"},"added":["released"],"removed":[]}]}