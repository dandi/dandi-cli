{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1600193964,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY5Mjg5MDA1MA==","github-url":"https://github.com/dandi/dandi-cli/issues/240#issuecomment-692890050"},"message":"The change was in the `dandiset.yaml` file, correct?  What should happen to this file between downloading and uploading?  The dandiset has to be registered before uploading, which means modifying the `dandiset.yaml`.  Currently, if the file is present when registering, the old keys will be added to the file next to the new \"dandiset\" key.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1600196530,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY5MjkxNTUyMw==","github-url":"https://github.com/dandi/dandi-cli/issues/240#issuecomment-692915523"},"message":"My current working idea is that the problem was introduced by me in #233 where I have tried to \"unify\" metadata records of \"draft\" (from girder) dandiset metadata records to look like the ones returned by \"published\" (from API) ones.  But that was done without \"account\" for `upload` also uploading that (now changed?) `dandiset.yaml` as metadata record for the dandiset (folder)... so self-inflicted mess ;-)  If I got it right - such as test would be handy, I think on current master it should fail to upload.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1600196778,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY5MjkxODI2OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/240#issuecomment-692918269"},"message":"OK, but should the test leave the `dandiset.yaml` that gets downloaded from the archive alone, should it delete it before calling `register()`, should `register()` even be called, what?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1600196850,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY5MjkxODg4Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/240#issuecomment-692918886"},"message":"that is what I wonder -- can we `upload` (to local instance) without `register` call?  I think upload will just generate that folder and proceed","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1600197153,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY5MjkyMTU3OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/240#issuecomment-692921579"},"message":"If I try calling `upload()` without registering (using the latest code on master), it fails because `dandiset.yaml` doesn't contain a top-level \"identifier\" key:\n\n```\n/Users/jwodder/dartmouth/dandi-cli/dandi/tests/test_upload.py:161: in test_upload_external_download\n    upload(paths=[], dandi_instance=dandi_instance_id, devel_debug=True)\n/Users/jwodder/dartmouth/dandi-cli/dandi/upload.py:51: in upload\n    ds_identifier = dandiset.identifier\n/Users/jwodder/dartmouth/dandi-cli/dandi/dandiset.py:90: in identifier\n    return self.metadata[\"identifier\"]\nE   KeyError: 'identifier'\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1600198089,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDY5MjkyOTI0OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/240#issuecomment-692929249"},"message":"yeap, that is the bug due to \"unification\" I was talking about. Just send a PR with a failing  test and I am still thinking about proper \"resolution\" here.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1600697678,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50Mzc4ODkwMTM0Nw=="},"status":2}]}