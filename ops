{"version":2,"ops":[{"type":6,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1631804303,"metadata":{"github-id":"UCE_lAHODBZtRc47gHSmziQ6bz8"},"target":"e7e19e1b210af8570e07be649bae7b4769e4240daaa94a602f2f4977295af205","message":"As discussed in https://github.com/dandi/helpdesk/discussions/30, it would be useful to have a way to upload stand-alone video files to DANDI and have them be associated with NWB files.\n\nThe way NWB handles this is to support linking to external files. In the `ImageSeries` object, you have the option to specify an external_path of a video file. This file is usually in the same folder as the NWB file. Then, instead of reading the data internally, an API would know to read the data from the designated location. It seems that would be a bit tricky to  implement on DANDI, because the files use web-based referencing instead of a local file system. Maybe the best approach would be to change the value in `external_path` to an s3 location. I don't think think could be done during `dandi organize` because that s3 location would not yet be known. @yarikoptic do you have any ideas for how we might implement this?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1631805244,"metadata":{"github-id":"IC_kwDODBZtRc425Tr1","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-920992501"},"message":"Some bullet point thoughts\n- I don't think we should have s3 dandiarchive location paths in the nwb file: overfits for the archive, and would not be easily \"usable\" locally if file is e.g. already downloaded.\n  - within our extracted metadata - yes we should \"link\" them somehow (problem -- asset IDs are mutable, we don't want to change linkage with a minimal extracted metadata change, blob IDs are not really a semantic descriptor, but probably the best fit here)\n- another problem is that `external_path` then needs to be adjusted by `dandi organize` (so no symlinks, etc modes; copy or modify data files)!  That would end up \"expensive\" and lengthy etc.\n- above aspect is not \"unique\" - we were already thinking about possible ways how metadata changes in .nwb could be \"sidecar\"-ed in some supplementary lightweight file/record.\n- We can easily implement it at dandi (-cli, whatnot) level with e.g. a matching .json (I think it would end up being consistent  with BIDS usage of .json) and add fields there to provide such linkage/overloads between files, and then incorporate that information within dandischema representation using semantic linkage annotation\n- ideally there should be nwb-level solution: not just `external_path` for a specific \"entry\" , but establish chaining of the multiple (or at least two) .nwb files:\n  - then `dandi organize` could populate those \"next one\" file with any desired overrides, without needing to modify the original file","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1631827882,"metadata":{"github-id":"IC_kwDODBZtRc426XGM","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-921268620"},"message":"\u003e ideally there should be nwb-level solution: not just external_path for a specific \"entry\" , but establish chaining of the multiple (or at least two) .nwb files:\n\nWhat do you mean by an nwb-level solution? You can already chain together two NWB files with external links, but that has all the same problems as you mention above. Are you talking about a separate text file that links two files together? Also, note that linking two nwb files together would not solve the current problem, because one of the files needs to be a standard video file (like .mp4)","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1631828606,"metadata":{"github-id":"IC_kwDODBZtRc426Y3w","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-921275888"},"message":"I thought about having 3 files:\n- whatsoever_modalities.nwb - the original data etc, just renamed\n- whatsoever.mp4 - video, just renamed\n- whatsoever.nwb - small file we (organize) creates which \n  - chains into whatsoever_modalities.nwb (relative path)\n  - has video ( whatsoever.mp4) referenced via external_path for that video modality data type\n  - overrides (if possible) for any metadata (or data?) we need to tune","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1631828637,"metadata":{"github-id":"UCE_lALODBZtRc426Y3wzh28r7E"},"target":"9d71fa8138647985adfe243591ee0a0419a782f101ff20fd65209b4a32e0f26e","message":"I thought about having 3 files:\n- whatsoever_modalities.nwb - the original data etc, just renamed\n- whatsoever.mp4 - video, just renamed\n- whatsoever.nwb - small file we (`dandi organize`) creates which \n  - chains into whatsoever_modalities.nwb (relative path)\n  - has video ( whatsoever.mp4) referenced via external_path for that video modality data type\n  - overrides (if possible) for any metadata (or data?) we need to tune","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1631828714,"metadata":{"github-id":"UCE_lALODBZtRc426Y3wzh28sTc"},"target":"9d71fa8138647985adfe243591ee0a0419a782f101ff20fd65209b4a32e0f26e","message":"I thought about having 3 files:\n- whatsoever_modalities.nwb - the original data etc, just renamed\n- whatsoever.mp4 - video, just renamed\n- whatsoever.nwb - small file we (`dandi organize`) creates which \n  - chains into whatsoever_modalities.nwb (relative path)\n  - has video ( whatsoever.mp4) referenced via external_path for that video modality data type\n  - overrides (if possible) for any metadata (or data?) we need to tune\n\nThe point will be for users to load whatever.nwb to get most compete representation , or if desired, load individual files","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1631830314,"metadata":{"github-id":"IC_kwDODBZtRc426cS4","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-921289912"},"message":"so for web based access, someone would need to check via the path api if these files exist? this seems to build in assumptions like bids into a naming scheme. can we also come up with something that allows some referencing just on the Web. should dandi server update metadata record to inject related resource links?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1631835034,"metadata":{"github-id":"IC_kwDODBZtRc426md-","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-921331582"},"message":"If there was a way to specify multiple alternative external_path (pretty much like git annex does), then we could have added urls to point to end point to fetch blob by digest or Sha 256","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1631835104,"metadata":{"github-id":"UCE_lALODBZtRc426md-zh29JBs"},"target":"841abd1a861251889685651b3cbce1f85242cf1b22352cd8480c6a0585fa2e1d","message":"If there was a way to specify multiple alternative external_path (pretty much like git annex does), then we could have added urls to point to end point to fetch blob by digest or Sha 256.\nSo may be just a matter of making those external references to lists within nwb?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1646844447,"metadata":{"github-id":"IC_kwDODBZtRc4_Xhks","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-1063131436"},"message":"@bendichter Should we consider this issue closed by #841 which added support for `organize`ing video files into dandisets?","files":null},{"type":3,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1646846030,"metadata":{"github-id":"IC_kwDODBZtRc4_Xo8Q","github-url":"https://github.com/dandi/dandi-cli/issues/769#issuecomment-1063161616"},"message":"yes!","files":null},{"type":4,"author":{"id":"f068089e26f6e2e30d51a62e75a77af7d9dc5ecb"},"timestamp":1646846030,"metadata":{"github-id":"CE_lADODBZtRc47gHSmzwAAAAFyPovA"},"status":2}]}