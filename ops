{"version":2,"ops":[{"type":1,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1732593902,"metadata":{"github-id":"I_kwDODBZtRc6ghBqw","github-url":"https://github.com/dandi/dandi-cli/issues/1541","origin":"github"},"title":"Test failures of `No module named 'hdmf.array'`","message":"Only the `ubuntu-latest, 3.9, dev-deps` CI workflow has 14 failures of `No module named 'hdmf.array'`.  See [latest run](https://github.com/dandi/dandi-cli/actions/runs/12020160010/job/33508218907).  \n\n\u003cdetails\u003e\n\n\u003csummary\u003eError logs from latest run\u003c/summary\u003e\n\n```\n=================================== FAILURES ===================================\n____________________________ test_validate_severity ____________________________\ndandi/cli/tests/test_cmd_validate.py:33: in test_validate_severity\n    assert r.exit_code == 0\nE   assert 1 == 0\nE    +  where 1 = \u003cResult SystemExit(1)\u003e.exit_code\n------------------------------ Captured log setup ------------------------------\nINFO     dandi:organize.py:838 Loading metadata from 1 files\nINFO     dandi:organize.py:1079 Organized 1 paths. Visit /tmp/pytest-of-runner/pytest-0/organized_nwb_dir0/\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:base.py:134 Caught exception No module named 'hdmf.array'\n_____________________________ test_validate_ignore _____________________________\ndandi/cli/tests/test_cmd_validate.py:49: in test_validate_ignore\n    assert \"DANDI.NO_DANDISET_FOUND\" in r.output\nE   assert 'DANDI.NO_DANDISET_FOUND' in \"Error: No module named 'hdmf.array'\\n\"\nE    +  where \"Error: No module named 'hdmf.array'\\n\" = \u003cResult SystemExit(1)\u003e.output\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:base.py:134 Caught exception No module named 'hdmf.array'\n_______________________ test_validate_nwb_path_grouping ________________________\ndandi/cli/tests/test_cmd_validate.py:60: in test_validate_nwb_path_grouping\n    assert r.exit_code == 0\nE   assert 1 == 0\nE    +  where 1 = \u003cResult SystemExit(1)\u003e.exit_code\n------------------------------ Captured log setup ------------------------------\nINFO     dandi:organize.py:838 Loading metadata from 2 files\nINFO     dandi:organize.py:1079 Organized 2 paths. Visit /tmp/pytest-of-runner/pytest-0/organized_nwb_dir1/\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:base.py:134 Caught exception No module named 'hdmf.array'\n_____________________________ test_smoke[command1] _____________________________\ndandi/cli/tests/test_command.py:18: in test_smoke\n    assert r.exit_code == 0, f\"Exited abnormally. out={r.stdout}\"\nE   AssertionError: Exited abnormally. out=Error: No module named 'hdmf.array'\nE     \nE   assert 1 == 0\nE    +  where 1 = \u003cResult SystemExit(1)\u003e.exit_code\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:base.py:134 Caught exception No module named 'hdmf.array'\n____________________________ test_validate_simple1 _____________________________\ndandi/tests/test_files.py:325: in test_validate_simple1\n    errors = dandi_file(simple1_nwb).get_validation_errors(\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n_______________________ test_validate_simple1_no_subject _______________________\ndandi/tests/test_files.py:332: in test_validate_simple1_no_subject\n    errors = dandi_file(simple1_nwb).get_validation_errors()\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n____________________________ test_validate_simple2 _____________________________\ndandi/tests/test_files.py:342: in test_validate_simple2\n    errors = dandi_file(\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n__________________________ test_validate_simple2_new ___________________________\ndandi/tests/test_files.py:351: in test_validate_simple2_new\n    errors = dandi_file(\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n_____________________ test_validate_simple3_no_subject_id ______________________\ndandi/tests/test_files.py:359: in test_validate_simple3_no_subject_id\n    errors = dandi_file(simple3_nwb).get_validation_errors()\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n_____________________________ test_validate_bogus ______________________________\ndandi/tests/test_files.py:377: in test_validate_bogus\n    errors = dandi_file(path).get_validation_errors()\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n_____________________________ test_upload_download _____________________________\ndandi/tests/test_upload.py:39: in test_upload_download\n    new_dandiset.upload()\ndandi/tests/fixtures.py:561: in upload\n    upload(\ndandi/upload.py:431: in upload\n    for v in process_path(dfile):\ndandi/upload.py:264: in process_path\n    validation_statuses = dfile.get_validation_errors()\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n------------------------------ Captured log setup ------------------------------\nDEBUG    dandi:dandiapi.py:198 POST http://localhost:8000/api/dandisets/\nDEBUG    dandi:dandiapi.py:262 Response: 200\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:dandiapi.py:198 GET http://localhost:8000/api/info/\nDEBUG    dandi:dandiapi.py:262 Response: 200\nDEBUG    dandi:dandiapi.py:494 Using api key from DANDI_API_KEY environment variable\nDEBUG    dandi:dandiapi.py:198 GET http://localhost:8000/api/auth/token\nDEBUG    dandi:dandiapi.py:262 Response: 200\nDEBUG    dandi:dandiset.py:128 Found identifier 000226 in top level 'identifier'\nINFO     dandi:upload.py:214 Found 2 files to consider\n_________________________ test_upload_invalid_metadata _________________________\ndandi/tests/test_upload.py:278: in test_upload_invalid_metadata\n    new_dandiset.upload()\ndandi/tests/fixtures.py:561: in upload\n    upload(\ndandi/upload.py:431: in upload\n    for v in process_path(dfile):\ndandi/upload.py:264: in process_path\n    validation_statuses = dfile.get_validation_errors()\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n------------------------------ Captured log setup ------------------------------\nDEBUG    dandi:dandiapi.py:198 POST http://localhost:8000/api/dandisets/\nDEBUG    dandi:dandiapi.py:262 Response: 200\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:dandiapi.py:198 GET http://localhost:8000/api/info/\nDEBUG    dandi:dandiapi.py:262 Response: 200\nDEBUG    dandi:dandiapi.py:494 Using api key from DANDI_API_KEY environment variable\nDEBUG    dandi:dandiapi.py:198 GET http://localhost:8000/api/auth/token\nDEBUG    dandi:dandiapi.py:262 Response: 200\nDEBUG    dandi:dandiset.py:128 Found identifier 000247 in top level 'identifier'\nINFO     dandi:upload.py:214 Found 2 files to consider\n___________________________ test_validate_nwb_error ____________________________\ndandi/tests/test_validate.py:16: in test_validate_nwb_error\n    assert len([i for i in validation_result if i.severity]) \u003e 0\ndandi/tests/test_validate.py:16: in \u003clistcomp\u003e\n    assert len([i for i in validation_result if i.severity]) \u003e 0\ndandi/validate.py:161: in validate\n    yield from df.get_validation_errors(\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n_____________________ test_validate_bids[ieeg_epilepsyNWB] _____________________\ndandi/tests/test_validate.py:54: in test_validate_bids\n    for i in validation_result:\ndandi/validate.py:161: in validate\n    yield from df.get_validation_errors(\ndandi/files/bids.py:223: in get_validation_errors\n    return NWBAsset.get_validation_errors(\ndandi/files/bases.py:512: in get_validation_errors\n    from nwbinspector import Importance, inspect_nwbfile, load_config\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/__init__.py:6: in \u003cmodule\u003e\n    from ._nwb_inspection import (\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/nwbinspector/_nwb_inspection.py:12: in \u003cmodule\u003e\n    from hdmf_zarr import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/__init__.py:1: in \u003cmodule\u003e\n    from .backend import ZarrIO\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/backend.py:24: in \u003cmodule\u003e\n    from .zarr_utils import BuilderZarrReferenceDataset, BuilderZarrTableDataset\n/opt/hostedtoolcache/Python/3.9.20/x64/lib/python3.9/site-packages/hdmf_zarr/zarr_utils.py:14: in \u003cmodule\u003e\n    from hdmf.array import Array\nE   ModuleNotFoundError: No module named 'hdmf.array'\n------------------------------ Captured log call -------------------------------\nWARNING  bids-schema:validator.py:341 No BIDS reference root provided.\nINFO     bids-schema:validator.py:292 SUCCESS: All files are BIDS valid and no BIDS-required files are missing.\n\n---------- coverage: platform linux, python 3.9.20-final-0 -----------\nCoverage XML written to file coverage.xml\n\n============================= slowest 10 durations =============================\n54.81s call     dandi/tests/test_dandiapi.py::test_rename_type_mismatch[subdir1/apple.txt/core.dat]\n50.71s setup    dandi/cli/tests/test_service_scripts.py::test_reextract_metadata\n19.20s call     dandi/tests/test_metadata.py::test_bids_nwb_metadata_integration\n9.43s call     dandi/tests/test_dandiapi.py::test_get_dandiset_published_other_version[True]\n9.39s call     dandi/tests/test_dandiapi.py::test_get_dandiset_published_other_version[False]\n8.64s call     dandi/tests/test_download.py::test_download_000027[https://dandiarchive.org/dandiset/000027/0.210831.2033]\n8.14s call     dandi/tests/test_organize.py::test_organize_nwb_test_data[1-dry]\n7.96s call     dandi/tests/test_download.py::test_download_newest_version\n7.54s call     dandi/tests/test_dandiapi.py::test_publish_and_manipulate\n6.94s call     dandi/tests/test_upload.py::test_upload_bids_zarr\n=========================== short test summary info ============================\nFAILED dandi/cli/tests/test_cmd_validate.py::test_validate_severity - assert 1 == 0\n +  where 1 = \u003cResult SystemExit(1)\u003e.exit_code\nFAILED dandi/cli/tests/test_cmd_validate.py::test_validate_ignore - assert 'DANDI.NO_DANDISET_FOUND' in \"Error: No module named 'hdmf.array'\\n\"\n +  where \"Error: No module named 'hdmf.array'\\n\" = \u003cResult SystemExit(1)\u003e.output\nFAILED dandi/cli/tests/test_cmd_validate.py::test_validate_nwb_path_grouping - assert 1 == 0\n +  where 1 = \u003cResult SystemExit(1)\u003e.exit_code\nFAILED dandi/cli/tests/test_command.py::test_smoke[command1] - AssertionError: Exited abnormally. out=Error: No module named 'hdmf.array'\n  \nassert 1 == 0\n +  where 1 = \u003cResult SystemExit(1)\u003e.exit_code\nFAILED dandi/tests/test_files.py::test_validate_simple1 - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_files.py::test_validate_simple1_no_subject - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_files.py::test_validate_simple2 - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_files.py::test_validate_simple2_new - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_files.py::test_validate_simple3_no_subject_id - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_files.py::test_validate_bogus - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_upload.py::test_upload_download - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_upload.py::test_upload_invalid_metadata - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_validate.py::test_validate_nwb_error - ModuleNotFoundError: No module named 'hdmf.array'\nFAILED dandi/tests/test_validate.py::test_validate_bids[ieeg_epilepsyNWB] - ModuleNotFoundError: No module named 'hdmf.array'\nERROR dandi/cli/tests/test_service_scripts.py::test_reextract_metadata - ModuleNotFoundError: No module named 'hdmf.array'\n= 14 failed, 694 passed, 1 skipped, 3 xfailed, 13 xpassed, 1 error in 778.37s (0:12:58) =\n```\n\n\u003c/details\u003e","files":null}]}