{"version":2,"ops":[{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1744664628,"metadata":{"github-id":"UCE_lAHODBZtRc6yd36Wzne8TVw"},"target":"4581e78eab16c2a8400f9034dba9f6bc7db5f15bc2fb77b160bb3656b6e2bc08","message":"This error was observed by @ayendiki when uploading data to LINC Archive on version `0.67.3` (all issues were resolved once downgrading to `0.67.0`) -- both commands failed at `0.67.3`:\n\n```\ndandi upload -i linc 000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz\n```\n\nand \n\n```\nDANDI_DEVEL=1 dandi upload -i linc --validation skip 000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz\n```\n\nInvestigating now -- but the errors that came about signaled that BIDS validation was occuring on all files in the directory, even though upload was centered purely on `000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz` with a error shown down below:\n\n```\n$ dandi upload -i linc 000003/derivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz\n2025-04-14 15:19:54,352 [    INFO] Found 2 files to consider\n$\u003c2\u003ePATH$\u003c2\u003e $\u003c2\u003e$\u003c2\u003ePATH$\u003c2\u003e                                                                                       $\u003c2\u003eSIZE$\u003c2\u003e    $\u003c2\u003eERRORS$\u003c2\u003e $\u003c2\u003ePROGRESS$\u003c2\u003e $\u003c2\u003eSTATUS$\u003c2\u003e $\u003c2\u003eMESSAGE$$\u003c2\u003e$\u003c2\u003ePATH$\u003c2\u003e                                                                                       $\u003c2\u003eSIZE$\u003c2\u003e    $\u003c2\u003eERRORS$\u003c2\u003e $\u003c2\u003ePROGRESS$\u003c2\u003e $\u003c2\u003eSTATUS$\u003c2\u003e    $\u003c2\u003eM$\u003c2\u003e$\u003c2\u003ePATH$\u003c2\u003e                                                                                       $\u003c2\u003eSIZE$\u003c2\u003e    $\u003c2\u003eERRORS$\u003c2\u003e $\u003c2\u003ePROGRESS$\u003c2\u003e $\u003c2\u003eSTATUS$\u003c2\u003e           $\u003c2\u003eMESSAGE$\u003c2\u003e                                                                     1.6 kB                  skipped   should be edited online\n$\u003c2\u003e$\u003c2\u003edandiset.yaml$\u003c2\u003e                                                                              1.6 kB                  skipped          should be edited online\n$\u003c2\u003e$\u003c2\u003ederivatives/histology/sub-MF278/sub-MF278_stacked_blockface_masked_grayscale_level4.nii.gz$\u003c2\u003e 4.9 MB                  pre-validating\nSummary:                                                                                   4.9 MB                  1 skipped        1 should be edited online\n                                                                                                                   1 pre-validating\n--- Logging error ---\nTraceback (most recent call last):\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 1160, in emit\n    msg = self.format(record)\n          ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 999, in format\n    return fmt.format(record)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 703, in format\n    record.message = record.getMessage()\n                     ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 392, in getMessage\n    msg = msg % self.args\n          ~~~~^~~~~~~~~~~\nValueError: unsupported format character '`' (0x60) at index 25\nCall stack:\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/threading.py\", line 1032, in _bootstrap\n    self._bootstrap_inner()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/threading.py\", line 1075, in _bootstrap_inner\n    self.run()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/threading.py\", line 1012, in run\n    self._target(*self._args, **self._kwargs)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/concurrent/futures/thread.py\", line 92, in _worker\n    work_item.run()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/pyout/interface.py\", line 482, in async_fn\n    for i in gen:\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/upload.py\", line 264, in process_path\n    validation_statuses = dfile.get_validation_errors()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 285, in get_validation_errors\n    return GenericAsset.get_validation_errors(\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bases.py\", line 185, in get_validation_errors\n    asset = self.get_metadata(digest=self._DUMMY_DIGEST)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 199, in get_metadata\n    metadata = self.bids_dataset_description.get_asset_metadata(self)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 128, in get_asset_metadata\n    self._validate()\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/files/bids.py\", line 90, in _validate\n    results = validate_bids(self.bids_root)\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/dandi/validate.py\", line 47, in validate_bids\n    validation_result = validate_bids_(paths, exclude_files=[\"dandiset.yaml\"])\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/bidsschematools/validator.py\", line 644, in validate_bids\n    validation_result = validate_all(\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/bidsschematools/validator.py\", line 432, in validate_all\n    lgr.debug(\"\\t* `%s`, with pattern: `%`\", target_path, target_regex)\nMessage: '\\t* `%s`, with pattern: `%`'\nArguments: ('/autofs/space/aspasia_002/users/linc/000003/participants.tsv', '(?:.*/)?(?P\u003cpath\u003edataset_description\\\\.json)(?:/.*)?\\\\Z')\n--- Logging error ---\nTraceback (most recent call last):\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 1160, in emit\n    msg = self.format(record)\n          ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 999, in format\n    return fmt.format(record)\n           ^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 703, in format\n    record.message = record.getMessage()\n                     ^^^^^^^^^^^^^^^^^^^\n  File \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/logging/__init__.py\", line 392, in getMessage\n    msg = msg % self.args\n```","files":null},{"type":3,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1744663863,"metadata":{"github-id":"IC_kwDODBZtRc6nEbWX","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2802955671"},"message":"Cc @candleindark @yarikoptic @satra @kabilar","files":null},{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1744664042,"metadata":{"github-id":"UCE_lALODBZtRc6nEbWXzmNpdsY"},"target":"60d5ef5765ca594095844f2bb7c7f19b6f590dd55d95ea28c3c57c4e545020e4","message":"Cc @candleindark @yarikoptic @satra @kabilar @jwodder","files":null},{"type":3,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1744664198,"metadata":{"github-id":"IC_kwDODBZtRc6nEeDt","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2802966765"},"message":"Tagging https://github.com/dandi/dandi-cli/pull/1591 as it may be a source of error -- looking closer....","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744665443,"metadata":{"github-id":"IC_kwDODBZtRc6nExag","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803046048"},"message":"It is a bug in logging in bidsschematools - missing s for the second %\n\n```\n\nFile \"/autofs/space/aspasia_002/users/code/miniforge3/envs/dandi/lib/python3.12/site-packages/bidsschematools/validator.py\", line 432, in validate_all\n    lgr.debug(\"\\t* `%s`, with pattern: `%`\", target_path, target_regex)\n```\nI thought i submitted a fix but I fail to find it so likely I didn't.\n\nBut also the question if we should reduce logging to INFO there by default","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744666042,"metadata":{"github-id":"IC_kwDODBZtRc6nE2aw","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803066544"},"message":"Submitted\n- https://github.com/bids-standard/bids-specification/pull/2102\nwhile on the phone... Please try out if you can @aaronkanzer happen there is more such bugs there","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744666077,"metadata":{"github-id":"IC_kwDODBZtRc6nE2q9","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803067581"},"message":"I think, in general, the default log level should be INFO. The DEBUG log level is for debugging purposes. The DEBUG log level produces too much information for regular use, and I think a point to have a DEBUG level is to have a level to put verbose info without cluttering the log in regular use.","files":null},{"type":6,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744666151,"metadata":{"github-id":"UCE_lALODBZtRc6nE2q9zmNqmZw"},"target":"3d297ab910f3fb806e297cd9faab333f50b7884cb35e85c0f928914829c4de63","message":"\u003e But also the question if we should reduce logging to INFO there by default\n\nI think, in general, the default log level should be INFO. The DEBUG log level is for debugging purposes. The DEBUG log level produces too much information for regular use, and I think a point to have a DEBUG level is to have a level to put verbose info without cluttering the log in regular use.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744666347,"metadata":{"github-id":"IC_kwDODBZtRc6nE4ln","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803075431"},"message":"Yes, BUT we log into a file at debug level iirc and it already came handy to be able to introspect what went wrong since in many use cases (connections etc), it is impossible to reproduce","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744666472,"metadata":{"github-id":"IC_kwDODBZtRc6nE5gF","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803079173"},"message":"The question here is how to work around. If log filtering is done before formatting - then we could filter that log on current versions of bidsschematools","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744666503,"metadata":{"github-id":"IC_kwDODBZtRc6nE5x3","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803080311"},"message":"Or just raise to INFO for bidsschematools only for now","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1744666764,"metadata":{"github-id":"IC_kwDODBZtRc6nE7wT","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803088403"},"message":"\u003e Yes, BUT we log into a file at debug level iirc and it already came handy to be able to introspect what went wrong since in many use cases (connections etc), it is impossible to reproduce\n\nI think that if that information is essential, not just for debugging purpose, then it should be logged `lgr.info` or above.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1744677809,"metadata":{"github-id":"IC_kwDODBZtRc6nGQIg","github-url":"https://github.com/dandi/dandi-cli/issues/1611#issuecomment-2803434016"},"message":"it is potentially essential for debugging, thus at debug level logged into a file which is IMHO appropriate level.  `bidsschematools` got a fix and hopefully would get released soon.  It might be interesting to understand why it surfaced just now, but not critical.  @aaronkanzer would you have a chance to try with fixed up bidsschematools?","files":null}]}