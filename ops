{"version":2,"ops":[{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635360071,"metadata":{"github-id":"UCE_lAHODBZtRc492qneziXJaBo"},"target":"8ec2807815d6ecd90803909a4ebb4134ab1013760949493512704fb6e54b6ea1","message":"discovered during walkthrough by @bendichter \n```\nlena:/tmp\n$\u003e dandi download 'https://gui-staging.dandiarchive.org/#/dandiset/100507'\nPATH                        SIZE      DONE     DONE% CHECKSUM STATUS          MESSAGE   \ndandiset.yaml                                                 done            updated   \nsub-001/sub-001_ecephys.nwb 241.8 kB  241.8 kB  100%    ok    done                      \nSummary:                    241.8 kB  241.8 kB                2 done          1 updated \n                                      100.00%                                           \n2021-10-27 14:36:03,538 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20211027183556Z-3690277.log\n\n$\u003e dandi download 'https://gui-staging.dandiarchive.org/#/dandiset/100507'\nPATH                 SIZE DONE    DONE% CHECKSUM STATUS MESSAGE   \ndandiset.yaml                                           updating  \nSummary:                  0 Bytes                       1 updating\n                          \u003c0.00%                                  \n2021-10-27 14:36:12,039 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20211027183608Z-3690314.log\nError: ./100507/dandiset.yaml\n```\n\n- it should have not error-ed out -- should have updated (if there was a change to that file) or just reported skipped (the same)\n- `error` should be reported in that pyout table instead of `updating` instead of printed at the end\n\nI think it might be a regression of some kind since I strongly believe I have done such repeated redownload before without issues.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1635449904,"metadata":{"github-id":"IC_kwDODBZtRc443xKi","github-url":"https://github.com/dandi/dandi-cli/issues/819#issuecomment-954143394"},"message":"@yarikoptic This happened because the behavior of `_populate_dandiset_yaml()` when `dandiset.yaml` already exists is determined by the `--existing` option, which defaults to \"error\".  Should the function be changed?  If so, how?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635450613,"metadata":{"github-id":"IC_kwDODBZtRc443y_a","github-url":"https://github.com/dandi/dandi-cli/issues/819#issuecomment-954150874"},"message":"oh!  Let me just describe desired behavior -- should be consistent with assets\n\n- if content is the same -- skip (with corresponding status update and message that the same)\n- if we have modification time for dandiset metadata record (I don't think we do, do we?) -- then we could do proper \"update\" comparison.  if we don't -- just treat that it is different -- error that differ (unless --existing overwrite or force)\n- error still should be withing pyout status column, like if when asset fails to download, and not outside","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1635450883,"metadata":{"github-id":"IC_kwDODBZtRc443zuD","github-url":"https://github.com/dandi/dandi-cli/issues/819#issuecomment-954153859"},"message":"@yarikoptic So is this the desired behavior when `--existing` is \"error\"?\n\n\u003e if we have modification time for dandiset metadata record (I don't think we do, do we?)\n\nWhen `--existing` is \"refresh\", the code already checks the mtime of `dandiset.yaml` against the Dandiset's modification time.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635451966,"metadata":{"github-id":"IC_kwDODBZtRc4432yY","github-url":"https://github.com/dandi/dandi-cli/issues/819#issuecomment-954166424"},"message":"cool.  Let's just add test for \"if the same -- do not error (even if existing==error)\"?  for assets content checking is expensive but for dandiset.yaml it is relatively cheap. I see no point in erroring out on it if it is the same.  Or you disagree?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1635452535,"metadata":{"github-id":"IC_kwDODBZtRc4434se","github-url":"https://github.com/dandi/dandi-cli/issues/819#issuecomment-954174238"},"message":"@yarikoptic I'm not clear on exactly what changes you want.  Should `dandiset.yaml` be compared based on timestamp or contents?  Should only the behavior for `--existing=error` be changed or other `--existing` values as well?","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635452766,"metadata":{"github-id":"IC_kwDODBZtRc4435UZ","github-url":"https://github.com/dandi/dandi-cli/issues/819#issuecomment-954176793"},"message":"based on content first -- if the same: nothing to do (skip) regardless of `existing`.  If not the same: proceed as what it does now I guess","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635455574,"metadata":{"github-id":"CE_lADODBZtRc492qnezwAAAAFKBQFL"},"status":2}]}