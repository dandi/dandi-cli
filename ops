{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680725677,"metadata":{"github-id":"I_kwDODBZtRc5it_6P","github-url":"https://github.com/dandi/dandi-cli/issues/1269","origin":"github"},"title":"Errorring test under NFS: Empty directories cannot be Zarr assets","message":"few days ago testing under NFS was added .  In https://github.com/dandi/dandi-cli/pull/1267#issuecomment-1497873494 a run under NFS failed with exception\n```\n_________________ test_dandi_file_zarr_with_excluded_dotfiles __________________\ndandi/tests/test_files.py:309: in test_dandi_file_zarr_with_excluded_dotfiles\n    zf = dandi_file(zarr_path)\ndandi/files/__init__.py:195: in dandi_file\n    return factory(filepath, path, dandiset_path)\ndandi/files/_private.py:71: in __call__\n    return self.CLASSES[DandiFileType.classify(filepath)](\ndandi/files/_private.py:42: in classify\n    raise UnknownAssetError(\"Empty directories cannot be Zarr assets\")\nE   dandi.exceptions.UnknownAssetError: Empty directories cannot be Zarr assets\n```\nwhich did not emerge upon rerun.\n\nBut apparently it was not the first time it failed - `master` experienced them already\n\n```\n(dandisets-2) dandi@drogon:/mnt/backup/dandi/tinuous-logs/dandi-cli/2023$ datalad foreach-dataset --output-streams relpath git grep 'Empty directories cannot be Zarr assets'\n04/04/github/push/master/0be71d3/Tests/4856/18_test (ubuntu-latest, 3.7, nfs).txt:2023-04-04T16:14:55.1866665Z     raise UnknownAssetError(\"Empty directories cannot be Zarr assets\")\n04/04/github/push/master/0be71d3/Tests/4856/18_test (ubuntu-latest, 3.7, nfs).txt:2023-04-04T16:14:55.1867133Z E   dandi.exceptions.UnknownAssetError: Empty directories cannot be Zarr assets\n04/04/github/push/master/0be71d3/Tests/4856/18_test (ubuntu-latest, 3.7, nfs).txt:2023-04-04T16:14:55.1877404Z FAILED dandi/tests/test_files.py::test_dandi_file_zarr_with_excluded_dotfiles - dandi.exceptions.UnknownAssetError: Empty directories cannot be Zarr assets\n04/04/github/push/master/0be71d3/Tests/4856/test (ubuntu-latest, 3.7, nfs)/7_Run all tests.txt:2023-04-04T16:14:55.1866660Z     raise UnknownAssetError(\"Empty directories cannot be Zarr assets\")\n04/04/github/push/master/0be71d3/Tests/4856/test (ubuntu-latest, 3.7, nfs)/7_Run all tests.txt:2023-04-04T16:14:55.1867128Z E   dandi.exceptions.UnknownAssetError: Empty directories cannot be Zarr assets\n04/04/github/push/master/0be71d3/Tests/4856/test (ubuntu-latest, 3.7, nfs)/7_Run all tests.txt:2023-04-04T16:14:55.1877393Z FAILED dandi/tests/test_files.py::test_dandi_file_zarr_with_excluded_dotfiles - dandi.exceptions.UnknownAssetError: Empty directories cannot be Zarr assets\n```\n\nso added testing scenario already picking up on some NFS oddity.  Should be looked into what is happening -- most likely that NFS is not fast enough to show the files listing for the freshly generated test zarr folder?  then we might need to add some sleeping but such situation sounds a bit odd -- needs analysis.","files":null}]}