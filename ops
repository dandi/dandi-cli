{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1742311027,"metadata":{"github-id":"I_kwDODBZtRc6uk1Na","github-url":"https://github.com/dandi/dandi-cli/issues/1594","origin":"github"},"title":"upload: Error out for asset (blob or zarr) upon discovering a path with `.dandidownload`","message":"Observed in the logs kindly provided by @Kevancic \n\n```shell\n‚ùØ grep 'download failed after' 2025.03.17-13.22.01Z-29148.log | grep dandidownload\n2025-03-17T19:06:51-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/14.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:56-0400 [DEBUG   ] dandi 29148:140441118824192 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/15.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:06:57-0400 [DEBUG   ] dandi 29148:140441637340928 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/16.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:08:31-0400 [DEBUG   ] dandi 29148:140441135609600 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/17.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:52-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/82.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:55-0400 [DEBUG   ] dandi 29148:140441622124288 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/80.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:27:58-0400 [DEBUG   ] dandi 29148:140442184173312 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/83.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n2025-03-17T19:29:32-0400 [DEBUG   ] dandi 29148:140442167387904 000026/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS38_stain-Calretinin_SPIM.ome.zarr/0/1/30/84.dandidownload/checksum - download failed after 4 attempts: HTTPSConnectionPool(host='dandiarchive.s3.amazonaws.com', port=443): Read timed out. (read timeout=30)\n```\n\nand I bet this is just a tip of the iceberg -- there might be more of such potentially broken [*] zarrs . \n\nInterestingly, we observe those \"folders\" \n- directly on S3 (run `aws s3 ls s3://dandiarchive/zarr/6c80a9a2-7955-48f3-ac69-84cdf101a695/0/1/0/ --no-sign-request | grep dandidownload`)\n- in datalad datasets https://github.com/dandizarrs/6c80a9a2-7955-48f3-ac69-84cdf101a695/tree/draft/0/1/0\n- on webdav but only in dandisets/ endpoints (https://webdav.dandiarchive.org/dandisets/000026/draft/sub-I45/ses-SPIM/micr/sub-I45_ses-SPIM_sample-BrocaAreaS32_stain-Somatostatin_SPIM.ome.zarr/0/1/0/)\n\nbut not in \n- zarr manifest files\n- and thus not /zarrs/ endpoint on webdav: https://webdav.dandiarchive.org/zarrs/6c8/0a9/6c80a9a2-7955-48f3-ac69-84cdf101a695/5b8c4a0cd968b1fe1a9017d06a8605fc-17807--26781820728.zarr/0/1/0/\n\nTODOs here:\n\n- [ ] make dandi-cli error out on attempt to upload anything with such an internal suffix.\n- [ ] make dandi-cli issue a warning and skip attempt to download remote blob or a file within zarr with such a suffix\n\nTODOs elsewhere\n- see which zarrs (and dandisets) were effected - I will run find across dandizarrs on drogon\n- see which blobs were effected if any - I will run find across dandisets on drogon\n- alert owners of the dandisets and work out clean up procedure \n\n[*] they could potentially be not really broken since zarr structure would just ignore those folders, but they are indication that there was incomplete/interrupted without clean up download.  So they are if not necessarily broken, they have \"garbage\" in them which should be \"analyzed\" and cleaned up.","files":null}]}