{"version":2,"ops":[{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679404035,"metadata":{"github-id":"IC_kwDODBZtRc5YFY4j","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1477807651"},"message":"You already can download an arbitrary file(s) or folders at the high-level API which you see in command line or have in Python API, e.g. you can just cut paste a URL from dandiarchive.org web site while browsing a dandiset:\n\n```\n❯ dandi download https://dandiarchive.org/dandiset/000029/0.230317.1553/files?location=sub-anm369962/\nPATH                                             SIZE    DONE    DONE% CHECKSUM STATUS          MESSAGE\nsub-anm369962/sub-anm369962_behavior+ecephys.nwb 6.6 MB  6.6 MB   100%    ok    done                   \nSummary:                                         6.6 MB  6.6 MB                 1 done                 \n                                                         100.00%                                       \n2023-03-21 09:00:47,239 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20230321130019Z-465662.log\n```\n\nyou can as well point to specific file(s) even.\n\n```\n❯ dandi download --help\nUsage: dandi download [OPTIONS] [URL]...\n\n  Download files or entire folders from DANDI.\n\n  Accepted resource identifier patterns:\n   - DANDI:\u003cdandiset id\u003e[/\u003cversion\u003e]\n   - https://dandiarchive.org/...\n   - https://identifiers.org/DANDI:\u003cdandiset id\u003e[/\u003cversion id\u003e] (\u003cversion id\u003e cannot be 'draft')\n   - https://\u003cserver\u003e[/api]/[#/]dandiset/\u003cdandiset id\u003e[/\u003cversion\u003e][/files[?location=\u003cpath\u003e]]\n   - https://*dandiarchive-org.netflify.app/...\n   - https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e[/versions[/\u003cversion\u003e]]\n   - https://\u003cserver\u003e[/api]/assets/\u003casset id\u003e[/download]\n   - https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e/versions/\u003cversion\u003e/assets/\u003casset id\u003e[/download]\n   - https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e/versions/\u003cversion\u003e/assets/?path=\u003cpath\u003e\n   - dandi://\u003cinstance name\u003e/\u003cdandiset id\u003e[@\u003cversion\u003e][/\u003cpath\u003e]\n   - https://\u003cserver\u003e/...\n      \n```\ngives full list of supported URL schemes -- just use the one with `\u003cpath\u003e` in it.\n\nAlso all dandisets are available as DataLad datasets from github: https://github.com/dandisets/  so if you install datalad you can get yet another way to access all those files given desired pattern.\n\nAlso see \"mid-level\" API https://dandi.readthedocs.io/en/latest/modref/index.html#mid-level-user-interfaces which gives you lots of flexibility of interacting with archive, and with low-level https://dandi.readthedocs.io/en/latest/modref/index.html#low-level-user-interfaces you can get even more \"native\" with our API server.\n\nI hope that such variety satisfy any curious need, or do you see some use case which cannot be fulfilled yet?","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679404067,"metadata":{"github-id":"UCE_lALODBZtRc5YFY4jzi7aHxg"},"target":"ee587eb574c5989f4e6471c6a04f20f3cb3d11d2dc6f73e3168ca93ac1904775","message":"You already can download an arbitrary file(s) or folders at the high-level API which you see in command line or have in Python API, e.g. you can just cut paste a URL from dandiarchive.org web site while browsing a dandiset (edit: pay attention to having trailing `/` in the path -- apparently it matters, see #1256):\n\n```\n❯ dandi download https://dandiarchive.org/dandiset/000029/0.230317.1553/files?location=sub-anm369962/\nPATH                                             SIZE    DONE    DONE% CHECKSUM STATUS          MESSAGE\nsub-anm369962/sub-anm369962_behavior+ecephys.nwb 6.6 MB  6.6 MB   100%    ok    done                   \nSummary:                                         6.6 MB  6.6 MB                 1 done                 \n                                                         100.00%                                       \n2023-03-21 09:00:47,239 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20230321130019Z-465662.log\n```\n\nyou can as well point to specific file(s) even.\n\n```\n❯ dandi download --help\nUsage: dandi download [OPTIONS] [URL]...\n\n  Download files or entire folders from DANDI.\n\n  Accepted resource identifier patterns:\n   - DANDI:\u003cdandiset id\u003e[/\u003cversion\u003e]\n   - https://dandiarchive.org/...\n   - https://identifiers.org/DANDI:\u003cdandiset id\u003e[/\u003cversion id\u003e] (\u003cversion id\u003e cannot be 'draft')\n   - https://\u003cserver\u003e[/api]/[#/]dandiset/\u003cdandiset id\u003e[/\u003cversion\u003e][/files[?location=\u003cpath\u003e]]\n   - https://*dandiarchive-org.netflify.app/...\n   - https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e[/versions[/\u003cversion\u003e]]\n   - https://\u003cserver\u003e[/api]/assets/\u003casset id\u003e[/download]\n   - https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e/versions/\u003cversion\u003e/assets/\u003casset id\u003e[/download]\n   - https://\u003cserver\u003e[/api]/dandisets/\u003cdandiset id\u003e/versions/\u003cversion\u003e/assets/?path=\u003cpath\u003e\n   - dandi://\u003cinstance name\u003e/\u003cdandiset id\u003e[@\u003cversion\u003e][/\u003cpath\u003e]\n   - https://\u003cserver\u003e/...\n      \n```\ngives full list of supported URL schemes -- just use the one with `\u003cpath\u003e` in it.\n\nAlso all dandisets are available as DataLad datasets from github: https://github.com/dandisets/  so if you install datalad you can get yet another way to access all those files given desired pattern.\n\nAlso see \"mid-level\" API https://dandi.readthedocs.io/en/latest/modref/index.html#mid-level-user-interfaces which gives you lots of flexibility of interacting with archive, and with low-level https://dandi.readthedocs.io/en/latest/modref/index.html#low-level-user-interfaces you can get even more \"native\" with our API server.\n\nI hope that such variety satisfy any curious need, or do you see some use case which cannot be fulfilled yet?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1679404663,"metadata":{"github-id":"IC_kwDODBZtRc5YFcpL","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1477823051"},"message":"don't forget `glob`. available in python and on the API. i'm not 100% download supports it, but @yarikoptic can clarify. definitely doable in the python side.\n\n@colleenjg - for your specific use case, i think datalad is a good option. (you can get access to any dandiset via datalad, not just yours - see http://datasets.datalad.org/?dir=/dandi/dandisets).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679406890,"metadata":{"github-id":"IC_kwDODBZtRc5YFquh","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1477880737"},"message":"\u003e @colleenjg - for your specific use case, i think datalad is a good option. (you can get access to any dandiset via datalad, not just yours - see http://datasets.datalad.org/?dir=/dandi/dandisets).\n\nclarification: http://datasets.datalad.org/?dir=/dandi/dandisets is a \"clone\" of the https://github.com/dandi/dandisets/ which contains individual dandisets from https://github.com/dandisets/ . So the http://datasets.datalad.org/?dir=/dandi/dandisets might be lagging behind at times, thus I would recommend to work/navigate them directly on github.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679407236,"metadata":{"github-id":"IC_kwDODBZtRc5YFtDd","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1477890269"},"message":"\u003e don't forget `glob`. available in python and on the API. i'm not 100% download supports it, but @yarikoptic can clarify. definitely doable in the python side.\n\nright  - forgot about that one.  ATM we do not have support for it at the \"high level\" (CLI) API but have support for getting assets based on glob https://dandi.readthedocs.io/en/latest/modref/dandiapi.html#dandi.dandiapi.RemoteDandiset.get_assets_by_glob so you can match assets and then download or interrogate their metadata at the mid-level API that way.","files":null},{"type":3,"author":{"id":"23a0b490ec2a3aef708e5bf3548508030984c8bd"},"timestamp":1679407274,"metadata":{"github-id":"IC_kwDODBZtRc5YFtT0","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1477891316"},"message":"Thanks @yarikoptic and @satra. I didn't know that for downloading individual subjects - great! I'm not getting successful `glob` expansion, though, using the \\\u003cpath\\\u003e URL scheme - I don't know if I'm doing something wrong, or whether it's a functionality you'd even be interested in including. \n\nSo, for example, \n- [x] `dandi download https://api.dandiarchive.org/api/dandisets/000037/versions/draft/assets/?path=sub-408021/` works, for the case where I want all files for subject 408021.\n- [ ] `dandi download https://api.dandiarchive.org/api/dandisets/000037/versions/draft/assets/?path=sub-408021/*image*` doesn't work, for the case where I just want the files for subject 408021 that include the stimulus template images.\n\nAs mentioned, I do have my own solution to this, which just identifies the URLs I want to download via the asset paths:\n```\nfrom dandi import dandiapi\ndandiset = dandiapi.DandiAPIClient().get_dandiset(\"000037\", \"draft\")\nasset_urls = [asset.download_url for asset in dandiset.get_assets() if \"sub-408021\" in asset.path and \"image\" in asset.path]\n```\nI just thought I'd check whether this kind of functionality, integrated into the download function, might be of broader interest. The answer may be that no, this is niche enough that users should just write their own code, as I've done.","files":null},{"type":3,"author":{"id":"23a0b490ec2a3aef708e5bf3548508030984c8bd"},"timestamp":1679407305,"metadata":{"github-id":"IC_kwDODBZtRc5YFtha","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1477892186"},"message":"I see! Ok, I'll definitely take a look at `get_assets_by_glob()`!","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1679490147,"metadata":{"github-id":"IC_kwDODBZtRc5YL-Ac","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1479532572"},"message":"\u003e * `?path=sub-408021/*image*` doesn't work\n\nyeap, as I have mentioned we do not have `glob` support at that level ATM.  @jwodder - do you think it would be worth/easy adding smth like `--path-type=exact,glob` to `dandi download` and then if `glob` to use `get_assets_by_glob` instead of just by path?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1679508515,"metadata":{"github-id":"IC_kwDODBZtRc5YN5CQ","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1480036496"},"message":"@yarikoptic How would the paths at which to download assets specified by a glob URL be determined?  Cf. [this description of how determining download paths currently works for \"exact\" URLs](https://github.com/dandi/dandi-cli/issues/598#issuecomment-829426987).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680624557,"metadata":{"github-id":"IC_kwDODBZtRc5ZLt5_","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1496243839"},"message":"Since glob is concerned with the paths within a particular dandisets, for a glob behavior could either be\na. download paths are from the top of the dandiset, e.g. in above example would all fall under `sub-408021`\nb. strip the `os.path.commonprefix()` of all those paths.\n\nOverall I think `a.` makes it closer to the most common use cases (download some portion of the dandiset I am at), so I would choose that. WDYT?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1680706295,"metadata":{"github-id":"IC_kwDODBZtRc5ZQ-84","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1497624376"},"message":"@yarikoptic How is (a) \"closer to the most common use cases\"?  When downloading a folder of assets, all path components before the folder name are stripped; that's closer to — though still not the same as — (b).","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1680709074,"metadata":{"github-id":"IC_kwDODBZtRc5ZRQ5X","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1497697879"},"message":"\u003e @yarikoptic How is (a) \"closer to the most common use cases\"? \n\nmy thinking was that most common would be to either download same type (data modality) of files across different subjects, or a folder for a specific subject.  In both cases having subject folder(s) (which is the folder at the top level of dandiset) would be desired.  Even  when I want to collate files/subjects from different dandisets, I would probably like to keep them in original hierarchy, thus a subject folder from each dataset (although in this case conflicts could come for the subjects with the same id - but let's keep that of no concern at this point).\n\nAnd as you mention in\n\n\u003e When downloading a folder of assets, all path components before the folder name are stripped; that's closer to — though still not the same as — (b).\n\n\"before\" the folder name is stripped so the folder itself is kept as the common path part for all of them.\n\nI don't like b. (Stripping common prefix ) because it would then depend on the state of dandiset, e.g. if I ask for `sub-*/*` and then if there is one subject - I would get files dumped without leading directory, if there is multiple -- into subfolders.\n\nWe might want it somehow explicit (e.g. like `git annex addurl` has `--pathdepth` which I somewhat dislike), but I don't think we should do that here since also not clear what/how that should be done.  Thus (a) sounded like most sensible thing to do.","files":null},{"type":4,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682028201,"metadata":{"github-id":"CE_lADODBZtRc5hYXnEzwAAAAIcId3E"},"status":2},{"type":3,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1682095700,"metadata":{"github-id":"IC_kwDODBZtRc5afD0P","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1518091535"},"message":"\u003c!-- GITHUB_RELEASE COMMENT: released --\u003e\n:rocket: Issue was released in [`0.54.0`](https://github.com/dandi/dandi-cli/releases/tag/0.54.0) :rocket:","files":null},{"type":5,"author":{"id":"7a8552494914d3e4116f4b434eb4812a914ca405"},"timestamp":1682095701,"metadata":{"github-id":"LE_lADODBZtRc5hYXnEzwAAAAIclM-g"},"added":["released"],"removed":[]},{"type":3,"author":{"id":"23a0b490ec2a3aef708e5bf3548508030984c8bd"},"timestamp":1682350546,"metadata":{"github-id":"IC_kwDODBZtRc5an4N_","github-url":"https://github.com/dandi/dandi-cli/issues/1255#issuecomment-1520403327"},"message":"Just tried it out! Works great! :) Thanks!!","files":null}]}