{"version":2,"ops":[{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616703224,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ1MDk5NzEyNDM="},"added":["performance"],"removed":[]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616703292,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwNzQwNTUwNw==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-807405507"},"message":"or are we also 'digesting' to get the md5 for the part to compare with resultant etag? that might explain why cpu bound.  Then may be it is easy/safe to switch to subprocess pool?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1616703747,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwNzQxNzU0OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-807417549"},"message":"@yarikoptic All of the etag digestion happens before any uploading takes place.  Note that I also noticed the drogon CPU hitting max usage a couple days ago when you were uploading files, before the file-multithreading was implemented.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616704121,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwNzQyNzYxNg==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-807427616"},"message":"When I was uploading a single file it was just 20% . What you observed was probably due to parallelization above that at pyout level","files":null},{"type":2,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616707336,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDUxMDI0NTI3OA=="},"title":"upload: \"too CPU heavy\" with ~~10~~ 1 parallel threads upload","was":"upload: \"too CPU heavy\" with ~~10~~ 1 parallel threads upload"},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616707440,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDgwNzUxNjY4NA==","github-url":"https://github.com/dandi/dandi-cli/issues/504#issuecomment-807516684"},"message":"well, even with `--jobs 1:1` I see 100% cpu load and that slow speed.  So needs debugging etc.  Please also add some `lgr.log(5, \"Thread %s, Uploading block %d of size %d\", ... )` so we have some \"easy\" ways to debug without code changes","files":null}]}