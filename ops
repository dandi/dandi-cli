{"version":2,"ops":[{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746554224,"metadata":{"github-id":"UCE_lAHODBZtRc61SddUznnY-Bw"},"target":"956f5b7bf9193b9eca010c672a789f12f47ff4c148327f50c6ca865bd901e711","message":"I'm attempting to run dandi organize and dandi upload on some NWB files I've generated. I get the following dandi validation error:\n```\n2025-05-06T03:54:53+0000 [WARNING ] dandi 1370:139809792194304  Error 1: ValidationResult(id='pynwb.DynamicTable (processing/eye_tracking/ellipse): missing data type ElementIdentifiers (id)', origin=ValidationOrigin(name='pynwb', version='2.8.3', bids_version=None), scope=\u003cScope.FILE: 'file'\u003e, severity=\u003cSeverity.ERROR: 3\u003e, asset_paths=None, within_asset_paths={'/tmp/nxf.8M0y39gRXN/capsule/results/001417/sub-752311/sub-752311_ecephys.nwb': 'processing/eye_tracking/ellipse'}, dandiset_path=None, dataset_path=None, message='Failed to validate. missing data type ElementIdentifiers (id)', metadata=None, path=PosixPath('/tmp/nxf.8M0y39gRXN/capsule/results/001417/sub-752311/sub-752311_ecephys.nwb'), path_regex=None)\n```\n\nThe code I'm using to package this portion of the NWB is as follows:\n```python\n    eye_tracking_df_new = pd.DataFrame({\n        'name': ['eye_tracking'] * len(eye_tracking_df),\n        'reference_frame': ['nose'] * len(eye_tracking_df),\n        'data_x': eye_tracking_df['eye_center_x'],\n        'data_y': eye_tracking_df['eye_center_y'],\n        'area': eye_tracking_df['eye_area'],\n        'area_raw': eye_tracking_df['eye_area_raw'],\n        'width': eye_tracking_df['eye_width'],\n        'height': eye_tracking_df['eye_height'],\n        'angle': eye_tracking_df['eye_phi'],\n        'timestamps': eye_tracking_df['timestamps']\n    })\n    ellipse_eye_tracking = pynwb.core.DynamicTable.from_dataframe(\n            name=\"ellipse\",\n            df=eye_tracking_df_new\n    )\n    eye_mod = pynwb.ProcessingModule(\"eye_tracking\", \"eye tracking data\")\n    nwb_file.add_processing_module(eye_mod)\n    eye_mod.add_data_interface(ellipse_eye_tracking)\n```\n\nPrinting this field of the nwb displays\n```\nn\u003e\u003e\u003e nwb.processing['eye_tracking']['ellipse']\nellipse hdmf.common.table.DynamicTable at 0x139866740202080\nFields:\n  colnames: ['name' 'reference_frame' 'data_x' 'data_y' 'area' 'area_raw' 'width'\n 'height' 'angle' 'timestamps']\n  columns: (\n    name \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    reference_frame \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    data_x \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    data_y \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    area \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    area_raw \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    width \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    height \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    angle \u003cclass 'hdmf.common.table.VectorData'\u003e,\n    timestamps \u003cclass 'hdmf.common.table.VectorData'\u003e\n  )\n  id: id \u003cclass 'hdmf.common.table.ElementIdentifiers'\u003e\n```","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1746541769,"metadata":{"github-id":"IC_kwDODBZtRc6qKKnl","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2854791653"},"message":"Hi @h-mayorquin @candleindark, could you please look into this issue?  Thanks.","files":null},{"type":3,"author":{"id":"f3557c4ceea08ee5e22c6aab1e8604bfb798bfa4"},"timestamp":1746549467,"metadata":{"github-id":"IC_kwDODBZtRc6qL5_Z","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2855247833"},"message":"@rcpeene By looking at the error, it seems to me that the DANDI client is not the latest version. What version of DANDI client are you running? It would be great if you try the latest version of DANDI client as well. Recently, we made some changes to the validation process to produce more informative output, and more are coming.","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746554753,"metadata":{"github-id":"IC_kwDODBZtRc6qMyfK","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2855479242"},"message":"Just reran it with dandi==0.68.0.\n```\n2025-05-06T18:02:34+0000 [WARNING ] dandi 42:140531670980352  Error 2: id='pynwb.DynamicTable (processing/eye_tracking/ellipse): missing data type ElementIdentifiers (id)' origin=Origin(type=\u003cOriginType.VALIDATION: 'VALIDATION'\u003e, validator=\u003cValidator.pynwb: 'pynwb'\u003e, validator_version='2.8.3', standard=\u003cStandard.NWB: 'NWB'\u003e, standard_version='2.7.0') scope=\u003cScope.FILE: 'file'\u003e origin_result=DynamicTable (processing/eye_tracking/ellipse): missing data type ElementIdentifiers (id) severity=\u003cSeverity.ERROR: 40\u003e asset_paths=None within_asset_paths={'/results/001417/sub-752311/sub-752311_ecephys.nwb': 'processing/eye_tracking/ellipse'} dandiset_path=None dataset_path=None message='Failed to validate. missing data type ElementIdentifiers (id)' metadata=None path=PosixPath('/results/001417/sub-752311/sub-752311_ecephys.nwb') path_regex=None\n```","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1746559899,"metadata":{"github-id":"IC_kwDODBZtRc6qNphw","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2855704688"},"message":"smells like some issue in pynwb or hdmf... @rly wdyt?","files":null},{"type":3,"author":{"id":"24891a1a9a6057dee135acf783d3b5f6d886008e"},"timestamp":1746562535,"metadata":{"github-id":"IC_kwDODBZtRc6qOM8D","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2855849731"},"message":"Yes, that is an NWB validation issue. The error says that the DynamicTable named \"ellipse\" is missing a column with type ElementIdentifiers, which is almost exclusively used for the \"id\" column. However, the OP shows the \"id\" column is present.\n\nI cannot reproduce this issue on my end with this test code:\n```python\nimport pynwb\nimport pandas as pd\nfrom pynwb.testing.mock.file import mock_NWBFile\n\nnwb = mock_NWBFile()\n\n# Create a mock eye tracking table\neye_tracking_df = pd.DataFrame(\n    {\n        'eye_center_x': [100, 150, 200],\n        'eye_center_y': [100, 150, 200],\n        'eye_area': [10, 20, 30],\n        'eye_area_raw': [10, 20, 30],\n        'eye_width': [10, 20, 30],\n        'eye_height': [10, 20, 30],\n        'eye_phi': [10, 20, 30],\n        'timestamps': [10, 20, 30]\n    }\n)\n\neye_tracking_df_new = pd.DataFrame({\n    'name': ['eye_tracking'] * len(eye_tracking_df),\n    'reference_frame': ['nose'] * len(eye_tracking_df),\n    'data_x': eye_tracking_df['eye_center_x'],\n    'data_y': eye_tracking_df['eye_center_y'],\n    'area': eye_tracking_df['eye_area'],\n    'area_raw': eye_tracking_df['eye_area_raw'],\n    'width': eye_tracking_df['eye_width'],\n    'height': eye_tracking_df['eye_height'],\n    'angle': eye_tracking_df['eye_phi'],\n    'timestamps': eye_tracking_df['timestamps']\n})\nellipse_eye_tracking = pynwb.core.DynamicTable.from_dataframe(\n    name=\"ellipse\",\n    df=eye_tracking_df_new\n)\neye_mod = pynwb.ProcessingModule(name=\"eye_tracking\", description=\"eye tracking data\")\nnwb.add_processing_module(eye_mod)\neye_mod.add_data_interface(ellipse_eye_tracking)\n\nwith pynwb.NWBHDF5IO(\"test_dandi_cli_1623.nwb\", mode='w') as io:\n    io.write(nwb)\n\nprint(pynwb.validate(path=\"test_dandi_cli_1623.nwb\"))  # prints []\n```\n\n@rcpeene, can you please run this on your file and let us know what it says:\n```bash\npynwb-validate /tmp/nxf.8M0y39gRXN/capsule/results/001417/sub-752311/sub-752311_ecephys.nwb\n```","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746564346,"metadata":{"github-id":"IC_kwDODBZtRc6qOhE9","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2855932221"},"message":"```\n(base) root@748d8ceb9ec6:~/capsule# pynwb-validate /root/capsule/data/nwb/ecephys_752311_2025-01-22_14-05-21_experiment1_recording1.nwb\nValidating /root/capsule/data/nwb/ecephys_752311_2025-01-22_14-05-21_experiment1_recording1.nwb against cached namespace information using namespace 'core'.\n - found the following errors:\nDynamicTable (processing/eye_tracking/corneal_reflection): missing data type ElementIdentifiers (id)\nDynamicTable (processing/eye_tracking/ellipse): missing data type ElementIdentifiers (id)\nDynamicTable (processing/eye_tracking/pupil): missing data type ElementIdentifiers (id)\n```","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746564860,"metadata":{"github-id":"UCE_lALODBZtRc6qOhE9zmXzxP4"},"target":"b6ed07d8046f58177703af143f163adab56fbd7f8bfd96760210df845faec617","message":"```\n(base) root@748d8ceb9ec6:~/capsule# pynwb-validate /root/capsule/data/nwb/ecephys_752311_2025-01-22_14-05-21_experiment1_recording1.nwb\nValidating /root/capsule/data/nwb/ecephys_752311_2025-01-22_14-05-21_experiment1_recording1.nwb against cached namespace information using namespace 'core'.\n - found the following errors:\nDynamicTable (processing/eye_tracking/corneal_reflection): missing data type ElementIdentifiers (id)\nDynamicTable (processing/eye_tracking/ellipse): missing data type ElementIdentifiers (id)\nDynamicTable (processing/eye_tracking/pupil): missing data type ElementIdentifiers (id)\n```\n\ncould it be that `id` appears to be a non-column attribute rather than a column?","files":null},{"type":6,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746569787,"metadata":{"github-id":"UCE_lALODBZtRc6qOhE9zmX2lh0"},"target":"b6ed07d8046f58177703af143f163adab56fbd7f8bfd96760210df845faec617","message":"```\n(base) root@748d8ceb9ec6:~/capsule# pynwb-validate /root/capsule/data/nwb/ecephys_752311_2025-01-22_14-05-21_experiment1_recording1.nwb\nValidating /root/capsule/data/nwb/ecephys_752311_2025-01-22_14-05-21_experiment1_recording1.nwb against cached namespace information using namespace 'core'.\n - found the following errors:\nDynamicTable (processing/eye_tracking/ellipse): missing data type ElementIdentifiers (id)\n```\n\ncould it be that `id` appears to be a non-column attribute rather than a column?","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746564409,"metadata":{"github-id":"IC_kwDODBZtRc6qOhkt","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2855934253"},"message":"might be worth noting I also get the following warning when opening the file:\n```\n/opt/conda/lib/python3.12/site-packages/hdmf/common/table.py:489: UserWarning: An attribute 'name' already exists on DynamicTable 'ellipse' so this column cannot be accessed as an attribute, e.g., table.name; it can only be accessed using other methods, e.g., table['name'].\n  self.__set_table_attr(col)\n```","files":null},{"type":3,"author":{"id":"cac198dcaca68fe02c5f855e68c71695554017cc"},"timestamp":1746576742,"metadata":{"github-id":"IC_kwDODBZtRc6qRK6h","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2856627873"},"message":"Using\n`eye_tracking_df_new.index = pd.RangeIndex(start=0, stop=len(eye_tracking_df_new), step=1)`\nbefore instantiating the dynamic table seems to be a successful workaround.","files":null},{"type":3,"author":{"id":"24891a1a9a6057dee135acf783d3b5f6d886008e"},"timestamp":1747036360,"metadata":{"github-id":"IC_kwDODBZtRc6rJDZq","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2871277162"},"message":"Sorry for my slow response.\n\n\u003e could it be that id appears to be a non-column attribute rather than a column?\n\nNo, `id` should be a non-column field.\n\n\u003e UserWarning: An attribute 'name' already exists on DynamicTable 'ellipse' so this column cannot be accessed as an attribute, e.g., table.name; it can only be accessed using other methods, e.g., table['name'].\n\nThis is expected because you have a column named \"name\".\n\n\u003e Using\n\u003e `eye_tracking_df_new.index = pd.RangeIndex(start=0, stop=len(eye_tracking_df_new), step=1)`\n\u003e before instantiating the dynamic table seems to be a successful workaround.\n\nInteresting. That suggests that the index of `eye_tracking_df_new` started as something incompatible for validating with the id field (the index values are used to populate the id field). I can't figure out what incompatible index values would be. The id field allows only integers. If you still have this code, could you print what the previous `eye_tracking_df_new.index` was? What version of HDMF is installed?","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1749493511,"metadata":{"github-id":"IC_kwDODBZtRc6wOgdr","github-url":"https://github.com/dandi/dandi-cli/issues/1623#issuecomment-2956593003"},"message":"\u003e The id field allows only integers. If you still have this code, could you print what the previous eye_tracking_df_new.index was? What version of HDMF is installed?\n\nHi @rcpeene, when you have a chance, can you please let us know the above?","files":null}]}