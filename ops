{"version":2,"ops":[{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625149370,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjI5MDY1Mg==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872290652"},"message":"@satra These errors are caught and responded to by falling back to `get_default_metadata()`.  Is attempting to open files as NWB by default actually a problem?\n\nAlso, I find it hard to believe that this is only happening on Python 3.7; I'm confident I've seen it on Python 3.9 as well.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625149438,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjI5MTQ2Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872291466"},"message":"i just saw this in the most recent PR for the CI test #694","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625149557,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjI5Mjg5OA==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872292898"},"message":"@satra And the problem is...?","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625150669,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMwNzI5OA==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872307298"},"message":"py3.7 fails a test with the error i posted in this issue.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625150870,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMwOTg4Ng==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872309886"},"message":"@satra No, that error has nothing to do with the failure.  The test failed because a to-be-published test Dandiset failed validation.  (To be precise, what happened was that the server classified the Dandiset as \"Invalid\" with the message \"1 assets have not been validated yet\", which suggests a bug on the server's end.)","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625151728,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMyMDcwMQ==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872320701"},"message":"@jwodder - indeed - i did not scroll up beyond the `ERROR` log. \n\nregarding the failure, do you know if validation finished and then you tried to publish? posting an asset -\u003e triggers validation -\u003e which updates publishability. the question on the server's end is, is it validating? or is it stuck validating?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625151871,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMyMjcxNA==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872322714"},"message":"@satra The `ValueError` is raised before actually trying to publish; the `publish()` method starts out by querying the version's `/info/` endpoint until the status is either \"Valid\" or \"Invalid\", and in the latter case it raises a `ValueError`.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625152171,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMyNjg0OA==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872326848"},"message":"right, but do you know if the validation process has actually completed? the validation endpoint should give more info. as in do you:\n\nPOST asset\nwait for validation to complete (on a test file this should happen quickly, but not instantaneously)\ncheck for validity\nthen try to publish","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625152314,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMyODc2OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872328769"},"message":"for example:  https://api.dandiarchive.org/api/dandisets/000023/versions/draft/assets/1a93dc97-327d-4f9c-992d-c2149e7810ae/validation/","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625152372,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMyOTU1NQ==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872329555"},"message":"@satra Check for validity how?  The only way I know is to query `/dandisets/{dandiset__pk}/versions/{version}/info/` and check the \"status\" field, which is what the code does.  If you're referring to the `/uploads/{upload_id}/validate/` endpoint, I don't believe that's bothered with asset metadata validation for a while.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625152465,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMzMDc1MA==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872330750"},"message":"@dchiquito \n* What is the recommended way to check for valid metadata before trying to publish?\n* A test recently failed while trying to upload because the version `/info/` endpoint returned a status of \"Invalid\" with a `validation_error` of \"1 assets have not been validated yet\"; that seems to be a bug.","files":null},{"type":3,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625152487,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMzMTA4OQ==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872331089"},"message":"@jwodder - did you see the example above?","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1625152501,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDg3MjMzMTI3OA==","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-872331278"},"message":"@satra Yes, after I commented.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1658932847,"metadata":{"github-id":"IC_kwDODBZtRc5HVnzY","github-url":"https://github.com/dandi/dandi-cli/issues/695#issuecomment-1196850392"},"message":"@satra dandi-cli now only treats files with `.nwb` extension as NWB, and Dandiset metadata is checked for validity before publishing.  Can this issue therefore be considered resolved?","files":null},{"type":4,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1658939868,"metadata":{"github-id":"CE_lADODBZtRc43uIelzwAAAAGlrQTD"},"status":2}]}