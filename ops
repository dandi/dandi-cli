{"version":2,"ops":[{"type":2,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1681938171,"metadata":{"github-id":"RTE_lADODBZtRc5j4Ba2zwAAAAIbefEX"},"title":"Add support for validation of zarr filesets","was":"Add support for validation of zarr filesets"},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682002031,"metadata":{"github-id":"IC_kwDODBZtRc5aY2Mf","github-url":"https://github.com/dandi/dandi-cli/issues/1281#issuecomment-1516462879"},"message":"@yarikoptic \n* What makes you say that ome-zarr-py PR was merged?  It was clearly closed without being merged.\n* It appears that the given validation method loads all(?) of the Zarr data into memory, which will be a problem for arbitrarily large Zarrs.","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682014285,"metadata":{"github-id":"LE_lADODBZtRc5j4Ba2zwAAAAIcCFA5"},"added":["blocked"],"removed":[]},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682014442,"metadata":{"github-id":"IC_kwDODBZtRc5aZ8oX","github-url":"https://github.com/dandi/dandi-cli/issues/1281#issuecomment-1516751383"},"message":"\u003e * What makes you say that ome-zarr-py PR was merged?  It was clearly closed without being merged.\n\nheh, not sure why I thought that \"Closed\" meant \"Merged\" to me ;) \n\n\u003e * It appears that the given validation method loads all(?) of the Zarr data into memory, which will be a problem for arbitrarily large Zarrs.\n\nthat would really make it unlikely to be usable by default... where do they do it?\n\nfrom glancing over https://github.com/ome/ome-zarr-py/pull/142/files#diff-b50d9715cc6e4017cfc055fd0ed73ecb5d9158e17f4d58ca5b3ba08b89c46657R206 I thought it would just validate structure/metadata against some jsonschema.","files":null},{"type":6,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682014468,"metadata":{"github-id":"UCE_lALODBZtRc5aZ8oXzjA9W6o"},"target":"9b0ec4721700b6e477bfbdb17c78ed1428124f79cb12a98941f62b86f1969016","message":"\u003e * What makes you say that ome-zarr-py PR was merged?  It was clearly closed without being merged.\n\nheh, not sure why I thought that \"Closed\" meant \"Merged\" to me ;) Left a question on that PR on what is the destiny/plan there in terms of validation.\n\n\u003e * It appears that the given validation method loads all(?) of the Zarr data into memory, which will be a problem for arbitrarily large Zarrs.\n\nthat would really make it unlikely to be usable by default... where do they do it?\n\nfrom glancing over https://github.com/ome/ome-zarr-py/pull/142/files#diff-b50d9715cc6e4017cfc055fd0ed73ecb5d9158e17f4d58ca5b3ba08b89c46657R206 I thought it would just validate structure/metadata against some jsonschema.","files":null},{"type":3,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682014802,"metadata":{"github-id":"IC_kwDODBZtRc5aZ-R5","github-url":"https://github.com/dandi/dandi-cli/issues/1281#issuecomment-1516758137"},"message":"@yarikoptic [`ome_zarr.utils.validate()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/utils.py#L58) calls [`visit()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/utils.py#L22), which iterates over the return values of [`Reader.__call__()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/reader.py#L685), which either descends through the node (I haven't yet found what's populating the \"descend\" structures) or (line 698) calls [`ZarrLocation.load()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/io.py#L109); that calls out to a third party library that I haven't looked at yet, but the name sure sounds like it's loading data.","files":null},{"type":6,"author":{"id":"364914f8b1c8a9131d300bf2978e4ffe2ff1aeeb"},"timestamp":1682014825,"metadata":{"github-id":"UCE_lALODBZtRc5aZ-R5zjA9byM"},"target":"65397b28c6c0704d39cb0949e3d3a96572869f815fddd9cbf62b2ca4868a870b","message":"@yarikoptic [`ome_zarr.utils.validate()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/utils.py#L58) calls [`visit()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/utils.py#L22), which iterates over the return values of [`Reader.__call__()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/reader.py#L685), which either descends through the node (I haven't yet found what's populating the \"descend\" structures) or (line 698) calls [`ZarrLocation.load()`](https://github.com/will-moore/ome-zarr-py/blob/c03b0a054285abb5f65cc8014d3fa78ff0c8182d/ome_zarr/io.py#L109), which calls out to a third party library that I haven't looked at yet, but the name sure sounds like it's loading data.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1682520836,"metadata":{"github-id":"IC_kwDODBZtRc5az7D2","github-url":"https://github.com/dandi/dandi-cli/issues/1281#issuecomment-1523560694"},"message":"I have followed https://github.com/ome/ome-zarr-py/pull/142#issuecomment-1517024760 and \n`ran check-jsonschema --schemafile /home/dandi/proj/ngff/0.4/schemas/image.schema \u003c(curl --silent \"$url\")`\n\n\u003cdetails\u003e\n\u003csummary\u003ecoded within `/mnt/backup/dandi/dandizarrs/tools/jsonschema-check-zattrs` on drogon:\n\u003c/summary\u003e \n\n```shell\n#!/bin/bash\n\n# inspired by https://github.com/ome/ome-zarr-py/pull/142#issuecomment-1517024760\n\nset -eu\n#set -x\nfor z in \"$@\"; do\n        zattrs=\"$z/.zattrs\"\n        if ! /bin/ls \"$zattrs\" \u0026\u003e/dev/null; then\n                echo \"$z - no .zattrs, skipping\"\n                continue\n        fi\n        url=$(git -C \"$z\" annex whereis .zattrs | grep https://dandiarchive | awk '{print $2;}' | head -n 1)\n        echo \"$z - $url\"\n        check-jsonschema --schemafile /home/dandi/proj/ngff/0.4/schemas/image.schema \u003c(curl --silent \"$url\") | sed -e 's,^,  ,'g\ndone\n```\n\u003c/details\u003e\n\n and got following list of failures http://www.oneukrainian.com/tmp/dandizarrs-jsonschema-checks.out - so the majority of zarrs have\n\n```\n  Schema validation errors were encountered.\n    /dev/fd/63::$.omero.channels[0].window: 'start' is a required property\n    /dev/fd/63::$.omero.channels[0].window: 'end' is a required property\n```\nin fact - there is only 137 zarrs which pass validation and over 4k which do not.\n\n@slaytonmarx could you please check with similar (`check-jsonschema --schemafile https://raw.githubusercontent.com/ome/ngff/main/0.4/schemas/image.schema YOUR.zarr/.zattrs`) command on zarr files you have?","files":null},{"type":3,"author":{"id":"adccd23cf679e6fb55b1c23d1d08cb100dec6f4e"},"timestamp":1682528405,"metadata":{"github-id":"IC_kwDODBZtRc5a0sIi","github-url":"https://github.com/dandi/dandi-cli/issues/1281#issuecomment-1523761698"},"message":"I'll check tomorrow morning and let you know!","files":null},{"type":3,"author":{"id":"adccd23cf679e6fb55b1c23d1d08cb100dec6f4e"},"timestamp":1682599996,"metadata":{"github-id":"IC_kwDODBZtRc5a734R","github-url":"https://github.com/dandi/dandi-cli/issues/1281#issuecomment-1525644817"},"message":"I received the same validation errors as Yarik:\n```\nsmarx@leviathan:/mnt/beegfs/Lee/dandi/sub-MITU01/ses-20211001h11m49s01/micr$ check-jsonschema --schemafile https://raw.githubusercontent.com/ome/ngff/main/0.4/schemas/image.schema sub-MITU01_ses-20211001h11m49s01_sample-103_stain-LEC_run-1_chunk-10_SPIM.ome.zarr/.zattrs\nSchema validation errors were encountered.\n  sub-MITU01_ses-20211001h11m49s01_sample-103_stain-LEC_run-1_chunk-10_SPIM.ome.zarr/.zattrs::$.omero.channels[0].window: 'start' is a required property\n  sub-MITU01_ses-20211001h11m49s01_sample-103_stain-LEC_run-1_chunk-10_SPIM.ome.zarr/.zattrs::$.omero.channels[0].window: 'end' is a required property\n```","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1721326112,"metadata":{"github-id":"LE_lADODBZtRc5j4Ba2zwAAAAMoRdjj"},"added":["zarr"],"removed":[]}]}