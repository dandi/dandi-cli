{"version":2,"ops":[{"type":6,"author":{"id":"bd35622b4fac033435347fff87f54b8235f275bb"},"timestamp":1721313552,"metadata":{"github-id":"UCE_lAHODBZtRc6RX6dyzmEBaxQ"},"target":"c18c61400712242a565777a3160b5fb6bc73a0a190f8059b92baf56dbb5ab9fd","message":"Cc @dstansby @kabilar @satra @yarikoptic @waxlamp @balbasty\n\nIn the LINC project, @dstansby encountered a scenario where an update was requested for a portion of a Zarr directory. \nCurrently, DANDI and LINC treat a Zarr directory as a single object tree, requiring the entire directory to be downloaded even for updates that only modify specific pieces.\n\nDownloading the entire Zarr directory can be inefficient, especially for large datasets where only a small portion needs updating.\n\nThis issue's purpose is to capture the need for mechanism to allow for partial updates of Zarr directories within Dandi and LINC. \n\nAnalagous, @satra suggested the initial usage of [zarrita](https://github.com/scalableminds/zarrita) to explore elements of sharding, with perhaps the LINC project as a place to test","files":null},{"type":3,"author":{"id":"7b3660b55979a5de05395332b7e56fa8357939a7"},"timestamp":1721314869,"metadata":{"github-id":"IC_kwDODBZtRc6GrVAT","github-url":"https://github.com/dandi/dandi-cli/issues/1474#issuecomment-2259505171"},"message":"I think there are two separate, but related issues here (and solving 2. depends on solving 1. first):\n\n1. Updating a single file within a dandiset. It would be very useful to document the workflow for doing this. So far the best I have come up with is:\n\n- Download the dandiset: `dandi download --download dandiset.yaml \u003cdandiset-url\u003e`\n- Download the file I want to change\n- Manually re-create the directory structure that already exists in the remote dandiset (this is very tedious and feels like it should be automatic!)\n- Put the file in the right place in the directory structure.\n- Make changes\n- Upload the file\n\n2. The same as above, but for editing the metadata of a zarr directory. As @aaronkanzer says, it's treated as a single object tree so there's no obvious way to only download the metadata file and then re-upload it.","files":null},{"type":3,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1721328047,"metadata":{"github-id":"IC_kwDODBZtRc6GrVAW","github-url":"https://github.com/dandi/dandi-cli/issues/1474#issuecomment-2259505174"},"message":"1. non-zarr case: so **it is possible but *just* inconvenient** as for \"Manually re-create the directory structure\".  I have created a dedicated issue\n\n- https://github.com/dandi/dandi-cli/issues/1460\n\nto boil down/implement desired convenience.\n\nNB upon trying different URI schemas I found that there is a \"workaround side-effect\" if path is used as a glob (might not be generally applicable/desired), then we would get leading path too\n\n```shell\n❯ dandi download https://dandiarchive.org/dandisets/000027/versions/0.210831.2033/assets/\\?glob\\=sub-RAT123/sub-RAT123.nwb\nPATH                      SIZE     DONE    DONE% CHECKSUM STATUS          MESSAGE\nsub-RAT123/sub-RAT123.nwb 18.8 kB  18.8 kB  100%    ok    done                   \nSummary:                  18.8 kB  18.8 kB                1 done                 \n                                   100.00%      \n```\n\n- 1.a. There is also a datalad way, which to a degree most convenient since it provides you locally full dandiset filetree hierarchy and thus flexibility/convenience. \n\n```shell\n❯ datalad clone https://github.com/dandisets/000027\n[INFO   ] Remote origin not usable by git-annex; setting annex-ignore                                                                                                               \n[INFO   ] https://github.com/dandisets/000027/config download failed: Not Found                                                                                                     \n[INFO   ] access to 2 dataset siblings dandi-dandisets-dropbox, dandiapi not auto-enabled, enable with:\n| \t\tdatalad siblings -d \"/tmp/000027\" enable -s SIBLING \ninstall(ok): /tmp/000027 (dataset)\n❯ cd 000027\n❯ datalad get sub-RAT123/sub-RAT123.nwb\nget(ok): sub-RAT123/sub-RAT123.nwb (file) [from web...]                                                                                                                             \n❯ ls -lL sub-RAT123/sub-RAT123.nwb\n-r--r--r-- 1 yoh yoh 18792 Jul 18 07:51 sub-RAT123/sub-RAT123.nwb\n# now edit / dandi upload\n```\n\n2. zarr. In general **it is possible, but *very* inconvenient** as would require download of a full zarr first.\n\nFor an \"ultimate\" solution, we need to add some basic zarr navigator, related\n\n- https://github.com/dandi/dandi-archive/issues/1746\n\nto make it easier for a user to get desired \"full\" URL to specific zarr component.\n\nAs for update of metadata only it would be quite tricky AFAIK to implement correctly but indeed editing metadata is a valid use case.  ATM it is 'possible' only via full zarr download, and I believe we would avoid reuploading any file which was not modified (@jwodder might correct me if I am wrong).\nAs for partial download and upload of zarr -- I think we would also need support for that in the client:\n- https://github.com/dandi/dandi-cli/issues/1461\n- https://github.com/dandi/dandi-cli/issues/1462\n\n- 2.b case. Note that we also have datalad datasets for zarr \"filesets\" too!  https://github.com/dandizarrs/ . Frankly I have not yet tried how `dandi upload` would behave if we do try to `datalad get` only some files and then upload such updated zarr folder while some data files would be missing.","files":null},{"type":3,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1722391787,"metadata":{"github-id":"IC_kwDODBZtRc6GrVAZ","github-url":"https://github.com/dandi/dandi-cli/issues/1474#issuecomment-2259505177"},"message":"Thanks team.  Moving this issue to the DANDI Client repo, as it doesn't seem like we would need changes to the web app or REST API.","files":null},{"type":5,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1723237099,"metadata":{"github-id":"LE_lADODBZtRc6RX6dyzwAAAAM4EZxa"},"added":["zarr"],"removed":[]}]}