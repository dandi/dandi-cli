{"version":2,"ops":[{"type":1,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1642893707,"metadata":{"github-id":"I_kwDODBZtRc5CQ3Hs","github-url":"https://github.com/dandi/dandi-cli/issues/875","origin":"github"},"title":"zarr upload errors","message":"i'm trying to upload a \"smaller\" zarr file (~38G and ~250k files) and the upload is erroring out at 5%. also the upload rate is really low. on the same machine i can upload at speeds close to 120 MB/s (bytes not bits).\n\n\u003cdetails\u003e \u003csummary\u003e terminal log \u003c/summary\u003e\n\n```\n$ dandi -l DEBUG upload -i dandi-staging --validation skip sub-MITU01_run-1_sample-178_stain-LEC_chunk-1_spim.ngff -J 1:100\n2022-01-22 15:28:42,112 [   DEBUG] Starting new HTTPS connection (1): rig.mit.edu:443\n2022-01-22 15:28:42,487 [   DEBUG] https://rig.mit.edu:443 \"GET /et/projects/dandi/dandi-cli HTTP/1.1\" 200 579\n2022-01-22 15:28:42,498 [ WARNING] A newer version (0.34.1) of dandi/dandi-cli is available. You are using 0.34.0+50.gc12f72b\n2022-01-22 15:29:01,325 [   DEBUG] Creating converter from 7 to 5\n2022-01-22 15:29:01,325 [   DEBUG] Creating converter from 5 to 7\n2022-01-22 15:29:01,325 [   DEBUG] Creating converter from 7 to 5\n2022-01-22 15:29:01,325 [   DEBUG] Creating converter from 5 to 7\n2022-01-22 15:29:22,129 [   DEBUG] GET https://api-staging.dandiarchive.org/api/info/\n2022-01-22 15:29:22,133 [   DEBUG] Starting new HTTPS connection (1): api-staging.dandiarchive.org:443\n2022-01-22 15:29:22,404 [   DEBUG] https://api-staging.dandiarchive.org:443 \"GET /api/info/ HTTP/1.1\" 200 146\n2022-01-22 15:29:22,405 [   DEBUG] Response: 200\n2022-01-22 15:29:22,406 [   DEBUG] GET https://api-staging.dandiarchive.org/api/auth/token\n2022-01-22 15:29:22,430 [   DEBUG] https://api-staging.dandiarchive.org:443 \"GET /api/auth/token HTTP/1.1\" 301 0\n2022-01-22 15:29:22,490 [   DEBUG] https://api-staging.dandiarchive.org:443 \"GET /api/auth/token/ HTTP/1.1\" 200 42\n2022-01-22 15:29:22,490 [   DEBUG] Response: 200\n2022-01-22 15:29:22,495 [   DEBUG] Found identifier DANDI:101233 in top level 'identifier'\n2022-01-22 15:29:23,813 [    INFO] Found 1 files to consider\n2022-01-22 15:29:24,056 [   DEBUG] Initializing mode with given value of None\n2022-01-22 15:29:24,059 [   DEBUG] Setting write mode to 'update'\n2022-01-22 15:29:24,060 [   DEBUG] Setting width to stream width: 112\nPATH                                     SIZE    ERRORS      UPLOAD STATUS                MESSAGE               \n...ample-178_stain-LEC_chunk-1_spim.ngff 38.5 GB                 5% ERROR                 500 Server Error: I...\nSummary:                                 38.5 GB         429.2 kB/s 1 ERROR               1 500 Server Error:...\n2022-01-22 16:54:52,772 [    INFO] Logs saved in /home/satra/.cache/dandi-cli/log/20220122202836Z-1485034.log\n```\n\n\u003c/details\u003e\n\n\u003cdetails\u003e \u003csummary\u003e error section from log file \u003c/summary\u003e\n\n```\n...\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.common 1485034:139660036019968 value='500 Server Error: Internal Server Error for url: https://api-staging.dandiarchive.org/api/zarr/b6905a85-d409-49c4-9a28-f6e8111e49c5/upload/compl\nete/', value width=148, old field length=22, min width=0, max width=None =\u003e wants=148\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.common 1485034:139660036019968 Available width after assigned: 0\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.common 1485034:139660036019968 Assigned widths: {'path': 40, 'size': 7, 'errors': 6, 'upload': 11, 'status': 21, 'message': 22}\n...\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.common 1485034:139660036019968 value='1 500 Server Error: Internal Server Error for url: https://api-staging.dandiarchive.org/api/zarr/b6905a85-d409-49c4-9a28-f6e8111e49c5/upload/complete/', value width=150, old field length=22, min width=0, max width=None =\u003e wants=150\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.common 1485034:139660036019968 Available width after assigned: 0\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.common 1485034:139660036019968 Assigned widths: {'path': 40, 'size': 7, 'errors': 6, 'upload': 11, 'status': 21, 'message': 22}\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.field 1485034:139660036019968 Rendering field with value 'Summary:' and non-default keys ['width', 'default']\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.field 1485034:139660036019968 Rendering field with value '38.5 GB' and non-default keys ['width', 'default']\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.field 1485034:139660036019968 Rendering field with value '' and non-default keys ['width', 'default']\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.field 1485034:139660036019968 Rendering field with value '429.2 kB/s' and non-default keys ['width', 'default']\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.field 1485034:139660036019968 Rendering field with value '1 ERROR' and non-default keys ['width', 'default']\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.field 1485034:139660036019968 Rendering field with value '1 500 Server Error: Internal Server Error for url: https://api-staging.dandiarchive.org/api/zarr/b6905a85-d409-49c4-9a28-f6e8111e49c5/upload/complete/' and non-default keys ['width', 'default']\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.interface 1485034:139660036019968 Moving up 2 line(s) to repaint the whole thing. Blame row {'status': 'ERROR', 'message': '500 Server Error: Internal Server Error for url: https://api-staging.dandiarchive.org/api/zarr/b6905a85-d409-49c4-9a28-f6e8111e49c5/upload/complete/', 'path': 'sub-MITU01/ses-20210521h17m17s06/microscopy/sub-MITU01_run-1_sample-178_stain-LEC_chunk-1_spim.ngff'}\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.interface 1485034:139660036019968 Wrote summary\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.interface 1485034:139660036019968 Releasing write lock\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.interface 1485034:139662846678848 Processing future \u003cFuture at 0x7f0522fd6cb0 state=finished returned NoneType\u003e\n2022-01-22T16:54:52-0500 [DEBUG   ] pyout.interface 1485034:139662846678848 Pool shut down\n```","files":null}]}