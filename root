{"version":2,"ops":[{"type":1,"author":{"id":"7eea5bdd45d6b031d3bf16a241db06db985fb528"},"timestamp":1707848923,"metadata":{"github-id":"I_kwDODBZtRc5_IcB5","github-url":"https://github.com/dandi/dandi-cli/issues/1405","origin":"github"},"title":"Running tests in non-tox environment resulting in peer reset","message":"attn @jwodder @yarikoptic @TheChymera \n\nLooking for advice to fix some failures running `dandi-cli` testing suite in dev mode on the NWB Inspector after adjusting the strategy\n\nWe originally followed the developer instructions here: https://github.com/dandi/dandi-cli/blob/master/DEVELOPMENT.md#running-tests-locally\n\nWith the goal of running the `dandi-cli` testing suite against a dev branch of the NWB Inspector to ensure there are no unexpected failures prior to cutting a new release\n\nBut @jwodder pointed out that the `tox` was creating its own isolated virtual environment that did not depend on an editable local version of the Inspector, hence we switched from `tox` to direct invocation of `pytest`: https://github.com/NeurodataWithoutBorders/nwbinspector/blob/dev/.github/workflows/dandi-dev.yml#L21-L35\n\nThis worked well for a week or so, but the past couple of days have resulted in the errors seen in these logs: https://github.com/NeurodataWithoutBorders/nwbinspector/actions/runs/7889319139/job/21531401494\n\nwhich are all of the form\n\n```\nDuring handling of the above exception, another exception occurred:\nvenvs/dev3/lib/python3.9/site-packages/requests/adapters.py:486: in send\n    resp = conn.urlopen(\nvenvs/dev3/lib/python3.9/site-packages/urllib3/connectionpool.py:799: in urlopen\n    retries = retries.increment(\nvenvs/dev3/lib/python3.9/site-packages/urllib3/util/retry.py:550: in increment\n    raise six.reraise(type(error), error, _stacktrace)\nvenvs/dev3/lib/python3.9/site-packages/urllib3/packages/six.py:769: in reraise\n    raise value.with_traceback(tb)\nvenvs/dev3/lib/python3.9/site-packages/urllib3/connectionpool.py:715: in urlopen\n    httplib_response = self._make_request(\nvenvs/dev3/lib/python3.9/site-packages/urllib3/connectionpool.py:467: in _make_request\n    six.raise_from(e, None)\nvenvs/dev3/lib/python3.9/site-packages/urllib3/connectionpool.py:462: in _make_request\n    httplib_response = conn.getresponse()\n/usr/share/miniconda/envs/__setup_conda/lib/python3.9/http/client.py:1377: in getresponse\n    response.begin()\n/usr/share/miniconda/envs/__setup_conda/lib/python3.9/http/client.py:320: in begin\n    version, status, reason = self._read_status()\n/usr/share/miniconda/envs/__setup_conda/lib/python3.9/http/client.py:281: in _read_status\n    line = str(self.fp.readline(_MAXLINE + 1), \"iso-8859-1\")\n/usr/share/miniconda/envs/__setup_conda/lib/python3.9/socket.py:704: in readinto\n    return self._sock.recv_into(b)\nE   urllib3.exceptions.ProtocolError: ('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer'))\n```\n\nAny ideas how to fix this? Attempting to retry it several times did not seem to magically resolve","files":null}]}