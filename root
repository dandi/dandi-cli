{"version":2,"ops":[{"type":1,"author":{"id":"d8203afd43c9e0a9d07c45dd62b58a81d53a2ebe"},"timestamp":1742410174,"metadata":{"github-id":"I_kwDODBZtRc6uzzI9","github-url":"https://github.com/dandi/dandi-cli/issues/1595","origin":"github"},"title":"Question: How can I increase upload speeds?","message":"## Context\n\nWe are planning to upload 216 TB from Columbia University to lincbrain.org over the coming months.  We are working to reduce the upload time by compressing the data and optimizing the upload speed.\n\n## Benchmarking upload speeds\n\nRegarding the upload speed, I have testing both the DANDI Client and AWS CLI from a node on the MIT Engaging Cluster (8 cores, 32 GB).  \nI uploaded a single asset at a time to the DANDI Staging server with the DANDI CLI or to a private S3 bucket with the AWS CLI.  Certainly network variability could be a source of the variability in the results below, but I did perform some of the tests several times with similar results each time.  \n\n| Client | Asset | Max Upload Speed (MBps) |\n| - | - | - |\n| DANDI | Zarr | ~30 |\n| DANDI | NWB | ~80 |\n| DANDI | AVI | ~70 |\n| AWS | Zarr | ~55 |\n| AWS | NWB | ~110 |\n\nSteps to reproduce DANDI CLI tests:\n- `srun --ntasks 1 --cpus-per-task 8 --mem 32G -p mit_preemptable --pty /bin/bash`\n- DANDI Client version: `0.67.2`\n- `dandi upload -i dandi-staging --validation ignore --jobs 8`\n\nSteps to reproduce AWS CLI tests:\n- `srun --ntasks 1 --cpus-per-task 8 --mem 32G -p mit_preemptable --pty /bin/bash`\n- AWS CLI version: `aws-cli/2.24.26 Python/3.12.9 Linux/4.18.0-372.9.1.el8.x86_64 exe/x86_64.rocky.8`\n- `~/awsv2/2.24.26/bin/aws s3 cp --recursive \u003cfilename\u003e s3://linc-lsm-upload-test/ --acl private`\n\n### Speedtest CLI\n- Just as check I ran [speedtest CLI](https://github.com/sivel/speedtest-cli).  (Although these results can't be compared directly to the above DANDI and AWS speed tests.)\n\n  ```bash\n  $ curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python3 -\n  \n  Retrieving speedtest.net configuration...\n  Testing from Massachusetts Institute of Technology (\u003credacted IP\u003e)...\n  Retrieving speedtest.net server list...\n  Selecting best server based on ping...\n  Hosted by Comcast (Boston, MA) [3.14 km]: 5.89 ms\n  Testing download speed................................................................................\n  Download: 829.92 Mbit/s\n  Testing upload speed......................................................................................................\n  Upload: 895.24 Mbit/s\n  ```\n\n### Questions\n- Is there anything I can do to increase the upload speed of the DANDI Client since it is noticeably slower than the AWS CLI?\n  - I can appreciate that uploading multiple assets in parallel with the `--jobs` flag will increase the overall data transfer speed, but I wanted to evaluate if there is anything I can do to increase the transfer of a single asset.\n- Why do Zarrs have slower upload speeds?\n  - If the slower speed is related to the number of files, perhaps reducing the number of chunks with sharded Zarrs would help with this.\n\nThank you.\n\ncc @aaronkanzer @emineozeen @wenzeli @ayendiki","files":null}]}