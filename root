{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1733949781,"metadata":{"github-id":"I_kwDODBZtRc6i9PgH","github-url":"https://github.com/dandi/dandi-cli/issues/1551","origin":"github"},"title":"interleave::get is \"expensive\"","message":"Part of troubleshooting of\n- #1549 \n\nrunning a straightforward download\n\n```\nrm -rf sub-*; DANDI_DEVEL_AGGRESSIVE_RETRY=1 dandi --log-level=INFO download -e refresh -J 1:1 https://api.dandiarchive.org/api/assets/f0da6521-b9c7-4fa5-9405-c48527aebe90/download/\n```\nwhich is a single file/thread download leads to dandi CLI being 10-20% CPU and py-spy showing\n\n![image](https://github.com/user-attachments/assets/bdaa7d79-d0a0-4f10-b945-e6094980b23a)\n\nso sampling profiler finds itself most often in `get (interleave/__init__.py)`.  There are multiple `get`s in that file but this particular Interleaver.get https://github.com/jwodder/interleave/blob/master/src/interleave/__init__.py#L348 is the primary suspect due to internal `while True` loop. \n\n@jwodder could you please see if code there potentially be made more efficient?","files":null}]}