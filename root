{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616703224,"metadata":{"github-id":"MDU6SXNzdWU4NDEyNzI4NTg=","github-url":"https://github.com/dandi/dandi-cli/issues/504","origin":"github"},"title":"upload: \"too CPU heavy\" with ~~10~~ 1 parallel threads upload","message":"trying the reupload of the 3.6T monster stating to use 10 threads... \n```\n*$\u003e DANDI_DEVEL=1 dandi -l 1 upload -i dandi-api --allow-any-path  --validation skip --jobs 1:10 --devel-debug largeuploads/blobs/f5d/aac/79d9c6c1ba2439200d45680f1cb941087750a000e484ea2973232709d2\n2021-03-25 14:12:44,011 [   DEBUG] Running a newer version (0.12.1+4.gd41969c) of dandi/dandi-cli than available (0.12.0)\n2021-03-25 14:12:45,494 [   DEBUG] Found identifier DANDI:000029 in top level 'identifier'\n2021-03-25 14:12:45,504 [    INFO] Found 1 files to consider\n{'size': 3628888939868}\n{'status': 'digesting'}\n{'status': 'extracting metadata'}\n{'status': 'failed to extract metadata'}\n{'status': 'uploading'}\n{'status': 'calculating etag'}\n{'status': 'initiating upload'}\n{'status': 'uploading', 'upload': 0.010000000000363747}\n{'status': 'uploading', 'upload': 0.020000000000727495}\n...\n```\nthe wire is running thin (15MBps) and CPU busy  at 100% for that process.  Some profiling/troubleshooting should be done to see why it is so CPU heavy given that it should be just sending data over the net.  May be some intermediate buffer (at requests level?) should be increased or smth like that.","files":null}]}