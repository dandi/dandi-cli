{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1591051385,"metadata":{"github-id":"MDU6SXNzdWU2Mjg3NzQ2NDQ=","github-url":"https://github.com/dandi/dandi-cli/issues/111","origin":"github"},"title":"tqdm: errors in the tests with \"AssertionError: attempt to release recursive lock not owned by thread\"","message":"Not a good day for tqdm I guess. Now (after #110 on smaug) it errors tests locally \n```\n_________________________________________ test_download_multiple_files __________________________________________\n\ntmpdir = local('/home/yoh/.tmp/pytest-of-yoh/pytest-657/test_download_multiple_files0')\n\n    @mark.skipif_no_network\n    def test_download_multiple_files(tmpdir):\n        url = (\n            \"https://gui.dandiarchive.org/#/folder/5e70d3173da50caa9adaf334/selected/\"\n            \"item+5e70d3173da50caa9adaf335/item+5e70d3183da50caa9adaf336\"\n        )\n    \n\u003e       ret = download(url, tmpdir)\n\ndandi/tests/test_download.py:74: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\ndandi/download.py:230: in download\n    for file in files\nvenvs/dev3/lib/python3.7/site-packages/joblib/parallel.py:1017: in __call__\n    self.retrieve()\nvenvs/dev3/lib/python3.7/site-packages/joblib/parallel.py:909: in retrieve\n    self._output.extend(job.get(timeout=self.timeout))\n/usr/lib/python3.7/multiprocessing/pool.py:657: in get\n    raise self._value\n/usr/lib/python3.7/multiprocessing/pool.py:121: in worker\n    result = (True, func(*args, **kwds))\nvenvs/dev3/lib/python3.7/site-packages/joblib/_parallel_backends.py:608: in __call__\n    return self.func(*args, **kwargs)\nvenvs/dev3/lib/python3.7/site-packages/joblib/parallel.py:256: in __call__\n    for func, args, kwargs in self.items]\nvenvs/dev3/lib/python3.7/site-packages/joblib/parallel.py:256: in \u003clistcomp\u003e\n    for func, args, kwargs in self.items]\ndandi/girder.py:389: in download_file\n    self.downloadFile(file_id, path)\nvenvs/dev3/lib/python3.7/site-packages/girder_client/__init__.py:1207: in downloadFile\n    length=int(req.headers.get('content-length', 0))) as reporter:\ndandi/girder.py:490: in __init__\n    self._pbar = tqdm.tqdm(desc=label, total=length, unit=\"B\", unit_scale=True)\nvenvs/dev3/lib/python3.7/site-packages/tqdm/std.py:1048: in __init__\n    self.refresh(lock_args=self.lock_args)\nvenvs/dev3/lib/python3.7/site-packages/tqdm/std.py:1338: in refresh\n    self._lock.release()\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = \u003ctqdm.std.TqdmDefaultWriteLock object at 0x7fb21a006b10\u003e\n\n    def release(self):\n        for lock in self.locks[::-1]:  # Release in inverse order of acquisition\n\u003e           lock.release()\nE           AssertionError: attempt to release recursive lock not owned by thread\n\nvenvs/dev3/lib/python3.7/site-packages/tqdm/std.py:93: AssertionError\n--------------------------------------------- Captured stderr call ----------------------------------------------\n2020-06-01 18:36:24,494 [    INFO] Downloading item with id ['5e70d3173da50caa9adaf335', '5e70d3183da50caa9adaf336'] from https://girder.dandiarchive.org/\nsub-anm372795_ses-20170715.nwb: 100%|██████████| 323k/323k [00:00\u003c00:00, 422kB/s]\n```\n```\n$\u003e acpolicy python3-tqdm\npython3-tqdm:\n  Installed: 4.43.0-1\n  Candidate: 4.43.0-1\n  Version table:\n *** 4.43.0-1 900\n        900 http://deb.debian.org/debian bullseye/main amd64 Packages\n        900 http://deb.debian.org/debian bullseye/main i386 Packages\n        600 http://http.debian.net/debian sid/main amd64 Packages\n        100 /var/lib/dpkg/status\n```","files":null}]}