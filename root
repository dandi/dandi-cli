{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1743778428,"metadata":{"github-id":"I_kwDODBZtRc6xLrx8","github-url":"https://github.com/dandi/dandi-cli/issues/1606","origin":"github"},"title":"validate on datalad dataset without data fetched -- floods the screen","message":"\u003cdetails\u003e\n\u003csummary\u003ewith exception tracebacks for every file\u003c/summary\u003e \n\n```shell\n❯ datalad clone https://github.com/dandisets/000029\n[INFO   ] Remote origin not usable by git-annex; setting annex-ignore                                                                                                               \n[INFO   ] https://github.com/dandisets/000029/config download failed: Not Found                                                                                                     \n[INFO   ] access to 2 dataset siblings dandi-dandisets-dropbox, dandiapi not auto-enabled, enable with:\n| \t\tdatalad siblings -d \"/tmp/000029\" enable -s SIBLING \ninstall(ok): /tmp/000029 (dataset)\n❯ dandi validate 000029\n[pynwb.GENERIC] /tmp/000029/sub-monk-g/sub-monk-g.nwb — [Errno 2] Unable to synchronously open file (unable to open file: name = '/tmp/000029/sub-monk-g/sub-monk-g.nwb', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)\n[NWBI.During io.read() - \u003cclass 'ValueError'\u003e: Unable to automatically determine method. Path /tmp/000029/sub-monk-g/sub-monk-g.nwb does not appear to be a URL and is not a file on the local filesystem.] /tmp/000029/sub-monk-g/sub-monk-g.nwb — Traceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/_nwb_inspection.py\", line 277, in inspect_nwbfile\n    in_memory_nwbfile = read_nwbfile(nwbfile_path=nwbfile_path)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 95, in read_nwbfile\n    nwbfile, _ = _read_nwbfile_helper(nwbfile_path=nwbfile_path, method=method, backend=backend)\n                 ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 143, in _read_nwbfile_helper\n    method = method or _get_method(nwbfile_path)\n                       ~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 28, in _get_method\n    raise ValueError(message)\nValueError: Unable to automatically determine method. Path /tmp/000029/sub-monk-g/sub-monk-g.nwb does not appear to be a URL and is not a file on the local filesystem.\n\n[pynwb.GENERIC] /tmp/000029/sub-anm369964/sub-anm369964_behavior+ecephys.nwb — [Errno 2] Unable to synchronously open file (unable to open file: name = '/tmp/000029/sub-anm369964/sub-anm369964_behavior+ecephys.nwb', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)\n[NWBI.During io.read() - \u003cclass 'ValueError'\u003e: Unable to automatically determine method. Path /tmp/000029/sub-anm369964/sub-anm369964_behavior+ecephys.nwb does not appear to be a URL and is not a file on the local filesystem.] /tmp/000029/sub-anm369964/sub-anm369964_behavior+ecephys.nwb — Traceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/_nwb_inspection.py\", line 277, in inspect_nwbfile\n    in_memory_nwbfile = read_nwbfile(nwbfile_path=nwbfile_path)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 95, in read_nwbfile\n    nwbfile, _ = _read_nwbfile_helper(nwbfile_path=nwbfile_path, method=method, backend=backend)\n                 ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 143, in _read_nwbfile_helper\n    method = method or _get_method(nwbfile_path)\n                       ~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 28, in _get_method\n    raise ValueError(message)\nValueError: Unable to automatically determine method. Path /tmp/000029/sub-anm369964/sub-anm369964_behavior+ecephys.nwb does not appear to be a URL and is not a file on the local filesystem.\n\n[pynwb.GENERIC] /tmp/000029/sub-anm369963/sub-anm369963_behavior+ecephys.nwb — [Errno 2] Unable to synchronously open file (unable to open file: name = '/tmp/000029/sub-anm369963/sub-anm369963_behavior+ecephys.nwb', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)\n[NWBI.During io.read() - \u003cclass 'ValueError'\u003e: Unable to automatically determine method. Path /tmp/000029/sub-anm369963/sub-anm369963_behavior+ecephys.nwb does not appear to be a URL and is not a file on the local filesystem.] /tmp/000029/sub-anm369963/sub-anm369963_behavior+ecephys.nwb — Traceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/_nwb_inspection.py\", line 277, in inspect_nwbfile\n    in_memory_nwbfile = read_nwbfile(nwbfile_path=nwbfile_path)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 95, in read_nwbfile\n    nwbfile, _ = _read_nwbfile_helper(nwbfile_path=nwbfile_path, method=method, backend=backend)\n                 ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 143, in _read_nwbfile_helper\n    method = method or _get_method(nwbfile_path)\n                       ~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 28, in _get_method\n    raise ValueError(message)\nValueError: Unable to automatically determine method. Path /tmp/000029/sub-anm369963/sub-anm369963_behavior+ecephys.nwb does not appear to be a URL and is not a file on the local filesystem.\n\n[pynwb.GENERIC] /tmp/000029/sub-anm369962/sub-anm369962_behavior+ecephys.nwb — [Errno 2] Unable to synchronously open file (unable to open file: name = '/tmp/000029/sub-anm369962/sub-anm369962_behavior+ecephys.nwb', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)\n[NWBI.During io.read() - \u003cclass 'ValueError'\u003e: Unable to automatically determine method. Path /tmp/000029/sub-anm369962/sub-anm369962_behavior+ecephys.nwb does not appear to be a URL and is not a file on the local filesystem.] /tmp/000029/sub-anm369962/sub-anm369962_behavior+ecephys.nwb — Traceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/_nwb_inspection.py\", line 277, in inspect_nwbfile\n    in_memory_nwbfile = read_nwbfile(nwbfile_path=nwbfile_path)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 95, in read_nwbfile\n    nwbfile, _ = _read_nwbfile_helper(nwbfile_path=nwbfile_path, method=method, backend=backend)\n                 ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 143, in _read_nwbfile_helper\n    method = method or _get_method(nwbfile_path)\n                       ~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 28, in _get_method\n    raise ValueError(message)\nValueError: Unable to automatically determine method. Path /tmp/000029/sub-anm369962/sub-anm369962_behavior+ecephys.nwb does not appear to be a URL and is not a file on the local filesystem.\n\n[pynwb.GENERIC] /tmp/000029/sub-RAT123/sub-RAT123.nwb — [Errno 2] Unable to synchronously open file (unable to open file: name = '/tmp/000029/sub-RAT123/sub-RAT123.nwb', errno = 2, error message = 'No such file or directory', flags = 0, o_flags = 0)\n[NWBI.During io.read() - \u003cclass 'ValueError'\u003e: Unable to automatically determine method. Path /tmp/000029/sub-RAT123/sub-RAT123.nwb does not appear to be a URL and is not a file on the local filesystem.] /tmp/000029/sub-RAT123/sub-RAT123.nwb — Traceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/_nwb_inspection.py\", line 277, in inspect_nwbfile\n    in_memory_nwbfile = read_nwbfile(nwbfile_path=nwbfile_path)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 95, in read_nwbfile\n    nwbfile, _ = _read_nwbfile_helper(nwbfile_path=nwbfile_path, method=method, backend=backend)\n                 ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 143, in _read_nwbfile_helper\n    method = method or _get_method(nwbfile_path)\n                       ~~~~~~~~~~~^^^^^^^^^^^^^^\n  File \"/home/yoh/proj/dandi/dandi-cli-master/venv/dev3/lib/python3.13/site-packages/nwbinspector/tools/_read_nwbfile.py\", line 28, in _get_method\n    raise ValueError(message)\nValueError: Unable to automatically determine method. Path /tmp/000029/sub-RAT123/sub-RAT123.nwb does not appear to be a URL and is not a file on the local filesystem.\n\n2025-04-04 10:47:01,176 [    INFO] Logs saved in /home/yoh/.local/state/dandi-cli/log/2025.04.04-14.47.00Z-548118.log\n\n```\n\u003c/details\u003e\n\nI think we should embed knowledge that specific validators need content to get files validated.  But some might be \"mixed\" and have no option to validate e.g. only filename without content (like `bids-validator` has `--ignoreNiftiHeaders`).  So I think we need to\n\n- add `--missing-file-content error,only-non-data,skip` option so we would error (not as verbose) by default for validation of those, with `only-non-data` we would instruct validators (or skip if we know that it only cares about data, like nwb.validate) to check only non-data components, like paths (e.g. by providing `--ignoreNiftiHeaders` to `bids-validator`), `skip` -- skipping that file entirely if no content.\n  - may be control should be configurable per validator... not sure though yet if worthwhile -- we could add some handling for comma-separated list later on\n- if any validation was skipped due to use of `only-non-data,skip` and encountering broken symlink -- we need to add into validation a WARNING record on that file that it was skipped for that reason (at the end summarization should just state that there were X warnings of those kinds)","files":null}]}