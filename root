{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1600703116,"metadata":{"github-id":"MDU6SXNzdWU3MDU3MTYzNzE=","github-url":"https://github.com/dandi/dandi-cli/issues/245","origin":"github"},"title":"local_docker_compose some times fails","message":"e.g. this run of master: https://github.com/dandi/dandi-cli/runs/1144609727\n\nit seems that the initial failure causing it is\n\n`minio.error.InvalidAccessKeyId: InvalidAccessKeyId: message: The access key Id you provided does not exist in our records.`\n\n\u003cdetails\u003e\n\u003csummary\u003emore of traceback etc\u003c/summary\u003e \n\n```shell\nCreating dandiarchive-docker_django_run ... done\nTraceback (most recent call last):\n  File \"./manage.py\", line 20, in \u003cmodule\u003e\n    main()\n  File \"./manage.py\", line 16, in main\n    execute_from_command_line(sys.argv)\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py\", line 401, in execute_from_command_line\n    utility.execute()\n  File \"/usr/local/lib/python3.8/site-packages/django/core/management/__init__.py\", line 377, in execute\n    django.setup()\n  File \"/usr/local/lib/python3.8/site-packages/django/__init__.py\", line 24, in setup\n    apps.populate(settings.INSTALLED_APPS)\n  File \"/usr/local/lib/python3.8/site-packages/django/apps/registry.py\", line 114, in populate\n    app_config.import_models()\n  File \"/usr/local/lib/python3.8/site-packages/django/apps/config.py\", line 211, in import_models\n    self.models_module = import_module(models_module_name)\n  File \"/usr/local/lib/python3.8/importlib/__init__.py\", line 127, in import_module\n    return _bootstrap._gcd_import(name[level:], package, level)\n...\n  File \"/opt/django/dandi/publish/models/asset.py\", line 27, in _get_asset_blob_storage\n    return create_s3_storage(settings.DANDI_DANDISETS_BUCKET_NAME)\n  File \"/opt/django/dandi/publish/storage.py\", line 119, in create_s3_storage\n    storage = VerbatimNameMinioStorage(\n  File \"/opt/django/dandi/publish/storage.py\", line 57, in __init__\n    super().__init__(*args, **kwargs)\n  File \"/usr/local/lib/python3.8/site-packages/minio_storage/storage.py\", line 75, in __init__\n    self._init_check()\n  File \"/usr/local/lib/python3.8/site-packages/minio_storage/storage.py\", line 89, in _init_check\n    if self.auto_create_bucket and not self.client.bucket_exists(\n  File \"/usr/local/lib/python3.8/site-packages/minio/api.py\", line 404, in bucket_exists\n    self._url_open('HEAD', bucket_name=bucket_name)\n  File \"/usr/local/lib/python3.8/site-packages/minio/api.py\", line 2185, in _url_open\n    region = self._get_bucket_region(bucket_name)\n  File \"/usr/local/lib/python3.8/site-packages/minio/api.py\", line 2063, in _get_bucket_region\n    region = self._get_bucket_location(bucket_name)\n  File \"/usr/local/lib/python3.8/site-packages/minio/api.py\", line 2105, in _get_bucket_location\n    raise ResponseError(response, method, bucket_name).get_exception()\nminio.error.InvalidAccessKeyId: InvalidAccessKeyId: message: The access key Id you provided does not exist in our records.\nStopping dandiarchive-docker_rabbitmq_1 ... \nStopping dandiarchive-docker_postgres_1 ... \n```\n\u003c/details\u003e\n\nwhich overall leads to `87 passed, 13 errors`.  If that is the actual issue triggering the failure -- smells like some race condition, and may be then should be addressed at \"-publish\" level.  Or could we just try starting a few times within our fixture?  WDYT @jwodder ?","files":null}]}