{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1635277057,"metadata":{"github-id":"I_kwDODBZtRc49yk-F","github-url":"https://github.com/dandi/dandi-cli/issues/817","origin":"github"},"title":"we are silently failing to download a non-existing asset","message":"I was going through an example on https://www.dandiarchive.org/handbook/10_using_dandi/ and was surprised by:\n\n```shell\n$\u003e dandi --version\n0.31.0+2.g1620fcd\n$\u003e dandi download https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/download/\n$\u003e echo $?\n0\n```\n\nso it seems nothing was done, no error reported, and exit code is 0. log file does have details that the asset is not there (404) though\n\n```shell\n$\u003e cat /home/yoh/.cache/dandi-cli/log/20211026193255Z-3618862.log\n2021-10-26T15:32:55-0400 [INFO    ] dandi 3618862:140654837679936 dandi v0.31.0+2.g1620fcd, hdmf v3.1.1, pynwb v2.0.0, h5py v3.4.0\n2021-10-26T15:32:55-0400 [INFO    ] dandi 3618862:140654837679936 sys.argv = ['/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/bin/dandi', 'download', 'https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/download/']\n2021-10-26T15:32:55-0400 [INFO    ] dandi 3618862:140654837679936 os.getcwd() = /tmp\n2021-10-26T15:32:56-0400 [DEBUG   ] urllib3.connectionpool 3618862:140654837679936 Starting new HTTPS connection (1): rig.mit.edu:443\n2021-10-26T15:32:56-0400 [DEBUG   ] urllib3.connectionpool 3618862:140654837679936 https://rig.mit.edu:443 \"GET /et/projects/dandi/dandi-cli HTTP/1.1\" 200 471\n2021-10-26T15:32:56-0400 [DEBUG   ] dandi 3618862:140654837679936 Running a newer version (0.31.0+2.g1620fcd) of dandi/dandi-cli than available (0.31.0)\n2021-10-26T15:32:56-0400 [DEBUG   ] dandi 3618862:140654837679936 Parsing url https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/download/\n2021-10-26T15:32:56-0400 [DEBUG   ] dandi 3618862:140654837679936 Parsed into AssetIDURL(api_url=AnyHttpUrl('https://api.dandiarchive.org/api', scheme='https', host='api.dandiarchive.org', tld='org', host_type='domain', path='/api'), dandiset_id='000004', version_id='draft', asset_id='9d9f379d-9fd1-4872-8c49-3891dfb693ab')\n2021-10-26T15:32:56-0400 [DEBUG   ] pyout.interface 3618862:140654837679936 Initializing mode with given value of None\n2021-10-26T15:32:56-0400 [DEBUG   ] pyout.interface 3618862:140654837679936 Setting write mode to 'update'\n2021-10-26T15:32:56-0400 [DEBUG   ] pyout.interface 3618862:140654837679936 Setting width to stream width: 151\n2021-10-26T15:32:56-0400 [DEBUG   ] dandi 3618862:140654249309952 GET https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/\n2021-10-26T15:32:56-0400 [DEBUG   ] urllib3.connectionpool 3618862:140654249309952 Starting new HTTPS connection (1): api.dandiarchive.org:443\n2021-10-26T15:32:56-0400 [DEBUG   ] urllib3.connectionpool 3618862:140654249309952 https://api.dandiarchive.org:443 \"GET /api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/ HTTP/1.1\" 404 23\n2021-10-26T15:32:56-0400 [DEBUG   ] dandi 3618862:140654249309952 Response: 404\n2021-10-26T15:32:56-0400 [ERROR   ] dandi 3618862:140654249309952 Error 404 while sending GET request to https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/: {\"detail\":\"Not found.\"}\n2021-10-26T15:32:56-0400 [DEBUG   ] pyout.interface 3618862:140654837679936 Waiting for asynchronous calls\n2021-10-26T15:32:56-0400 [INFO    ] dandi 3618862:140654837679936 Logs saved in /home/yoh/.cache/dandi-cli/log/20211026193255Z-3618862.log\n```\nand if I specify to use `-f debug` (not default pyout) we do show that error log message but exit code is still 0.\n\n```shell\n$\u003e dandi download -f debug https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/download/\n2021-10-26 15:34:54,652 [   ERROR] Error 404 while sending GET request to https://api.dandiarchive.org/api/dandisets/000004/versions/draft/assets/9d9f379d-9fd1-4872-8c49-3891dfb693ab/: {\"detail\":\"Not found.\"}\n2021-10-26 15:34:54,654 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20211026193454Z-3619234.log\n\n$\u003e echo $?\n0\n```\n\nI feel that\n- pyout interfacing code should be adjusted to show the \"table\" with ERROR shown\n- we should exit with non-0 exit code if any `download` has errored out","files":null}]}