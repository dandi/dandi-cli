{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1743710075,"metadata":{"github-id":"I_kwDODBZtRc6xDszg","github-url":"https://github.com/dandi/dandi-cli/issues/1604","origin":"github"},"title":"flaky test_follow_redirect on windows","message":"while on \n- #1603 \nran into \n\n```\n____________________________ test_follow_redirect _____________________________\n937\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:787: in urlopen\n938\n    response = self._make_request(\n939\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:488: in _make_request\n940\n    raise new_e\n941\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:464: in _make_request\n942\n    self._validate_conn(conn)\n943\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:1093: in _validate_conn\n944\n    conn.connect()\n945\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connection.py:741: in connect\n946\n    sock_and_verified = _ssl_wrap_socket_and_match_hostname(\n947\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connection.py:920: in _ssl_wrap_socket_and_match_hostname\n948\n    ssl_sock = ssl_wrap_socket(\n949\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\util\\ssl_.py:460: in ssl_wrap_socket\n950\n    ssl_sock = _ssl_wrap_socket_impl(sock, context, tls_in_tls, server_hostname)\n951\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\util\\ssl_.py:504: in _ssl_wrap_socket_impl\n952\n    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)\n953\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\ssl.py:513: in wrap_socket\n954\n    return self.sslsocket_class._create(\n955\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\ssl.py:1071: in _create\n956\n    self.do_handshake()\n957\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\ssl.py:1342: in do_handshake\n958\n    self._sslobj.do_handshake()\n959\nE   ConnectionResetError: [WinError 10054] An existing connection was forcibly closed by the remote host\n960\n\n961\nDuring handling of the above exception, another exception occurred:\n962\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\adapters.py:667: in send\n963\n    resp = conn.urlopen(\n964\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:841: in urlopen\n965\n    retries = retries.increment(\n966\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\util\\retry.py:474: in increment\n967\n    raise reraise(type(error), error, _stacktrace)\n968\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\util\\util.py:38: in reraise\n969\n    raise value.with_traceback(tb)\n970\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:787: in urlopen\n971\n    response = self._make_request(\n972\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:488: in _make_request\n973\n    raise new_e\n974\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:464: in _make_request\n975\n    self._validate_conn(conn)\n976\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connectionpool.py:1093: in _validate_conn\n977\n    conn.connect()\n978\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connection.py:741: in connect\n979\n    sock_and_verified = _ssl_wrap_socket_and_match_hostname(\n980\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\connection.py:920: in _ssl_wrap_socket_and_match_hostname\n981\n    ssl_sock = ssl_wrap_socket(\n982\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\util\\ssl_.py:460: in ssl_wrap_socket\n983\n    ssl_sock = _ssl_wrap_socket_impl(sock, context, tls_in_tls, server_hostname)\n984\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\urllib3\\util\\ssl_.py:504: in _ssl_wrap_socket_impl\n985\n    return ssl_context.wrap_socket(sock, server_hostname=server_hostname)\n986\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\ssl.py:513: in wrap_socket\n987\n    return self.sslsocket_class._create(\n988\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\ssl.py:1071: in _create\n989\n    self.do_handshake()\n990\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\ssl.py:1342: in do_handshake\n991\n    self._sslobj.do_handshake()\n992\nE   urllib3.exceptions.ProtocolError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n993\n\n994\nDuring handling of the above exception, another exception occurred:\n995\ndandi\\tests\\test_dandiarchive.py:461: in test_follow_redirect\n996\n    url = follow_redirect(\"https://bit.ly/dandi12\")\n997\ndandi\\dandiarchive.py:894: in follow_redirect\n998\n    r = requests.head(url, allow_redirects=True)\n999\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\api.py:100: in head\n1000\n    return request(\"head\", url, **kwargs)\n1001\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\api.py:59: in request\n1002\n    return session.request(method=method, url=url, **kwargs)\n1003\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\sessions.py:589: in request\n1004\n    resp = self.send(prep, **send_kwargs)\n1005\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\sessions.py:724: in send\n1006\n    history = [resp for resp in gen]\n1007\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\sessions.py:724: in \u003clistcomp\u003e\n1008\n    history = [resp for resp in gen]\n1009\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\sessions.py:265: in resolve_redirects\n1010\n    resp = self.send(\n1011\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\sessions.py:703: in send\n1012\n    r = adapter.send(request, **kwargs)\n1013\nC:\\hostedtoolcache\\windows\\Python\\3.10.11\\x64\\lib\\site-packages\\requests\\adapters.py:682: in send\n1014\n    raise ConnectionError(err, request=request)\n1015\nE   requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n```\n\nwhich seems has happened twice and only on windows now this month\n\n```\ndandi@drogon:/mnt/backup/dandi/tinuous-logs/dandi-cli/2025/04$ git grep 'FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect'\n01/github/pr/1599/0ca8b1f/Tests/6271/6_test (windows-2019, 3.10, normal).txt:2025-04-01T19:49:07.5583593Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n01/github/pr/UNK/7e4d870/Tests/6270/16_test (windows-2019, 3.12, normal).txt:2025-04-01T19:40:14.2207536Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n```\n\nand happened few times prior\n\n```\n05/github/cron/20250305T060430/51d8348/Tests/6174/13_test (windows-2019, 3.9, normal).txt:2025-03-05T06:15:02.1727469Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n13/github/cron/20250313T060426/5555a76/Tests/6196/2_test (windows-2019, 3.12, normal).txt:2025-03-13T06:10:13.5556876Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n17/github/pr/1514/0c6c076/Tests/6206/3_test (windows-2019, 3.10, normal).txt:2025-03-17T22:17:28.4957896Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectTimeout: HTTPSConnectionPool(host='dandiarchive.org', port=443): Max retries exceeded with url: / (Caused by ConnectTimeoutError(\u003curllib3.connection.HTTPSConnection object at 0x0000022F073FAAD0\u003e, 'Connection to dandiarchive.org timed out. (connect timeout=None)'))\n20/github/pr/1514/64bbc5c/Tests/6219/3_test (windows-2019, 3.11, normal).txt:2025-03-20T21:19:24.5352147Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n24/github/pr/1514/46eb9d3/Tests/6229/12_test (windows-2019, 3.9, normal).txt:2025-03-24T03:04:18.3189061Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n24/github/pr/1514/46eb9d3/Tests/6229/9_test (windows-2019, 3.10, normal).txt:2025-03-24T03:05:55.6916477Z FAILED dandi/tests/test_dandiarchive.py::test_follow_redirect - requests.exceptions.ConnectionError: ('Connection aborted.', ConnectionResetError(10054, 'An existing connection was forcibly closed by the remote host', None, 10054, None))\n~\n```\nalways windows ... \n```","files":null}]}