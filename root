{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1675119112,"metadata":{"github-id":"I_kwDODBZtRc5dLopz","github-url":"https://github.com/dandi/dandi-cli/issues/1196","origin":"github"},"title":"Extract metadata from asset on remote server","message":"A satellite to https://github.com/dandi/dandi-archive/issues/1450 . We need to workout a way to update metadata of draft dandisets, at least for NWB assets, without downloading them or going through datalad-fuse. PyNWB works fine with fsspec or via ROS3 driver to get remote access to the asset. \n\nSo if we dismiss for now the use case of NWB file belonging to BIDS (not DANDI layout dandiset) where there might be extra metadata needed to be extracted using BIDS utils, we need a helper given a dandiset ID and server instance (name)\n- verify that dandiset is not BIDS dandiset (that there is no dataset-description.json), if it is BIDS - skip\n- iterate through the assets and if an asset is .nwb file\n  - extract metadata from the remote copy of the file by accessing via fsspec not local file\n  - (optional, probably not needed really) check if resultant metadata record differs anyhow besides version of the dandi-cli which extracted it \n  - mint a new asset for the prior blob id / path but with new metadata\n\nCorrect @satra ?  \n\nNote that we will pretty much double number of assets in the archive (now we have 240323), some of old ones would become orphans (we still do not have GC AFAIK) if not belonging to any published dandiset version (it seems we have only half of 170 non-empty dandisets published , ref: https://github.com/dandi/dandi-archive/issues/1455)","files":null}]}