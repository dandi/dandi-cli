{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1681937324,"metadata":{"github-id":"I_kwDODBZtRc5j38R0","github-url":"https://github.com/dandi/dandi-cli/issues/1280","origin":"github"},"title":"service-scripts update-dandiset-from-doi","message":"In our today's meeting attended by @waxlamp @bendichter @asmacdo and @weiglszonja we decided that https://github.com/dandi/dandi-archive/issues/1423 would be approached by first implementing needed logic in dandi-cli, at large reusing prototypes coded up in https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1373745996 and https://github.com/dandi/dandi-archive/issues/1423#issuecomment-1408669132 .\n\nIn this issue we would **not** work to address https://github.com/dandi/dandi-archive/issues/772 , as to enhance authors' metadata with records from ORCID. For that we might later craft a dedicated `update-dandiset-contributors-from-orcid` or alike to be either chained or integrated with in `update-dandiset-from-doi`.\n\nI think we need \n\n```shell\ndandi service-scripts update-dandiset-from-doi -d|--dandiset DANDISET_ID[ --existing ask,overwrite,skip][ --fields contributor,name,description,relatedResource]  DOI\n```\n\n- `--existing` is to instruct on how to behave while intending to place a value where there is a **different** value already. If \"ask\" - show existing value, offer a new one, ask it should be overwritten.  if \"overwrite\" -- just overwrite without interaction. if \"skip\" - skip\n- `--fields` -- by default go through all listed below, but if option is specified (comma separated values?) - consider only those\n\nThe command will\n- get metadata for DANDISET_ID\n- request citation record from DOI\n- based on information in DOI record\n  - add \"authors\" to the `contributor:` list\n    - while considering an author, check if there is already one which matches either by ORCID or if not present - name matches an already known contributor.  If so and not identical -- act based on `existing` value\n    - if corresponding author of the paper (if record provides that information) -- add with `dcite:ContactPerson` role,  for all - add as `dcite:Author`\n    - see e.g. https://github.com/dandisets/000402/blob/b5e4ab7e991e1f91476da31c722be276ec08c8f3/dandiset.yaml#L121 for a sample of such automatically added entries and what default fields to take\n  - use \"title\" for the \"name:\"\n  - use \"abstract\" for the \"description:\"\n  - add a record to `relatedResource:` list alike\n ```yaml\n- identifier: {DOI}\n  name: {title}\n  relation: dcite:IsDescribedBy\n  schemaKey: Resource\n  url: https://doi.org/{DOI}\n```\n   - first check if there is one among possibly present and identify based on \"identifier\", act based on `--existing` \n- if anything was actually changed in the metadata record\n  - add to `wasGeneratedBy:` a record like the one we are adding while extracting metadata for assets:\n\n```json\n        {\n          \"description\": \"Metadata ({','.join(modified_fields)}) was enhanced by DANDI cli from DOI {doi}\",\n          \"endDate\": \"{now}\",\n          \"id\": \"urn:uuid:{iirc random UUID}\",\n          \"name\": \"Metadata extraction from DOI\",\n          \"schemaKey\": \"Activity\",\n          \"startDate\": \"{when started doing the mess}\",\n          \"wasAssociatedWith\": [\n            {\n              \"identifier\": \"RRID:SCR_019009\",\n              \"name\": \"DANDI Command Line Interface\",\n              \"schemaKey\": \"Software\",\n              \"url\": \"https://github.com/dandi/dandi-cli\",\n              \"version\": \"{version}\"\n            }\n          ]\n        }\n ```\n    which would then allow us to figure out dandisets which used this functionality.\n   - ask to either show simple unified diff in rendering of the original and modified records\n   - ask to either update dandiset record with this modified record, and if yes - do so\n\n@bendichter @satra any other fields possibly to re-use or reference to from  dandiset?  Anything to add/remove from above?","files":null}]}