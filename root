{"version":2,"ops":[{"type":1,"author":{"id":"b47d70447f48e9670debced52b0983080ea7199d"},"timestamp":1688139488,"metadata":{"github-id":"I_kwDODBZtRc5qQoXV","github-url":"https://github.com/dandi/dandi-cli/issues/1307","origin":"github"},"title":"cannot upload zarr files","message":"Hi all, \n\nusing the latest version I can't upload zarr data because an `IsADirectoryError` exception is raised. See below. \n\n\n\n```\n2023-06-30T17:19:50+0200 [INFO    ] dandi 3077715:140494520747840 dandi v0.55.1, hdmf v3.6.1, pynwb v2.3.3, h5py v3.9.0\n2023-06-30T17:19:50+0200 [INFO    ] dandi 3077715:140494520747840 sys.argv = ['/opt/bin/dandi', 'upload', '--allow-any-path', '--validation', 'ignore', 'sub-I59/ses-SPIM/micr/sub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr']\n2023-06-30T17:19:50+0200 [INFO    ] dandi 3077715:140494520747840 os.getcwd() = /mnt/NIH/DANDI/000026\n2023-06-30T17:19:50+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 Starting new HTTPS connection (1): rig.mit.edu:443\n2023-06-30T17:19:51+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 https://rig.mit.edu:443 \"GET /et/projects/dandi/dandi-cli HTTP/1.1\" 200 579\n2023-06-30T17:19:51+0200 [DEBUG   ] dandi 3077715:140494520747840 No newer (than 0.55.1) version of dandi/dandi-cli found available\n...\n2023-06-30T17:19:53+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 Starting new HTTPS connection (1): dandiarchive.org:443\n2023-06-30T17:19:53+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 https://dandiarchive.org:443 \"GET /server-info HTTP/1.1\" 200 354\n2023-06-30T17:19:53+0200 [DEBUG   ] dandi 3077715:140494520747840 GET https://api.dandiarchive.org/api/info/\n2023-06-30T17:19:53+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 Starting new HTTPS connection (1): api.dandiarchive.org:443\n2023-06-30T17:19:53+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 https://api.dandiarchive.org:443 \"GET /api/info/ HTTP/1.1\" 200 354\n2023-06-30T17:19:53+0200 [DEBUG   ] dandi 3077715:140494520747840 Response: 200\n...\n2023-06-30T17:19:58+0200 [DEBUG   ] dandi 3077715:140494520747840 Using API key from keyring\n2023-06-30T17:19:58+0200 [DEBUG   ] dandi 3077715:140494520747840 GET https://api.dandiarchive.org/api/auth/token\n2023-06-30T17:19:58+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 https://api.dandiarchive.org:443 \"GET /api/auth/token HTTP/1.1\" 301 0\n2023-06-30T17:19:58+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 https://api.dandiarchive.org:443 \"GET /api/auth/token/ HTTP/1.1\" 200 42\n2023-06-30T17:19:58+0200 [DEBUG   ] dandi 3077715:140494520747840 Response: 200\n2023-06-30T17:19:58+0200 [DEBUG   ] dandi 3077715:140494520747840 Found identifier DANDI:000026 in top level 'identifier'\n2023-06-30T17:20:17+0200 [INFO    ] dandi 3077715:140494520747840 Found 2 files to consider\n2023-06-30T17:20:19+0200 [WARNING ] bids-schema 3077715:140493548414720 No BIDS reference root provided.\n2023-06-30T17:20:19+0200 [INFO    ] bids-schema 3077715:140493548414720 No schema path specified, defaulting to the bundled schema, `/opt/lib/python3.8/site-packages/bidsschematools/data/schema`.\n...\n2023-06-30T17:21:58+0200 [DEBUG   ] dandi 3077715:140493548414720 GET https://api.dandiarchive.org/api/dandisets/000026/versions/draft/assets/\n2023-06-30T17:21:58+0200 [DEBUG   ] urllib3.connectionpool 3077715:140493548414720 Resetting dropped connection: api.dandiarchive.org\n2023-06-30T17:21:59+0200 [DEBUG   ] urllib3.connectionpool 3077715:140493548414720 https://api.dandiarchive.org:443 \"GET /api/dandisets/000026/versions/draft/assets/?path=sub-I59%2Fses-SPIM%2Fmicr%2Fsub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr HTTP/1.1\" 200 52\n2023-06-30T17:21:59+0200 [DEBUG   ] dandi 3077715:140493548414720 Response: 200\n2023-06-30T17:22:01+0200 [DEBUG   ] fscacher.cache 3077715:140493548414720 Calling memoized version of \u003cfunction get_dandietag at 0x7fc69e831ca0\u003e for /mnt/NIH/DANDI/000026/sub-I59/ses-SPIM/micr/sub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr\n2023-06-30T17:22:01+0200 [DEBUG   ] fscacher.cache 3077715:140493548414720 Running original \u003cfunction get_dandietag at 0x7fc69e831ca0\u003e on PosixPath('/mnt/NIH/DANDI/000026/sub-I59/ses-SPIM/micr/sub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr')\n2023-06-30T17:22:01+0200 [ERROR   ] dandi 3077715:140493548414720 Error uploading /mnt/NIH/DANDI/000026/sub-I59/ses-SPIM/micr/sub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr:\nTraceback (most recent call last):\n  File \"/opt/lib/python3.8/site-packages/dandi/upload.py\", line 263, in process_path\n    for r in dfile.iter_upload(\n  File \"/opt/lib/python3.8/site-packages/dandi/files/bases.py\", line 339, in iter_upload\n    etagger = get_dandietag(self.filepath)\n  File \"/opt/lib/python3.8/site-packages/fscacher/cache.py\", line 157, in fingerprinter\n    ret = fingerprinted(*args, **kwargs_)\n  File \"/opt/lib/python3.8/site-packages/joblib/memory.py\", line 655, in __call__\n    return self._cached_call(args, kwargs)[0]\n  File \"/opt/lib/python3.8/site-packages/joblib/memory.py\", line 598, in _cached_call\n    out, metadata = self.call(*args, **kwargs)\n  File \"/opt/lib/python3.8/site-packages/joblib/memory.py\", line 856, in call\n    output = self.func(*args, **kwargs)\n  File \"/opt/lib/python3.8/site-packages/fscacher/cache.py\", line 97, in fingerprinted\n    return f(path, *args, **kwargs)\n  File \"/opt/lib/python3.8/site-packages/dandi/support/digests.py\", line 100, in get_dandietag\n    return DandiETag.from_file(filepath)\n  File \"/opt/lib/python3.8/site-packages/dandischema/digests/dandietag.py\", line 147, in from_file\n    with open(path, \"rb\") as f:\nIsADirectoryError: [Errno 21] Is a directory: '/mnt/NIH/DANDI/000026/sub-I59/ses-SPIM/micr/sub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr'\n2023-06-30T17:22:01+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 Starting new HTTPS connection (1): rig.mit.edu:443\n2023-06-30T17:22:01+0200 [DEBUG   ] urllib3.connectionpool 3077715:140494520747840 https://rig.mit.edu:443 \"GET /et/projects/dandi/dandi-cli HTTP/1.1\" 200 579\n2023-06-30T17:22:01+0200 [DEBUG   ] dandi 3077715:140494520747840 Caught exception [Errno 21] Is a directory: '/mnt/NIH/DANDI/000026/sub-I59/ses-SPIM/micr/sub-I59_ses-SPIM_sample-BrocaAreaS01_stain-Calretinin_SPIM.ome.zarr'\n\n```","files":null}]}