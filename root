{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1717684236,"metadata":{"github-id":"I_kwDODBZtRc6LYVbY","github-url":"https://github.com/dandi/dandi-cli/issues/1450","origin":"github"},"title":"test_nwb2asset_remote_asset timed out in test (ubuntu-latest, 3.8, dandi-api)","message":"https://github.com/dandi/dandi-cli/actions/runs/9395898413/job/25876096821\n\n```\n_________________________ test_nwb2asset_remote_asset __________________________\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fscacher/cache.py:133: in fingerprinter\n    path = op.realpath(path_orig)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/posixpath.py:390: in realpath\n    filename = os.fspath(filename)\nE   TypeError: expected str, bytes or os.PathLike object, not RemoteReadableAsset\n\nDuring handling of the above exception, another exception occurred:\ndandi/tests/test_metadata.py:889: in test_nwb2asset_remote_asset\n    assert nwb2asset(r, digest=digest) == BareAsset.model_construct(\ndandi/metadata/nwb.py:149: in nwb2asset\n    metadata = get_metadata(nwb_path)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fscacher/cache.py:138: in fingerprinter\n    return f(*args, **kwargs)\ndandi/metadata/nwb.py:106: in get_metadata\n    meta.update(_get_pynwb_metadata(r))\ndandi/pynwb_utils.py:206: in _get_pynwb_metadata\n    with open_readable(path) as fp, h5py.File(fp, \"r\") as h5, NWBHDF5IO(\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/h5py/_hl/files.py:562: in __init__\n    fid = make_fid(name, mode, userblock_size, fapl, fcpl, swmr=swmr)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/h5py/_hl/files.py:235: in make_fid\n    fid = h5f.open(name, flags, fapl=fapl)\nh5py/_objects.pyx:54: in h5py._objects.with_phil.wrapper\n    ???\nh5py/_objects.pyx:55: in h5py._objects.with_phil.wrapper\n    ???\nh5py/h5f.pyx:102: in h5py.h5f.open\n    ???\nh5py/h5fd.pyx:163: in h5py.h5fd.H5FD_fileobj_read\n    ???\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fsspec/spec.py:1915: in readinto\n    data = self.read(out.nbytes)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fsspec/implementations/http.py:598: in read\n    return super().read(length)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fsspec/spec.py:1897: in read\n    out = self.cache._fetch(self.loc, self.loc + length)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fsspec/caching.py:481: in _fetch\n    self.cache = self.fetcher(start, bend)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fsspec/asyn.py:118: in wrapper\n    return sync(self.loop, func, *args, **kwargs)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/site-packages/fsspec/asyn.py:91: in sync\n    if event.wait(1):\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/threading.py:558: in wait\n    signaled = self._cond.wait(timeout)\n/opt/hostedtoolcache/Python/3.8.18/x64/lib/python3.8/threading.py:306: in wait\n    gotit = waiter.acquire(True, timeout)\nE   Failed: Timeout \u003e300.0s\n------------------------------ Captured log setup ------------------------------\nDEBUG    dandi:dandiapi.py:197 POST http://localhost:8000/api/dandisets/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/info/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:dandiapi.py:493 Using api key from DANDI_API_KEY environment variable\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/auth/token\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:dandiset.py:128 Found identifier 000112 in top level 'identifier'\nINFO     dandi:upload.py:214 Found 2 files to consider\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/dandisets/000112/versions/draft/assets/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:bases.py:342 Calculated dandi-etag of 2dfea6d6ebb6018f3a5c59707bc69ed3-1 for /tmp/pytest-of-runner/pytest-0/dandiset107/sub-mouse001/sub-mouse001.nwb\nDEBUG    dandi:bases.py:351 sub-mouse001/sub-mouse001.nwb: Beginning upload\nDEBUG    dandi:dandiapi.py:197 POST http://localhost:8000/api/uploads/initialize/\nDEBUG    dandi:dandiapi.py:261 Response: 409\nDEBUG    dandi:dandiapi.py:268 Error 409 while sending POST request to http://localhost:8000/api/uploads/initialize/: \"Blob already exists.\"\nDEBUG    dandi:bases.py:367 sub-mouse001/sub-mouse001.nwb: Blob already exists on server\nDEBUG    dandi:bases.py:446 sub-mouse001/sub-mouse001.nwb: Assigning asset blob to dandiset \u0026 version\nDEBUG    dandi:dandiapi.py:197 POST http://localhost:8000/api/dandisets/000112/versions/draft/assets/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nINFO     dandi:bases.py:460 sub-mouse001/sub-mouse001.nwb: Asset successfully uploaded\n------------------------------ Captured log call -------------------------------\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/dandisets/000112/versions/draft/assets/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/dandisets/000112/versions/draft/assets/b770f47f-b67f-4a58-8883-09a2466eb577/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/dandisets/000112/versions/draft/assets/b770f47f-b67f-4a58-8883-09a2466eb577/\nDEBUG    dandi:dandiapi.py:261 Response: 200\nDEBUG    dandi:dandiapi.py:197 GET http://localhost:8000/api/dandisets/000112/versions/draft/assets/b770f47f-b67f-4a58-8883-09a2466eb577/\nDEBUG    dandi:dandiapi.py:261 Response: 200\n\n---------- coverage: platform linux, python 3.8.18-final-0 -----------\n```\n\n@jwodder please remind what those trailing requests are for -- waiting for validation or smth?  I wonder if it is result of some recent change...","files":null}]}