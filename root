{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1623273745,"metadata":{"github-id":"MDU6SXNzdWU5MTY2ODM4NTk=","github-url":"https://github.com/dandi/dandi-cli/issues/661","origin":"github"},"title":"can't upload file/asset if metadata \"extraction\" fails (even if `--validation ignore`)","message":"with 0.19.0+31.g02ee314 , `upload` of a file where metadata extraction fails would not upload at all.\nIn my case it was on a dummy old nwb we have in 000027 and 29:\n```\n(git-annex)lena:~/proj/dandi/dandisets/000029[master]git\n$\u003e dandi upload --validation ignore --existing force sub-RAT123/sub-RAT123.nwb\n2021-06-09 17:15:48,403 [    INFO] Found 1 files to consider\nPATH                      SIZE       ERRORS     UPLOAD STATUS                MESSAGE                      \nsub-RAT123/sub-RAT123.nwb 18.8 kB       1              skipped               failed to extract metadata...\nSummary:                  18.8 kB 1 with errors        1 skipped             1 failed to extract metada...\n2021-06-09 17:15:48,802 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20210609211546Z-1677599.log\n```\nand log gave gory details\n```\n2021-06-09T17:15:46-0400 [INFO    ] dandi 1677599:140096533518144 dandi v0.19.0+31.g02ee314, hdmf v2.3.0, pynwb v1.4.0, h5py v2.10.0\n2021-06-09T17:15:46-0400 [INFO    ] dandi 1677599:140096533518144 sys.argv = ['/home/yoh/proj/dandi/dandi-cli-master/venvs/dev3/bin/dandi', 'upload', '--validation', 'ignore', '--existing', 'force', 'sub-RAT123/sub-RAT123.nwb']\n2021-06-09T17:15:46-0400 [INFO    ] dandi 1677599:140096533518144 os.getcwd() = /home/yoh/proj/dandi/dandisets/000029\n2021-06-09T17:15:48-0400 [INFO    ] dandi 1677599:140096533518144 Found 1 files to consider\n2021-06-09T17:15:48-0400 [ERROR   ] dandi 1677599:140096393844480 Failed to extract metadata from sub-RAT123/sub-RAT123.nwb\nTraceback (most recent call last):\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/upload.py\", line 245, in process_path\n    asset_metadata = nwb2asset(\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/metadata.py\", line 551, in nwb2asset\n    asset = metadata2asset(metadata)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/metadata.py\", line 601, in metadata2asset\n    bare_dict = extract_model(models.BareAsset, metadata).json_dict()\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/metadata.py\", line 229, in extract_model\n    value = kwargs.get(field, extract_field(field, metadata))\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/metadata.py\", line 313, in extract_field\n    return FIELD_EXTRACTORS[field](metadata)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/metadata.py\", line 282, in extract_session\n    models.Session(\n  File \"pydantic/main.py\", line 400, in pydantic.main.BaseModel.__init__\npydantic.error_wrappers.ValidationError: 1 validation error for Session\nname\n  none is not an allowed value (type=type_error.none.not_allowed)\n2021-06-09T17:15:48-0400 [INFO    ] dandi 1677599:140096533518144 Logs saved in /home/yoh/.cache/dandi-cli/log/20210609211546Z-1677599.log\n```\n\nso session is not there and that causes `nwb2asset` to kaboom.  I guess we could take it as a feature but I believe it is a regression (didn't check yet) from previous behavior where we did allow to upload if `--validation ignore` or alike. WDYT @satra ?","files":null}]}