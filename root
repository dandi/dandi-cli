{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1714774074,"metadata":{"github-id":"I_kwDODBZtRc6Hzwxc","github-url":"https://github.com/dandi/dandi-cli/issues/1441","origin":"github"},"title":"py 3.12 -- test completion sourcing fails","message":"only on CI on ubuntu\n\n```\n============================= test session starts ==============================\nplatform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.5.0 -- /opt/hostedtoolcache/Python/3.12.3/x64/bin/python\ncachedir: .pytest_cache\nrootdir: /home/runner/work/dandi-cli/dandi-cli\nconfigfile: tox.ini\nplugins: mock-3.14.0, rerunfailures-14.0, timeout-2.3.1, cov-5.0.0\ntimeout: 300.0s\n...\n=================================== FAILURES ===================================\n_______________________ test_shell_completion_sourceable _______________________\ndandi/cli/tests/test_shell_completion.py:17: in test_shell_completion_sourceable\n    subprocess.run(\n/opt/hostedtoolcache/Python/3.12.3/x64/lib/python3.12/subprocess.py:571: in run\n    raise CalledProcessError(retcode, process.args,\nE   subprocess.CalledProcessError: Command '['bash', '-c', 'source \u003c(dandi shell-completion)']' returned non-zero exit status 2.\n\n---------- coverage: platform linux, python 3.12.3-final-0 -----------\nCoverage XML written to file coverage.xml\n```\n\nbut passes for me locally\n\n```\n‚ùØ python -m pytest -s -v dandi/cli/tests/test_shell_completion.py\n====================================================================================================== test session starts =======================================================================================================\nplatform linux -- Python 3.12.3, pytest-8.2.0, pluggy-1.5.0 -- /home/yoh/proj/dandi/dandi-cli-master/venvs/dev3.12/bin/python\ncachedir: .pytest_cache\nrootdir: /home/yoh/proj/dandi/dandi-cli-master\nconfigfile: tox.ini\nplugins: rerunfailures-14.0, mock-3.14.0, cov-5.0.0\ncollected 1 item                                                                                                                                                                                                                 \n\ndandi/cli/tests/test_shell_completion.py::test_shell_completion_sourceable PASSED\n\n====================================================================================================== slowest 10 durations ======================================================================================================\n1.38s call     dandi/cli/tests/test_shell_completion.py::test_shell_completion_sourceable\n\n(2 durations \u003c 0.005s hidden.  Use -vv to show these durations.)\n======================================================================================================= 1 passed in 1.42s ========================================================================================================\npython -m pytest -s -v dandi/cli/tests/test_shell_completion.py  5.92s user 1.71s system 159% cpu 4.774 total\n\n```\n\nI guess would need an interactive session on CI to see what's up","files":null}]}