{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1665684740,"metadata":{"github-id":"I_kwDODBZtRc5T79gx","github-url":"https://github.com/dandi/dandi-cli/issues/1137","origin":"github"},"title":"Make any .request authenticate if 401?","message":"https://github.com/dandi/dandi-cli/pull/1132 solved problem for `ls` but in the course of going through https://github.com/dandi/dandi-cli/issues/1134 I got similar issue of dandi-cli not authenticating for `get_asset_by_path`:\n\n```\n❯ dandi --version\n0.46.4+10.gef9d853\n❯ cat embargo_url.py\nfrom dandi.dandiapi import DandiAPIClient\nimport sys\ndandiset_id = sys.argv[1] or '000006'  # ephys dataset from the Svoboda Lab\nfilepath = sys.argv[2] or 'sub-anm372795/sub-anm372795_ses-20170718.nwb'  # 450 kB file\nwith DandiAPIClient() as client:\n    # client.dandi_authenticate()\n    asset = client.get_dandiset(dandiset_id, 'draft').get_asset_by_path(filepath)\n    s3_url = asset.get_content_url(follow_redirects=1, strip_query=True)\n    print(f\"{dandiset_id}/{filepath} has {s3_url}\")\n❯ python embargo_url.py '000344' 'sub-private/sub-private.dat'\nError 401 while sending GET request to https://api.dandiarchive.org/api/dandisets/000344/versions/draft/assets/: {\"detail\":\"Authentication credentials were not provided.\"}\nTraceback (most recent call last):\n  File \"/home/yoh/proj/dandi/trash/embargo_url.py\", line 7, in \u003cmodule\u003e\n    asset = client.get_dandiset(dandiset_id, 'draft').get_asset_by_path(filepath)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/dandiapi.py\", line 1106, in get_asset_by_path\n    (asset,) = (\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/dandiapi.py\", line 1106, in \u003cgenexpr\u003e\n    (asset,) = (\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/dandiapi.py\", line 1062, in get_assets_with_path_prefix\n    for a in self.client.paginate(\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/dandiapi.py\", line 354, in paginate\n    resp = self.get(path, params=params, json_resp=False)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/dandiapi.py\", line 300, in get\n    return self.request(\"GET\", path, **kwargs)\n  File \"/home/yoh/proj/dandi/dandi-cli-master/dandi/dandiapi.py\", line 272, in request\n    raise requests.HTTPError(msg, response=result)\nrequests.exceptions.HTTPError: Error 401 while sending GET request to https://api.dandiarchive.org/api/dandisets/000344/versions/draft/assets/: {\"detail\":\"Authentication credentials were not provided.\"}\n```\n\nI think that we should aim to `dandi_authenticate` for any `.request` if we get 401 , shouldn't we?","files":null}]}