{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614005934,"metadata":{"github-id":"MDU6SXNzdWU4MTM1NzgxNjk=","github-url":"https://github.com/dandi/dandi-cli/issues/405","origin":"github"},"title":"Make validation of the upload query server/update less frequently + improve yields to pyout","message":"ATM we are bombarding API server with validation requests too frequently.  E.g. (although this is parallel uploads):\n```\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Waiting for server-side validation to complete\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi GET https://api.dandiarchive.org/api/uploads/validations/c2c71c26b433c6cd317822d5bf6484f9fa0dce07293a9eecc46f3dfafbb84125/\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Response: 200\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Waiting for server-side validation to complete\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi GET https://api.dandiarchive.org/api/uploads/validations/d32f2cc328dedec938c2a28c734a9ec4f3cc2f347b13fccee3bd5d5ede1cf35c/\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Response: 200\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Response: 200\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Waiting for server-side validation to complete\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi GET https://api.dandiarchive.org/api/uploads/validations/81a6e764bda0c0cfa4b96d200b103d347e7d7c7c4ee82665b5b9784f8d2084cf/\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi Waiting for server-side validation to complete\n2021-02-22T09:53:38-0500 [DEBUG   ] dandi GET https://api.dandiarchive.org/api/uploads/validations/f07681c40d0aae99f82836605115290927a25971fcada11b6d502e0e48a73f13/\n2021-02-22T09:53:39-0500 [DEBUG   ] dandi Response: 200\n2021-02-22T09:53:39-0500 [DEBUG   ] dandi Waiting for server-side validation to complete\n2021-02-22T09:53:39-0500 [DEBUG   ] dandi GET https://api.dandiarchive.org/api/uploads/validations/ee9eac72ff68e02f413c1e97445b712d20b9bc692c1cc7c1c4b0433b857e59b1/\n2021-02-22T09:53:39-0500 [DEBUG   ] dandi Response: 200\n2021-02-22T09:53:39-0500 [DEBUG   ] dandi Waiting for server-side validation to complete\n2021-02-22T09:53:39-0500 [DEBUG   ] dandi GET https://api.dandiarchive.org/api/uploads/validations/c2c71c26b433c6cd317822d5bf6484f9fa0dce07293a9eecc46f3dfafbb84125/\n```\n\nI don't think we can make it \"too smart\" (i.e. somehow accumulate the knowledge to guestimate ETA for the validation given the size) but we could at least \n- make it progressively long (I believe we have already some code/behavior like that in dandi-cli somewhere) where we start with querying at 1, 2, 4, ... seconds delays and topping at 60 sec (I think it is logical)\n- may be do make it a bit smart depending on the file size (e.g. not worth even querying at 1 sec to start with if \u003e 100MB)\n- also ATM it causes pyout output blink too much since we keep yielding the same `{'status': 'validating'}` -- we should stop doing that.  If status didnot change, do not re-yield the same `validating` record","files":null}]}