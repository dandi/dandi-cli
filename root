{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1617987361,"metadata":{"github-id":"MDU6SXNzdWU4NTQ2OTQ1NDY=","github-url":"https://github.com/dandi/dandi-cli/issues/542","origin":"github"},"title":"download: test_download_000027 fails in a docker container","message":"I wonder what could be a reason, and may be it is due to https and missing certificates?  I guess we would need more information provided in that `WARNING  dandi:dandiarchive.py:115 Failed to lookup girder information for drafts/000027`?\n\n```shell\n_______________________________________________________________________ test_download_000027[https://dandiarchive.org/dandiset/000027/draft] ________________________________________________________________________\n/opt/miniconda-latest/lib/python3.8/site-packages/dandi/tests/test_download.py:50: in test_download_000027\n    download(url, tmpdir, existing=\"skip\")  # TODO: check that skipped\n/opt/miniconda-latest/lib/python3.8/site-packages/dandi/download.py:80: in download\n    for rec in gen_:\n/opt/miniconda-latest/lib/python3.8/site-packages/dandi/download.py:121: in download_generator\n    with navigate_url(urls[0]) as (client, dandiset, assets):\n/opt/miniconda-latest/lib/python3.8/contextlib.py:113: in __enter__\n    return next(self.gen)\n/opt/miniconda-latest/lib/python3.8/site-packages/dandi/dandiarchive.py:45: in navigate_url\n    asset_id, asset_type, client, server_type = _map_to_girder(url)\n/opt/miniconda-latest/lib/python3.8/site-packages/dandi/dandiarchive.py:118: in _map_to_girder\n    raise RuntimeError(f\"Cannot download from {url}\")\nE   RuntimeError: Cannot download from https://dandiarchive.org/dandiset/000027/draft\n------------------------------------------------------------------------------------------------- Captured log call -------------------------------------------------------------------------------------------------\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:girder.py:823 Establishing a client for https://girder.dandiarchive.org\nDEBUG    dandi:girder.py:494 Traversing folder with id 5f0640a2ab90ac46c4561e4f\nINFO     dandi:girder.py:466 Traversing remote dandisets (000027) recursively\nDEBUG    dandi:dandiset.py:95 Found identifier 000027 in 'dandiset.identifier'\nDEBUG    dandi:download.py:366 Updating dandiset.yaml from obtained dandiset metadata\nDEBUG    dandi:dandiset.py:100 Found identifier 000027 in top level 'identifier'\nDEBUG    dandi:download.py:586 Starting new download in new download directory\nDEBUG    dandi:download.py:524 Verified that /tmp/pytest-of-root/pytest-0/test_download_000027_https___d1/000027/sub-RAT123/sub-RAT123.nwb has correct sha1 3db188426a3f91ae08fb5899491dcbc551292b1f\nDEBUG    dandi.support.digests:digests.py:64 Estimating digests for /tmp/pytest-of-root/pytest-0/test_download_000027_https___d1/000027/sub-RAT123/sub-RAT123.nwb\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:girder.py:823 Establishing a client for https://girder.dandiarchive.org\nDEBUG    dandi:girder.py:494 Traversing folder with id 5f0640a2ab90ac46c4561e4f\nINFO     dandi:girder.py:466 Traversing remote dandisets (000027) recursively\nDEBUG    dandi:dandiset.py:95 Found identifier 000027 in 'dandiset.identifier'\nDEBUG    dandi:download.py:366 Updating dandiset.yaml from obtained dandiset metadata\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://dandiarchive.org/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:296 Parsing url https://gui.dandiarchive.org/#/dandiset/000027/draft\nDEBUG    dandi:dandiarchive.py:406 Parsed into ('girder', 'https://girder.dandiarchive.org/', 'dandiset', {'dandiset_id': '000027', 'version': 'draft'})\nDEBUG    dandi:girder.py:823 Establishing a client for https://girder.dandiarchive.org\nWARNING  dandi:dandiarchive.py:115 Failed to lookup girder information for drafts/000027\n```\ninvocation was:\n```\ndocker run -it --rm -v $PWD/test-downstream.sh:/usr/local/bin/test-downstream.sh dandiarchive/nwb-healthstatus:pynwb-latest bash test-downstream.sh\n```\n\nand the dirty script:\n\n```shell\n$\u003e cat test-downstream.sh\n#!/bin/bash\n\nset -eux\n\ninstall_target=https://github.com/dandi/dandi-cli  # or just dandi\ndevinstall_cmd='pip install ${install_target}[test]'\ntest_cmd='python -m pytest -s -v dandi'\n\ncd \"$(mktemp -d ${TMPDIR:-/tmp}/nwbh-XXXXXXX)\"\n\n# nevermind it -- we will just use pip3 and python3\n## Workaround for debian based systems which have no python\n#if ! which python \u0026\u0026 which python3 ;  then\n#   ln -s `which python3` /usr/local/bin/python\n#fi\nwhich pip3\npython3 --version\n\npip3 install --force-reinstall 'numpy\u003c1.19.4'\n#pip3 install 'dandi[test]'\npip3 install 'dandi[test] @ git+https://github.com/dandi/dandi-cli'\npython3 -m pytest -s -v --tb short --pyargs dandi\n```","files":null}]}