{"version":2,"ops":[{"type":1,"author":{"id":"12cb25e6e3f19b53447b05d00d7d4d53c925c908"},"timestamp":1625145646,"metadata":{"github-id":"MDU6SXNzdWU5MzQ4NDAyMjk=","github-url":"https://github.com/dandi/dandi-cli/issues/695","origin":"github"},"title":"when a non-hdf5 file is being opened a different error is being raised by h5py ","message":"perhaps this is already being tackled in a PR. given that this is specific to 3.7 may be worth checking what version is available. the code suggests that every file is being opened using nwb?\n\nhowever, given that the blob store doesn't have any file extensions, we do need some better evaluation of a file before opening it. we can use the extension if available, but fall back on some other options if not.\n\n```\nERROR    dandi:upload.py:249 Failed to extract metadata from /tmp/pytest-of-runner/pytest-0/test_publish_and_manipulate0/upload/subdir/file.txt\nTraceback (most recent call last):\n  File \"/home/runner/work/dandi-cli/dandi-cli/dandi/upload.py\", line 246, in process_path\n    path, digest=file_etag, digest_type=\"dandi_etag\"\n  File \"/home/runner/work/dandi-cli/dandi-cli/dandi/metadata.py\", line 673, in nwb2asset\n    metadata = get_metadata(nwb_path)\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/fscacher/cache.py\", line 116, in fingerprinter\n    ret = fingerprinted(path, *args, **kwargs_)\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/joblib/memory.py\", line 591, in __call__\n    return self._cached_call(args, kwargs)[0]\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/joblib/memory.py\", line 534, in _cached_call\n    out, metadata = self.call(*args, **kwargs)\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/joblib/memory.py\", line 761, in call\n    output = self.func(*args, **kwargs)\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/fscacher/cache.py\", line 84, in fingerprinted\n    return f(path, *args, **kwargs)\n  File \"/home/runner/work/dandi-cli/dandi-cli/dandi/metadata.py\", line 51, in get_metadata\n    meta[\"nwb_version\"] = get_nwb_version(path)\n  File \"/home/runner/work/dandi-cli/dandi-cli/dandi/pynwb_utils.py\", line 95, in get_nwb_version\n    with h5py.File(filepath, \"r\") as h5file:\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/h5py/_hl/files.py\", line 408, in __init__\n    swmr=swmr)\n  File \"/opt/hostedtoolcache/Python/3.7.10/x64/lib/python3.7/site-packages/h5py/_hl/files.py\", line 173, in make_fid\n    fid = h5f.open(name, flags, fapl=fapl)\n  File \"h5py/_objects.pyx\", line 54, in h5py._objects.with_phil.wrapper\n  File \"h5py/_objects.pyx\", line 55, in h5py._objects.with_phil.wrapper\n  File \"h5py/h5f.pyx\", line 88, in h5py.h5f.open\nOSError: Unable to open file (file signature not found)\n```","files":null}]}