{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1645041770,"metadata":{"github-id":"I_kwDODBZtRc5D-pef","github-url":"https://github.com/dandi/dandi-cli/issues/915","origin":"github"},"title":"zarr upload: do not pre-digest anything","message":"A distilled variant of #903, which if decided to proceed with could take precedence over improving any related code (#913 for more efficient digesting of zarr folders; and #914 - disabling fscaching of individual files in zarr):\n\n- disable digesting of zarr folders in `upload` -- always assume that they differ\n- do not digest individual files unless really needed -- remote file is present, the same size, so its ETag is the only way to say for sure if it is the same\n- for now keep digesting for providing digests to mint upload urls for the batch.  But I am afraid we better disable fscaching of those digests (thus in part #914) since seems to provide too notable impact\n  - ideally there should be a separate process/thread which would take care about pre-digesting files which might be missing digests for the next batch.  This way we could minimize delay between batches\n  - md5 digest should be computed in-band while uploading and compared against ETag for the file whenever done\n- overall zarr archive checksum'ing on the server will be disabled, so we should then stop checking if our upload of the zarr is consistent with the remote upon completion.\n\nIs that about right @satra, are we disabling checksumming of zarrs on dandi-api during upload @dchiquito ?","files":null}]}