{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1616606021,"metadata":{"github-id":"MDU6SXNzdWU4Mzk5NDU1ODg=","github-url":"https://github.com/dandi/dandi-cli/issues/494","origin":"github"},"title":"upload: avoid an explicit check for blob existence, just catch /initialize 409","message":"There is no longer need for an explicit check for blob existence:\n```python\n        try:\n            resp = self.post(\n                \"/blobs/digest/\",\n                json={\"algorithm\": \"dandi:dandi-etag\", \"value\": filetag},\n            )\n        except requests.HTTPError as e:\n            if e.response.status_code == 404:\n                lgr.debug(\"%s: Blob does not already exist on server\", asset_path)\n                blob_exists = False\n            else:\n                raise\n```\nplease just proceed to `/uploads/initialize/` and react to 409 to decide that blob is already there .  That would make code more robust and avoid race condition if the same blob is uploaded meanwhile and then `initialize` would return 409.\n\nAlso please add `yield {\"status\": \"initiating upload\"}` right before then since otherwise client would show `{'status': 'calculating etag'}` for awhile although already proceeding to upload","files":null}]}