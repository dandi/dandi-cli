{"version":2,"ops":[{"type":1,"author":{"id":"34bb3b7763ea6d04cae1c21ede40209df34305b5"},"timestamp":1614617422,"metadata":{"github-id":"MDU6SXNzdWU4MTkwNTUyOTg=","github-url":"https://github.com/dandi/dandi-cli/issues/439","origin":"github"},"title":"schema conversion: allow for prenatal sessions (and generally wrong session datetime)","message":"ATM we have in dandi-api-datasets:\n```\n*$\u003e head -n 30 000045/CONVERSION.errors\nsub-a92164cc-6d0a-48d7-9cf8-ab4db11a7133/sub-a92164cc-6d0a-48d7-9cf8-ab4db11a7133_ses-13e2522c-4590-48ea-90f2-55e911ab43e4_behavior+image.nwb\nTraceback (most recent call last):\n  File \"tools/populate_dandiset_asset_yamls.py\", line 53, in main\n    metadata = nwb2asset(\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 319, in nwb2asset\n    asset = metadata2asset(metadata)\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 345, in metadata2asset\n    return extract_model(models.BareAssetMeta, metadata)\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 234, in extract_model\n    value = kwargs.get(field, extract_field(field, metadata))\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 306, in extract_field\n    return FIELD_EXTRACTORS[field](metadata)\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 243, in func\n    m = extract_model(\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 234, in extract_model\n    value = kwargs.get(field, extract_field(field, metadata))\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 306, in extract_field\n    return FIELD_EXTRACTORS[field](metadata)\n  File \"/home/dandi/cronlib/dandi-api-datasets/.cronlib/venv/lib/python3.8/site-packages/dandi/metadata.py\", line 128, in extract_age\n    raise ValueError(\"session_start_time precedes date_of_birth\")\nValueError: session_start_time precedes date_of_birth\n```\n\nand indeed DOB is after the session date/time but also age has `P` prefix for prenatal AFAIK ... so we should not crash on that... \n```shell\ndrogon:/home/dandi/cronlib/dandi-api-datasets\n$\u003e DANDI_DEVEL=1 DANDI_CACHE=ignore  dandi -l debug ls  /mnt/backup/dandi/dandisets/000045/sub-a92164cc-6d0a-48d7-9cf8-ab4db11a7133/sub-a92164cc-6d0a-48d7-9cf8-ab4db11a7133_ses-1dabf56f-4a6a-4f42-8cc1-eb7c96b04f2f_behavior+image.nwb\n2021-03-01 11:48:34,272 [   DEBUG] Running a newer version (0.10.0+200.g32647ba.dirty) of dandi/dandi-cli than available (0.10.0)\n/home/yoh/miniconda3/envs/dandi-devel/lib/python3.8/site-packages/hdmf/spec/namespace.py:484: UserWarning: Ignoring cached namespace 'hdmf-common' version 1.2.0 because version 1.3.0 is already loaded.\n  warn(\"Ignoring cached namespace '%s' version %s because version %s is already loaded.\"\n/home/yoh/miniconda3/envs/dandi-devel/lib/python3.8/site-packages/pynwb/misc.py:270: UserWarning: It is best practice to set `source_timeseries` if it is present to document where the DecompositionSeries was derived from. (Optional)\n  warnings.warn(\"It is best practice to set `source_timeseries` if it is present to document \"\n- age: P25W\n  date_of_birth: 2020-05-26 00:00:00+00:00\n  experiment_description: ibl_neuropixel_brainwide_01\n  experimenter:\n  - ines\n  - miles\n  genotype: ''\n  identifier: 1dabf56f-4a6a-4f42-8cc1-eb7c96b04f2f\n  institution: Champalimaud Centre for the Unknown\n  keywords:\n  - ines,miles\n  - mainenlab\n  - IBL\n  lab: mainenlab\n  nd_types:\n  - BehavioralTimeSeries\n  - DecompositionSeries\n  - Device\n  - DynamicTable\n  - IblSessionData\n  - IblSubject\n  - ImageSeries\n  - ProcessingModule\n  - TimeIntervals (2)\n  - TimeSeries\n  number_of_electrodes: 0\n  number_of_units: 0\n  nwb_version: 2.2.5\n  path: /mnt/backup/dandi/dandisets/000045/sub-a92164cc-6d0a-48d7-9cf8-ab4db11a7133/sub-a92164cc-6d0a-48d7-9cf8-ab4db11a7133_ses-1dabf56f-4a6a-4f42-8cc1-eb7c96b04f2f_behavior+image.nwb\n  related_publications: null\n  session_description: Behavior training/tasks\n  session_id: 1dabf56f-4a6a-4f42-8cc1-eb7c96b04f2f\n  session_start_time: 2020-03-02 15:24:38+00:00\n  sex: F\n  size: 12196763\n  species: Laboratory mouse\n  subject_id: a92164cc-6d0a-48d7-9cf8-ab4db11a7133\n2021-03-01 11:48:37,807 [    INFO] Logs saved in /home/yoh/.cache/dandi-cli/log/20210301164833Z-25316.log\n```\n\nalso in general, I think this check is more appropriate for validation stage, not conversion, so even if not prenatal - we should just let it go forward without crashing","files":null}]}